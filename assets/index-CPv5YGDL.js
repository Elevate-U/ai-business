import{l as ys,K as go,H as ms,J as fa,_ as Mn,x as pa,a as vo,d as B,y as ie,k as vt,R as _s,p as ga,q as va,A as me,T as ya,E as ma}from"./react-vendor-BYlzYzcd.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();var _a=0;function l(n,e,t,r,s,i){e||(e={});var o,a,c=e;if("ref"in c)for(a in c={},e)a=="ref"?o=e[a]:c[a]=e[a];var u={type:n,props:c,key:t,ref:o,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:--_a,__i:-1,__u:0,__source:s,__self:i};if(typeof n=="function"&&(o=n.defaultProps))for(a in o)c[a]===void 0&&(c[a]=o[a]);return ys.vnode&&ys.vnode(u),u}var wa={};function $t(n,e){for(var t in e)n[t]=e[t];return n}function Pn(n,e,t){var r,s=/(?:\?([^#]*))?(#.*)?$/,i=n.match(s),o={};if(i&&i[1])for(var a=i[1].split("&"),c=0;c<a.length;c++){var u=a[c].split("=");o[decodeURIComponent(u[0])]=decodeURIComponent(u.slice(1).join("="))}n=kn(n.replace(s,"")),e=kn(e||"");for(var d=Math.max(n.length,e.length),h=0;h<d;h++)if(e[h]&&e[h].charAt(0)===":"){var f=e[h].replace(/(^:|[+*?]+$)/g,""),p=(e[h].match(/[+*?]+$/)||wa)[0]||"",y=~p.indexOf("+"),v=~p.indexOf("*"),g=n[h]||"";if(!g&&!v&&(p.indexOf("?")<0||y)){r=!1;break}if(o[f]=decodeURIComponent(g),y||v){o[f]=n.slice(h).map(decodeURIComponent).join("/");break}}else if(e[h]!==n[h]){r=!1;break}return(t.default===!0||r!==!1)&&o}function ba(n,e){return n.rank<e.rank?1:n.rank>e.rank?-1:n.index-e.index}function Sa(n,e){return n.index=e,n.rank=function(t){return t.props.default?0:kn(t.props.path).map(Ta).join("")}(n),n.props}function kn(n){return n.replace(/(^\/+|\/+$)/g,"").split("/")}function Ta(n){return n.charAt(0)==":"?1+"*+?".indexOf(n.charAt(n.length-1))||4:5}var Ea={},Qe=[],Ot=[],Ee=null,Fn={url:Bn()},yo=go(Fn);function Pa(){var n=vo(yo);if(n===Fn){var e=B()[1];ie(function(){return Ot.push(e),function(){return Ot.splice(Ot.indexOf(e),1)}},[])}return[n,je]}function Bn(){var n;return""+((n=Ee&&Ee.location?Ee.location:Ee&&Ee.getCurrentLocation?Ee.getCurrentLocation():typeof location<"u"?location:Ea).pathname||"")+(n.search||"")}function je(n,e){return e===void 0&&(e=!1),typeof n!="string"&&n.url&&(e=n.replace,n=n.url),function(t){for(var r=Qe.length;r--;)if(Qe[r].canRoute(t))return!0;return!1}(n)&&function(t,r){r===void 0&&(r="push"),Ee&&Ee[r]?Ee[r](t):typeof history<"u"&&history[r+"State"]&&history[r+"State"](null,null,t)}(n,e?"replace":"push"),mo(n)}function mo(n){for(var e=!1,t=0;t<Qe.length;t++)Qe[t].routeTo(n)&&(e=!0);return e}function ka(n){if(n&&n.getAttribute){var e=n.getAttribute("href"),t=n.getAttribute("target");if(e&&e.match(/^\//g)&&(!t||t.match(/^_?self$/i)))return je(e)}}function Aa(n){return n.stopImmediatePropagation&&n.stopImmediatePropagation(),n.stopPropagation&&n.stopPropagation(),n.preventDefault(),!1}function _o(n){if(!(n.ctrlKey||n.metaKey||n.altKey||n.shiftKey||n.button)){var e=n.target;do if(e.localName==="a"&&e.getAttribute("href")){if(e.hasAttribute("data-native")||e.hasAttribute("native"))return;if(ka(e))return Aa(n)}while(e=e.parentNode)}}var ws=!1;function wo(n){n.history&&(Ee=n.history),this.state={url:n.url||Bn()}}$t(wo.prototype=new pa,{shouldComponentUpdate:function(n){return n.static!==!0||n.url!==this.props.url||n.onChange!==this.props.onChange},canRoute:function(n){var e=ms(this.props.children);return this.g(e,n)!==void 0},routeTo:function(n){this.setState({url:n});var e=this.canRoute(n);return this.p||this.forceUpdate(),e},componentWillMount:function(){this.p=!0},componentDidMount:function(){var n=this;ws||(ws=!0,Ee||addEventListener("popstate",function(){mo(Bn())}),addEventListener("click",_o)),Qe.push(this),Ee&&(this.u=Ee.listen(function(e){var t=e.location||e;n.routeTo(""+(t.pathname||"")+(t.search||""))})),this.p=!1},componentWillUnmount:function(){typeof this.u=="function"&&this.u(),Qe.splice(Qe.indexOf(this),1)},componentWillUpdate:function(){this.p=!0},componentDidUpdate:function(){this.p=!1},g:function(n,e){n=n.filter(Sa).sort(ba);for(var t=0;t<n.length;t++){var r=n[t],s=Pn(e,r.props.path,r.props);if(s)return[r,s]}},render:function(n,e){var t,r,s=n.onChange,i=e.url,o=this.c,a=this.g(ms(n.children),i);if(a&&(r=fa(a[0],$t($t({url:i,matches:t=a[1]},t),{key:void 0,ref:void 0}))),i!==(o&&o.url)){$t(Fn,o=this.c={url:i,previous:o&&o.url,current:r,path:r?r.props.path:null,matches:t}),o.router=this,o.active=r?[r]:[];for(var c=Ot.length;c--;)Ot[c]({});typeof s=="function"&&s(o)}return Mn(yo.Provider,{value:o},r)}});var Oe=function(n){return Mn("a",$t({onClick:_o},n))};function zt(){return zt=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},zt.apply(null,arguments)}var yt;(function(n){n.Pop="POP",n.Push="PUSH",n.Replace="REPLACE"})(yt||(yt={}));var bs=function(n){return n},Ss="beforeunload",$a="hashchange",Ra="popstate";function Oa(n){n===void 0&&(n={});var e=n,t=e.window,r=t===void 0?document.defaultView:t,s=r.history;function i(){var $=Ps(r.location.hash.substr(1)),M=$.pathname,Z=M===void 0?"/":M,G=$.search,re=G===void 0?"":G,oe=$.hash,ee=oe===void 0?"":oe,he=s.state||{};return[he.idx,bs({pathname:Z,search:re,hash:ee,state:he.usr||null,key:he.key||"default"})]}var o=null;function a(){if(o)p.call(o),o=null;else{var $=yt.Pop,M=i(),Z=M[0],G=M[1];if(p.length){if(Z!=null){var re=d-Z;re&&(o={action:$,location:G,retry:function(){x(re*-1)}},x(re))}}else _($)}}r.addEventListener(Ra,a),r.addEventListener($a,function(){var $=i(),M=$[1];ar(M)!==ar(h)&&a()});var c=yt.Pop,u=i(),d=u[0],h=u[1],f=Es(),p=Es();d==null&&(d=0,s.replaceState(zt({},s.state,{idx:d}),""));function y(){var $=document.querySelector("base"),M="";if($&&$.getAttribute("href")){var Z=r.location.href,G=Z.indexOf("#");M=G===-1?Z:Z.slice(0,G)}return M}function v($){return y()+"#"+(typeof $=="string"?$:ar($))}function g($,M){return M===void 0&&(M=null),bs(zt({pathname:h.pathname,hash:"",search:""},typeof $=="string"?Ps($):$,{state:M,key:ja()}))}function w($,M){return[{usr:$.state,key:$.key,idx:M},v($)]}function E($,M,Z){return!p.length||(p.call({action:$,location:M,retry:Z}),!1)}function _($){c=$;var M=i();d=M[0],h=M[1],f.call({action:c,location:h})}function P($,M){var Z=yt.Push,G=g($,M);function re(){P($,M)}if(E(Z,G,re)){var oe=w(G,d+1),ee=oe[0],he=oe[1];try{s.pushState(ee,"",he)}catch{r.location.assign(he)}_(Z)}}function b($,M){var Z=yt.Replace,G=g($,M);function re(){b($,M)}if(E(Z,G,re)){var oe=w(G,d),ee=oe[0],he=oe[1];s.replaceState(ee,"",he),_(Z)}}function x($){s.go($)}var D={get action(){return c},get location(){return h},createHref:v,push:P,replace:b,go:x,back:function(){x(-1)},forward:function(){x(1)},listen:function(M){return f.push(M)},block:function(M){var Z=p.push(M);return p.length===1&&r.addEventListener(Ss,Ts),function(){Z(),p.length||r.removeEventListener(Ss,Ts)}}};return D}function Ts(n){n.preventDefault(),n.returnValue=""}function Es(){var n=[];return{get length(){return n.length},push:function(t){return n.push(t),function(){n=n.filter(function(r){return r!==t})}},call:function(t){n.forEach(function(r){return r&&r(t)})}}}function ja(){return Math.random().toString(36).substr(2,8)}function ar(n){var e=n.pathname,t=e===void 0?"/":e,r=n.search,s=r===void 0?"":r,i=n.hash,o=i===void 0?"":i;return s&&s!=="?"&&(t+=s.charAt(0)==="?"?s:"?"+s),o&&o!=="#"&&(t+=o.charAt(0)==="#"?o:"#"+o),t}function Ps(n){var e={};if(n){var t=n.indexOf("#");t>=0&&(e.hash=n.substr(t),n=n.substr(0,t));var r=n.indexOf("?");r>=0&&(e.search=n.substr(r),n=n.substr(0,r)),n&&(e.pathname=n)}return e}const Ia="modulepreload",xa=function(n){return"/"+n},ks={},Dt=function(e,t,r){let s=Promise.resolve();if(t&&t.length>0){let c=function(u){return Promise.all(u.map(d=>Promise.resolve(d).then(h=>({status:"fulfilled",value:h}),h=>({status:"rejected",reason:h}))))};document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),a=o?.nonce||o?.getAttribute("nonce");s=c(t.map(u=>{if(u=xa(u),u in ks)return;ks[u]=!0;const d=u.endsWith(".css"),h=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${u}"]${h}`))return;const f=document.createElement("link");if(f.rel=d?"stylesheet":Ia,d||(f.as="script"),f.crossOrigin="",f.href=u,a&&f.setAttribute("nonce",a),document.head.appendChild(f),d)return new Promise((p,y)=>{f.addEventListener("load",p),f.addEventListener("error",()=>y(new Error(`Unable to preload CSS for ${u}`)))})}))}function i(o){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=o,window.dispatchEvent(a),!a.defaultPrevented)throw o}return s.then(o=>{for(const a of o||[])a.status==="rejected"&&i(a.reason);return e().catch(i)})},Ca=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>Dt(async()=>{const{default:r}=await Promise.resolve().then(()=>St);return{default:r}},void 0).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)};class Hn extends Error{constructor(e,t="FunctionsError",r){super(e),this.name=t,this.context=r}}class Ua extends Hn{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class As extends Hn{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class $s extends Hn{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var An;(function(n){n.Any="any",n.ApNortheast1="ap-northeast-1",n.ApNortheast2="ap-northeast-2",n.ApSouth1="ap-south-1",n.ApSoutheast1="ap-southeast-1",n.ApSoutheast2="ap-southeast-2",n.CaCentral1="ca-central-1",n.EuCentral1="eu-central-1",n.EuWest1="eu-west-1",n.EuWest2="eu-west-2",n.EuWest3="eu-west-3",n.SaEast1="sa-east-1",n.UsEast1="us-east-1",n.UsWest1="us-west-1",n.UsWest2="us-west-2"})(An||(An={}));var Da=function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(d){try{u(r.next(d))}catch(h){o(h)}}function c(d){try{u(r.throw(d))}catch(h){o(h)}}function u(d){d.done?i(d.value):s(d.value).then(a,c)}u((r=r.apply(n,e||[])).next())})};class La{constructor(e,{headers:t={},customFetch:r,region:s=An.Any}={}){this.url=e,this.headers=t,this.region=s,this.fetch=Ca(r)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var r;return Da(this,void 0,void 0,function*(){try{const{headers:s,method:i,body:o}=t;let a={},{region:c}=t;c||(c=this.region);const u=new URL(`${this.url}/${e}`);c&&c!=="any"&&(a["x-region"]=c,u.searchParams.set("forceFunctionRegion",c));let d;o&&(s&&!Object.prototype.hasOwnProperty.call(s,"Content-Type")||!s)&&(typeof Blob<"u"&&o instanceof Blob||o instanceof ArrayBuffer?(a["Content-Type"]="application/octet-stream",d=o):typeof o=="string"?(a["Content-Type"]="text/plain",d=o):typeof FormData<"u"&&o instanceof FormData?d=o:(a["Content-Type"]="application/json",d=JSON.stringify(o)));const h=yield this.fetch(u.toString(),{method:i||"POST",headers:Object.assign(Object.assign(Object.assign({},a),this.headers),s),body:d}).catch(v=>{throw new Ua(v)}),f=h.headers.get("x-relay-error");if(f&&f==="true")throw new As(h);if(!h.ok)throw new $s(h);let p=((r=h.headers.get("Content-Type"))!==null&&r!==void 0?r:"text/plain").split(";")[0].trim(),y;return p==="application/json"?y=yield h.json():p==="application/octet-stream"?y=yield h.blob():p==="text/event-stream"?y=h:p==="multipart/form-data"?y=yield h.formData():y=yield h.text(),{data:y,error:null,response:h}}catch(s){return{data:null,error:s,response:s instanceof $s||s instanceof As?s.context:void 0}}})}}function bo(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function So(n){if(Object.prototype.hasOwnProperty.call(n,"__esModule"))return n;var e=n.default;if(typeof e=="function"){var t=function r(){var s=!1;try{s=this instanceof r}catch{}return s?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(r){var s=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(t,r,s.get?s:{enumerable:!0,get:function(){return n[r]}})}),t}var ue={},it={},ot={},at={},ct={},lt={},Na=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},mt=Na();const qa=mt.fetch,To=mt.fetch.bind(mt),Eo=mt.Headers,Ma=mt.Request,Fa=mt.Response,St=Object.freeze(Object.defineProperty({__proto__:null,Headers:Eo,Request:Ma,Response:Fa,default:To,fetch:qa},Symbol.toStringTag,{value:"Module"})),Ba=So(St);var Mt={},Rs;function Po(){if(Rs)return Mt;Rs=1,Object.defineProperty(Mt,"__esModule",{value:!0});class n extends Error{constructor(t){super(t.message),this.name="PostgrestError",this.details=t.details,this.hint=t.hint,this.code=t.code}}return Mt.default=n,Mt}var Os;function ko(){if(Os)return lt;Os=1;var n=lt&&lt.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(lt,"__esModule",{value:!0});const e=n(Ba),t=n(Po());class r{constructor(i){this.shouldThrowOnError=!1,this.method=i.method,this.url=i.url,this.headers=i.headers,this.schema=i.schema,this.body=i.body,this.shouldThrowOnError=i.shouldThrowOnError,this.signal=i.signal,this.isMaybeSingle=i.isMaybeSingle,i.fetch?this.fetch=i.fetch:typeof fetch>"u"?this.fetch=e.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(i,o){return this.headers=Object.assign({},this.headers),this.headers[i]=o,this}then(i,o){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");const a=this.fetch;let c=a(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async u=>{var d,h,f;let p=null,y=null,v=null,g=u.status,w=u.statusText;if(u.ok){if(this.method!=="HEAD"){const b=await u.text();b===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?y=b:y=JSON.parse(b))}const _=(d=this.headers.Prefer)===null||d===void 0?void 0:d.match(/count=(exact|planned|estimated)/),P=(h=u.headers.get("content-range"))===null||h===void 0?void 0:h.split("/");_&&P&&P.length>1&&(v=parseInt(P[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(y)&&(y.length>1?(p={code:"PGRST116",details:`Results contain ${y.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},y=null,v=null,g=406,w="Not Acceptable"):y.length===1?y=y[0]:y=null)}else{const _=await u.text();try{p=JSON.parse(_),Array.isArray(p)&&u.status===404&&(y=[],p=null,g=200,w="OK")}catch{u.status===404&&_===""?(g=204,w="No Content"):p={message:_}}if(p&&this.isMaybeSingle&&(!((f=p?.details)===null||f===void 0)&&f.includes("0 rows"))&&(p=null,g=200,w="OK"),p&&this.shouldThrowOnError)throw new t.default(p)}return{error:p,data:y,count:v,status:g,statusText:w}});return this.shouldThrowOnError||(c=c.catch(u=>{var d,h,f;return{error:{message:`${(d=u?.name)!==null&&d!==void 0?d:"FetchError"}: ${u?.message}`,details:`${(h=u?.stack)!==null&&h!==void 0?h:""}`,hint:"",code:`${(f=u?.code)!==null&&f!==void 0?f:""}`},data:null,count:null,status:0,statusText:""}})),c.then(i,o)}returns(){return this}overrideTypes(){return this}}return lt.default=r,lt}var js;function Ao(){if(js)return ct;js=1;var n=ct&&ct.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(ct,"__esModule",{value:!0});const e=n(ko());class t extends e.default{select(s){let i=!1;const o=(s??"*").split("").map(a=>/\s/.test(a)&&!i?"":(a==='"'&&(i=!i),a)).join("");return this.url.searchParams.set("select",o),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(s,{ascending:i=!0,nullsFirst:o,foreignTable:a,referencedTable:c=a}={}){const u=c?`${c}.order`:"order",d=this.url.searchParams.get(u);return this.url.searchParams.set(u,`${d?`${d},`:""}${s}.${i?"asc":"desc"}${o===void 0?"":o?".nullsfirst":".nullslast"}`),this}limit(s,{foreignTable:i,referencedTable:o=i}={}){const a=typeof o>"u"?"limit":`${o}.limit`;return this.url.searchParams.set(a,`${s}`),this}range(s,i,{foreignTable:o,referencedTable:a=o}={}){const c=typeof a>"u"?"offset":`${a}.offset`,u=typeof a>"u"?"limit":`${a}.limit`;return this.url.searchParams.set(c,`${s}`),this.url.searchParams.set(u,`${i-s+1}`),this}abortSignal(s){return this.signal=s,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:s=!1,verbose:i=!1,settings:o=!1,buffers:a=!1,wal:c=!1,format:u="text"}={}){var d;const h=[s?"analyze":null,i?"verbose":null,o?"settings":null,a?"buffers":null,c?"wal":null].filter(Boolean).join("|"),f=(d=this.headers.Accept)!==null&&d!==void 0?d:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${u}; for="${f}"; options=${h};`,u==="json"?this:this}rollback(){var s;return((s=this.headers.Prefer)!==null&&s!==void 0?s:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}}return ct.default=t,ct}var Is;function Wn(){if(Is)return at;Is=1;var n=at&&at.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(at,"__esModule",{value:!0});const e=n(Ao());class t extends e.default{eq(s,i){return this.url.searchParams.append(s,`eq.${i}`),this}neq(s,i){return this.url.searchParams.append(s,`neq.${i}`),this}gt(s,i){return this.url.searchParams.append(s,`gt.${i}`),this}gte(s,i){return this.url.searchParams.append(s,`gte.${i}`),this}lt(s,i){return this.url.searchParams.append(s,`lt.${i}`),this}lte(s,i){return this.url.searchParams.append(s,`lte.${i}`),this}like(s,i){return this.url.searchParams.append(s,`like.${i}`),this}likeAllOf(s,i){return this.url.searchParams.append(s,`like(all).{${i.join(",")}}`),this}likeAnyOf(s,i){return this.url.searchParams.append(s,`like(any).{${i.join(",")}}`),this}ilike(s,i){return this.url.searchParams.append(s,`ilike.${i}`),this}ilikeAllOf(s,i){return this.url.searchParams.append(s,`ilike(all).{${i.join(",")}}`),this}ilikeAnyOf(s,i){return this.url.searchParams.append(s,`ilike(any).{${i.join(",")}}`),this}is(s,i){return this.url.searchParams.append(s,`is.${i}`),this}in(s,i){const o=Array.from(new Set(i)).map(a=>typeof a=="string"&&new RegExp("[,()]").test(a)?`"${a}"`:`${a}`).join(",");return this.url.searchParams.append(s,`in.(${o})`),this}contains(s,i){return typeof i=="string"?this.url.searchParams.append(s,`cs.${i}`):Array.isArray(i)?this.url.searchParams.append(s,`cs.{${i.join(",")}}`):this.url.searchParams.append(s,`cs.${JSON.stringify(i)}`),this}containedBy(s,i){return typeof i=="string"?this.url.searchParams.append(s,`cd.${i}`):Array.isArray(i)?this.url.searchParams.append(s,`cd.{${i.join(",")}}`):this.url.searchParams.append(s,`cd.${JSON.stringify(i)}`),this}rangeGt(s,i){return this.url.searchParams.append(s,`sr.${i}`),this}rangeGte(s,i){return this.url.searchParams.append(s,`nxl.${i}`),this}rangeLt(s,i){return this.url.searchParams.append(s,`sl.${i}`),this}rangeLte(s,i){return this.url.searchParams.append(s,`nxr.${i}`),this}rangeAdjacent(s,i){return this.url.searchParams.append(s,`adj.${i}`),this}overlaps(s,i){return typeof i=="string"?this.url.searchParams.append(s,`ov.${i}`):this.url.searchParams.append(s,`ov.{${i.join(",")}}`),this}textSearch(s,i,{config:o,type:a}={}){let c="";a==="plain"?c="pl":a==="phrase"?c="ph":a==="websearch"&&(c="w");const u=o===void 0?"":`(${o})`;return this.url.searchParams.append(s,`${c}fts${u}.${i}`),this}match(s){return Object.entries(s).forEach(([i,o])=>{this.url.searchParams.append(i,`eq.${o}`)}),this}not(s,i,o){return this.url.searchParams.append(s,`not.${i}.${o}`),this}or(s,{foreignTable:i,referencedTable:o=i}={}){const a=o?`${o}.or`:"or";return this.url.searchParams.append(a,`(${s})`),this}filter(s,i,o){return this.url.searchParams.append(s,`${i}.${o}`),this}}return at.default=t,at}var xs;function $o(){if(xs)return ot;xs=1;var n=ot&&ot.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(ot,"__esModule",{value:!0});const e=n(Wn());class t{constructor(s,{headers:i={},schema:o,fetch:a}){this.url=s,this.headers=i,this.schema=o,this.fetch=a}select(s,{head:i=!1,count:o}={}){const a=i?"HEAD":"GET";let c=!1;const u=(s??"*").split("").map(d=>/\s/.test(d)&&!c?"":(d==='"'&&(c=!c),d)).join("");return this.url.searchParams.set("select",u),o&&(this.headers.Prefer=`count=${o}`),new e.default({method:a,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(s,{count:i,defaultToNull:o=!0}={}){const a="POST",c=[];if(this.headers.Prefer&&c.push(this.headers.Prefer),i&&c.push(`count=${i}`),o||c.push("missing=default"),this.headers.Prefer=c.join(","),Array.isArray(s)){const u=s.reduce((d,h)=>d.concat(Object.keys(h)),[]);if(u.length>0){const d=[...new Set(u)].map(h=>`"${h}"`);this.url.searchParams.set("columns",d.join(","))}}return new e.default({method:a,url:this.url,headers:this.headers,schema:this.schema,body:s,fetch:this.fetch,allowEmpty:!1})}upsert(s,{onConflict:i,ignoreDuplicates:o=!1,count:a,defaultToNull:c=!0}={}){const u="POST",d=[`resolution=${o?"ignore":"merge"}-duplicates`];if(i!==void 0&&this.url.searchParams.set("on_conflict",i),this.headers.Prefer&&d.push(this.headers.Prefer),a&&d.push(`count=${a}`),c||d.push("missing=default"),this.headers.Prefer=d.join(","),Array.isArray(s)){const h=s.reduce((f,p)=>f.concat(Object.keys(p)),[]);if(h.length>0){const f=[...new Set(h)].map(p=>`"${p}"`);this.url.searchParams.set("columns",f.join(","))}}return new e.default({method:u,url:this.url,headers:this.headers,schema:this.schema,body:s,fetch:this.fetch,allowEmpty:!1})}update(s,{count:i}={}){const o="PATCH",a=[];return this.headers.Prefer&&a.push(this.headers.Prefer),i&&a.push(`count=${i}`),this.headers.Prefer=a.join(","),new e.default({method:o,url:this.url,headers:this.headers,schema:this.schema,body:s,fetch:this.fetch,allowEmpty:!1})}delete({count:s}={}){const i="DELETE",o=[];return s&&o.push(`count=${s}`),this.headers.Prefer&&o.unshift(this.headers.Prefer),this.headers.Prefer=o.join(","),new e.default({method:i,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}}return ot.default=t,ot}var kt={},At={},Cs;function Ha(){return Cs||(Cs=1,Object.defineProperty(At,"__esModule",{value:!0}),At.version=void 0,At.version="0.0.0-automated"),At}var Us;function Wa(){if(Us)return kt;Us=1,Object.defineProperty(kt,"__esModule",{value:!0}),kt.DEFAULT_HEADERS=void 0;const n=Ha();return kt.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${n.version}`},kt}var Ds;function Ga(){if(Ds)return it;Ds=1;var n=it&&it.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(it,"__esModule",{value:!0});const e=n($o()),t=n(Wn()),r=Wa();class s{constructor(o,{headers:a={},schema:c,fetch:u}={}){this.url=o,this.headers=Object.assign(Object.assign({},r.DEFAULT_HEADERS),a),this.schemaName=c,this.fetch=u}from(o){const a=new URL(`${this.url}/${o}`);return new e.default(a,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(o){return new s(this.url,{headers:this.headers,schema:o,fetch:this.fetch})}rpc(o,a={},{head:c=!1,get:u=!1,count:d}={}){let h;const f=new URL(`${this.url}/rpc/${o}`);let p;c||u?(h=c?"HEAD":"GET",Object.entries(a).filter(([v,g])=>g!==void 0).map(([v,g])=>[v,Array.isArray(g)?`{${g.join(",")}}`:`${g}`]).forEach(([v,g])=>{f.searchParams.append(v,g)})):(h="POST",p=a);const y=Object.assign({},this.headers);return d&&(y.Prefer=`count=${d}`),new t.default({method:h,url:f,headers:y,schema:this.schemaName,body:p,fetch:this.fetch,allowEmpty:!1})}}return it.default=s,it}var Ls;function Ka(){if(Ls)return ue;Ls=1;var n=ue&&ue.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(ue,"__esModule",{value:!0}),ue.PostgrestError=ue.PostgrestBuilder=ue.PostgrestTransformBuilder=ue.PostgrestFilterBuilder=ue.PostgrestQueryBuilder=ue.PostgrestClient=void 0;const e=n(Ga());ue.PostgrestClient=e.default;const t=n($o());ue.PostgrestQueryBuilder=t.default;const r=n(Wn());ue.PostgrestFilterBuilder=r.default;const s=n(Ao());ue.PostgrestTransformBuilder=s.default;const i=n(ko());ue.PostgrestBuilder=i.default;const o=n(Po());return ue.PostgrestError=o.default,ue.default={PostgrestClient:e.default,PostgrestQueryBuilder:t.default,PostgrestFilterBuilder:r.default,PostgrestTransformBuilder:s.default,PostgrestBuilder:i.default,PostgrestError:o.default},ue}var Va=Ka();const za=bo(Va),{PostgrestClient:Ja,PostgrestQueryBuilder:Xu,PostgrestFilterBuilder:Zu,PostgrestTransformBuilder:ed,PostgrestBuilder:td,PostgrestError:rd}=za;function Ya(){if(typeof WebSocket<"u")return WebSocket;if(typeof global.WebSocket<"u")return global.WebSocket;if(typeof window.WebSocket<"u")return window.WebSocket;if(typeof self.WebSocket<"u")return self.WebSocket;throw new Error("`WebSocket` is not supported in this environment")}const Qa=Ya(),Xa="2.11.15",Za=`realtime-js/${Xa}`,ec="1.0.0",Ro=1e4,tc=1e3;var jt;(function(n){n[n.connecting=0]="connecting",n[n.open=1]="open",n[n.closing=2]="closing",n[n.closed=3]="closed"})(jt||(jt={}));var ge;(function(n){n.closed="closed",n.errored="errored",n.joined="joined",n.joining="joining",n.leaving="leaving"})(ge||(ge={}));var Ae;(function(n){n.close="phx_close",n.error="phx_error",n.join="phx_join",n.reply="phx_reply",n.leave="phx_leave",n.access_token="access_token"})(Ae||(Ae={}));var $n;(function(n){n.websocket="websocket"})($n||($n={}));var Ye;(function(n){n.Connecting="connecting",n.Open="open",n.Closing="closing",n.Closed="closed"})(Ye||(Ye={}));class rc{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),r=new TextDecoder;return this._decodeBroadcast(e,t,r)}_decodeBroadcast(e,t,r){const s=t.getUint8(1),i=t.getUint8(2);let o=this.HEADER_LENGTH+2;const a=r.decode(e.slice(o,o+s));o=o+s;const c=r.decode(e.slice(o,o+i));o=o+i;const u=JSON.parse(r.decode(e.slice(o,e.byteLength)));return{ref:null,topic:a,event:c,payload:u}}}class Oo{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var ne;(function(n){n.abstime="abstime",n.bool="bool",n.date="date",n.daterange="daterange",n.float4="float4",n.float8="float8",n.int2="int2",n.int4="int4",n.int4range="int4range",n.int8="int8",n.int8range="int8range",n.json="json",n.jsonb="jsonb",n.money="money",n.numeric="numeric",n.oid="oid",n.reltime="reltime",n.text="text",n.time="time",n.timestamp="timestamp",n.timestamptz="timestamptz",n.timetz="timetz",n.tsrange="tsrange",n.tstzrange="tstzrange"})(ne||(ne={}));const Ns=(n,e,t={})=>{var r;const s=(r=t.skipTypes)!==null&&r!==void 0?r:[];return Object.keys(e).reduce((i,o)=>(i[o]=nc(o,n,e,s),i),{})},nc=(n,e,t,r)=>{const s=e.find(a=>a.name===n),i=s?.type,o=t[n];return i&&!r.includes(i)?jo(i,o):Rn(o)},jo=(n,e)=>{if(n.charAt(0)==="_"){const t=n.slice(1,n.length);return ac(e,t)}switch(n){case ne.bool:return sc(e);case ne.float4:case ne.float8:case ne.int2:case ne.int4:case ne.int8:case ne.numeric:case ne.oid:return ic(e);case ne.json:case ne.jsonb:return oc(e);case ne.timestamp:return cc(e);case ne.abstime:case ne.date:case ne.daterange:case ne.int4range:case ne.int8range:case ne.money:case ne.reltime:case ne.text:case ne.time:case ne.timestamptz:case ne.timetz:case ne.tsrange:case ne.tstzrange:return Rn(e);default:return Rn(e)}},Rn=n=>n,sc=n=>{switch(n){case"t":return!0;case"f":return!1;default:return n}},ic=n=>{if(typeof n=="string"){const e=parseFloat(n);if(!Number.isNaN(e))return e}return n},oc=n=>{if(typeof n=="string")try{return JSON.parse(n)}catch(e){return console.log(`JSON parse error: ${e}`),n}return n},ac=(n,e)=>{if(typeof n!="string")return n;const t=n.length-1,r=n[t];if(n[0]==="{"&&r==="}"){let i;const o=n.slice(1,t);try{i=JSON.parse("["+o+"]")}catch{i=o?o.split(","):[]}return i.map(a=>jo(e,a))}return n},cc=n=>typeof n=="string"?n.replace(" ","T"):n,Io=n=>{let e=n;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")};class cr{constructor(e,t,r={},s=Ro){this.channel=e,this.event=t,this.payload=r,this.timeout=s,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var r;return this._hasReceived(e)&&t((r=this.receivedResp)===null||r===void 0?void 0:r.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(r=>r.status===e).forEach(r=>r.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var qs;(function(n){n.SYNC="sync",n.JOIN="join",n.LEAVE="leave"})(qs||(qs={}));class It{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=t?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},s=>{const{onJoin:i,onLeave:o,onSync:a}=this.caller;this.joinRef=this.channel._joinRef(),this.state=It.syncState(this.state,s,i,o),this.pendingDiffs.forEach(c=>{this.state=It.syncDiff(this.state,c,i,o)}),this.pendingDiffs=[],a()}),this.channel._on(r.diff,{},s=>{const{onJoin:i,onLeave:o,onSync:a}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(s):(this.state=It.syncDiff(this.state,s,i,o),a())}),this.onJoin((s,i,o)=>{this.channel._trigger("presence",{event:"join",key:s,currentPresences:i,newPresences:o})}),this.onLeave((s,i,o)=>{this.channel._trigger("presence",{event:"leave",key:s,currentPresences:i,leftPresences:o})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,r,s){const i=this.cloneDeep(e),o=this.transformState(t),a={},c={};return this.map(i,(u,d)=>{o[u]||(c[u]=d)}),this.map(o,(u,d)=>{const h=i[u];if(h){const f=d.map(g=>g.presence_ref),p=h.map(g=>g.presence_ref),y=d.filter(g=>p.indexOf(g.presence_ref)<0),v=h.filter(g=>f.indexOf(g.presence_ref)<0);y.length>0&&(a[u]=y),v.length>0&&(c[u]=v)}else a[u]=d}),this.syncDiff(i,{joins:a,leaves:c},r,s)}static syncDiff(e,t,r,s){const{joins:i,leaves:o}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return r||(r=()=>{}),s||(s=()=>{}),this.map(i,(a,c)=>{var u;const d=(u=e[a])!==null&&u!==void 0?u:[];if(e[a]=this.cloneDeep(c),d.length>0){const h=e[a].map(p=>p.presence_ref),f=d.filter(p=>h.indexOf(p.presence_ref)<0);e[a].unshift(...f)}r(a,d,c)}),this.map(o,(a,c)=>{let u=e[a];if(!u)return;const d=c.map(h=>h.presence_ref);u=u.filter(h=>d.indexOf(h.presence_ref)<0),e[a]=u,s(a,u,c),u.length===0&&delete e[a]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(r=>t(r,e[r]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,r)=>{const s=e[r];return"metas"in s?t[r]=s.metas.map(i=>(i.presence_ref=i.phx_ref,delete i.phx_ref,delete i.phx_ref_prev,i)):t[r]=s,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var Ms;(function(n){n.ALL="*",n.INSERT="INSERT",n.UPDATE="UPDATE",n.DELETE="DELETE"})(Ms||(Ms={}));var Fs;(function(n){n.BROADCAST="broadcast",n.PRESENCE="presence",n.POSTGRES_CHANGES="postgres_changes",n.SYSTEM="system"})(Fs||(Fs={}));var Ne;(function(n){n.SUBSCRIBED="SUBSCRIBED",n.TIMED_OUT="TIMED_OUT",n.CLOSED="CLOSED",n.CHANNEL_ERROR="CHANNEL_ERROR"})(Ne||(Ne={}));class Gn{constructor(e,t={config:{}},r){this.topic=e,this.params=t,this.socket=r,this.bindings={},this.state=ge.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new cr(this,Ae.join,this.params,this.timeout),this.rejoinTimer=new Oo(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=ge.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(s=>s.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=ge.closed,this.socket._remove(this)}),this._onError(s=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,s),this.state=ge.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=ge.errored,this.rejoinTimer.scheduleTimeout())}),this._on(Ae.reply,{},(s,i)=>{this._trigger(this._replyEventName(i),s)}),this.presence=new It(this),this.broadcastEndpointURL=Io(this.socket.endPoint)+"/api/broadcast",this.private=this.params.config.private||!1}subscribe(e,t=this.timeout){var r,s;if(this.socket.isConnected()||this.socket.connect(),this.state==ge.closed){const{config:{broadcast:i,presence:o,private:a}}=this.params;this._onError(d=>e?.(Ne.CHANNEL_ERROR,d)),this._onClose(()=>e?.(Ne.CLOSED));const c={},u={broadcast:i,presence:o,postgres_changes:(s=(r=this.bindings.postgres_changes)===null||r===void 0?void 0:r.map(d=>d.filter))!==null&&s!==void 0?s:[],private:a};this.socket.accessTokenValue&&(c.access_token=this.socket.accessTokenValue),this.updateJoinPayload(Object.assign({config:u},c)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:d})=>{var h;if(this.socket.setAuth(),d===void 0){e?.(Ne.SUBSCRIBED);return}else{const f=this.bindings.postgres_changes,p=(h=f?.length)!==null&&h!==void 0?h:0,y=[];for(let v=0;v<p;v++){const g=f[v],{filter:{event:w,schema:E,table:_,filter:P}}=g,b=d&&d[v];if(b&&b.event===w&&b.schema===E&&b.table===_&&b.filter===P)y.push(Object.assign(Object.assign({},g),{id:b.id}));else{this.unsubscribe(),this.state=ge.errored,e?.(Ne.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=y,e&&e(Ne.SUBSCRIBED);return}}).receive("error",d=>{this.state=ge.errored,e?.(Ne.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(d).join(", ")||"error")))}).receive("timeout",()=>{e?.(Ne.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,r){return this._on(e,t,r)}async send(e,t={}){var r,s;if(!this._canPush()&&e.type==="broadcast"){const{event:i,payload:o}=e,c={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:o,private:this.private}]})};try{const u=await this._fetchWithTimeout(this.broadcastEndpointURL,c,(r=t.timeout)!==null&&r!==void 0?r:this.timeout);return await((s=u.body)===null||s===void 0?void 0:s.cancel()),u.ok?"ok":"error"}catch(u){return u.name==="AbortError"?"timed out":"error"}}else return new Promise(i=>{var o,a,c;const u=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((c=(a=(o=this.params)===null||o===void 0?void 0:o.config)===null||a===void 0?void 0:a.broadcast)===null||c===void 0)&&c.ack)&&i("ok"),u.receive("ok",()=>i("ok")),u.receive("error",()=>i("error")),u.receive("timeout",()=>i("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=ge.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(Ae.close,"leave",this._joinRef())};this.joinPush.destroy();let r=null;return new Promise(s=>{r=new cr(this,Ae.leave,{},e),r.receive("ok",()=>{t(),s("ok")}).receive("timeout",()=>{t(),s("timed out")}).receive("error",()=>{s("error")}),r.send(),this._canPush()||r.trigger("ok",{})}).finally(()=>{r?.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.rejoinTimer&&clearTimeout(this.rejoinTimer.timer),this.joinPush.destroy()}async _fetchWithTimeout(e,t,r){const s=new AbortController,i=setTimeout(()=>s.abort(),r),o=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:s.signal}));return clearTimeout(i),o}_push(e,t,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let s=new cr(this,e,t,r);return this._canPush()?s.send():(s.startTimeout(),this.pushBuffer.push(s)),s}_onMessage(e,t,r){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,r){var s,i;const o=e.toLocaleLowerCase(),{close:a,error:c,leave:u,join:d}=Ae;if(r&&[a,c,u,d].indexOf(o)>=0&&r!==this._joinRef())return;let f=this._onMessage(o,t,r);if(t&&!f)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(o)?(s=this.bindings.postgres_changes)===null||s===void 0||s.filter(p=>{var y,v,g;return((y=p.filter)===null||y===void 0?void 0:y.event)==="*"||((g=(v=p.filter)===null||v===void 0?void 0:v.event)===null||g===void 0?void 0:g.toLocaleLowerCase())===o}).map(p=>p.callback(f,r)):(i=this.bindings[o])===null||i===void 0||i.filter(p=>{var y,v,g,w,E,_;if(["broadcast","presence","postgres_changes"].includes(o))if("id"in p){const P=p.id,b=(y=p.filter)===null||y===void 0?void 0:y.event;return P&&((v=t.ids)===null||v===void 0?void 0:v.includes(P))&&(b==="*"||b?.toLocaleLowerCase()===((g=t.data)===null||g===void 0?void 0:g.type.toLocaleLowerCase()))}else{const P=(E=(w=p?.filter)===null||w===void 0?void 0:w.event)===null||E===void 0?void 0:E.toLocaleLowerCase();return P==="*"||P===((_=t?.event)===null||_===void 0?void 0:_.toLocaleLowerCase())}else return p.type.toLocaleLowerCase()===o}).map(p=>{if(typeof f=="object"&&"ids"in f){const y=f.data,{schema:v,table:g,commit_timestamp:w,type:E,errors:_}=y;f=Object.assign(Object.assign({},{schema:v,table:g,commit_timestamp:w,eventType:E,new:{},old:{},errors:_}),this._getPayloadRecords(y))}p.callback(f,r)})}_isClosed(){return this.state===ge.closed}_isJoined(){return this.state===ge.joined}_isJoining(){return this.state===ge.joining}_isLeaving(){return this.state===ge.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,r){const s=e.toLocaleLowerCase(),i={type:s,filter:t,callback:r};return this.bindings[s]?this.bindings[s].push(i):this.bindings[s]=[i],this}_off(e,t){const r=e.toLocaleLowerCase();return this.bindings[r]=this.bindings[r].filter(s=>{var i;return!(((i=s.type)===null||i===void 0?void 0:i.toLocaleLowerCase())===r&&Gn.isEqual(s.filter,t))}),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const r in e)if(e[r]!==t[r])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(Ae.close,{},e)}_onError(e){this._on(Ae.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=ge.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=Ns(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=Ns(e.columns,e.old_record)),t}}const Bs=()=>{},lc=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class uc{constructor(e,t){var r;this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=Ro,this.heartbeatIntervalMs=25e3,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=Bs,this.ref=0,this.logger=Bs,this.conn=null,this.sendBuffer=[],this.serializer=new rc,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._resolveFetch=i=>{let o;return i?o=i:typeof fetch>"u"?o=(...a)=>Dt(async()=>{const{default:c}=await Promise.resolve().then(()=>St);return{default:c}},void 0).then(({default:c})=>c(...a)):o=fetch,(...a)=>o(...a)},this.endPoint=`${e}/${$n.websocket}`,this.httpEndpoint=Io(e),t?.transport?this.transport=t.transport:this.transport=null,t?.params&&(this.params=t.params),t?.timeout&&(this.timeout=t.timeout),t?.logger&&(this.logger=t.logger),(t?.logLevel||t?.log_level)&&(this.logLevel=t.logLevel||t.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),t?.heartbeatIntervalMs&&(this.heartbeatIntervalMs=t.heartbeatIntervalMs);const s=(r=t?.params)===null||r===void 0?void 0:r.apikey;if(s&&(this.accessTokenValue=s,this.apiKey=s),this.reconnectAfterMs=t?.reconnectAfterMs?t.reconnectAfterMs:i=>[1e3,2e3,5e3,1e4][i-1]||1e4,this.encode=t?.encode?t.encode:(i,o)=>o(JSON.stringify(i)),this.decode=t?.decode?t.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new Oo(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this._resolveFetch(t?.fetch),t?.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.worker=t?.worker||!1,this.workerUrl=t?.workerUrl}this.accessToken=t?.accessToken||null}connect(){if(!this.conn){if(this.transport||(this.transport=Qa),!this.transport)throw new Error("No transport provided");this.conn=new this.transport(this.endpointURL()),this.setupConnection()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:ec}))}disconnect(e,t){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,t??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset(),this.channels.forEach(r=>r.teardown()))}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,t,r){this.logger(e,t,r)}connectionState(){switch(this.conn&&this.conn.readyState){case jt.connecting:return Ye.Connecting;case jt.open:return Ye.Open;case jt.closing:return Ye.Closing;default:return Ye.Closed}}isConnected(){return this.connectionState()===Ye.Open}channel(e,t={config:{}}){const r=`realtime:${e}`,s=this.getChannels().find(i=>i.topic===r);if(s)return s;{const i=new Gn(`realtime:${e}`,t,this);return this.channels.push(i),i}}push(e){const{topic:t,event:r,payload:s,ref:i}=e,o=()=>{this.encode(e,a=>{var c;(c=this.conn)===null||c===void 0||c.send(a)})};this.log("push",`${t} ${r} (${i})`,s),this.isConnected()?o():this.sendBuffer.push(o)}async setAuth(e=null){let t=e||this.accessToken&&await this.accessToken()||this.accessTokenValue;this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach(r=>{const s={access_token:t,version:Za};t&&r.updateJoinPayload(s),r.joinedOnce&&r._isJoined()&&r._push(Ae.access_token,{access_token:t})}))}async sendHeartbeat(){var e;if(!this.isConnected()){this.heartbeatCallback("disconnected");return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),this.heartbeatCallback("timeout"),(e=this.conn)===null||e===void 0||e.close(tc,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.heartbeatCallback("sent"),await this.setAuth()}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(r=>r.topic===e&&(r._isJoined()||r._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_onConnMessage(e){this.decode(e.data,t=>{let{topic:r,event:s,payload:i,ref:o}=t;r==="phoenix"&&s==="phx_reply"&&this.heartbeatCallback(t.payload.status=="ok"?"ok":"error"),o&&o===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null),this.log("receive",`${i.status||""} ${r} ${s} ${o&&"("+o+")"||""}`,i),Array.from(this.channels).filter(a=>a._isMember(r)).forEach(a=>a._trigger(s,i,o)),this.stateChangeCallbacks.message.forEach(a=>a(t))})}_onConnOpen(){this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this.reconnectTimer.reset(),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this.stateChangeCallbacks.open.forEach(e=>e())}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this.workerRef.terminate()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(t=>t(e))}_onConnError(e){this.log("transport",`${e}`),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(t=>t(e))}_triggerChanError(){this.channels.forEach(e=>e._trigger(Ae.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const r=e.match(/\?/)?"&":"?",s=new URLSearchParams(t);return`${e}${r}${s}`}_workerObjectUrl(e){let t;if(e)t=e;else{const r=new Blob([lc],{type:"application/javascript"});t=URL.createObjectURL(r)}return t}}class Kn extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function de(n){return typeof n=="object"&&n!==null&&"__isStorageError"in n}class dc extends Kn{constructor(e,t){super(e),this.name="StorageApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class On extends Kn{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var hc=function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(d){try{u(r.next(d))}catch(h){o(h)}}function c(d){try{u(r.throw(d))}catch(h){o(h)}}function u(d){d.done?i(d.value):s(d.value).then(a,c)}u((r=r.apply(n,e||[])).next())})};const xo=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>Dt(async()=>{const{default:r}=await Promise.resolve().then(()=>St);return{default:r}},void 0).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)},fc=()=>hc(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield Dt(()=>Promise.resolve().then(()=>St),void 0)).Response:Response}),jn=n=>{if(Array.isArray(n))return n.map(t=>jn(t));if(typeof n=="function"||n!==Object(n))return n;const e={};return Object.entries(n).forEach(([t,r])=>{const s=t.replace(/([-_][a-z])/gi,i=>i.toUpperCase().replace(/[-_]/g,""));e[s]=jn(r)}),e};var Xe=function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(d){try{u(r.next(d))}catch(h){o(h)}}function c(d){try{u(r.throw(d))}catch(h){o(h)}}function u(d){d.done?i(d.value):s(d.value).then(a,c)}u((r=r.apply(n,e||[])).next())})};const lr=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),pc=(n,e,t)=>Xe(void 0,void 0,void 0,function*(){const r=yield fc();n instanceof r&&!t?.noResolveJson?n.json().then(s=>{e(new dc(lr(s),n.status||500))}).catch(s=>{e(new On(lr(s),s))}):e(new On(lr(n),n))}),gc=(n,e,t,r)=>{const s={method:n,headers:e?.headers||{}};return n==="GET"?s:(s.headers=Object.assign({"Content-Type":"application/json"},e?.headers),r&&(s.body=JSON.stringify(r)),Object.assign(Object.assign({},s),t))};function Lt(n,e,t,r,s,i){return Xe(this,void 0,void 0,function*(){return new Promise((o,a)=>{n(t,gc(e,r,s,i)).then(c=>{if(!c.ok)throw c;return r?.noResolveJson?c:c.json()}).then(c=>o(c)).catch(c=>pc(c,a,r))})})}function Jt(n,e,t,r){return Xe(this,void 0,void 0,function*(){return Lt(n,"GET",e,t,r)})}function We(n,e,t,r,s){return Xe(this,void 0,void 0,function*(){return Lt(n,"POST",e,r,s,t)})}function vc(n,e,t,r,s){return Xe(this,void 0,void 0,function*(){return Lt(n,"PUT",e,r,s,t)})}function yc(n,e,t,r){return Xe(this,void 0,void 0,function*(){return Lt(n,"HEAD",e,Object.assign(Object.assign({},t),{noResolveJson:!0}),r)})}function Co(n,e,t,r,s){return Xe(this,void 0,void 0,function*(){return Lt(n,"DELETE",e,r,s,t)})}var _e=function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(d){try{u(r.next(d))}catch(h){o(h)}}function c(d){try{u(r.throw(d))}catch(h){o(h)}}function u(d){d.done?i(d.value):s(d.value).then(a,c)}u((r=r.apply(n,e||[])).next())})};const mc={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Hs={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class _c{constructor(e,t={},r,s){this.url=e,this.headers=t,this.bucketId=r,this.fetch=xo(s)}uploadOrUpdate(e,t,r,s){return _e(this,void 0,void 0,function*(){try{let i;const o=Object.assign(Object.assign({},Hs),s);let a=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(o.upsert)});const c=o.metadata;typeof Blob<"u"&&r instanceof Blob?(i=new FormData,i.append("cacheControl",o.cacheControl),c&&i.append("metadata",this.encodeMetadata(c)),i.append("",r)):typeof FormData<"u"&&r instanceof FormData?(i=r,i.append("cacheControl",o.cacheControl),c&&i.append("metadata",this.encodeMetadata(c))):(i=r,a["cache-control"]=`max-age=${o.cacheControl}`,a["content-type"]=o.contentType,c&&(a["x-metadata"]=this.toBase64(this.encodeMetadata(c)))),s?.headers&&(a=Object.assign(Object.assign({},a),s.headers));const u=this._removeEmptyFolders(t),d=this._getFinalPath(u),h=yield this.fetch(`${this.url}/object/${d}`,Object.assign({method:e,body:i,headers:a},o?.duplex?{duplex:o.duplex}:{})),f=yield h.json();return h.ok?{data:{path:u,id:f.Id,fullPath:f.Key},error:null}:{data:null,error:f}}catch(i){if(de(i))return{data:null,error:i};throw i}})}upload(e,t,r){return _e(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,r)})}uploadToSignedUrl(e,t,r,s){return _e(this,void 0,void 0,function*(){const i=this._removeEmptyFolders(e),o=this._getFinalPath(i),a=new URL(this.url+`/object/upload/sign/${o}`);a.searchParams.set("token",t);try{let c;const u=Object.assign({upsert:Hs.upsert},s),d=Object.assign(Object.assign({},this.headers),{"x-upsert":String(u.upsert)});typeof Blob<"u"&&r instanceof Blob?(c=new FormData,c.append("cacheControl",u.cacheControl),c.append("",r)):typeof FormData<"u"&&r instanceof FormData?(c=r,c.append("cacheControl",u.cacheControl)):(c=r,d["cache-control"]=`max-age=${u.cacheControl}`,d["content-type"]=u.contentType);const h=yield this.fetch(a.toString(),{method:"PUT",body:c,headers:d}),f=yield h.json();return h.ok?{data:{path:i,fullPath:f.Key},error:null}:{data:null,error:f}}catch(c){if(de(c))return{data:null,error:c};throw c}})}createSignedUploadUrl(e,t){return _e(this,void 0,void 0,function*(){try{let r=this._getFinalPath(e);const s=Object.assign({},this.headers);t?.upsert&&(s["x-upsert"]="true");const i=yield We(this.fetch,`${this.url}/object/upload/sign/${r}`,{},{headers:s}),o=new URL(this.url+i.url),a=o.searchParams.get("token");if(!a)throw new Kn("No token returned by API");return{data:{signedUrl:o.toString(),path:e,token:a},error:null}}catch(r){if(de(r))return{data:null,error:r};throw r}})}update(e,t,r){return _e(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,r)})}move(e,t,r){return _e(this,void 0,void 0,function*(){try{return{data:yield We(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:r?.destinationBucket},{headers:this.headers}),error:null}}catch(s){if(de(s))return{data:null,error:s};throw s}})}copy(e,t,r){return _e(this,void 0,void 0,function*(){try{return{data:{path:(yield We(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:r?.destinationBucket},{headers:this.headers})).Key},error:null}}catch(s){if(de(s))return{data:null,error:s};throw s}})}createSignedUrl(e,t,r){return _e(this,void 0,void 0,function*(){try{let s=this._getFinalPath(e),i=yield We(this.fetch,`${this.url}/object/sign/${s}`,Object.assign({expiresIn:t},r?.transform?{transform:r.transform}:{}),{headers:this.headers});const o=r?.download?`&download=${r.download===!0?"":r.download}`:"";return i={signedUrl:encodeURI(`${this.url}${i.signedURL}${o}`)},{data:i,error:null}}catch(s){if(de(s))return{data:null,error:s};throw s}})}createSignedUrls(e,t,r){return _e(this,void 0,void 0,function*(){try{const s=yield We(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),i=r?.download?`&download=${r.download===!0?"":r.download}`:"";return{data:s.map(o=>Object.assign(Object.assign({},o),{signedUrl:o.signedURL?encodeURI(`${this.url}${o.signedURL}${i}`):null})),error:null}}catch(s){if(de(s))return{data:null,error:s};throw s}})}download(e,t){return _e(this,void 0,void 0,function*(){const s=typeof t?.transform<"u"?"render/image/authenticated":"object",i=this.transformOptsToQueryString(t?.transform||{}),o=i?`?${i}`:"";try{const a=this._getFinalPath(e);return{data:yield(yield Jt(this.fetch,`${this.url}/${s}/${a}${o}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(a){if(de(a))return{data:null,error:a};throw a}})}info(e){return _e(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const r=yield Jt(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:jn(r),error:null}}catch(r){if(de(r))return{data:null,error:r};throw r}})}exists(e){return _e(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield yc(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(r){if(de(r)&&r instanceof On){const s=r.originalError;if([400,404].includes(s?.status))return{data:!1,error:r}}throw r}})}getPublicUrl(e,t){const r=this._getFinalPath(e),s=[],i=t?.download?`download=${t.download===!0?"":t.download}`:"";i!==""&&s.push(i);const a=typeof t?.transform<"u"?"render/image":"object",c=this.transformOptsToQueryString(t?.transform||{});c!==""&&s.push(c);let u=s.join("&");return u!==""&&(u=`?${u}`),{data:{publicUrl:encodeURI(`${this.url}/${a}/public/${r}${u}`)}}}remove(e){return _e(this,void 0,void 0,function*(){try{return{data:yield Co(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(de(t))return{data:null,error:t};throw t}})}list(e,t,r){return _e(this,void 0,void 0,function*(){try{const s=Object.assign(Object.assign(Object.assign({},mc),t),{prefix:e||""});return{data:yield We(this.fetch,`${this.url}/object/list/${this.bucketId}`,s,{headers:this.headers},r),error:null}}catch(s){if(de(s))return{data:null,error:s};throw s}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const wc="2.7.1",bc={"X-Client-Info":`storage-js/${wc}`};var ut=function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(d){try{u(r.next(d))}catch(h){o(h)}}function c(d){try{u(r.throw(d))}catch(h){o(h)}}function u(d){d.done?i(d.value):s(d.value).then(a,c)}u((r=r.apply(n,e||[])).next())})};class Sc{constructor(e,t={},r){this.url=e,this.headers=Object.assign(Object.assign({},bc),t),this.fetch=xo(r)}listBuckets(){return ut(this,void 0,void 0,function*(){try{return{data:yield Jt(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(de(e))return{data:null,error:e};throw e}})}getBucket(e){return ut(this,void 0,void 0,function*(){try{return{data:yield Jt(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(de(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return ut(this,void 0,void 0,function*(){try{return{data:yield We(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(de(r))return{data:null,error:r};throw r}})}updateBucket(e,t){return ut(this,void 0,void 0,function*(){try{return{data:yield vc(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(de(r))return{data:null,error:r};throw r}})}emptyBucket(e){return ut(this,void 0,void 0,function*(){try{return{data:yield We(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(de(t))return{data:null,error:t};throw t}})}deleteBucket(e){return ut(this,void 0,void 0,function*(){try{return{data:yield Co(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(de(t))return{data:null,error:t};throw t}})}}class Tc extends Sc{constructor(e,t={},r){super(e,t,r)}from(e){return new _c(this.url,this.headers,e,this.fetch)}}const Ec="2.50.5";let Rt="";typeof Deno<"u"?Rt="deno":typeof document<"u"?Rt="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Rt="react-native":Rt="node";const Pc={"X-Client-Info":`supabase-js-${Rt}/${Ec}`},kc={headers:Pc},Ac={schema:"public"},$c={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},Rc={};var Oc=function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(d){try{u(r.next(d))}catch(h){o(h)}}function c(d){try{u(r.throw(d))}catch(h){o(h)}}function u(d){d.done?i(d.value):s(d.value).then(a,c)}u((r=r.apply(n,e||[])).next())})};const jc=n=>{let e;return n?e=n:typeof fetch>"u"?e=To:e=fetch,(...t)=>e(...t)},Ic=()=>typeof Headers>"u"?Eo:Headers,xc=(n,e,t)=>{const r=jc(t),s=Ic();return(i,o)=>Oc(void 0,void 0,void 0,function*(){var a;const c=(a=yield e())!==null&&a!==void 0?a:n;let u=new s(o?.headers);return u.has("apikey")||u.set("apikey",n),u.has("Authorization")||u.set("Authorization",`Bearer ${c}`),r(i,Object.assign(Object.assign({},o),{headers:u}))})};var Cc=function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(d){try{u(r.next(d))}catch(h){o(h)}}function c(d){try{u(r.throw(d))}catch(h){o(h)}}function u(d){d.done?i(d.value):s(d.value).then(a,c)}u((r=r.apply(n,e||[])).next())})};function Uc(n){return n.endsWith("/")?n:n+"/"}function Dc(n,e){var t,r;const{db:s,auth:i,realtime:o,global:a}=n,{db:c,auth:u,realtime:d,global:h}=e,f={db:Object.assign(Object.assign({},c),s),auth:Object.assign(Object.assign({},u),i),realtime:Object.assign(Object.assign({},d),o),global:Object.assign(Object.assign(Object.assign({},h),a),{headers:Object.assign(Object.assign({},(t=h?.headers)!==null&&t!==void 0?t:{}),(r=a?.headers)!==null&&r!==void 0?r:{})}),accessToken:()=>Cc(this,void 0,void 0,function*(){return""})};return n.accessToken?f.accessToken=n.accessToken:delete f.accessToken,f}const Uo="2.70.0",gt=30*1e3,In=3,ur=In*gt,Lc="http://localhost:9999",Nc="supabase.auth.token",qc={"X-Client-Info":`gotrue-js/${Uo}`},xn="X-Supabase-Api-Version",Do={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},Mc=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,Fc=6e5;class Vn extends Error{constructor(e,t,r){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=r}}function W(n){return typeof n=="object"&&n!==null&&"__isAuthError"in n}class Bc extends Vn{constructor(e,t,r){super(e,t,r),this.name="AuthApiError",this.status=t,this.code=r}}function Hc(n){return W(n)&&n.name==="AuthApiError"}class Lo extends Vn{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class Ke extends Vn{constructor(e,t,r,s){super(e,r,s),this.name=t,this.status=r}}class Be extends Ke{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function Wc(n){return W(n)&&n.name==="AuthSessionMissingError"}class Ft extends Ke{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Bt extends Ke{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class Ht extends Ke{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function Gc(n){return W(n)&&n.name==="AuthImplicitGrantRedirectError"}class Ws extends Ke{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Cn extends Ke{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function dr(n){return W(n)&&n.name==="AuthRetryableFetchError"}class Gs extends Ke{constructor(e,t,r){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=r}}class xt extends Ke{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const Yt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),Ks=` 	
\r=`.split(""),Kc=(()=>{const n=new Array(128);for(let e=0;e<n.length;e+=1)n[e]=-1;for(let e=0;e<Ks.length;e+=1)n[Ks[e].charCodeAt(0)]=-2;for(let e=0;e<Yt.length;e+=1)n[Yt[e].charCodeAt(0)]=e;return n})();function Vs(n,e,t){if(n!==null)for(e.queue=e.queue<<8|n,e.queuedBits+=8;e.queuedBits>=6;){const r=e.queue>>e.queuedBits-6&63;t(Yt[r]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const r=e.queue>>e.queuedBits-6&63;t(Yt[r]),e.queuedBits-=6}}function No(n,e,t){const r=Kc[n];if(r>-1)for(e.queue=e.queue<<6|r,e.queuedBits+=6;e.queuedBits>=8;)t(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(r===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(n)}"`)}}function zs(n){const e=[],t=o=>{e.push(String.fromCodePoint(o))},r={utf8seq:0,codepoint:0},s={queue:0,queuedBits:0},i=o=>{Jc(o,r,t)};for(let o=0;o<n.length;o+=1)No(n.charCodeAt(o),s,i);return e.join("")}function Vc(n,e){if(n<=127){e(n);return}else if(n<=2047){e(192|n>>6),e(128|n&63);return}else if(n<=65535){e(224|n>>12),e(128|n>>6&63),e(128|n&63);return}else if(n<=1114111){e(240|n>>18),e(128|n>>12&63),e(128|n>>6&63),e(128|n&63);return}throw new Error(`Unrecognized Unicode codepoint: ${n.toString(16)}`)}function zc(n,e){for(let t=0;t<n.length;t+=1){let r=n.charCodeAt(t);if(r>55295&&r<=56319){const s=(r-55296)*1024&65535;r=(n.charCodeAt(t+1)-56320&65535|s)+65536,t+=1}Vc(r,e)}}function Jc(n,e,t){if(e.utf8seq===0){if(n<=127){t(n);return}for(let r=1;r<6;r+=1)if((n>>7-r&1)===0){e.utf8seq=r;break}if(e.utf8seq===2)e.codepoint=n&31;else if(e.utf8seq===3)e.codepoint=n&15;else if(e.utf8seq===4)e.codepoint=n&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(n<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|n&63,e.utf8seq-=1,e.utf8seq===0&&t(e.codepoint)}}function Yc(n){const e=[],t={queue:0,queuedBits:0},r=s=>{e.push(s)};for(let s=0;s<n.length;s+=1)No(n.charCodeAt(s),t,r);return new Uint8Array(e)}function Qc(n){const e=[];return zc(n,t=>e.push(t)),new Uint8Array(e)}function Xc(n){const e=[],t={queue:0,queuedBits:0},r=s=>{e.push(s)};return n.forEach(s=>Vs(s,t,r)),Vs(null,t,r),e.join("")}function Zc(n){return Math.round(Date.now()/1e3)+n}function el(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){const e=Math.random()*16|0;return(n=="x"?e:e&3|8).toString(16)})}const ke=()=>typeof window<"u"&&typeof document<"u",Ve={tested:!1,writable:!1},Ct=()=>{if(!ke())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(Ve.tested)return Ve.writable;const n=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(n,n),globalThis.localStorage.removeItem(n),Ve.tested=!0,Ve.writable=!0}catch{Ve.tested=!0,Ve.writable=!1}return Ve.writable};function tl(n){const e={},t=new URL(n);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((s,i)=>{e[i]=s})}catch{}return t.searchParams.forEach((r,s)=>{e[s]=r}),e}const qo=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>Dt(async()=>{const{default:r}=await Promise.resolve().then(()=>St);return{default:r}},void 0).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)},rl=n=>typeof n=="object"&&n!==null&&"status"in n&&"ok"in n&&"json"in n&&typeof n.json=="function",Mo=async(n,e,t)=>{await n.setItem(e,JSON.stringify(t))},Wt=async(n,e)=>{const t=await n.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},Gt=async(n,e)=>{await n.removeItem(e)};class Zt{constructor(){this.promise=new Zt.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}Zt.promiseConstructor=Promise;function hr(n){const e=n.split(".");if(e.length!==3)throw new xt("Invalid JWT structure");for(let r=0;r<e.length;r++)if(!Mc.test(e[r]))throw new xt("JWT not in base64url format");return{header:JSON.parse(zs(e[0])),payload:JSON.parse(zs(e[1])),signature:Yc(e[2]),raw:{header:e[0],payload:e[1]}}}async function nl(n){return await new Promise(e=>{setTimeout(()=>e(null),n)})}function sl(n,e){return new Promise((r,s)=>{(async()=>{for(let i=0;i<1/0;i++)try{const o=await n(i);if(!e(i,null,o)){r(o);return}}catch(o){if(!e(i,o)){s(o);return}}})()})}function il(n){return("0"+n.toString(16)).substr(-2)}function ol(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",r=t.length;let s="";for(let i=0;i<56;i++)s+=t.charAt(Math.floor(Math.random()*r));return s}return crypto.getRandomValues(e),Array.from(e,il).join("")}async function al(n){const t=new TextEncoder().encode(n),r=await crypto.subtle.digest("SHA-256",t),s=new Uint8Array(r);return Array.from(s).map(i=>String.fromCharCode(i)).join("")}async function cl(n){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),n;const t=await al(n);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function dt(n,e,t=!1){const r=ol();let s=r;t&&(s+="/PASSWORD_RECOVERY"),await Mo(n,`${e}-code-verifier`,s);const i=await cl(r);return[i,r===i?"plain":"s256"]}const ll=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function ul(n){const e=n.headers.get(xn);if(!e||!e.match(ll))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function dl(n){if(!n)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(n<=e)throw new Error("JWT has expired")}function hl(n){switch(n){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const fl=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function ht(n){if(!fl.test(n))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}var pl=function(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(n);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(n,r[s])&&(t[r[s]]=n[r[s]]);return t};const Je=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),gl=[502,503,504];async function Js(n){var e;if(!rl(n))throw new Cn(Je(n),0);if(gl.includes(n.status))throw new Cn(Je(n),n.status);let t;try{t=await n.json()}catch(i){throw new Lo(Je(i),i)}let r;const s=ul(n);if(s&&s.getTime()>=Do["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?r=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(r=t.error_code),r){if(r==="weak_password")throw new Gs(Je(t),n.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(r==="session_not_found")throw new Be}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((i,o)=>i&&typeof o=="string",!0))throw new Gs(Je(t),n.status,t.weak_password.reasons);throw new Bc(Je(t),n.status||500,r)}const vl=(n,e,t,r)=>{const s={method:n,headers:e?.headers||{}};return n==="GET"?s:(s.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e?.headers),s.body=JSON.stringify(r),Object.assign(Object.assign({},s),t))};async function z(n,e,t,r){var s;const i=Object.assign({},r?.headers);i[xn]||(i[xn]=Do["2024-01-01"].name),r?.jwt&&(i.Authorization=`Bearer ${r.jwt}`);const o=(s=r?.query)!==null&&s!==void 0?s:{};r?.redirectTo&&(o.redirect_to=r.redirectTo);const a=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",c=await yl(n,e,t+a,{headers:i,noResolveJson:r?.noResolveJson},{},r?.body);return r?.xform?r?.xform(c):{data:Object.assign({},c),error:null}}async function yl(n,e,t,r,s,i){const o=vl(e,r,s,i);let a;try{a=await n(t,Object.assign({},o))}catch(c){throw console.error(c),new Cn(Je(c),0)}if(a.ok||await Js(a),r?.noResolveJson)return a;try{return await a.json()}catch(c){await Js(c)}}function Le(n){var e;let t=null;bl(n)&&(t=Object.assign({},n),n.expires_at||(t.expires_at=Zc(n.expires_in)));const r=(e=n.user)!==null&&e!==void 0?e:n;return{data:{session:t,user:r},error:null}}function Ys(n){const e=Le(n);return!e.error&&n.weak_password&&typeof n.weak_password=="object"&&Array.isArray(n.weak_password.reasons)&&n.weak_password.reasons.length&&n.weak_password.message&&typeof n.weak_password.message=="string"&&n.weak_password.reasons.reduce((t,r)=>t&&typeof r=="string",!0)&&(e.data.weak_password=n.weak_password),e}function Ge(n){var e;return{data:{user:(e=n.user)!==null&&e!==void 0?e:n},error:null}}function ml(n){return{data:n,error:null}}function _l(n){const{action_link:e,email_otp:t,hashed_token:r,redirect_to:s,verification_type:i}=n,o=pl(n,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),a={action_link:e,email_otp:t,hashed_token:r,redirect_to:s,verification_type:i},c=Object.assign({},o);return{data:{properties:a,user:c},error:null}}function wl(n){return n}function bl(n){return n.access_token&&n.refresh_token&&n.expires_in}const fr=["global","local","others"];var Sl=function(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(n);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(n,r[s])&&(t[r[s]]=n[r[s]]);return t};class Tl{constructor({url:e="",headers:t={},fetch:r}){this.url=e,this.headers=t,this.fetch=qo(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t=fr[0]){if(fr.indexOf(t)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${fr.join(", ")}`);try{return await z(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(r){if(W(r))return{data:null,error:r};throw r}}async inviteUserByEmail(e,t={}){try{return await z(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:Ge})}catch(r){if(W(r))return{data:{user:null},error:r};throw r}}async generateLink(e){try{const{options:t}=e,r=Sl(e,["options"]),s=Object.assign(Object.assign({},r),t);return"newEmail"in r&&(s.new_email=r?.newEmail,delete s.newEmail),await z(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:s,headers:this.headers,xform:_l,redirectTo:t?.redirectTo})}catch(t){if(W(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await z(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:Ge})}catch(t){if(W(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,r,s,i,o,a,c;try{const u={nextPage:null,lastPage:0,total:0},d=await z(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(t=e?.page)===null||t===void 0?void 0:t.toString())!==null&&r!==void 0?r:"",per_page:(i=(s=e?.perPage)===null||s===void 0?void 0:s.toString())!==null&&i!==void 0?i:""},xform:wl});if(d.error)throw d.error;const h=await d.json(),f=(o=d.headers.get("x-total-count"))!==null&&o!==void 0?o:0,p=(c=(a=d.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&c!==void 0?c:[];return p.length>0&&(p.forEach(y=>{const v=parseInt(y.split(";")[0].split("=")[1].substring(0,1)),g=JSON.parse(y.split(";")[1].split("=")[1]);u[`${g}Page`]=v}),u.total=parseInt(f)),{data:Object.assign(Object.assign({},h),u),error:null}}catch(u){if(W(u))return{data:{users:[]},error:u};throw u}}async getUserById(e){ht(e);try{return await z(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:Ge})}catch(t){if(W(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){ht(e);try{return await z(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:Ge})}catch(r){if(W(r))return{data:{user:null},error:r};throw r}}async deleteUser(e,t=!1){ht(e);try{return await z(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:Ge})}catch(r){if(W(r))return{data:{user:null},error:r};throw r}}async _listFactors(e){ht(e.userId);try{const{data:t,error:r}=await z(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:s=>({data:{factors:s},error:null})});return{data:t,error:r}}catch(t){if(W(t))return{data:null,error:t};throw t}}async _deleteFactor(e){ht(e.userId),ht(e.id);try{return{data:await z(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(W(t))return{data:null,error:t};throw t}}}const El={getItem:n=>Ct()?globalThis.localStorage.getItem(n):null,setItem:(n,e)=>{Ct()&&globalThis.localStorage.setItem(n,e)},removeItem:n=>{Ct()&&globalThis.localStorage.removeItem(n)}};function Qs(n={}){return{getItem:e=>n[e]||null,setItem:(e,t)=>{n[e]=t},removeItem:e=>{delete n[e]}}}function Pl(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const ft={debug:!!(globalThis&&Ct()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class Fo extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class kl extends Fo{}async function Al(n,e,t){ft.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",n,e);const r=new globalThis.AbortController;return e>0&&setTimeout(()=>{r.abort(),ft.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",n)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(n,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},async s=>{if(s){ft.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",n,s.name);try{return await t()}finally{ft.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",n,s.name)}}else{if(e===0)throw ft.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",n),new kl(`Acquiring an exclusive Navigator LockManager lock "${n}" immediately failed`);if(ft.debug)try{const i=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(i,null,"  "))}catch(i){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",i)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}}))}Pl();const $l={url:Lc,storageKey:Nc,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:qc,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function Xs(n,e,t){return await t()}class Ut{constructor(e){var t,r;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=Ut.nextInstanceID,Ut.nextInstanceID+=1,this.instanceID>0&&ke()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const s=Object.assign(Object.assign({},$l),e);if(this.logDebugMessages=!!s.debug,typeof s.debug=="function"&&(this.logger=s.debug),this.persistSession=s.persistSession,this.storageKey=s.storageKey,this.autoRefreshToken=s.autoRefreshToken,this.admin=new Tl({url:s.url,headers:s.headers,fetch:s.fetch}),this.url=s.url,this.headers=s.headers,this.fetch=qo(s.fetch),this.lock=s.lock||Xs,this.detectSessionInUrl=s.detectSessionInUrl,this.flowType=s.flowType,this.hasCustomAuthorizationHeader=s.hasCustomAuthorizationHeader,s.lock?this.lock=s.lock:ke()&&(!((t=globalThis?.navigator)===null||t===void 0)&&t.locks)?this.lock=Al:this.lock=Xs,this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?s.storage?this.storage=s.storage:Ct()?this.storage=El:(this.memoryStorage={},this.storage=Qs(this.memoryStorage)):(this.memoryStorage={},this.storage=Qs(this.memoryStorage)),ke()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(i){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",i)}(r=this.broadcastChannel)===null||r===void 0||r.addEventListener("message",async i=>{this._debug("received broadcast notification from other tab or client",i),await this._notifyAllSubscribers(i.data.event,i.data.session,!1)})}this.initialize()}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${Uo}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{const t=tl(window.location.href);let r="none";if(this._isImplicitGrantCallback(t)?r="implicit":await this._isPKCECallback(t)&&(r="pkce"),ke()&&this.detectSessionInUrl&&r!=="none"){const{data:s,error:i}=await this._getSessionFromURL(t,r);if(i){if(this._debug("#_initialize()","error detecting session from URL",i),Gc(i)){const c=(e=i.details)===null||e===void 0?void 0:e.code;if(c==="identity_already_exists"||c==="identity_not_found"||c==="single_identity_not_deletable")return{error:i}}return await this._removeSession(),{error:i}}const{session:o,redirectType:a}=s;return this._debug("#_initialize()","detected session in URL",o,"redirect type",a),await this._saveSession(o),setTimeout(async()=>{a==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",o):await this._notifyAllSubscribers("SIGNED_IN",o)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return W(t)?{error:t}:{error:new Lo("Unexpected error during initialization",t)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,r,s;try{const i=await z(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(r=(t=e?.options)===null||t===void 0?void 0:t.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:(s=e?.options)===null||s===void 0?void 0:s.captchaToken}},xform:Le}),{data:o,error:a}=i;if(a||!o)return{data:{user:null,session:null},error:a};const c=o.session,u=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:u,session:c},error:null}}catch(i){if(W(i))return{data:{user:null,session:null},error:i};throw i}}async signUp(e){var t,r,s;try{let i;if("email"in e){const{email:d,password:h,options:f}=e;let p=null,y=null;this.flowType==="pkce"&&([p,y]=await dt(this.storage,this.storageKey)),i=await z(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:f?.emailRedirectTo,body:{email:d,password:h,data:(t=f?.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:f?.captchaToken},code_challenge:p,code_challenge_method:y},xform:Le})}else if("phone"in e){const{phone:d,password:h,options:f}=e;i=await z(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:d,password:h,data:(r=f?.data)!==null&&r!==void 0?r:{},channel:(s=f?.channel)!==null&&s!==void 0?s:"sms",gotrue_meta_security:{captcha_token:f?.captchaToken}},xform:Le})}else throw new Bt("You must provide either an email or phone number and a password");const{data:o,error:a}=i;if(a||!o)return{data:{user:null,session:null},error:a};const c=o.session,u=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:u,session:c},error:null}}catch(i){if(W(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithPassword(e){try{let t;if("email"in e){const{email:i,password:o,options:a}=e;t=await z(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:i,password:o,gotrue_meta_security:{captcha_token:a?.captchaToken}},xform:Ys})}else if("phone"in e){const{phone:i,password:o,options:a}=e;t=await z(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:i,password:o,gotrue_meta_security:{captcha_token:a?.captchaToken}},xform:Ys})}else throw new Bt("You must provide either an email or phone number and a password");const{data:r,error:s}=t;return s?{data:{user:null,session:null},error:s}:!r||!r.session||!r.user?{data:{user:null,session:null},error:new Ft}:(r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),{data:Object.assign({user:r.user,session:r.session},r.weak_password?{weakPassword:r.weak_password}:null),error:s})}catch(t){if(W(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,r,s,i;return await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(r=e.options)===null||r===void 0?void 0:r.scopes,queryParams:(s=e.options)===null||s===void 0?void 0:s.queryParams,skipBrowserRedirect:(i=e.options)===null||i===void 0?void 0:i.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:t}=e;if(t==="solana")return await this.signInWithSolana(e);throw new Error(`@supabase/auth-js: Unsupported chain "${t}"`)}async signInWithSolana(e){var t,r,s,i,o,a,c,u,d,h,f,p;let y,v;if("message"in e)y=e.message,v=e.signature;else{const{chain:g,wallet:w,statement:E,options:_}=e;let P;if(ke())if(typeof w=="object")P=w;else{const x=window;if("solana"in x&&typeof x.solana=="object"&&("signIn"in x.solana&&typeof x.solana.signIn=="function"||"signMessage"in x.solana&&typeof x.solana.signMessage=="function"))P=x.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof w!="object"||!_?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");P=w}const b=new URL((t=_?.url)!==null&&t!==void 0?t:window.location.href);if("signIn"in P&&P.signIn){const x=await P.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},_?.signInWithSolana),{version:"1",domain:b.host,uri:b.href}),E?{statement:E}:null));let D;if(Array.isArray(x)&&x[0]&&typeof x[0]=="object")D=x[0];else if(x&&typeof x=="object"&&"signedMessage"in x&&"signature"in x)D=x;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in D&&"signature"in D&&(typeof D.signedMessage=="string"||D.signedMessage instanceof Uint8Array)&&D.signature instanceof Uint8Array)y=typeof D.signedMessage=="string"?D.signedMessage:new TextDecoder().decode(D.signedMessage),v=D.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in P)||typeof P.signMessage!="function"||!("publicKey"in P)||typeof P!="object"||!P.publicKey||!("toBase58"in P.publicKey)||typeof P.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");y=[`${b.host} wants you to sign in with your Solana account:`,P.publicKey.toBase58(),...E?["",E,""]:[""],"Version: 1",`URI: ${b.href}`,`Issued At: ${(s=(r=_?.signInWithSolana)===null||r===void 0?void 0:r.issuedAt)!==null&&s!==void 0?s:new Date().toISOString()}`,...!((i=_?.signInWithSolana)===null||i===void 0)&&i.notBefore?[`Not Before: ${_.signInWithSolana.notBefore}`]:[],...!((o=_?.signInWithSolana)===null||o===void 0)&&o.expirationTime?[`Expiration Time: ${_.signInWithSolana.expirationTime}`]:[],...!((a=_?.signInWithSolana)===null||a===void 0)&&a.chainId?[`Chain ID: ${_.signInWithSolana.chainId}`]:[],...!((c=_?.signInWithSolana)===null||c===void 0)&&c.nonce?[`Nonce: ${_.signInWithSolana.nonce}`]:[],...!((u=_?.signInWithSolana)===null||u===void 0)&&u.requestId?[`Request ID: ${_.signInWithSolana.requestId}`]:[],...!((h=(d=_?.signInWithSolana)===null||d===void 0?void 0:d.resources)===null||h===void 0)&&h.length?["Resources",..._.signInWithSolana.resources.map(D=>`- ${D}`)]:[]].join(`
`);const x=await P.signMessage(new TextEncoder().encode(y),"utf8");if(!x||!(x instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");v=x}}try{const{data:g,error:w}=await z(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:y,signature:Xc(v)},!((f=e.options)===null||f===void 0)&&f.captchaToken?{gotrue_meta_security:{captcha_token:(p=e.options)===null||p===void 0?void 0:p.captchaToken}}:null),xform:Le});if(w)throw w;return!g||!g.session||!g.user?{data:{user:null,session:null},error:new Ft}:(g.session&&(await this._saveSession(g.session),await this._notifyAllSubscribers("SIGNED_IN",g.session)),{data:Object.assign({},g),error:w})}catch(g){if(W(g))return{data:{user:null,session:null},error:g};throw g}}async _exchangeCodeForSession(e){const t=await Wt(this.storage,`${this.storageKey}-code-verifier`),[r,s]=(t??"").split("/");try{const{data:i,error:o}=await z(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:r},xform:Le});if(await Gt(this.storage,`${this.storageKey}-code-verifier`),o)throw o;return!i||!i.session||!i.user?{data:{user:null,session:null,redirectType:null},error:new Ft}:(i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",i.session)),{data:Object.assign(Object.assign({},i),{redirectType:s??null}),error:o})}catch(i){if(W(i))return{data:{user:null,session:null,redirectType:null},error:i};throw i}}async signInWithIdToken(e){try{const{options:t,provider:r,token:s,access_token:i,nonce:o}=e,a=await z(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:s,access_token:i,nonce:o,gotrue_meta_security:{captcha_token:t?.captchaToken}},xform:Le}),{data:c,error:u}=a;return u?{data:{user:null,session:null},error:u}:!c||!c.session||!c.user?{data:{user:null,session:null},error:new Ft}:(c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",c.session)),{data:c,error:u})}catch(t){if(W(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,r,s,i,o;try{if("email"in e){const{email:a,options:c}=e;let u=null,d=null;this.flowType==="pkce"&&([u,d]=await dt(this.storage,this.storageKey));const{error:h}=await z(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:a,data:(t=c?.data)!==null&&t!==void 0?t:{},create_user:(r=c?.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:c?.captchaToken},code_challenge:u,code_challenge_method:d},redirectTo:c?.emailRedirectTo});return{data:{user:null,session:null},error:h}}if("phone"in e){const{phone:a,options:c}=e,{data:u,error:d}=await z(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:a,data:(s=c?.data)!==null&&s!==void 0?s:{},create_user:(i=c?.shouldCreateUser)!==null&&i!==void 0?i:!0,gotrue_meta_security:{captcha_token:c?.captchaToken},channel:(o=c?.channel)!==null&&o!==void 0?o:"sms"}});return{data:{user:null,session:null,messageId:u?.message_id},error:d}}throw new Bt("You must provide either an email or phone number.")}catch(a){if(W(a))return{data:{user:null,session:null},error:a};throw a}}async verifyOtp(e){var t,r;try{let s,i;"options"in e&&(s=(t=e.options)===null||t===void 0?void 0:t.redirectTo,i=(r=e.options)===null||r===void 0?void 0:r.captchaToken);const{data:o,error:a}=await z(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:i}}),redirectTo:s,xform:Le});if(a)throw a;if(!o)throw new Error("An error occurred on token verification.");const c=o.session,u=o.user;return c?.access_token&&(await this._saveSession(c),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",c)),{data:{user:u,session:c},error:null}}catch(s){if(W(s))return{data:{user:null,session:null},error:s};throw s}}async signInWithSSO(e){var t,r,s;try{let i=null,o=null;return this.flowType==="pkce"&&([i,o]=await dt(this.storage,this.storageKey)),await z(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(r=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&r!==void 0?r:void 0}),!((s=e?.options)===null||s===void 0)&&s.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:i,code_challenge_method:o}),headers:this.headers,xform:ml})}catch(i){if(W(i))return{data:null,error:i};throw i}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:r}=e;if(r)throw r;if(!t)throw new Be;const{error:s}=await z(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:s}})}catch(e){if(W(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:r,type:s,options:i}=e,{error:o}=await z(this.fetch,"POST",t,{headers:this.headers,body:{email:r,type:s,gotrue_meta_security:{captcha_token:i?.captchaToken}},redirectTo:i?.emailRedirectTo});return{data:{user:null,session:null},error:o}}else if("phone"in e){const{phone:r,type:s,options:i}=e,{data:o,error:a}=await z(this.fetch,"POST",t,{headers:this.headers,body:{phone:r,type:s,gotrue_meta_security:{captcha_token:i?.captchaToken}}});return{data:{user:null,session:null,messageId:o?.message_id},error:a}}throw new Bt("You must provide either an email or phone number and a type")}catch(t){if(W(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async t=>t))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const r=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),s=(async()=>(await r,await t()))();return this.pendingInLock.push((async()=>{try{await s}catch{}})()),s}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const r=t();for(this.pendingInLock.push((async()=>{try{await r}catch{}})()),await r;this.pendingInLock.length;){const s=[...this.pendingInLock];await Promise.all(s),this.pendingInLock.splice(0,s.length)}return await r}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await Wt(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const r=e.expires_at?e.expires_at*1e3-Date.now()<ur:!1;if(this._debug("#__loadSession()",`session has${r?"":" not"} expired`,"expires_at",e.expires_at),!r){if(this.storage.isServer){let o=this.suppressGetSessionWarning;e=new Proxy(e,{get:(c,u,d)=>(!o&&u==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),o=!0,this.suppressGetSessionWarning=!0),Reflect.get(c,u,d))})}return{data:{session:e},error:null}}const{session:s,error:i}=await this._callRefreshToken(e.refresh_token);return i?{data:{session:null},error:i}:{data:{session:s},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await z(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:Ge}):await this._useSession(async t=>{var r,s,i;const{data:o,error:a}=t;if(a)throw a;return!(!((r=o.session)===null||r===void 0)&&r.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Be}:await z(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(i=(s=o.session)===null||s===void 0?void 0:s.access_token)!==null&&i!==void 0?i:void 0,xform:Ge})})}catch(t){if(W(t))return Wc(t)&&(await this._removeSession(),await Gt(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async r=>{const{data:s,error:i}=r;if(i)throw i;if(!s.session)throw new Be;const o=s.session;let a=null,c=null;this.flowType==="pkce"&&e.email!=null&&([a,c]=await dt(this.storage,this.storageKey));const{data:u,error:d}=await z(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t?.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:a,code_challenge_method:c}),jwt:o.access_token,xform:Ge});if(d)throw d;return o.user=u.user,await this._saveSession(o),await this._notifyAllSubscribers("USER_UPDATED",o),{data:{user:o.user},error:null}})}catch(r){if(W(r))return{data:{user:null},error:r};throw r}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new Be;const t=Date.now()/1e3;let r=t,s=!0,i=null;const{payload:o}=hr(e.access_token);if(o.exp&&(r=o.exp,s=r<=t),s){const{session:a,error:c}=await this._callRefreshToken(e.refresh_token);if(c)return{data:{user:null,session:null},error:c};if(!a)return{data:{user:null,session:null},error:null};i=a}else{const{data:a,error:c}=await this._getUser(e.access_token);if(c)throw c;i={access_token:e.access_token,refresh_token:e.refresh_token,user:a.user,token_type:"bearer",expires_in:r-t,expires_at:r},await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)}return{data:{user:i.user,session:i},error:null}}catch(t){if(W(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var r;if(!e){const{data:o,error:a}=t;if(a)throw a;e=(r=o.session)!==null&&r!==void 0?r:void 0}if(!e?.refresh_token)throw new Be;const{session:s,error:i}=await this._callRefreshToken(e.refresh_token);return i?{data:{user:null,session:null},error:i}:s?{data:{user:s.user,session:s},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if(W(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e,t){try{if(!ke())throw new Ht("No browser detected.");if(e.error||e.error_description||e.error_code)throw new Ht(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if(this.flowType==="pkce")throw new Ws("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new Ht("Not a valid implicit grant flow url.");break;default:}if(t==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new Ws("No code detected.");const{data:E,error:_}=await this._exchangeCodeForSession(e.code);if(_)throw _;const P=new URL(window.location.href);return P.searchParams.delete("code"),window.history.replaceState(window.history.state,"",P.toString()),{data:{session:E.session,redirectType:null},error:null}}const{provider_token:r,provider_refresh_token:s,access_token:i,refresh_token:o,expires_in:a,expires_at:c,token_type:u}=e;if(!i||!a||!o||!u)throw new Ht("No session defined in URL");const d=Math.round(Date.now()/1e3),h=parseInt(a);let f=d+h;c&&(f=parseInt(c));const p=f-d;p*1e3<=gt&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${p}s, should have been closer to ${h}s`);const y=f-h;d-y>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",y,f,d):d-y<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",y,f,d);const{data:v,error:g}=await this._getUser(i);if(g)throw g;const w={provider_token:r,provider_refresh_token:s,access_token:i,expires_in:h,expires_at:f,refresh_token:o,token_type:u,user:v.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:w,redirectType:e.type},error:null}}catch(r){if(W(r))return{data:{session:null,redirectType:null},error:r};throw r}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await Wt(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var r;const{data:s,error:i}=t;if(i)return{error:i};const o=(r=s.session)===null||r===void 0?void 0:r.access_token;if(o){const{error:a}=await this.admin.signOut(o,e);if(a&&!(Hc(a)&&(a.status===404||a.status===401||a.status===403)))return{error:a}}return e!=="others"&&(await this._removeSession(),await Gt(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const t=el(),r={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,r),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:r}}}async _emitInitialSession(e){return await this._useSession(async t=>{var r,s;try{const{data:{session:i},error:o}=t;if(o)throw o;await((r=this.stateChangeEmitters.get(e))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",i)),this._debug("INITIAL_SESSION","callback id",e,"session",i)}catch(i){await((s=this.stateChangeEmitters.get(e))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",i),console.error(i)}})}async resetPasswordForEmail(e,t={}){let r=null,s=null;this.flowType==="pkce"&&([r,s]=await dt(this.storage,this.storageKey,!0));try{return await z(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:r,code_challenge_method:s,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(i){if(W(i))return{data:null,error:i};throw i}}async getUserIdentities(){var e;try{const{data:t,error:r}=await this.getUser();if(r)throw r;return{data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(t){if(W(t))return{data:null,error:t};throw t}}async linkIdentity(e){var t;try{const{data:r,error:s}=await this._useSession(async i=>{var o,a,c,u,d;const{data:h,error:f}=i;if(f)throw f;const p=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(o=e.options)===null||o===void 0?void 0:o.redirectTo,scopes:(a=e.options)===null||a===void 0?void 0:a.scopes,queryParams:(c=e.options)===null||c===void 0?void 0:c.queryParams,skipBrowserRedirect:!0});return await z(this.fetch,"GET",p,{headers:this.headers,jwt:(d=(u=h.session)===null||u===void 0?void 0:u.access_token)!==null&&d!==void 0?d:void 0})});if(s)throw s;return ke()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(r?.url),{data:{provider:e.provider,url:r?.url},error:null}}catch(r){if(W(r))return{data:{provider:e.provider,url:null},error:r};throw r}}async unlinkIdentity(e){try{return await this._useSession(async t=>{var r,s;const{data:i,error:o}=t;if(o)throw o;return await z(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(s=(r=i.session)===null||r===void 0?void 0:r.access_token)!==null&&s!==void 0?s:void 0})})}catch(t){if(W(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const r=Date.now();return await sl(async s=>(s>0&&await nl(200*Math.pow(2,s-1)),this._debug(t,"refreshing attempt",s),await z(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:Le})),(s,i)=>{const o=200*Math.pow(2,s);return i&&dr(i)&&Date.now()+o-r<gt})}catch(r){if(this._debug(t,"error",r),W(r))return{data:{session:null,user:null},error:r};throw r}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const r=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",r),ke()&&!t.skipBrowserRedirect&&window.location.assign(r),{data:{provider:e,url:r},error:null}}async _recoverAndRefresh(){var e;const t="#_recoverAndRefresh()";this._debug(t,"begin");try{const r=await Wt(this.storage,this.storageKey);if(this._debug(t,"session from storage",r),!this._isValidSession(r)){this._debug(t,"session is not valid"),r!==null&&await this._removeSession();return}const s=((e=r.expires_at)!==null&&e!==void 0?e:1/0)*1e3-Date.now()<ur;if(this._debug(t,`session has${s?"":" not"} expired with margin of ${ur}s`),s){if(this.autoRefreshToken&&r.refresh_token){const{error:i}=await this._callRefreshToken(r.refresh_token);i&&(console.error(i),dr(i)||(this._debug(t,"refresh failed with a non-retryable error, removing the session",i),await this._removeSession()))}}else await this._notifyAllSubscribers("SIGNED_IN",r)}catch(r){this._debug(t,"error",r),console.error(r);return}finally{this._debug(t,"end")}}async _callRefreshToken(e){var t,r;if(!e)throw new Be;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const s=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(s,"begin");try{this.refreshingDeferred=new Zt;const{data:i,error:o}=await this._refreshAccessToken(e);if(o)throw o;if(!i.session)throw new Be;await this._saveSession(i.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",i.session);const a={session:i.session,error:null};return this.refreshingDeferred.resolve(a),a}catch(i){if(this._debug(s,"error",i),W(i)){const o={session:null,error:i};return dr(i)||await this._removeSession(),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(o),o}throw(r=this.refreshingDeferred)===null||r===void 0||r.reject(i),i}finally{this.refreshingDeferred=null,this._debug(s,"end")}}async _notifyAllSubscribers(e,t,r=!0){const s=`#_notifyAllSubscribers(${e})`;this._debug(s,"begin",t,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:e,session:t});const i=[],o=Array.from(this.stateChangeEmitters.values()).map(async a=>{try{await a.callback(e,t)}catch(c){i.push(c)}});if(await Promise.all(o),i.length>0){for(let a=0;a<i.length;a+=1)console.error(i[a]);throw i[0]}}finally{this._debug(s,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await Mo(this.storage,this.storageKey,e)}async _removeSession(){this._debug("#_removeSession()"),await Gt(this.storage,this.storageKey),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&ke()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),gt);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:r}}=t;if(!r||!r.refresh_token||!r.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const s=Math.floor((r.expires_at*1e3-e)/gt);this._debug("#_autoRefreshTokenTick()",`access token expires in ${s} ticks, a tick lasts ${gt}ms, refresh threshold is ${In} ticks`),s<=In&&await this._callRefreshToken(r.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof Fo)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!ke()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,r){const s=[`provider=${encodeURIComponent(t)}`];if(r?.redirectTo&&s.push(`redirect_to=${encodeURIComponent(r.redirectTo)}`),r?.scopes&&s.push(`scopes=${encodeURIComponent(r.scopes)}`),this.flowType==="pkce"){const[i,o]=await dt(this.storage,this.storageKey),a=new URLSearchParams({code_challenge:`${encodeURIComponent(i)}`,code_challenge_method:`${encodeURIComponent(o)}`});s.push(a.toString())}if(r?.queryParams){const i=new URLSearchParams(r.queryParams);s.push(i.toString())}return r?.skipBrowserRedirect&&s.push(`skip_http_redirect=${r.skipBrowserRedirect}`),`${e}?${s.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var r;const{data:s,error:i}=t;return i?{data:null,error:i}:await z(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(r=s?.session)===null||r===void 0?void 0:r.access_token})})}catch(t){if(W(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var r,s;const{data:i,error:o}=t;if(o)return{data:null,error:o};const a=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:{issuer:e.issuer}),{data:c,error:u}=await z(this.fetch,"POST",`${this.url}/factors`,{body:a,headers:this.headers,jwt:(r=i?.session)===null||r===void 0?void 0:r.access_token});return u?{data:null,error:u}:(e.factorType==="totp"&&(!((s=c?.totp)===null||s===void 0)&&s.qr_code)&&(c.totp.qr_code=`data:image/svg+xml;utf-8,${c.totp.qr_code}`),{data:c,error:null})})}catch(t){if(W(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r;const{data:s,error:i}=t;if(i)return{data:null,error:i};const{data:o,error:a}=await z(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(r=s?.session)===null||r===void 0?void 0:r.access_token});return a?{data:null,error:a}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+o.expires_in},o)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",o),{data:o,error:a})})}catch(t){if(W(t))return{data:null,error:t};throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r;const{data:s,error:i}=t;return i?{data:null,error:i}:await z(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:(r=s?.session)===null||r===void 0?void 0:r.access_token})})}catch(t){if(W(t))return{data:null,error:t};throw t}})}async _challengeAndVerify(e){const{data:t,error:r}=await this._challenge({factorId:e.factorId});return r?{data:null,error:r}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const r=e?.factors||[],s=r.filter(o=>o.factor_type==="totp"&&o.status==="verified"),i=r.filter(o=>o.factor_type==="phone"&&o.status==="verified");return{data:{all:r,totp:s,phone:i},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,r;const{data:{session:s},error:i}=e;if(i)return{data:null,error:i};if(!s)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:o}=hr(s.access_token);let a=null;o.aal&&(a=o.aal);let c=a;((r=(t=s.user.factors)===null||t===void 0?void 0:t.filter(h=>h.status==="verified"))!==null&&r!==void 0?r:[]).length>0&&(c="aal2");const d=o.amr||[];return{data:{currentLevel:a,nextLevel:c,currentAuthenticationMethods:d},error:null}}))}async fetchJwk(e,t={keys:[]}){let r=t.keys.find(o=>o.kid===e);if(r||(r=this.jwks.keys.find(o=>o.kid===e),r&&this.jwks_cached_at+Fc>Date.now()))return r;const{data:s,error:i}=await z(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(i)throw i;if(!s.keys||s.keys.length===0)throw new xt("JWKS is empty");if(this.jwks=s,this.jwks_cached_at=Date.now(),r=s.keys.find(o=>o.kid===e),!r)throw new xt("No matching signing key found in JWKS");return r}async getClaims(e,t={keys:[]}){try{let r=e;if(!r){const{data:p,error:y}=await this.getSession();if(y||!p.session)return{data:null,error:y};r=p.session.access_token}const{header:s,payload:i,signature:o,raw:{header:a,payload:c}}=hr(r);if(dl(i.exp),!s.kid||s.alg==="HS256"||!("crypto"in globalThis&&"subtle"in globalThis.crypto)){const{error:p}=await this.getUser(r);if(p)throw p;return{data:{claims:i,header:s,signature:o},error:null}}const u=hl(s.alg),d=await this.fetchJwk(s.kid,t),h=await crypto.subtle.importKey("jwk",d,u,!0,["verify"]);if(!await crypto.subtle.verify(u,h,o,Qc(`${a}.${c}`)))throw new xt("Invalid JWT signature");return{data:{claims:i,header:s,signature:o},error:null}}catch(r){if(W(r))return{data:null,error:r};throw r}}}Ut.nextInstanceID=0;const Rl=Ut;class Ol extends Rl{constructor(e){super(e)}}var jl=function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(d){try{u(r.next(d))}catch(h){o(h)}}function c(d){try{u(r.throw(d))}catch(h){o(h)}}function u(d){d.done?i(d.value):s(d.value).then(a,c)}u((r=r.apply(n,e||[])).next())})};class Il{constructor(e,t,r){var s,i,o;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const a=Uc(e),c=new URL(a);this.realtimeUrl=new URL("realtime/v1",c),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",c),this.storageUrl=new URL("storage/v1",c),this.functionsUrl=new URL("functions/v1",c);const u=`sb-${c.hostname.split(".")[0]}-auth-token`,d={db:Ac,realtime:Rc,auth:Object.assign(Object.assign({},$c),{storageKey:u}),global:kc},h=Dc(r??{},d);this.storageKey=(s=h.auth.storageKey)!==null&&s!==void 0?s:"",this.headers=(i=h.global.headers)!==null&&i!==void 0?i:{},h.accessToken?(this.accessToken=h.accessToken,this.auth=new Proxy({},{get:(f,p)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(p)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((o=h.auth)!==null&&o!==void 0?o:{},this.headers,h.global.fetch),this.fetch=xc(t,this._getAccessToken.bind(this),h.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},h.realtime)),this.rest=new Ja(new URL("rest/v1",c).href,{headers:this.headers,schema:h.db.schema,fetch:this.fetch}),h.accessToken||this._listenForAuthEvents()}get functions(){return new La(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}get storage(){return new Tc(this.storageUrl.href,this.headers,this.fetch)}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},r={}){return this.rest.rpc(e,t,r)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return jl(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:r}=yield this.auth.getSession();return(t=(e=r.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:null})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:s,storageKey:i,flowType:o,lock:a,debug:c},u,d){const h={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new Ol({url:this.authUrl.href,headers:Object.assign(Object.assign({},h),u),storageKey:i,autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:s,flowType:o,lock:a,debug:c,fetch:d,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(e){return new uc(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,r)=>{this._handleTokenChanged(t,"CLIENT",r?.access_token)})}_handleTokenChanged(e,t,r){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==r?this.changedAccessToken=r:e==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const xl=(n,e,t)=>new Il(n,e,t),Cl=void 0,Ul=void 0;console.error("Supabase URL or Anon Key is missing. Make sure to set VITE_SUPABASE_URL and VITE_SUPABASE_ANON_KEY in your .env file.");const X=xl(Cl,Ul,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!1,storageKey:"sb-auth-token",flowType:"pkce"},db:{schema:"public"},global:{headers:{"Content-Type":"application/json"},fetch:(n,e={})=>fetch(n,{...e,signal:AbortSignal.timeout(1e4)})}}),Bo=async()=>{try{console.log("Testing Supabase connection...");const{data:n,error:e}=await X.from("watch_history").select("count").limit(1);return e?(console.error("Supabase connection test failed:",e),!1):(console.log("Supabase connection test successful"),!0)}catch(n){return console.error("Supabase connection test error:",n),!1}};typeof window<"u"&&(window.supabase=X,window.testSupabaseConnection=Bo);const Ho=go();function Dl({children:n}){const[e,t]=B(null),[r,s]=B(null),[i,o]=B(!0);ie(()=>{(async()=>{const{data:{session:d}}=await X.auth.getSession();t(d),s(d?.user??null),o(!1)})();const{data:u}=X.auth.onAuthStateChange((d,h)=>{t(h),s(h?.user??null)});return()=>{u.subscription.unsubscribe()}},[]);const a={session:e,user:r,signOut:()=>X.auth.signOut()};return l(Ho.Provider,{value:a,children:!i&&n})}function Ze(){return vo(Ho)}let Ll=0,_t=null;const Qt={success:(n,e={})=>Kt(n,"success",e),error:(n,e={})=>Kt(n,"error",e),info:(n,e={})=>Kt(n,"info",e),warning:(n,e={})=>Kt(n,"warning",e)},Kt=(n,e="info",t={})=>{if(!_t)return;const r=Ll++,s=t.duration||(e==="error"?6e3:4e3),i={id:r,message:n,type:e,duration:s,timestamp:Date.now()};return _t(o=>[...o,i]),setTimeout(()=>{Un(r)},s),r},Un=n=>{_t&&_t(e=>e.filter(t=>t.id!==n))},Nl=({position:n="top-center"})=>{const[e,t]=B([]);return ie(()=>(_t=t,()=>{_t=null}),[]),e.length===0?null:l("div",{class:`toast-container toast-container--${n}`,children:e.map(r=>l("div",{class:`toast toast--${r.type}`,onClick:()=>Un(r.id),children:[l("div",{class:"toast__content",children:[r.type==="success"&&l("span",{class:"toast__icon",children:"✅"}),r.type==="error"&&l("span",{class:"toast__icon",children:"❌"}),r.type==="warning"&&l("span",{class:"toast__icon",children:"⚠️"}),r.type==="info"&&l("span",{class:"toast__icon",children:"ℹ️"}),l("span",{class:"toast__message",children:r.message})]}),l("button",{class:"toast__close",onClick:s=>{s.stopPropagation(),Un(r.id)},children:"×"})]},r.id))})},be={DARK:"dark",LIGHT:"light"},zn=()=>{const n=localStorage.getItem("theme");return n&&Object.values(be).includes(n)?n:window.matchMedia("(prefers-color-scheme: dark)").matches?be.DARK:be.LIGHT},Dn=n=>{Object.values(be).includes(n)||(console.warn(`Invalid theme: ${n}. Using default dark theme.`),n=be.DARK),n===be.LIGHT?document.documentElement.setAttribute("data-theme","light"):document.documentElement.removeAttribute("data-theme"),localStorage.setItem("theme",n),window.dispatchEvent(new CustomEvent("themeChanged",{detail:{theme:n}}))},ql=()=>{const e=zn()===be.LIGHT?be.DARK:be.LIGHT;return Dn(e),e},Ml=()=>{const n=zn();Dn(n),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",e=>{localStorage.getItem("theme")||Dn(e.matches?be.DARK:be.LIGHT)})},Fl=()=>{const[n,e]=B(!0);return ie(()=>{const r=zn();e(r===be.DARK);const s=i=>{e(i.detail.theme===be.DARK)};return window.addEventListener("themeChanged",s),()=>{window.removeEventListener("themeChanged",s)}},[]),l("button",{class:`theme-toggle ${n?"dark":"light"}`,onClick:()=>{const r=ql();e(r===be.DARK)},"aria-label":`Switch to ${n?"light":"dark"} mode`,title:`Switch to ${n?"light":"dark"} mode`,children:l("div",{class:"toggle-track",children:l("div",{class:"toggle-thumb",children:l("div",{class:"icon",children:n?l("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:l("path",{d:"M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"})}):l("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[l("circle",{cx:"12",cy:"12",r:"5"}),l("line",{x1:"12",y1:"1",x2:"12",y2:"3"}),l("line",{x1:"12",y1:"21",x2:"12",y2:"23"}),l("line",{x1:"4.22",y1:"4.22",x2:"5.64",y2:"5.64"}),l("line",{x1:"18.36",y1:"18.36",x2:"19.78",y2:"19.78"}),l("line",{x1:"1",y1:"12",x2:"3",y2:"12"}),l("line",{x1:"21",y1:"12",x2:"23",y2:"12"}),l("line",{x1:"4.22",y1:"19.78",x2:"5.64",y2:"18.36"}),l("line",{x1:"18.36",y1:"5.64",x2:"19.78",y2:"4.22"})]})})})})})},Bl=()=>{const[n,e]=B(""),[t,r]=B(!1),[s,i]=B(!1),{user:o,signOut:a}=Ze(),c=f=>{f.preventDefault(),n.trim()&&(je(`/search?q=${encodeURIComponent(n.trim())}`),e(""),i(!1))},u=async()=>{await a(),je("/")},d=()=>{r(!t),i(!1)};return l("header",{children:l("div",{class:"container",children:[l("div",{class:"header-left",children:[l(Oe,{href:"/",class:"logo",children:"FreeStream"}),l("nav",{class:t?"active":"",children:l("ul",{onClick:()=>r(!1),children:[l("li",{children:l(Oe,{activeClassName:"active",href:"/movies",children:"Movies"})}),l("li",{children:l(Oe,{activeClassName:"active",href:"/tv",children:"TV"})}),o?l(vt,{children:[l("li",{children:l(Oe,{activeClassName:"active",href:"/favorites",children:"Favorites"})}),l("li",{children:l(Oe,{activeClassName:"active",href:"/history",children:"History"})})]}):l(vt,{children:[l("li",{children:l("a",{href:"/login",style:{color:"#999",fontSize:"0.9em"},children:"Favorites (Login Required)"})}),l("li",{children:l("a",{href:"/login",style:{color:"#999",fontSize:"0.9em"},children:"History (Login Required)"})})]})]})})]}),s&&l("div",{class:"mobile-search-overlay",children:l("form",{class:"mobile-search-form",onSubmit:c,children:[l("input",{type:"text",placeholder:"Search movies & TV shows...",value:n,onInput:f=>e(f.target.value),class:"mobile-search-input",autoFocus:!0}),l("button",{type:"submit",class:"mobile-search-submit",children:l("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2",children:[l("circle",{cx:"11",cy:"11",r:"8"}),l("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"})]})})]})}),l("div",{class:"header-right",children:[l("form",{class:"search-container desktop-only",onSubmit:c,children:l("input",{type:"text",placeholder:"Search...",value:n,onInput:f=>e(f.target.value),class:"glass-light"})}),l("button",{class:"search-toggle mobile-only",onClick:()=>{i(!s),r(!1)},"aria-label":"Toggle search",children:l("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2",children:[l("circle",{cx:"11",cy:"11",r:"8"}),l("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"})]})}),l(Fl,{}),l("div",{class:"auth-links",children:o?l(vt,{children:[l("span",{class:"user-email",children:o.email}),l("button",{onClick:u,class:"auth-button",children:"Logout"})]}):l(vt,{children:[l(Oe,{href:"/login",class:"auth-link",children:"Login"}),l(Oe,{href:"/signup",class:"auth-link",children:"Sign Up"})]})})]}),l("button",{class:"hamburger",onClick:d,"aria-label":"Toggle menu",children:[l("span",{class:"bar"}),l("span",{class:"bar"}),l("span",{class:"bar"})]})]})})};var Hl=["className","activeClass","activeClassName","path"];function He(n){var e=n.className,t=n.activeClass,r=n.activeClassName,s=n.path,i=function(d,h){if(d==null)return{};var f,p,y={},v=Object.keys(d);for(p=0;p<v.length;p++)h.indexOf(f=v[p])>=0||(y[f]=d[f]);return y}(n,Hl),o=Pa()[0],a=s&&o.path&&Pn(o.path,s,{})||Pn(o.url,i.href,{}),c=i.class||e||"",u=a&&(t||r)||"";return i.class=c+(c&&u&&" ")+u,Mn(Oe,i)}const Wl=()=>l("footer",{class:"app-footer",children:[l("div",{class:"footer-content",children:[l("div",{class:"footer-brand",children:[l(He,{href:"/",class:"logo",children:"FreeStream"}),l("p",{children:"Your gateway to unlimited entertainment. Built with passion."})]}),l("div",{class:"footer-links",children:[l("div",{class:"footer-section",children:[l("h4",{children:"Platform"}),l("ul",{children:[l("li",{children:l(He,{href:"/",children:"Home"})}),l("li",{children:l(He,{href:"/movies",children:"Movies"})}),l("li",{children:l(He,{href:"/tv",children:"TV Shows"})})]})]}),l("div",{class:"footer-section",children:[l("h4",{children:"Account"}),l("ul",{children:[l("li",{children:l(He,{href:"/login",children:"Login"})}),l("li",{children:l(He,{href:"/signup",children:"Sign Up"})}),l("li",{children:l(He,{href:"/favorites",children:"Favorites"})})]})]}),l("div",{class:"footer-section",children:[l("h4",{children:"Legal"}),l("ul",{children:[l("li",{children:l("a",{href:"#",children:"Terms of Service"})}),l("li",{children:l("a",{href:"#",children:"Privacy Policy"})})]})]})]})]}),l("div",{class:"footer-bottom",children:[l("p",{children:"© 2024 FreeStream. All Rights Reserved. Not a real streaming service."}),l("div",{class:"footer-socials",children:[l("a",{href:"#","aria-label":"Github",children:l("i",{class:"fab fa-github"})}),l("a",{href:"#","aria-label":"Twitter",children:l("i",{class:"fab fa-twitter"})})]})]})]}),Zs=n=>{let e;const t=new Set,r=(u,d)=>{const h=typeof u=="function"?u(e):u;if(!Object.is(h,e)){const f=e;e=d??(typeof h!="object"||h===null)?h:Object.assign({},e,h),t.forEach(p=>p(e,f))}},s=()=>e,a={setState:r,getState:s,getInitialState:()=>c,subscribe:u=>(t.add(u),()=>t.delete(u))},c=e=n(r,s,a);return a},Gl=n=>n?Zs(n):Zs,Kl=n=>n;function Vl(n,e=Kl){const t=_s.useSyncExternalStore(n.subscribe,()=>e(n.getState()),()=>e(n.getInitialState()));return _s.useDebugValue(t),t}const ei=n=>{const e=Gl(n),t=r=>Vl(e,r);return Object.assign(t,e),t},zl=n=>n?ei(n):ei;function Jl(n,e){let t;try{t=n()}catch{return}return{getItem:s=>{var i;const o=c=>c===null?null:JSON.parse(c,void 0),a=(i=t.getItem(s))!=null?i:null;return a instanceof Promise?a.then(o):o(a)},setItem:(s,i)=>t.setItem(s,JSON.stringify(i,void 0)),removeItem:s=>t.removeItem(s)}}const Ln=n=>e=>{try{const t=n(e);return t instanceof Promise?t:{then(r){return Ln(r)(t)},catch(r){return this}}}catch(t){return{then(r){return this},catch(r){return Ln(r)(t)}}}},Yl=(n,e)=>(t,r,s)=>{let i={storage:Jl(()=>localStorage),partialize:v=>v,version:0,merge:(v,g)=>({...g,...v}),...e},o=!1;const a=new Set,c=new Set;let u=i.storage;if(!u)return n((...v)=>{console.warn(`[zustand persist middleware] Unable to update item '${i.name}', the given storage is currently unavailable.`),t(...v)},r,s);const d=()=>{const v=i.partialize({...r()});return u.setItem(i.name,{state:v,version:i.version})},h=s.setState;s.setState=(v,g)=>{h(v,g),d()};const f=n((...v)=>{t(...v),d()},r,s);s.getInitialState=()=>f;let p;const y=()=>{var v,g;if(!u)return;o=!1,a.forEach(E=>{var _;return E((_=r())!=null?_:f)});const w=((g=i.onRehydrateStorage)==null?void 0:g.call(i,(v=r())!=null?v:f))||void 0;return Ln(u.getItem.bind(u))(i.name).then(E=>{if(E)if(typeof E.version=="number"&&E.version!==i.version){if(i.migrate){const _=i.migrate(E.state,E.version);return _ instanceof Promise?_.then(P=>[!0,P]):[!0,_]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,E.state];return[!1,void 0]}).then(E=>{var _;const[P,b]=E;if(p=i.merge(b,(_=r())!=null?_:f),t(p,!0),P)return d()}).then(()=>{w?.(p,void 0),p=r(),o=!0,c.forEach(E=>E(p))}).catch(E=>{w?.(void 0,E)})};return s.persist={setOptions:v=>{i={...i,...v},v.storage&&(u=v.storage)},clearStorage:()=>{u?.removeItem(i.name)},getOptions:()=>i,rehydrate:()=>y(),hasHydrated:()=>o,onHydrate:v=>(a.add(v),()=>{a.delete(v)}),onFinishHydration:v=>(c.add(v),()=>{c.delete(v)})},i.skipHydration||y(),p||f},Ql=Yl,Nn="https://image.tmdb.org/t/p/w500",Xl=()=>"/api",we=Xl();function qn(n){return n?`${we}/image-proxy?url=${encodeURIComponent(n)}`:""}console.log(`🚀 API Base URL: ${we}`);console.log("🌍 Environment: production");const Ie=async()=>{let e=0;for(;e<2;)try{const t=new Promise((o,a)=>setTimeout(()=>a(new Error("Auth timeout")),5e3)),r=X.auth.getSession(),{data:{session:s},error:i}=await Promise.race([r,t]);if(i){if(console.error("Error getting current session:",i),i.message&&i.message.includes("NetworkError")&&e<1){e++,console.log(`Retrying auth session (attempt ${e+1}/2)`),await new Promise(o=>setTimeout(o,500*e));continue}return null}return s?.user?.id||null}catch(t){if(console.error("Error in getCurrentUserId:",t),t.message&&(t.message.includes("NetworkError")||t.message.includes("timeout"))&&e<1){e++,console.log(`Retrying auth due to network error (attempt ${e+1}/2)`),await new Promise(r=>setTimeout(r,500*e));continue}return null}return console.error("Failed to get user session after all retry attempts"),null},Zl=async()=>{let e=0;for(;e<3;)try{const t=await Ie();if(!t)return console.log("No authenticated user, returning empty watch history"),[];const r=new Promise((a,c)=>setTimeout(()=>c(new Error("Request timeout")),1e4)),s=X.from("watch_history").select("*").eq("user_id",t).order("watched_at",{ascending:!1}),{data:i,error:o}=await Promise.race([s,r]);if(o){if(console.error("Error fetching watch history:",o),o.message&&o.message.includes("NetworkError")&&e<2){e++,console.log(`Retrying watch history fetch (attempt ${e+1}/3)`),await new Promise(a=>setTimeout(a,1e3*e));continue}return[]}return i||[]}catch(t){if(console.error("Error in getWatchHistory:",t),t.message&&(t.message.includes("NetworkError")||t.message.includes("timeout"))&&e<2){e++,console.log(`Retrying watch history fetch due to network error (attempt ${e+1}/3)`),await new Promise(r=>setTimeout(r,1e3*e));continue}return[]}return console.error("Failed to fetch watch history after all retry attempts"),[]},pr=async(n,e,t,r)=>{try{const s=await Ie();if(!s)return console.log("No authenticated user, returning null progress"),null;let i=X.from("watch_progress").select("progress_seconds, duration_seconds").eq("user_id",s).eq("media_id",n).eq("media_type",e);e!=="movie"&&(i=i.eq("season_number",t).eq("episode_number",r));const{data:o,error:a}=await i;return a?(console.error("Error fetching watch progress:",a),null):o&&o.length>0?o[0]:null}catch(s){return console.error("Error in getWatchProgressForMedia:",s),null}},eu=async()=>{try{const n=await Ie();if(!n)return console.log("No authenticated user, returning empty continue watching list"),[];console.log("🔍 Fetching continue watching from watch_history...");const{data:e,error:t}=await X.from("watch_history").select("media_id, media_type, season_number, episode_number, watched_at").eq("user_id",n).order("watched_at",{ascending:!1});if(t)return console.error("Error fetching watch history for continue watching:",t),[];if(!e||e.length===0)return console.log("📭 No watch history found"),[];console.log(`📊 Found ${e.length} watch history entries`);const r=new Map;e.forEach(u=>{const d=u.media_id;r.has(d)||r.set(d,[]),r.get(d).push(u)});const s=[];for(const[u,d]of r){const f=d.sort((p,y)=>p.media_type==="movie"?new Date(y.watched_at)-new Date(p.watched_at):p.season_number!==y.season_number?(y.season_number||0)-(p.season_number||0):(y.episode_number||0)-(p.episode_number||0))[0];console.log(`📺 Most advanced for media ${u}: S${f.season_number}E${f.episode_number} (${f.media_type})`),s.push(f)}const o=(await Promise.all(s.map(async u=>{try{let d=X.from("watch_progress").select("progress_seconds, duration_seconds, updated_at").eq("user_id",n).eq("media_id",u.media_id).eq("media_type",u.media_type);u.media_type!=="movie"&&(d=d.eq("season_number",u.season_number).eq("episode_number",u.episode_number));const{data:h,error:f}=await d;if(f)return console.error(`Error fetching progress for ${u.media_id}:`,f),null;const p=h&&h.length>0?h[0]:null,y=p&&p.progress_seconds>30,v=new Date(u.watched_at)>new Date(Date.now()-7*24*60*60*1e3);if(y||v){if(p&&p.duration_seconds>0&&p.progress_seconds/p.duration_seconds>=.9){if(u.media_type!=="movie"){const w=await Wo(u.media_id,u.season_number,u.episode_number,u.media_type);if(w)return console.log(`✅ Episode completed, suggesting next: S${w.season}E${w.episode}`),{...u,season_number:w.season,episode_number:w.episode,progress_seconds:0,duration_seconds:null,updated_at:p.updated_at}}return null}return{...u,progress_seconds:p?.progress_seconds||0,duration_seconds:p?.duration_seconds||null,updated_at:p?.updated_at||u.watched_at}}return null}catch(d){return console.error(`Error processing continue watching entry for ${u.media_id}:`,d),null}}))).filter(Boolean).sort((u,d)=>new Date(d.updated_at)-new Date(u.updated_at));console.log(`📺 Found ${o.length} valid continue watching entries`);const c=(await Promise.all(o.map(async u=>{try{const d=await fetch(`${we}/tmdb/${u.media_type}/${u.media_id}`);return d.ok?{...await d.json(),type:u.media_type,progress_seconds:u.progress_seconds,duration_seconds:u.duration_seconds,season_number:u.season_number,episode_number:u.episode_number,updated_at:u.updated_at,media_id:u.media_id}:null}catch(d){return console.error("Error fetching TMDB details for continue watching item:",d),null}}))).filter(Boolean);return console.log(`🎬 Returning ${c.length} continue watching items`),c}catch(n){return console.error("Error in getContinueWatching:",n),[]}},ti=async(n,e,t,r=!1)=>{const s=await Ie();if(!s)return console.error("❌ Cannot save watch progress: No authenticated user"),!1;if(!n||typeof e>"u"||e<0)return console.error("❌ Invalid progress data:",{item:n,progress:e,durationInSeconds:t}),!1;const i={p_media_id:n.id,p_media_type:n.type,p_season_number:n.season||null,p_episode_number:n.episode||null,p_progress_seconds:e>0?Math.ceil(e):0,p_duration_seconds:t?Math.round(t):null,p_force_history_entry:r};console.log("💾 Saving watch progress (v2)...",i);const{error:o}=await X.rpc("save_watch_progress",i);if(!o)return console.log("✅ Watch progress saved successfully via RPC (v2)"),!0;console.warn(`⚠️ RPC (v2) failed, trying legacy (v1). Error: ${o.message}`);const{p_force_history_entry:a,...c}=i,{error:u}=await X.rpc("save_watch_progress",c);if(!u)return console.log("✅ Watch progress saved successfully via RPC (v1)"),!0;console.warn(`⚠️ RPC (v1) also failed, attempting direct DB write. Error: ${u.message}`);try{if(await tu(s,n,e,t,r))return!0}catch(d){console.error("❌ Direct DB write fallback threw an exception:",d)}return console.error("❌ All methods to save progress failed."),!1},tu=async(n,e,t,r,s)=>{try{console.log("🔄 Using direct database fallback for watch progress");const{error:i}=await X.from("watch_progress").upsert({user_id:n,media_id:e.id,media_type:e.type,season_number:e.season||null,episode_number:e.episode||null,progress_seconds:t>0?Math.ceil(t):0,duration_seconds:r?Math.round(r):null,updated_at:new Date().toISOString()},{onConflict:"user_id,media_id,media_type,season_number,episode_number"});if(i)return console.error("❌ Direct progress insert error:",i),!1;if(s||t>60){const{error:o}=await X.from("watch_history").upsert({user_id:n,media_id:e.id,media_type:e.type,season_number:e.season||null,episode_number:e.episode||null,watched_at:new Date().toISOString()},{onConflict:"user_id,media_id,media_type,season_number,episode_number"});o&&console.error("❌ Direct history insert error:",o)}return console.log("✅ Watch progress saved via direct database fallback"),!0}catch(i){return console.error("❌ Direct database fallback failed:",i),!1}},ri=async n=>{try{const e=await Ie();if(!e){console.log("Cannot add watch history entry: No authenticated user");return}if(!n)return;const{error:t}=await X.from("watch_history").upsert({user_id:e,media_id:n.id,media_type:n.type,season_number:n.season||null,episode_number:n.episode||null,watched_at:new Date().toISOString()},{onConflict:"user_id,media_id,media_type,season_number,episode_number"});t&&console.error("Error adding watch history entry:",t)}catch(e){console.error("Unexpected error adding watch history entry:",e)}},ru=async n=>{try{if(!n)return;if(!await Ie()){console.log("Cannot delete watch item: No authenticated user");return}const{error:t}=await X.rpc("delete_watch_item",{p_media_id:n.media_id,p_media_type:n.media_type,p_season_number:n.season_number,p_episode_number:n.episode_number});t&&console.error("Error deleting watch item:",t)}catch(e){console.error("Error in deleteWatchItem:",e)}},nu=async n=>{try{const e=await Ie();if(!e)return[];const{data:t,error:r}=await X.from("watch_progress").select("media_id, media_type, season_number, episode_number, progress_seconds, duration_seconds").eq("user_id",e).eq("media_id",n);return r?(console.error("Error fetching series history:",r),[]):t||[]}catch(e){return console.error("Error in getSeriesHistory:",e),[]}},Wo=async(n,e,t,r="tv")=>{try{const s=r==="anime"?"tv":r,i=await fetch(`${we}/tmdb/${s}/${n}`);if(!i.ok)return console.error(`Failed to fetch series details: ${i.status}`),null;const o=await i.json();if(!o.seasons||o.seasons.length===0)return console.error("No seasons found in series details"),null;const a=await fetch(`${we}/tmdb/${s}/${n}/season/${e}`);if(!a.ok)return console.error(`Failed to fetch season ${e} details: ${a.status}`),null;const c=await a.json();if(!c.episodes||c.episodes.length===0)return console.error(`No episodes found in season ${e}`),null;const u=c.episodes.length;if(console.log(`Current season ${e} has ${u} episodes, current episode: ${t}`),t<u)return console.log(`Next episode: S${e}E${t+1}`),{season:e,episode:t+1};const h=o.seasons.filter(f=>f.season_number>0).find(f=>f.season_number===e+1);return h&&h.episode_count>0?(console.log(`Next season found: S${h.season_number}E1`),{season:h.season_number,episode:1}):(console.log("No next episode available - series may be completed"),null)}catch(s){return console.error("Error getting next episode:",s),null}},su=async n=>{try{const e=await Ie();if(!e)return console.log("No authenticated user, returning null for last watched episode with progress"),null;console.log(`🔍 Looking for last watched episode for series ${n} from watch_history`);const{data:t,error:r}=await X.from("watch_history").select("season_number, episode_number, watched_at, media_type").eq("user_id",e).eq("media_id",n).order("watched_at",{ascending:!1});if(r)return console.error("Error fetching watch history:",r),null;if(!t||t.length===0)return console.log("📭 No episodes found in watch history"),null;console.log(`📊 Found ${t.length} episodes in watch history for series ${n}`);const i=t.sort((u,d)=>u.season_number!==d.season_number?d.season_number-u.season_number:d.episode_number-u.episode_number)[0];console.log(`📺 Most advanced episode from history: S${i.season_number}E${i.episode_number} (watched: ${i.watched_at})`);const{data:o,error:a}=await X.from("watch_progress").select("progress_seconds, duration_seconds, updated_at").eq("user_id",e).eq("media_id",n).eq("season_number",i.season_number).eq("episode_number",i.episode_number);if(a)return console.error("Error fetching progress data:",a),{season:i.season_number,episode:i.episode_number};const c=o&&o.length>0?o[0]:null;if(c){console.log(`📊 Progress data found: ${c.progress_seconds}/${c.duration_seconds}s`);let u=!1;if(c.duration_seconds>0){const d=c.progress_seconds/c.duration_seconds;u=d>=.9,console.log(`📊 Completion: ${(d*100).toFixed(1)}% - ${u?"COMPLETED":"INCOMPLETE"}`)}if(u){console.log(`✅ Most advanced episode S${i.season_number}E${i.episode_number} was completed, finding next episode`);const d=await Wo(n,i.season_number,i.episode_number,i.media_type);return d?(console.log(`🎯 Next episode found: S${d.season}E${d.episode}`),d):(console.log('🏁 No next episode available, series may be completed. No "continue watching" will be triggered.'),null)}else return console.log(`⏯️ Resuming incomplete episode S${i.season_number}E${i.episode_number}`),{season:i.season_number,episode:i.episode_number}}else return console.log(`📝 No progress data, but episode is in watch history: S${i.season_number}E${i.episode_number}`),{season:i.season_number,episode:i.episode_number}}catch(e){return console.error("Error in getLastWatchedEpisodeWithProgress:",e),null}},Go=async n=>{try{const e=await Ie();if(!e||!n||n.length===0)return{};const t={};return await Promise.all(n.map(async r=>{try{let s=X.from("watch_progress").select("progress_seconds, duration_seconds").eq("user_id",e).eq("media_id",r.media_id).eq("media_type",r.media_type);r.media_type==="tv"&&(r.season_number!=null&&(s=s.eq("season_number",r.season_number)),r.episode_number!=null&&(s=s.eq("episode_number",r.episode_number)));const{data:i,error:o}=await s;if(o)console.error(`Error fetching progress for ${r.media_type} ${r.media_id}:`,o);else if(i&&i.length>0){const a=i[0],c=`${r.media_id}-${r.media_type}-${r.season_number||0}-${r.episode_number||0}`;a.progress_seconds>=0&&a.duration_seconds>0&&(t[c]={progress_seconds:a.progress_seconds,duration_seconds:a.duration_seconds})}}catch(s){console.error(`Error fetching progress for item ${r.media_id}:`,s)}})),t}catch(e){return console.error("Error in getProgressForHistoryItems:",e),{}}},iu=async()=>{let e=0;for(;e<3;)try{const t=await Ie();if(!t)return console.log("No authenticated user, returning empty watch history with progress"),[];console.log("🔄 Fetching combined watch history and progress data...");const[r,s]=await Promise.all([X.from("watch_history").select("*").eq("user_id",t).order("watched_at",{ascending:!1}),X.from("watch_progress").select("media_id, media_type, season_number, episode_number, progress_seconds, duration_seconds").eq("user_id",t)]);if(r.error)throw r.error;s.error&&console.warn("Error fetching progress data, continuing without progress:",s.error);const i=r.data||[],o=s.data||[],a={};o.forEach(u=>{const d=`${u.media_id}-${u.media_type}-${u.season_number||0}-${u.episode_number||0}`;a[d]=u});const c=i.map(u=>{const d=`${u.media_id}-${u.media_type}-${u.season_number||0}-${u.episode_number||0}`,h=a[d];return{...u,progress_seconds:h?.progress_seconds||null,duration_seconds:h?.duration_seconds||null}});return console.log("✅ Successfully fetched combined data:",{totalItems:c.length,itemsWithProgress:c.filter(u=>u.progress_seconds>0).length}),c}catch(t){if(console.error("Error in getWatchHistoryWithProgress:",t),t.message&&(t.message.includes("NetworkError")||t.message.includes("timeout"))&&e<2){e++,console.log(`Retrying combined fetch due to network error (attempt ${e+1}/3)`),await new Promise(r=>setTimeout(r,1e3*e));continue}try{console.log("📋 All retries failed, trying fallback approach...");const r=await Zl(),s=await Go(r);return r.map(i=>{const o=`${i.media_id}-${i.media_type}-${i.season_number||0}-${i.episode_number||0}`,a=s[o];return{...i,progress_seconds:a?.progress_seconds||null,duration_seconds:a?.duration_seconds||null}})}catch(r){return console.error("Fallback approach also failed:",r),[]}}return console.error("Failed to fetch combined watch history and progress after all retry attempts"),[]},ze=async(n,e=3)=>{let t=[];for(let r=1;r<=e;r++)try{const s=await fetch(`${n}?page=${r}`);if(s.ok){const i=await s.json();t=[...t,...i.results||[]]}}catch(s){console.error(`Error fetching page ${r} from ${n}:`,s)}return t},wt=zl(Ql((n,e)=>({trending:[],popularMovies:[],popularTv:[],topRatedMovies:[],topRatedTv:[],upcomingMovies:[],nowPlayingMovies:[],airingTodayTv:[],favorites:[],favoritesFetched:!1,currentMediaItem:null,continueWatching:[],continueWatchingFetched:!1,fetchContinueWatching:async()=>{const{data:{user:t}}=await X.auth.getUser();if(!t){n({continueWatching:[],continueWatchingFetched:!0});return}const r=await eu();if(!r||r.length===0){n({continueWatching:[],continueWatchingFetched:!0});return}const s=r.reduce((i,o)=>(i.some(a=>a.media_id===o.media_id)||i.push(o),i),[]);n({continueWatching:s,continueWatchingFetched:!0})},removeContinueWatchingItem:t=>{n(r=>({continueWatching:r.continueWatching.filter(s=>s.media_id!==t)}))},setCurrentMediaItem:t=>n({currentMediaItem:t}),fetchTrending:async()=>{if(!(e().trending.length>0))try{const t=await fetch("/api/tmdb/trending/all/week");if(t.ok){const r=await t.json();n({trending:r.results||[]})}}catch(t){console.error("Error fetching trending:",t)}},fetchPopularMovies:async()=>{if(e().popularMovies.length>0)return;const t=await ze("/api/tmdb/movie/popular");n({popularMovies:t})},fetchPopularTv:async()=>{if(e().popularTv.length>0)return;const t=await ze("/api/tmdb/tv/popular");n({popularTv:t})},fetchTopRatedMovies:async()=>{if(e().topRatedMovies.length>0)return;const t=await ze("/api/tmdb/movie/top_rated");n({topRatedMovies:t})},fetchTopRatedTv:async()=>{if(e().topRatedTv.length>0)return;const t=await ze("/api/tmdb/tv/top_rated");n({topRatedTv:t})},fetchUpcomingMovies:async()=>{if(e().upcomingMovies.length>0)return;const t=await ze("/api/tmdb/movie/upcoming");n({upcomingMovies:t})},fetchNowPlayingMovies:async()=>{if(e().nowPlayingMovies.length>0)return;const t=await ze("/api/tmdb/movie/now_playing");n({nowPlayingMovies:t})},fetchAiringTodayTv:async()=>{if(e().airingTodayTv.length>0)return;const t=await ze("/api/tmdb/tv/airing_today");n({airingTodayTv:t})},fetchFavorites:async()=>{const{data:{user:t}}=await X.auth.getUser();if(!t){n({favorites:[],favoritesFetched:!0});return}const{data:r,error:s}=await X.from("favorites").select("media_id, media_type, season_number, episode_number, episode_name").eq("user_id",t.id);if(s){console.error("Error fetching favorites:",s),n({favoritesFetched:!0});return}const i=await Promise.all(r.map(async o=>{const a=await fetch(`/api/tmdb/${o.media_type}/${o.media_id}`);if(a.ok){const c=await a.json();if(o.media_type==="tv"&&o.season_number&&o.episode_number){try{const u=await fetch(`/api/tmdb/tv/${o.media_id}/season/${o.season_number}/episode/${o.episode_number}`);if(u.ok){const d=await u.json();return{...c,type:o.media_type,season_number:o.season_number,episode_number:o.episode_number,episode_name:d.name||o.episode_name,still_path:d.still_path,vote_average:d.vote_average||c.vote_average,overview:d.overview||c.overview}}}catch(u){console.error("Error fetching episode details:",u)}return{...c,type:o.media_type,season_number:o.season_number,episode_number:o.episode_number,episode_name:o.episode_name}}return{...c,type:o.media_type}}return null}));n({favorites:i.filter(Boolean),favoritesFetched:!0})},addFavorite:async t=>{const{data:{user:r}}=await X.auth.getUser();if(!r)return;n(o=>({favorites:[t,...o.favorites]}));const s={user_id:r.id,media_id:t.id,media_type:t.type};t.type==="tv"&&t.season_number&&t.episode_number&&(s.season_number=t.season_number,s.episode_number=t.episode_number,s.episode_name=t.episode_name);const{error:i}=await X.from("favorites").insert(s);i&&(console.error("Error adding favorite:",i),n(o=>({favorites:o.favorites.filter(a=>a.id!==t.id||a.season_number!==t.season_number||a.episode_number!==t.episode_number)})))},removeFavorite:async(t,r=null,s=null)=>{const{data:{user:i}}=await X.auth.getUser();if(!i)return;const o=e().favorites;n(u=>({favorites:u.favorites.filter(d=>!(d.id===t&&d.season_number===r&&d.episode_number===s))}));const a=X.from("favorites").delete().match({user_id:i.id,media_id:t});r!==null&&s!==null?a.match({season_number:r,episode_number:s}):a.is("season_number",null).is("episode_number",null);const{error:c}=await a;c&&(console.error("Error removing favorite:",c),n({favorites:o}))},isFavorited:(t,r=null,s=null)=>{const{favorites:i,favoritesFetched:o}=e();return o?i.some(a=>a.id===t&&a.season_number===r&&a.episode_number===s):!1}}),{name:"freestream-storage",storage:localStorage,partialize:n=>({favorites:n.favorites,trending:n.trending,popularMovies:n.popularMovies,popularTv:n.popularTv,topRatedMovies:n.topRatedMovies,topRatedTv:n.topRatedTv,upcomingMovies:n.upcomingMovies,nowPlayingMovies:n.nowPlayingMovies,airingTodayTv:n.airingTodayTv,continueWatching:n.continueWatching})})),bt=({item:n,type:e,progress:t,duration:r,showDeleteButton:s,onDelete:i})=>{const{id:o,title:a,name:c,poster_path:u,still_path:d,vote_average:h,episode_name:f,season_number:p,episode_number:y,first_air_date:v,release_date:g,number_of_seasons:w}=n,E=d||u,_=c||a,P=t&&r>0?t/r*100:0,b=g||v?new Date(g||v).getFullYear():null,{addFavorite:x,removeFavorite:D,isFavorited:$}=wt(),M=$(n.id,n.season_number,n.episode_number),Z=ee=>{ee.preventDefault(),ee.stopPropagation(),M?D(n.id,n.season_number,n.episode_number):x({...n,type:e})};let G=`/watch/${e}/${n.id}`;e==="tv"&&n.season_number&&n.episode_number&&(G+=`/season/${n.season_number}/episode/${n.episode_number}`);const oe=e==="tv"&&p&&y?`S${p} E${y}${f?`: ${f}`:""}`:e==="tv"&&w?`${b||"Unknown"} • ${w} Season${w!==1?"s":""}`:e==="movie"&&b?b.toString():null;return l("div",{className:"movie-card-container",children:l(He,{href:G,className:"movie-card",children:l("div",{className:"poster-wrapper",children:[l("img",{src:qn(E?`${Nn}${E}`:"https://via.placeholder.com/500x750/1a1a1a/ffffff?text=No+Image"),alt:_,loading:"lazy"}),l("div",{className:"scrim"}),P>.01&&l("div",{className:"progress-bar-container",children:l("div",{className:"progress-bar",style:{width:`${Math.min(P,100)}%`}})}),l("div",{className:"card-info",children:[l("div",{className:"title-row",children:[l("h3",{className:"card-title",children:_}),l("button",{className:`favorite-btn ${M?"favorited":""}`,onClick:Z,children:M?"♥":"♡"})]}),oe&&l("p",{className:"card-subtitle",children:oe}),l("span",{className:"rating",children:["★ ",h?h.toFixed(1):"N/A"]})]}),s&&l("button",{className:"delete-btn",onClick:ee=>{ee.preventDefault(),ee.stopPropagation(),i&&i(n)},children:"×"})]})})})},ou=()=>l("div",{class:"features-showcase",children:[l("div",{class:"features-hero",children:l("div",{class:"features-hero-content",children:[l("h2",{class:"features-title",children:l("span",{class:"gradient-text",children:"Sign in for the full experience"})}),l("p",{class:"features-subtitle",children:"Get personalized recommendations, track your progress, and never lose your place"})]})}),l("div",{class:"features-grid",children:[{icon:"⏯️",title:"Continue Watching",description:"Pick up exactly where you left off across all your devices. Never lose your place again.",highlight:!0},{icon:"❤️",title:"Favorites Collection",description:"Save your favorite movies and TV shows in one place for quick access anytime.",highlight:!1},{icon:"📚",title:"Watch History",description:"Keep track of everything you've watched and easily find content you enjoyed.",highlight:!1},{icon:"🎯",title:"Personal Progress",description:"Sync your watch progress across devices and resume on any screen seamlessly.",highlight:!1},{icon:"🔍",title:"Smart Recommendations",description:"Get personalized suggestions based on your viewing history and preferences.",highlight:!1},{icon:"⚡",title:"Enhanced Experience",description:"Unlock the full potential of FreeStream with user-specific features and settings.",highlight:!1}].map((e,t)=>l("div",{class:`feature-card ${e.highlight?"featured":""}`,children:[l("div",{class:"feature-icon",children:e.icon}),l("h3",{class:"feature-title",children:e.title}),l("p",{class:"feature-description",children:e.description})]},t))}),l("div",{class:"features-footer",children:[l("div",{class:"features-stats",children:[l("div",{class:"stat",children:[l("span",{class:"stat-number",children:"10K+"}),l("span",{class:"stat-label",children:"Movies & Shows"})]}),l("div",{class:"stat",children:[l("span",{class:"stat-number",children:"4K"}),l("span",{class:"stat-label",children:"Ultra HD Quality"})]}),l("div",{class:"stat",children:[l("span",{class:"stat-number",children:"∞"}),l("span",{class:"stat-label",children:"Unlimited Access"})]})]}),l("p",{class:"features-note",children:[l(Oe,{href:"/login",class:"subtle-link",children:"Sign in"})," or ",l(Oe,{href:"/signup",class:"subtle-link",children:"create an account"})," to unlock these features"]})]})]}),Ko=({size:n="medium",text:e="Loading..."})=>{const t={small:"spinner-small",medium:"spinner-medium",large:"spinner-large"}[n];return l("div",{class:"loading-container",children:[l("div",{class:`loading-spinner ${t}`,children:[l("div",{class:"spinner-ring"}),l("div",{class:"spinner-ring"}),l("div",{class:"spinner-ring"}),l("div",{class:"spinner-ring"})]}),e&&l("p",{class:"loading-text",children:e})]})},au=()=>{const{user:n}=Ze();if(!n)return null;const e=()=>{const r=new Date().getHours();return r<12?"Good morning":r<17?"Good afternoon":"Good evening"},t=()=>n.user_metadata?.full_name?n.user_metadata.full_name.split(" ")[0]:n.email.split("@")[0];return l("div",{class:"welcome-message",children:[l("div",{class:"welcome-content",children:[l("h2",{class:"welcome-title",children:[e(),", ",l("span",{class:"user-name",children:t()}),"!"]}),l("p",{class:"welcome-subtitle",children:"What would you like to watch today?"})]}),l("div",{class:"welcome-stats",children:[l("div",{class:"stat-item",children:[l("span",{class:"stat-icon",children:"🎬"}),l("span",{class:"stat-text",children:"Unlimited Movies"})]}),l("div",{class:"stat-item",children:[l("span",{class:"stat-icon",children:"📺"}),l("span",{class:"stat-text",children:"TV Shows"})]}),l("div",{class:"stat-item",children:[l("span",{class:"stat-icon",children:"⚡"}),l("span",{class:"stat-text",children:"HD Streaming"})]})]})]})},gr=n=>{const{trending:e,popularMovies:t,popularTv:r,topRatedMovies:s,topRatedTv:i,upcomingMovies:o,nowPlayingMovies:a,airingTodayTv:c,fetchTrending:u,fetchPopularMovies:d,fetchPopularTv:h,fetchTopRatedMovies:f,fetchTopRatedTv:p,fetchUpcomingMovies:y,fetchNowPlayingMovies:v,fetchAiringTodayTv:g,continueWatching:w,continueWatchingFetched:E,fetchContinueWatching:_}=wt(),{user:P}=Ze(),[b,x]=B("all");ie(()=>{n.path==="/movies"?x("movie"):n.path==="/tv"?x("tv"):x("all")},[n.path]),ie(()=>{u(),d(),h(),f(),p(),y(),v(),g()},[u,d,h,f,p,y,v,g]),ie(()=>{P&&!E&&_()},[P,E,_]);const D=($,M,Z)=>!M||M.length===0?null:l("section",{class:"home-section",children:[l("h2",{children:$}),l("div",{class:"scrolling-row",children:M.map(G=>l(bt,{item:G,type:Z||G.media_type},`${$}-${G.id}`))})]});return l("div",{class:"container home-page",children:[l("h1",{class:"main-title",children:[b==="movie"&&"Movies",b==="tv"&&"TV Shows",b==="all"&&"Discover"]}),!P&&b==="all"&&l(vt,{children:[l("div",{class:"guest-info-banner",style:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"8px",padding:"16px",marginBottom:"24px",textAlign:"center"},children:[l("h3",{style:{margin:"0 0 8px 0",color:"var(--text-primary)"},children:"🎬 Start Streaming Instantly"}),l("p",{style:{margin:"0",color:"var(--text-secondary)"},children:["No account required! Click any movie or TV show to start watching immediately.",l("a",{href:"/login",style:{color:"var(--accent-color)",textDecoration:"none",marginLeft:"4px"},children:"Sign up"})," to save favorites, track progress, and continue watching across devices."]})]}),l(ou,{})]}),P&&b==="all"&&l(au,{}),E?w.length>0&&l("section",{class:"home-section",children:[l("h2",{children:"Continue Watching"}),l("div",{class:"scrolling-row scrolling-row--compact",children:w.map($=>l(bt,{item:$,type:$.type,progress:$.progress_seconds,duration:$.duration_seconds},`continue-watching-${$.type}-${$.id}`))})]}):l(Ko,{text:"Loading your continue watching..."}),b==="all"&&D("Trending This Week",e,"movie"),b!=="tv"&&D("Popular Movies",t,"movie"),b!=="tv"&&D("Now Playing Movies",a,"movie"),b!=="movie"&&D("Popular TV Shows",r,"tv"),(b==="all"||b==="movie")&&D("Top Rated Movies",s,"movie"),(b==="all"||b==="movie")&&D("Upcoming Movies",o,"movie"),(b==="all"||b==="tv")&&D("Top Rated TV Shows",i,"tv"),(b==="all"||b==="tv")&&D("Airing Today",c,"tv")]})};var Vt={exports:{}};const Vo=So(ga);var vr,ni;function cu(){if(ni)return vr;ni=1;var n=Vo;function e(i,o){var a={};for(var c in i)o.indexOf(c)>=0||Object.prototype.hasOwnProperty.call(i,c)&&(a[c]=i[c]);return a}function t(i,o){if(!(i instanceof o))throw new TypeError("Cannot call a class as a function")}function r(i,o){if(!i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o&&(typeof o=="object"||typeof o=="function")?o:i}function s(i,o){if(typeof o!="function"&&o!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof o);i.prototype=Object.create(o&&o.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),o&&(Object.setPrototypeOf?Object.setPrototypeOf(i,o):i.__proto__=o)}return vr=function(o,a,c){if(typeof o!="function")throw new Error("Expected reducePropsToState to be a function.");if(typeof a!="function")throw new Error("Expected handleStateChangeOnClient to be a function.");if(typeof c<"u"&&typeof c!="function")throw new Error("Expected mapStateOnServer to either be undefined or a function.");function u(h){return h.displayName||h.name||"Component"}return function(f){if(typeof f!="function")throw new Error("Expected WrappedComponent to be a React component.");var p=[],y=void 0;function v(){y=o(p.map(function(w){return w.props})),g.canUseDOM?a(y):c&&(y=c(y))}var g=function(w){s(E,w);function E(){return t(this,E),r(this,w.apply(this,arguments))}return E.peek=function(){return y},E.rewind=function(){if(E.canUseDOM)throw new Error("You may only call rewind() on the server. Call peek() to read the current state.");var P=y;return y=void 0,p=[],P},E.prototype.shouldComponentUpdate=function(P){var b=P.children,x=e(P,["children"]);return b&&b.length&&(x.children=b),d(x,this.props)},E.prototype.componentWillMount=function(){p.push(this),v()},E.prototype.componentDidUpdate=function(){v()},E.prototype.componentWillUnmount=function(){var P=p.indexOf(this);p.splice(P,1),v()},E.prototype.render=function(){return(0,n.h)(f,this.props)},E}(n.Component);return g.displayName="SideEffect("+u(f)+")",g.canUseDOM=!!(typeof window<"u"&&window.document&&window.document.createElement),g};function d(h,f){for(var p in h)if(!(p in f))return!0;for(var y in f)if(h[y]!==f[y])return!0;return!1}},vr}var yr,si;function zo(){if(si)return yr;si=1;var n=Object.prototype.toString;return yr=function(t){var r=n.call(t),s=r==="[object Arguments]";return s||(s=r!=="[object Array]"&&t!==null&&typeof t=="object"&&typeof t.length=="number"&&t.length>=0&&n.call(t.callee)==="[object Function]"),s},yr}var mr,ii;function lu(){if(ii)return mr;ii=1;var n;if(!Object.keys){var e=Object.prototype.hasOwnProperty,t=Object.prototype.toString,r=zo(),s=Object.prototype.propertyIsEnumerable,i=!s.call({toString:null},"toString"),o=s.call(function(){},"prototype"),a=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],c=function(f){var p=f.constructor;return p&&p.prototype===f},u={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},d=function(){if(typeof window>"u")return!1;for(var f in window)try{if(!u["$"+f]&&e.call(window,f)&&window[f]!==null&&typeof window[f]=="object")try{c(window[f])}catch{return!0}}catch{return!0}return!1}(),h=function(f){if(typeof window>"u"||!d)return c(f);try{return c(f)}catch{return!1}};n=function(p){var y=p!==null&&typeof p=="object",v=t.call(p)==="[object Function]",g=r(p),w=y&&t.call(p)==="[object String]",E=[];if(!y&&!v&&!g)throw new TypeError("Object.keys called on a non-object");var _=o&&v;if(w&&p.length>0&&!e.call(p,0))for(var P=0;P<p.length;++P)E.push(String(P));if(g&&p.length>0)for(var b=0;b<p.length;++b)E.push(String(b));else for(var x in p)!(_&&x==="prototype")&&e.call(p,x)&&E.push(String(x));if(i)for(var D=h(p),$=0;$<a.length;++$)!(D&&a[$]==="constructor")&&e.call(p,a[$])&&E.push(a[$]);return E}}return mr=n,mr}var _r,oi;function Jo(){if(oi)return _r;oi=1;var n=Array.prototype.slice,e=zo(),t=Object.keys,r=t?function(o){return t(o)}:lu(),s=Object.keys;return r.shim=function(){if(Object.keys){var o=function(){var a=Object.keys(arguments);return a&&a.length===arguments.length}(1,2);o||(Object.keys=function(c){return e(c)?s(n.call(c)):s(c)})}else Object.keys=r;return Object.keys||r},_r=r,_r}var wr,ai;function Yo(){return ai||(ai=1,wr=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var e={},t=Symbol("test"),r=Object(t);if(typeof t=="string"||Object.prototype.toString.call(t)!=="[object Symbol]"||Object.prototype.toString.call(r)!=="[object Symbol]")return!1;var s=42;e[t]=s;for(var i in e)return!1;if(typeof Object.keys=="function"&&Object.keys(e).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(e).length!==0)return!1;var o=Object.getOwnPropertySymbols(e);if(o.length!==1||o[0]!==t||!Object.prototype.propertyIsEnumerable.call(e,t))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var a=Object.getOwnPropertyDescriptor(e,t);if(a.value!==s||a.enumerable!==!0)return!1}return!0}),wr}var br,ci;function Jn(){if(ci)return br;ci=1;var n=Yo();return br=function(){return n()&&!!Symbol.toStringTag},br}var Sr,li;function Qo(){return li||(li=1,Sr=Object),Sr}var Tr,ui;function Xo(){return ui||(ui=1,Tr=Error),Tr}var Er,di;function uu(){return di||(di=1,Er=EvalError),Er}var Pr,hi;function du(){return hi||(hi=1,Pr=RangeError),Pr}var kr,fi;function hu(){return fi||(fi=1,kr=ReferenceError),kr}var Ar,pi;function Zo(){return pi||(pi=1,Ar=SyntaxError),Ar}var $r,gi;function Tt(){return gi||(gi=1,$r=TypeError),$r}var Rr,vi;function fu(){return vi||(vi=1,Rr=URIError),Rr}var Or,yi;function pu(){return yi||(yi=1,Or=Math.abs),Or}var jr,mi;function gu(){return mi||(mi=1,jr=Math.floor),jr}var Ir,_i;function vu(){return _i||(_i=1,Ir=Math.max),Ir}var xr,wi;function yu(){return wi||(wi=1,xr=Math.min),xr}var Cr,bi;function mu(){return bi||(bi=1,Cr=Math.pow),Cr}var Ur,Si;function _u(){return Si||(Si=1,Ur=Math.round),Ur}var Dr,Ti;function wu(){return Ti||(Ti=1,Dr=Number.isNaN||function(e){return e!==e}),Dr}var Lr,Ei;function bu(){if(Ei)return Lr;Ei=1;var n=wu();return Lr=function(t){return n(t)||t===0?t:t<0?-1:1},Lr}var Nr,Pi;function Su(){return Pi||(Pi=1,Nr=Object.getOwnPropertyDescriptor),Nr}var qr,ki;function Et(){if(ki)return qr;ki=1;var n=Su();if(n)try{n([],"length")}catch{n=null}return qr=n,qr}var Mr,Ai;function er(){if(Ai)return Mr;Ai=1;var n=Object.defineProperty||!1;if(n)try{n({},"a",{value:1})}catch{n=!1}return Mr=n,Mr}var Fr,$i;function Tu(){if($i)return Fr;$i=1;var n=typeof Symbol<"u"&&Symbol,e=Yo();return Fr=function(){return typeof n!="function"||typeof Symbol!="function"||typeof n("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:e()},Fr}var Br,Ri;function ea(){return Ri||(Ri=1,Br=typeof Reflect<"u"&&Reflect.getPrototypeOf||null),Br}var Hr,Oi;function ta(){if(Oi)return Hr;Oi=1;var n=Qo();return Hr=n.getPrototypeOf||null,Hr}var Wr,ji;function Eu(){if(ji)return Wr;ji=1;var n="Function.prototype.bind called on incompatible ",e=Object.prototype.toString,t=Math.max,r="[object Function]",s=function(c,u){for(var d=[],h=0;h<c.length;h+=1)d[h]=c[h];for(var f=0;f<u.length;f+=1)d[f+c.length]=u[f];return d},i=function(c,u){for(var d=[],h=u,f=0;h<c.length;h+=1,f+=1)d[f]=c[h];return d},o=function(a,c){for(var u="",d=0;d<a.length;d+=1)u+=a[d],d+1<a.length&&(u+=c);return u};return Wr=function(c){var u=this;if(typeof u!="function"||e.apply(u)!==r)throw new TypeError(n+u);for(var d=i(arguments,1),h,f=function(){if(this instanceof h){var w=u.apply(this,s(d,arguments));return Object(w)===w?w:this}return u.apply(c,s(d,arguments))},p=t(0,u.length-d.length),y=[],v=0;v<p;v++)y[v]="$"+v;if(h=Function("binder","return function ("+o(y,",")+"){ return binder.apply(this,arguments); }")(f),u.prototype){var g=function(){};g.prototype=u.prototype,h.prototype=new g,g.prototype=null}return h},Wr}var Gr,Ii;function Nt(){if(Ii)return Gr;Ii=1;var n=Eu();return Gr=Function.prototype.bind||n,Gr}var Kr,xi;function Yn(){return xi||(xi=1,Kr=Function.prototype.call),Kr}var Vr,Ci;function Qn(){return Ci||(Ci=1,Vr=Function.prototype.apply),Vr}var zr,Ui;function Pu(){return Ui||(Ui=1,zr=typeof Reflect<"u"&&Reflect&&Reflect.apply),zr}var Jr,Di;function ra(){if(Di)return Jr;Di=1;var n=Nt(),e=Qn(),t=Yn(),r=Pu();return Jr=r||n.call(t,e),Jr}var Yr,Li;function Xn(){if(Li)return Yr;Li=1;var n=Nt(),e=Tt(),t=Yn(),r=ra();return Yr=function(i){if(i.length<1||typeof i[0]!="function")throw new e("a function is required");return r(n,t,i)},Yr}var Qr,Ni;function ku(){if(Ni)return Qr;Ni=1;var n=Xn(),e=Et(),t;try{t=[].__proto__===Array.prototype}catch(o){if(!o||typeof o!="object"||!("code"in o)||o.code!=="ERR_PROTO_ACCESS")throw o}var r=!!t&&e&&e(Object.prototype,"__proto__"),s=Object,i=s.getPrototypeOf;return Qr=r&&typeof r.get=="function"?n([r.get]):typeof i=="function"?function(a){return i(a==null?a:s(a))}:!1,Qr}var Xr,qi;function na(){if(qi)return Xr;qi=1;var n=ea(),e=ta(),t=ku();return Xr=n?function(s){return n(s)}:e?function(s){if(!s||typeof s!="object"&&typeof s!="function")throw new TypeError("getProto: not an object");return e(s)}:t?function(s){return t(s)}:null,Xr}var Zr,Mi;function sa(){if(Mi)return Zr;Mi=1;var n=Function.prototype.call,e=Object.prototype.hasOwnProperty,t=Nt();return Zr=t.call(n,e),Zr}var en,Fi;function ia(){if(Fi)return en;Fi=1;var n,e=Qo(),t=Xo(),r=uu(),s=du(),i=hu(),o=Zo(),a=Tt(),c=fu(),u=pu(),d=gu(),h=vu(),f=yu(),p=mu(),y=_u(),v=bu(),g=Function,w=function(C){try{return g('"use strict"; return ('+C+").constructor;")()}catch{}},E=Et(),_=er(),P=function(){throw new a},b=E?function(){try{return arguments.callee,P}catch{try{return E(arguments,"callee").get}catch{return P}}}():P,x=Tu()(),D=na(),$=ta(),M=ea(),Z=Qn(),G=Yn(),re={},oe=typeof Uint8Array>"u"||!D?n:D(Uint8Array),ee={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?n:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?n:ArrayBuffer,"%ArrayIteratorPrototype%":x&&D?D([][Symbol.iterator]()):n,"%AsyncFromSyncIteratorPrototype%":n,"%AsyncFunction%":re,"%AsyncGenerator%":re,"%AsyncGeneratorFunction%":re,"%AsyncIteratorPrototype%":re,"%Atomics%":typeof Atomics>"u"?n:Atomics,"%BigInt%":typeof BigInt>"u"?n:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?n:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?n:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?n:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":t,"%eval%":eval,"%EvalError%":r,"%Float16Array%":typeof Float16Array>"u"?n:Float16Array,"%Float32Array%":typeof Float32Array>"u"?n:Float32Array,"%Float64Array%":typeof Float64Array>"u"?n:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?n:FinalizationRegistry,"%Function%":g,"%GeneratorFunction%":re,"%Int8Array%":typeof Int8Array>"u"?n:Int8Array,"%Int16Array%":typeof Int16Array>"u"?n:Int16Array,"%Int32Array%":typeof Int32Array>"u"?n:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":x&&D?D(D([][Symbol.iterator]())):n,"%JSON%":typeof JSON=="object"?JSON:n,"%Map%":typeof Map>"u"?n:Map,"%MapIteratorPrototype%":typeof Map>"u"||!x||!D?n:D(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":e,"%Object.getOwnPropertyDescriptor%":E,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?n:Promise,"%Proxy%":typeof Proxy>"u"?n:Proxy,"%RangeError%":s,"%ReferenceError%":i,"%Reflect%":typeof Reflect>"u"?n:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?n:Set,"%SetIteratorPrototype%":typeof Set>"u"||!x||!D?n:D(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?n:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":x&&D?D(""[Symbol.iterator]()):n,"%Symbol%":x?Symbol:n,"%SyntaxError%":o,"%ThrowTypeError%":b,"%TypedArray%":oe,"%TypeError%":a,"%Uint8Array%":typeof Uint8Array>"u"?n:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?n:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?n:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?n:Uint32Array,"%URIError%":c,"%WeakMap%":typeof WeakMap>"u"?n:WeakMap,"%WeakRef%":typeof WeakRef>"u"?n:WeakRef,"%WeakSet%":typeof WeakSet>"u"?n:WeakSet,"%Function.prototype.call%":G,"%Function.prototype.apply%":Z,"%Object.defineProperty%":_,"%Object.getPrototypeOf%":$,"%Math.abs%":u,"%Math.floor%":d,"%Math.max%":h,"%Math.min%":f,"%Math.pow%":p,"%Math.round%":y,"%Math.sign%":v,"%Reflect.getPrototypeOf%":M};if(D)try{null.error}catch(C){var he=D(D(C));ee["%Error.prototype%"]=he}var $e=function C(I){var U;if(I==="%AsyncFunction%")U=w("async function () {}");else if(I==="%GeneratorFunction%")U=w("function* () {}");else if(I==="%AsyncGeneratorFunction%")U=w("async function* () {}");else if(I==="%AsyncGenerator%"){var R=C("%AsyncGeneratorFunction%");R&&(U=R.prototype)}else if(I==="%AsyncIteratorPrototype%"){var F=C("%AsyncGenerator%");F&&D&&(U=D(F.prototype))}return ee[I]=U,U},ve={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},Pe=Nt(),Re=sa(),xe=Pe.call(G,Array.prototype.concat),et=Pe.call(Z,Array.prototype.splice),Ce=Pe.call(G,String.prototype.replace),Ue=Pe.call(G,String.prototype.slice),N=Pe.call(G,RegExp.prototype.exec),m=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,S=/\\(\\)?/g,T=function(I){var U=Ue(I,0,1),R=Ue(I,-1);if(U==="%"&&R!=="%")throw new o("invalid intrinsic syntax, expected closing `%`");if(R==="%"&&U!=="%")throw new o("invalid intrinsic syntax, expected opening `%`");var F=[];return Ce(I,m,function(K,ae,J,te){F[F.length]=J?Ce(te,S,"$1"):ae||K}),F},j=function(I,U){var R=I,F;if(Re(ve,R)&&(F=ve[R],R="%"+F[0]+"%"),Re(ee,R)){var K=ee[R];if(K===re&&(K=$e(R)),typeof K>"u"&&!U)throw new a("intrinsic "+I+" exists, but is not available. Please file an issue!");return{alias:F,name:R,value:K}}throw new o("intrinsic "+I+" does not exist!")};return en=function(I,U){if(typeof I!="string"||I.length===0)throw new a("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof U!="boolean")throw new a('"allowMissing" argument must be a boolean');if(N(/^%?[^%]*%?$/,I)===null)throw new o("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var R=T(I),F=R.length>0?R[0]:"",K=j("%"+F+"%",U),ae=K.name,J=K.value,te=!1,Se=K.alias;Se&&(F=Se[0],et(R,xe([0,1],Se)));for(var fe=1,pe=!0;fe<R.length;fe+=1){var ce=R[fe],ye=Ue(ce,0,1),tt=Ue(ce,-1);if((ye==='"'||ye==="'"||ye==="`"||tt==='"'||tt==="'"||tt==="`")&&ye!==tt)throw new o("property names with quotes must have matching quotes");if((ce==="constructor"||!pe)&&(te=!0),F+="."+ce,ae="%"+F+"%",Re(ee,ae))J=ee[ae];else if(J!=null){if(!(ce in J)){if(!U)throw new a("base intrinsic for "+I+" exists, but the property is not available.");return}if(E&&fe+1>=R.length){var qe=E(J,ce);pe=!!qe,pe&&"get"in qe&&!("originalValue"in qe.get)?J=qe.get:J=J[ce]}else pe=Re(J,ce),J=J[ce];pe&&!te&&(ee[ae]=J)}}return J},en}var tn,Bi;function Zn(){if(Bi)return tn;Bi=1;var n=ia(),e=Xn(),t=e([n("%String.prototype.indexOf%")]);return tn=function(s,i){var o=n(s,!!i);return typeof o=="function"&&t(s,".prototype.")>-1?e([o]):o},tn}var rn,Hi;function Au(){if(Hi)return rn;Hi=1;var n=Jn()(),e=Zn(),t=e("Object.prototype.toString"),r=function(a){return n&&a&&typeof a=="object"&&Symbol.toStringTag in a?!1:t(a)==="[object Arguments]"},s=function(a){return r(a)?!0:a!==null&&typeof a=="object"&&"length"in a&&typeof a.length=="number"&&a.length>=0&&t(a)!=="[object Array]"&&"callee"in a&&t(a.callee)==="[object Function]"},i=function(){return r(arguments)}();return r.isLegacyArguments=s,rn=i?r:s,rn}var nn,Wi;function es(){if(Wi)return nn;Wi=1;var n=er(),e=Zo(),t=Tt(),r=Et();return nn=function(i,o,a){if(!i||typeof i!="object"&&typeof i!="function")throw new t("`obj` must be an object or a function`");if(typeof o!="string"&&typeof o!="symbol")throw new t("`property` must be a string or a symbol`");if(arguments.length>3&&typeof arguments[3]!="boolean"&&arguments[3]!==null)throw new t("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&typeof arguments[4]!="boolean"&&arguments[4]!==null)throw new t("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&typeof arguments[5]!="boolean"&&arguments[5]!==null)throw new t("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&typeof arguments[6]!="boolean")throw new t("`loose`, if provided, must be a boolean");var c=arguments.length>3?arguments[3]:null,u=arguments.length>4?arguments[4]:null,d=arguments.length>5?arguments[5]:null,h=arguments.length>6?arguments[6]:!1,f=!!r&&r(i,o);if(n)n(i,o,{configurable:d===null&&f?f.configurable:!d,enumerable:c===null&&f?f.enumerable:!c,value:a,writable:u===null&&f?f.writable:!u});else if(h||!c&&!u&&!d)i[o]=a;else throw new e("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.")},nn}var sn,Gi;function ts(){if(Gi)return sn;Gi=1;var n=er(),e=function(){return!!n};return e.hasArrayLengthDefineBug=function(){if(!n)return null;try{return n([],"length",{value:1}).length!==1}catch{return!0}},sn=e,sn}var on,Ki;function qt(){if(Ki)return on;Ki=1;var n=Jo(),e=typeof Symbol=="function"&&typeof Symbol("foo")=="symbol",t=Object.prototype.toString,r=Array.prototype.concat,s=es(),i=function(u){return typeof u=="function"&&t.call(u)==="[object Function]"},o=ts()(),a=function(u,d,h,f){if(d in u){if(f===!0){if(u[d]===h)return}else if(!i(f)||!f())return}o?s(u,d,h,!0):s(u,d,h)},c=function(u,d){var h=arguments.length>2?arguments[2]:{},f=n(d);e&&(f=r.call(f,Object.getOwnPropertySymbols(d)));for(var p=0;p<f.length;p+=1)a(u,f[p],d[f[p]],h[f[p]])};return c.supportsDescriptors=!!o,on=c,on}var an={exports:{}},cn,Vi;function $u(){if(Vi)return cn;Vi=1;var n=ia(),e=es(),t=ts()(),r=Et(),s=Tt(),i=n("%Math.floor%");return cn=function(a,c){if(typeof a!="function")throw new s("`fn` is not a function");if(typeof c!="number"||c<0||c>4294967295||i(c)!==c)throw new s("`length` must be a positive 32-bit integer");var u=arguments.length>2&&!!arguments[2],d=!0,h=!0;if("length"in a&&r){var f=r(a,"length");f&&!f.configurable&&(d=!1),f&&!f.writable&&(h=!1)}return(d||h||!u)&&(t?e(a,"length",c,!0,!0):e(a,"length",c)),a},cn}var ln,zi;function Ru(){if(zi)return ln;zi=1;var n=Nt(),e=Qn(),t=ra();return ln=function(){return t(n,e,arguments)},ln}var Ji;function oa(){return Ji||(Ji=1,function(n){var e=$u(),t=er(),r=Xn(),s=Ru();n.exports=function(o){var a=r(arguments),c=o.length-(arguments.length-1);return e(a,1+(c>0?c:0),!0)},t?t(n.exports,"apply",{value:s}):n.exports.apply=s}(an)),an.exports}var un,Yi;function aa(){if(Yi)return un;Yi=1;var n=function(e){return e!==e};return un=function(t,r){return t===0&&r===0?1/t===1/r:!!(t===r||n(t)&&n(r))},un}var dn,Qi;function ca(){if(Qi)return dn;Qi=1;var n=aa();return dn=function(){return typeof Object.is=="function"?Object.is:n},dn}var hn,Xi;function Ou(){if(Xi)return hn;Xi=1;var n=ca(),e=qt();return hn=function(){var r=n();return e(Object,{is:r},{is:function(){return Object.is!==r}}),r},hn}var fn,Zi;function ju(){if(Zi)return fn;Zi=1;var n=qt(),e=oa(),t=aa(),r=ca(),s=Ou(),i=e(r(),Object);return n(i,{getPolyfill:r,implementation:t,shim:s}),fn=i,fn}var pn,eo;function Iu(){if(eo)return pn;eo=1;var n=Zn(),e=Jn()(),t=sa(),r=Et(),s;if(e){var i=n("RegExp.prototype.exec"),o={},a=function(){throw o},c={toString:a,valueOf:a};typeof Symbol.toPrimitive=="symbol"&&(c[Symbol.toPrimitive]=a),s=function(f){if(!f||typeof f!="object")return!1;var p=r(f,"lastIndex"),y=p&&t(p,"value");if(!y)return!1;try{i(f,c)}catch(v){return v===o}}}else{var u=n("Object.prototype.toString"),d="[object RegExp]";s=function(f){return!f||typeof f!="object"&&typeof f!="function"?!1:u(f)===d}}return pn=s,pn}var gn,to;function xu(){if(to)return gn;to=1;var n=function(){return typeof(function(){}).name=="string"},e=Object.getOwnPropertyDescriptor;if(e)try{e([],"length")}catch{e=null}n.functionsHaveConfigurableNames=function(){if(!n()||!e)return!1;var s=e(function(){},"name");return!!s&&!!s.configurable};var t=Function.prototype.bind;return n.boundFunctionsHaveNames=function(){return n()&&typeof t=="function"&&(function(){}).bind().name!==""},gn=n,gn}var vn,ro;function Cu(){if(ro)return vn;ro=1;var n=es(),e=ts()(),t=xu().functionsHaveConfigurableNames(),r=Tt();return vn=function(i,o){if(typeof i!="function")throw new r("`fn` is not a function");var a=arguments.length>2&&!!arguments[2];return(!a||t)&&(e?n(i,"name",o,!0,!0):n(i,"name",o)),i},vn}var yn,no;function la(){if(no)return yn;no=1;var n=Cu(),e=Tt(),t=Object;return yn=n(function(){if(this==null||this!==t(this))throw new e("RegExp.prototype.flags getter called on non-object");var s="";return this.hasIndices&&(s+="d"),this.global&&(s+="g"),this.ignoreCase&&(s+="i"),this.multiline&&(s+="m"),this.dotAll&&(s+="s"),this.unicode&&(s+="u"),this.unicodeSets&&(s+="v"),this.sticky&&(s+="y"),s},"get flags",!0),yn}var mn,so;function ua(){if(so)return mn;so=1;var n=la(),e=qt().supportsDescriptors,t=Object.getOwnPropertyDescriptor;return mn=function(){if(e&&/a/mig.flags==="gim"){var s=t(RegExp.prototype,"flags");if(s&&typeof s.get=="function"&&"dotAll"in RegExp.prototype&&"hasIndices"in RegExp.prototype){var i="",o={};if(Object.defineProperty(o,"hasIndices",{get:function(){i+="d"}}),Object.defineProperty(o,"sticky",{get:function(){i+="y"}}),s.get.call(o),i==="dy")return s.get}}return n},mn}var _n,io;function Uu(){if(io)return _n;io=1;var n=qt().supportsDescriptors,e=ua(),t=Et(),r=Object.defineProperty,s=Xo(),i=na(),o=/a/;return _n=function(){if(!n||!i)throw new s("RegExp.prototype.flags requires a true ES5 environment that supports property descriptors");var c=e(),u=i(o),d=t(u,"flags");return(!d||d.get!==c)&&r(u,"flags",{configurable:!0,enumerable:!1,get:c}),c},_n}var wn,oo;function Du(){if(oo)return wn;oo=1;var n=qt(),e=oa(),t=la(),r=ua(),s=Uu(),i=e(r());return n(i,{getPolyfill:r,implementation:t,shim:s}),wn=i,wn}var bn,ao;function Lu(){if(ao)return bn;ao=1;var n=Zn(),e=n("Date.prototype.getDay"),t=function(a){try{return e(a),!0}catch{return!1}},r=n("Object.prototype.toString"),s="[object Date]",i=Jn()();return bn=function(a){return typeof a!="object"||a===null?!1:i?t(a):r(a)===s},bn}var Sn,co;function Nu(){if(co)return Sn;co=1;var n=Jo(),e=Au(),t=ju(),r=Iu(),s=Du(),i=Lu(),o=Date.prototype.getTime;function a(h,f,p){var y=p||{};return(y.strict?t(h,f):h===f)?!0:!h||!f||typeof h!="object"&&typeof f!="object"?y.strict?t(h,f):h==f:d(h,f,y)}function c(h){return h==null}function u(h){return!(!h||typeof h!="object"||typeof h.length!="number"||typeof h.copy!="function"||typeof h.slice!="function"||h.length>0&&typeof h[0]!="number")}function d(h,f,p){var y,v;if(typeof h!=typeof f||c(h)||c(f)||h.prototype!==f.prototype||e(h)!==e(f))return!1;var g=r(h),w=r(f);if(g!==w)return!1;if(g||w)return h.source===f.source&&s(h)===s(f);if(i(h)&&i(f))return o.call(h)===o.call(f);var E=u(h),_=u(f);if(E!==_)return!1;if(E||_){if(h.length!==f.length)return!1;for(y=0;y<h.length;y++)if(h[y]!==f[y])return!1;return!0}if(typeof h!=typeof f)return!1;try{var P=n(h),b=n(f)}catch{return!1}if(P.length!==b.length)return!1;for(P.sort(),b.sort(),y=P.length-1;y>=0;y--)if(P[y]!=b[y])return!1;for(y=P.length-1;y>=0;y--)if(v=P[y],!a(h[v],f[v],p))return!1;return!0}return Sn=a,Sn}/*
object-assign
(c) Sindre Sorhus
@license MIT
*/var Tn,lo;function qu(){if(lo)return Tn;lo=1;var n=Object.getOwnPropertySymbols,e=Object.prototype.hasOwnProperty,t=Object.prototype.propertyIsEnumerable;function r(i){if(i==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(i)}function s(){try{if(!Object.assign)return!1;var i=new String("abc");if(i[5]="de",Object.getOwnPropertyNames(i)[0]==="5")return!1;for(var o={},a=0;a<10;a++)o["_"+String.fromCharCode(a)]=a;var c=Object.getOwnPropertyNames(o).map(function(d){return o[d]});if(c.join("")!=="0123456789")return!1;var u={};return"abcdefghijklmnopqrst".split("").forEach(function(d){u[d]=d}),Object.keys(Object.assign({},u)).join("")==="abcdefghijklmnopqrst"}catch{return!1}}return Tn=s()?Object.assign:function(i,o){for(var a,c=r(i),u,d=1;d<arguments.length;d++){a=Object(arguments[d]);for(var h in a)e.call(a,h)&&(c[h]=a[h]);if(n){u=n(a);for(var f=0;f<u.length;f++)t.call(a,u[f])&&(c[u[f]]=a[u[f]])}}return c},Tn}var pt={},uo;function Mu(){return uo||(uo=1,pt.__esModule=!0,pt.TAG_NAMES={HTML:"htmlAttributes",TITLE:"title",BASE:"base",META:"meta",LINK:"link",SCRIPT:"script",NOSCRIPT:"noscript",STYLE:"style"},pt.TAG_PROPERTIES={NAME:"name",CHARSET:"charset",HTTPEQUIV:"http-equiv",REL:"rel",HREF:"href",PROPERTY:"property",SRC:"src",INNER_HTML:"innerHTML",CSS_TEXT:"cssText",ITEM_PROP:"itemprop"},pt.PREACT_TAG_MAP={charset:"charSet","http-equiv":"httpEquiv",itemprop:"itemProp",class:"className"}),pt}var ho;function Fu(){return ho||(ho=1,function(n,e){e.__esModule=!0;var t=function(){function N(m,S){for(var T=0;T<S.length;T++){var j=S[T];j.enumerable=j.enumerable||!1,j.configurable=!0,"value"in j&&(j.writable=!0),Object.defineProperty(m,j.key,j)}}return function(m,S,T){return S&&N(m.prototype,S),T&&N(m,T),m}}(),r=Object.assign||function(N){for(var m=1;m<arguments.length;m++){var S=arguments[m];for(var T in S)Object.prototype.hasOwnProperty.call(S,T)&&(N[T]=S[T])}return N},s=Vo,i=cu(),o=f(i),a=Nu(),c=f(a),u=qu(),d=f(u),h=Mu();function f(N){return N&&N.__esModule?N:{default:N}}function p(N,m){if(!(N instanceof m))throw new TypeError("Cannot call a class as a function")}function y(N,m){if(!N)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return m&&(typeof m=="object"||typeof m=="function")?m:N}function v(N,m){if(typeof m!="function"&&m!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof m);N.prototype=Object.create(m&&m.prototype,{constructor:{value:N,enumerable:!1,writable:!0,configurable:!0}}),m&&(Object.setPrototypeOf?Object.setPrototypeOf(N,m):N.__proto__=m)}function g(N,m,S){return m in N?Object.defineProperty(N,m,{value:S,enumerable:!0,configurable:!0,writable:!0}):N[m]=S,N}var w="data-preact-helmet",E=function(m){return String(m).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;")},_=function(m,S){for(var T=m.length-1;T>=0;T--){var j=m[T];if(j[S])return j[S]}return null},P=function(m){var S=_(m,"title"),T=_(m,"titleTemplate");if(T&&S)return T.replace(/%s/g,function(){return S});var j=_(m,"defaultTitle");return S||j||""},b=function(m){return _(m,"onChangeClientState")||function(){}},x=function(m,S){return S.filter(function(T){return typeof T[m]<"u"}).map(function(T){return T[m]}).reduce(function(T,j){return r({},T,j)},{})},D=function(m,S){return S.filter(function(T){return typeof T[h.TAG_NAMES.BASE]<"u"}).map(function(T){return T[h.TAG_NAMES.BASE]}).reverse().reduce(function(T,j){if(!T.length)for(var C=Object.keys(j),I=0;I<C.length;I++){var U=C[I],R=U.toLowerCase();if(m.indexOf(R)!==-1&&j[R])return T.concat(j)}return T},[])},$=function(m,S,T){var j={};return T.filter(function(C){return typeof C[m]<"u"}).map(function(C){return C[m]}).reverse().reduce(function(C,I){var U={};I.filter(function(J){for(var te=void 0,Se=Object.keys(J),fe=0;fe<Se.length;fe++){var pe=Se[fe],ce=pe.toLowerCase();S.indexOf(ce)!==-1&&!(te===h.TAG_PROPERTIES.REL&&J[te].toLowerCase()==="canonical")&&!(ce===h.TAG_PROPERTIES.REL&&J[ce].toLowerCase()==="stylesheet")&&(te=ce),S.indexOf(pe)!==-1&&(pe===h.TAG_PROPERTIES.INNER_HTML||pe===h.TAG_PROPERTIES.CSS_TEXT||pe===h.TAG_PROPERTIES.ITEM_PROP)&&(te=pe)}if(!te||!J[te])return!1;var ye=J[te].toLowerCase();return j[te]||(j[te]={}),U[te]||(U[te]={}),j[te][ye]?!1:(U[te][ye]=!0,!0)}).reverse().forEach(function(J){return C.push(J)});for(var R=Object.keys(U),F=0;F<R.length;F++){var K=R[F],ae=(0,d.default)({},j[K],U[K]);j[K]=ae}return C},[]).reverse()},M=function(m,S){document.title=m||document.title,Z(h.TAG_NAMES.TITLE,S)},Z=function(m,S){for(var T=document.getElementsByTagName(m)[0],j=T.getAttribute(w),C=j?j.split(","):[],I=[].concat(C),U=Object.keys(S),R=0;R<U.length;R++){var F=U[R],K=S[F]||"";T.setAttribute(F,K),C.indexOf(F)===-1&&C.push(F);var ae=I.indexOf(F);ae!==-1&&I.splice(ae,1)}for(var J=I.length-1;J>=0;J--)T.removeAttribute(I[J]);C.length===I.length?T.removeAttribute(w):T.setAttribute(w,C.join(","))},G=function(m,S){var T=document.head||document.querySelector("head"),j=T.querySelectorAll(m+"["+w+"]"),C=Array.prototype.slice.call(j),I=[],U=void 0;return S&&S.length&&S.forEach(function(R){var F=document.createElement(m);for(var K in R)if(R.hasOwnProperty(K))if(K==="innerHTML")F.innerHTML=R.innerHTML;else if(K==="cssText")F.styleSheet?F.styleSheet.cssText=R.cssText:F.appendChild(document.createTextNode(R.cssText));else{var ae=typeof R[K]>"u"?"":R[K];F.setAttribute(K,ae)}F.setAttribute(w,"true"),C.some(function(J,te){return U=te,F.isEqualNode(J)})?C.splice(U,1):I.push(F)}),C.forEach(function(R){return R.parentNode.removeChild(R)}),I.forEach(function(R){return T.appendChild(R)}),{oldTags:C,newTags:I}},re=function(m){return Object.keys(m).reduce(function(S,T){var j=typeof m[T]<"u"?T+'="'+m[T]+'"':""+T;return S?S+" "+j:j},"")},oe=function(m,S,T){var j=re(T);return j?"<"+m+" "+w+" "+j+">"+E(S)+"</"+m+">":"<"+m+" "+w+">"+E(S)+"</"+m+">"},ee=function(m,S){return S.reduce(function(T,j){var C=Object.keys(j).filter(function(R){return!(R==="innerHTML"||R==="cssText")}).reduce(function(R,F){var K=typeof j[F]>"u"?F:F+'="'+E(j[F])+'"';return R?R+" "+K:K},""),I=j.innerHTML||j.cssText||"",U=[h.TAG_NAMES.NOSCRIPT,h.TAG_NAMES.SCRIPT,h.TAG_NAMES.STYLE].indexOf(m)===-1;return T+"<"+m+" "+w+" "+C+(U?">":">"+I+"</"+m+">")},"")},he=function(m,S,T){var j=g({key:S},w,!0),C=Object.keys(T).reduce(function(I,U){return I[U]=T[U],I},j);return[(0,s.h)(h.TAG_NAMES.TITLE,C,S)]},$e=function(m,S){return S.map(function(T,j){var C=g({key:j},w,!0);return Object.keys(T).forEach(function(I){var U=I;if(U==="innerHTML"||U==="cssText"){var R=T.innerHTML||T.cssText;C.dangerouslySetInnerHTML={__html:R}}else C[U]=T[I]}),(0,s.h)(m,C)})},ve=function(m,S){switch(m){case h.TAG_NAMES.TITLE:return{toComponent:function(){return he(m,S.title,S.titleAttributes)},toString:function(){return oe(m,S.title,S.titleAttributes)}};case h.TAG_NAMES.HTML:return{toComponent:function(){return S},toString:function(){return re(S)}};default:return{toComponent:function(){return $e(m,S)},toString:function(){return ee(m,S)}}}},Pe=function(m){var S=m.htmlAttributes,T=m.title,j=m.titleAttributes,C=m.baseTag,I=m.metaTags,U=m.linkTags,R=m.scriptTags,F=m.noscriptTags,K=m.styleTags;return{htmlAttributes:ve(h.TAG_NAMES.HTML,S),title:ve(h.TAG_NAMES.TITLE,{title:T,titleAttributes:j}),base:ve(h.TAG_NAMES.BASE,C),meta:ve(h.TAG_NAMES.META,I),link:ve(h.TAG_NAMES.LINK,U),script:ve(h.TAG_NAMES.SCRIPT,R),noscript:ve(h.TAG_NAMES.NOSCRIPT,F),style:ve(h.TAG_NAMES.STYLE,K)}},Re=function(m){var S,T;return T=S=function(j){v(C,j);function C(){return p(this,C),y(this,(C.__proto__||Object.getPrototypeOf(C)).apply(this,arguments))}return t(C,[{key:"shouldComponentUpdate",value:function(U){var R=r({},U);return(!R.children||!R.children.length)&&delete R.children,!(0,c.default)(this.props,R)}},{key:"render",value:function(){return(0,s.h)(m,this.props)}}],[{key:"canUseDOM",set:function(U){m.canUseDOM=U}}]),C}(s.Component),S.peek=m.peek,S.rewind=function(){var j=m.rewind();return j||(j=Pe({htmlAttributes:{},title:"",titleAttributes:{},baseTag:[],metaTags:[],linkTags:[],scriptTags:[],noscriptTags:[],styleTags:[]})),j},T},xe=function(m){return{htmlAttributes:x(h.TAG_NAMES.HTML,m),title:P(m),titleAttributes:x("titleAttributes",m),baseTag:D([h.TAG_PROPERTIES.HREF],m),metaTags:$(h.TAG_NAMES.META,[h.TAG_PROPERTIES.NAME,h.TAG_PROPERTIES.CHARSET,h.TAG_PROPERTIES.HTTPEQUIV,h.TAG_PROPERTIES.PROPERTY,h.TAG_PROPERTIES.ITEM_PROP],m),linkTags:$(h.TAG_NAMES.LINK,[h.TAG_PROPERTIES.REL,h.TAG_PROPERTIES.HREF],m),scriptTags:$(h.TAG_NAMES.SCRIPT,[h.TAG_PROPERTIES.SRC,h.TAG_PROPERTIES.INNER_HTML],m),noscriptTags:$(h.TAG_NAMES.NOSCRIPT,[h.TAG_PROPERTIES.INNER_HTML],m),styleTags:$(h.TAG_NAMES.STYLE,[h.TAG_PROPERTIES.CSS_TEXT],m),onChangeClientState:b(m)}},et=function(m){var S=m.htmlAttributes,T=m.title,j=m.titleAttributes,C=m.baseTag,I=m.metaTags,U=m.linkTags,R=m.scriptTags,F=m.noscriptTags,K=m.styleTags,ae=m.onChangeClientState;Z("html",S),M(T,j);var J={baseTag:G(h.TAG_NAMES.BASE,C),metaTags:G(h.TAG_NAMES.META,I),linkTags:G(h.TAG_NAMES.LINK,U),scriptTags:G(h.TAG_NAMES.SCRIPT,R),noscriptTags:G(h.TAG_NAMES.NOSCRIPT,F),styleTags:G(h.TAG_NAMES.STYLE,K)},te={},Se={};Object.keys(J).forEach(function(fe){var pe=J[fe],ce=pe.newTags,ye=pe.oldTags;ce.length&&(te[fe]=ce),ye.length&&(Se[fe]=J[fe].oldTags)}),ae(m,te,Se)},Ce=function(){return null},Ue=(0,o.default)(xe,et,Pe)(Ce);e.default=Re(Ue),n.exports=e.default}(Vt,Vt.exports)),Vt.exports}var Bu=Fu();const Xt=bo(Bu),Hu=()=>{const{user:n}=Ze(),e=wt(i=>i.favorites),t=wt(i=>i.fetchFavorites),[r,s]=B({});return ie(()=>{document.title="My Favorites - FreeStream",n&&t()},[n,t]),ie(()=>{(async()=>{if(n&&e.length>0){const o=e.map(a=>({media_id:a.id,media_type:a.type,season_number:a.season_number||null,episode_number:a.episode_number||null}));try{const a=await Go(o);s(a)}catch(a){console.error("Error fetching progress data for favorites:",a),s({})}}else s({})})()},[n,e]),l("div",{class:"container",children:[l(Xt,{children:l("title",{children:"My Favorites - FreeStream"})}),l("h1",{children:"My Favorites"}),e.length>0?l("div",{class:"movie-grid",children:e.map(i=>{const o=`${i.id}-${i.type}-${i.season_number||0}-${i.episode_number||0}`,a=r[o];return l(bt,{item:i,type:i.type,progress:a?.progress_seconds,duration:a?.duration_seconds},`${i.type}-${i.id}-${i.season_number||0}-${i.episode_number||0}`)})}):l("p",{children:"You haven't added any favorites yet."})]})},fo=async(n,e=3,t=1e3)=>{for(let r=0;r<e;r++)try{const s=new Promise((a,c)=>{setTimeout(()=>c(new Error("Request timeout")),1e4)}),i=fetch(n,{headers:{Accept:"application/json","Content-Type":"application/json"}}),o=await Promise.race([i,s]);if(!o.ok)throw new Error(`HTTP ${o.status}: ${o.statusText}`);return o}catch(s){if(console.warn(`Fetch attempt ${r+1} failed for ${n}:`,s.message),r===e-1)throw s;await new Promise(i=>setTimeout(i,t*(r+1)))}},Wu=()=>{const{user:n}=Ze(),[e,t]=B([]),[r,s]=B(!0),[i,o]=B(null),{removeContinueWatchingItem:a,fetchContinueWatching:c}=wt(),u=va(async()=>{if(!n){s(!1);return}s(!0),o(null);try{if(!await Bo())throw new Error("Supabase connection test failed. Please check your internet connection and try again.");const p=await iu();if(!p||p.length===0){t([]),s(!1);return}console.log("📚 Combined history data received:",{totalItems:p.length,itemsWithProgress:p.filter(g=>g.progress_seconds>0).length});const v=(await Promise.allSettled(p.map(async g=>{try{const E=await(await fo(`${we}/tmdb/${g.media_type}/${g.media_id}`)).json(),_={...E,id:E.id,watch_id:`${g.user_id}-${g.media_id}-${g.media_type}-${g.season_number||0}-${g.episode_number||0}`,type:g.media_type,media_type:g.media_type,media_id:g.media_id,season_number:g.season_number,episode_number:g.episode_number,watched_at:g.watched_at,progress_seconds:g.progress_seconds,duration_seconds:g.duration_seconds};if(g.media_type==="tv"&&g.season_number&&g.episode_number)try{const b=await(await fo(`${we}/tmdb/tv/${g.media_id}/season/${g.season_number}/episode/${g.episode_number}`)).json();return{..._,episode_name:b.name,still_path:b.still_path,episode_overview:b.overview}}catch(P){console.error("Error fetching episode details:",P)}return _}catch(w){return console.error(`Error fetching details for ${g.media_type} ${g.media_id}:`,w),{id:g.media_id,watch_id:`${g.user_id}-${g.media_id}-${g.media_type}-${g.season_number||0}-${g.episode_number||0}`,type:g.media_type,media_type:g.media_type,media_id:g.media_id,season_number:g.season_number,episode_number:g.episode_number,watched_at:g.watched_at,title:g.media_type==="tv"?"Unknown TV Show":"Unknown Movie",name:g.media_type==="tv"?"Unknown TV Show":void 0,poster_path:null,overview:"Details could not be loaded",_failed_to_load:!0,progress_seconds:g.progress_seconds,duration_seconds:g.duration_seconds}}}))).filter(g=>g.status==="fulfilled"&&g.value).map(g=>g.value);t(v)}catch(f){console.error("Error fetching watch history:",f),o("Failed to load watch history. Please try again."),t([])}finally{s(!1)}},[n]);ie(()=>{u()},[u]);const d=async f=>{t(e.filter(p=>p.watch_id!==f.watch_id)),a(f.media_id);try{await ru(f),await c()}catch(p){console.error("Failed to delete item or refetch continue watching:",p)}},h=()=>{u()};return r?l("div",{class:"container",children:l("p",{children:"Loading watch history..."})}):i?l("div",{class:"container",children:[l(Xt,{children:l("title",{children:"Watch History - FreeStream"})}),l("h1",{children:"Watch History"}),l("div",{class:"error-message",children:[l("p",{children:i}),l("button",{onClick:h,class:"retry-button",children:"Retry"})]})]}):l("div",{class:"container",children:[l(Xt,{children:l("title",{children:"Watch History - FreeStream"})}),l("h1",{children:"Watch History"}),e.length>0?l("div",{class:"movie-grid",children:e.map(f=>l(bt,{item:f,type:f.type,progress:f.progress_seconds,duration:f.duration_seconds,showDeleteButton:!0,onDelete:d},f.watch_id))}):l("p",{children:"Your watch history is empty."})]})},po=n=>{const[e,t]=B(null),[r,s]=B([]),[i,o]=B([]),[a,c]=B(""),[u,d]=B(!0),[h,f]=B(!1),[p,y]=B(1),[v,g]=B(1),[w,E]=B("videasy"),[_,P]=B(["videasy","vidsrc","embedsu"]),[b,x]=B(null),[D,$]=B(!1),[M,Z]=B(!1),[G,re]=B(!1),[oe,ee]=B(null),[he,$e]=B(null),[ve,Pe]=B(!1),[Re,xe]=B(!1),[et,Ce]=B([]),Ue=me(null),[N,m]=B([]),[S,T]=B(null),[j,C]=B(!1),[I,U]=B(0),[R,F]=B(1),K=6,ae=me(!1),J=me(null),te=me(!1),Se=me(!1),fe=me(!1),pe=me(null),ce=me(!1),ye=me(new Set),tt=me(0);me(0);const qe=me(null),{id:Q,type:k,season:rt,episode:nt}=n.matches,{user:Te}=Ze(),{addFavorite:rs,removeFavorite:ns,isFavorited:ss,setCurrentMediaItem:tr}=wt(),is=ya(()=>k!=="movie"||!S||!S.progress_seconds||S.progress_seconds<=0?0:S.duration_seconds>0?Math.min(100,S.progress_seconds/S.duration_seconds*100):S.progress_seconds>30?5:2,[k,S]),rr=Te?.id,os=me(rr);me(0),ie(()=>{os.current=rr},[rr]),ie(()=>()=>{ye.current.forEach(A=>clearTimeout(A)),ye.current.clear()},[p,v]),ie(()=>(e&&tr({...e,type:k}),()=>{tr(null)}),[e,k,tr]),ie(()=>{if(!Q||!k){je("/");return}c(""),xe(!1),Ce([]),t(null),d(!0),re(!1),ee(null),m([]),te.current=!1,Se.current=!1,fe.current=!1,pe.current=null,ce.current=!1,ye.current.forEach(L=>clearTimeout(L)),ye.current.clear(),tt.current=0,qe.current=null,(async()=>{d(!0);try{const L=new AbortController,O=setTimeout(()=>L.abort(),15e3),[Y,le,V]=await Promise.all([fetch(`${we}/tmdb/${k}/${Q}`,{signal:L.signal}).then(H=>{if(!H.ok)throw new Error(`HTTP ${H.status}: ${H.statusText}`);return H.json()}).catch(H=>{throw console.error("Error fetching media details:",H),H}),fetch(`${we}/tmdb/${k}/${Q}/videos`,{signal:L.signal}).then(H=>{if(!H.ok)throw new Error(`HTTP ${H.status}: ${H.statusText}`);return H.json()}).catch(H=>(console.error("Error fetching videos:",H),{results:[]})),fetch(`${we}/tmdb/${k}/${Q}/recommendations`,{signal:L.signal}).then(H=>{if(!H.ok)throw new Error(`HTTP ${H.status}: ${H.statusText}`);return H.json()}).catch(H=>(console.error("Error fetching recommendations:",H),{results:[]}))]);if(clearTimeout(O),t(Y),s(le.results||[]),o(V.results||[]),(k==="tv"||k==="anime")&&Y.seasons&&Y.seasons.length>0)if(rt&&nt&&!isNaN(parseInt(rt))&&!isNaN(parseInt(nt))){fe.current?fe.current=!1:te.current=!0;const se=parseInt(rt,10),q=parseInt(nt,10);(se!==p||q!==v)&&(y(se),g(q))}else{const se=Y.seasons.find(q=>q.season_number>0)||Y.seasons[0];(se.season_number!==p||v!==1)&&(y(se.season_number),g(1))}}catch{t(null),s([]),o([])}finally{d(!1)}})()},[Q,k,rt,nt]),ie(()=>{(async()=>{if(!Te||!e||!Q||!k){k==="movie"?T(null):(k==="tv"||k==="anime")&&m([]);return}try{if((k==="tv"||k==="anime")&&e.seasons&&e.seasons.length>0&&!(rt&&nt&&!isNaN(parseInt(rt))&&!isNaN(parseInt(nt)))&&!Se.current){console.log("🎬 Checking for continue watching episode...");const O=await su(Q);O&&O.season&&O.episode?(console.log(`🔄 Continue watching: S${O.season}E${O.episode}`),setTimeout(()=>{y(O.season),g(O.episode);const Y=`/watch/${k}/${Q}/season/${O.season}/episode/${O.episode}`;je(Y,!0)},100)):console.log("📭 No continue watching data found, starting from beginning"),Se.current=!0}if(k==="tv"||k==="anime"){const L=await nu(Q);m(L)}else if(k==="movie"){const L=await pr(Q,k);console.log("Movie progress data loaded:",L),T(L)}}catch(L){console.error("Error loading user-specific data:",L)}})()},[Te,e,Q,k]),ie(()=>{F(1)},[p]),ie(()=>{(async()=>{if(!(k!=="tv"&&k!=="anime"||!Q||!p)){$(!0);try{const L=new AbortController,O=setTimeout(()=>L.abort(),1e4),Y=await fetch(`${we}/tmdb/${k}/${Q}/season/${p}`,{signal:L.signal});if(clearTimeout(O),Y.ok){const le=await Y.json();x(le)}else x(null)}catch{x(null)}finally{$(!1)}}})()},[Q,k,p]),ie(()=>{const A=`${p}-${v}`,L=J.current&&J.current!==A;if(J.current=A,ae.current&&!L){ae.current=!1;return}L&&(ae.current=!1),(async()=>{if(!Q||!k)return;re(!1),ee(null),$e(null),Pe(!1);let Y=0;if(os.current)try{const V=await pr(Q,k,p,v);V&&V.progress_seconds>30?(Y=V.progress_seconds,U(V.progress_seconds)):U(0)}catch(V){console.error("Error fetching progress for stream URL:",V),U(0)}else U(0);let le=`${we}/stream-url?type=${k}&id=${Q}&source=${w}`;(k==="tv"||k==="anime")&&(le+=`&season=${p}&episode=${v}`,k==="anime"&&(le+=`&dub=${M}`)),w==="videasy"&&Y>30&&(le+=`&progress=${Math.floor(Y)}`);try{const V=new AbortController,H=setTimeout(()=>V.abort(),2e4),se=await fetch(le,{signal:V.signal});clearTimeout(H);const q=await se.json();if(!se.ok)throw new Error(q.message||`HTTP ${se.status}`);let De=q.url;q.isDirectSource?(c(De),Ce(q.qualities||[]),xe(!0)):(c(De),xe(!1),Ce([])),q.currentSource&&q.currentSource!==w&&(ae.current=!0,E(q.currentSource)),q.availableSources&&P(q.availableSources),$e(null)}catch(V){let H="Could not load the video stream.",se=!0;V.name==="AbortError"?H="Stream request timed out. Please try again.":V.message.includes("unavailable")?H="All streaming sources are currently unavailable. This is usually temporary.":V.message.includes("503")?H="Streaming service is temporarily down. Please try again in a few minutes.":V.message.includes("404")?H="This content is not available from the current source.":V.message.includes("NetworkError")||V.message.includes("fetch")?H="Network connection issue. Please check your internet and try again.":H="Unable to load video stream. This might be due to leaving and returning to the browser.",$e({message:H,canRetry:se}),c(""),xe(!1)}})()},[Q,k,p,v,w,M]);const as=()=>{if(!b||!b.episodes)return;const A=b.episodes.findIndex(L=>L.episode_number===v);if(A!==-1&&A<b.episodes.length-1){const L=b.episodes[A+1];g(L.episode_number)}re(!1),ee(null)};if(ie(()=>{if(G&&oe===null&&ee(15),oe>0){const A=setTimeout(()=>{ee(oe-1)},1e3);return()=>clearTimeout(A)}else oe===0&&as()},[G,oe]),ie(()=>{if(Te&&e){const A=`${Q}-${k}-${p}-${v}`,L=Date.now(),O=window.lastHistoryUpdate||{};(!O[A]||L-O[A]>5e3)&&(console.log("📝 Adding immediate watch history entry:",{mediaId:Q,type:k,season:p,episode:v,title:e.title||e.name}),ri({...e,id:e.id,type:k,season:p,episode:v}).then(()=>{console.log("✅ Watch history entry added successfully")}).catch(Y=>{console.error("❌ Failed to add watch history entry:",Y)}),window.lastHistoryUpdate={...O,[A]:L})}else console.log("⚠️ Skipping watch history entry:",{hasUser:!!Te,hasMediaDetails:!!e})},[Te,e,k,p,v,Q]),ie(()=>{if(console.log("🔐 Progress tracking setup:",{hasUser:!!Te,userId:Te?.id,hasMediaDetails:!!e}),!Te||!e){console.log("⚠️ Progress tracking disabled - missing user or media details");return}const A=async(O,Y)=>{if(console.log(`📊 Progress update received via ${Y}:`,O),O&&O.progress>=0&&O.duration>0){const le=Date.now(),V=`${Q}-${k}-${p}-${v}`,H=window.lastProgressSave||{};!H[V]||le-H[V]>5e3?(console.log(`🎬 Attempting to save progress for ${k} ${Q}:`,{progress:O.progress,duration:O.duration,season:p,episode:v}),await ti({...e,id:e.id,type:k,season:p,episode:v},O.progress,O.duration)?(console.log("✅ Progress saved successfully"),window.lastProgressSave={...H,[V]:le},k==="movie"?T({progress_seconds:O.progress,duration_seconds:O.duration}):(k==="tv"||k==="anime")&&m(De=>{const Me=[...De],Pt=Me.findIndex(st=>st.season_number===p&&st.episode_number===v),Fe={media_id:parseInt(Q,10),media_type:k,season_number:p,episode_number:v,progress_seconds:O.progress,duration_seconds:O.duration};return Pt>-1?Me[Pt]={...Me[Pt],...Fe}:Me.push(Fe),Me})):console.error("❌ Failed to save progress")):console.log("⏭️ Progress save skipped (too recent):",{timeSinceLastSave:le-H[V],threshold:5e3});const se=O.duration-O.progress;se<=15&&se>0&&!G&&(k==="tv"||k==="anime")&&re(!0)}else console.log("⚠️ Progress update ignored (insufficient data):",{hasProgressData:!!O,progress:O?.progress,duration:O?.duration,meetsThreshold:O?.progress>=0&&O?.duration>0})};let L;if(Re){const O=Ue.current;if(!O)return;const Y=async()=>{const V=await pr(Q,k,p,v);V&&V.progress_seconds&&(O.currentTime=V.progress_seconds)},le=async()=>{if(O.currentTime>0){const V=Date.now(),H=`${Q}-${k}-${p}-${v}`,se=window.lastProgressSave||{};if(!se[H]||V-se[H]>5e3){const q={progress:Math.round(O.currentTime),duration:Math.round(O.duration),percentage:O.duration>0?O.currentTime/O.duration*100:0};console.log("🎬 Direct video - saving progress:",q),await ti({...e,id:e.id,type:k,season:p,episode:v},q.progress,q.duration)?(console.log("✅ Direct video progress saved successfully"),window.lastProgressSave={...se,[H]:V},k==="movie"?T({progress_seconds:q.progress,duration_seconds:q.duration}):(k==="tv"||k==="anime")&&m(Pt=>{const Fe=[...Pt],st=Fe.findIndex(vs=>vs.season_number===p&&vs.episode_number===v),gs={media_id:parseInt(Q,10),media_type:k,season_number:p,episode_number:v,progress_seconds:q.progress,duration_seconds:q.duration};return st>-1?Fe[st]={...Fe[st],...gs}:Fe.push(gs),Fe})):console.error("❌ Failed to save direct video progress");const Me=q.duration-q.progress;Me<=15&&Me>0&&!G&&(k==="tv"||k==="anime")&&re(!0)}}};return O.addEventListener("loadedmetadata",Y),O.addEventListener("timeupdate",le),()=>{O.removeEventListener("loadedmetadata",Y),O.removeEventListener("timeupdate",le)}}else{L=V=>{const H=["player.videasy.net","vidsrc.to","embed.su","vidsrc.xyz","vidsrc.in","vidsrc.pm"],se=new URL(V.origin);if(H.includes(se.hostname))try{let q;if(typeof V.data=="string")try{q=JSON.parse(V.data)}catch(De){console.error("Error parsing player message:",De);return}else q=V.data;if(q.type==="PLAYER_EVENT"&&q.data)if(q.data.event==="timeupdate"){const De={progress:q.data.currentTime,duration:q.data.duration,mediaId:q.data.id,mediaType:q.data.mediaType,season:q.data.season,episode:q.data.episode};A(De,se.hostname)}else q.data.event==="ended"?handleMediaEnded():q.data.event==="play"?f(!0):q.data.event==="pause"&&f(!1);else q.type==="MEDIA_DATA"||(q.type==="VIDEASY_EVENT"&&q.event==="player_ready"?(C(!0),console.log("🎉 Videasy Player is ready!"),postPlayerMessage({action:"get_history"})):q.type==="request_seek"&&q.time&&(console.log(`Seeking to ${q.time}`),postPlayerMessage({action:"seek",time:q.time})))}catch(q){console.error("Error handling message from player:",q)}},window.addEventListener("message",L);let O;const Y=()=>{O&&clearInterval(O),O=setInterval(()=>{if(Te&&e&&a){const V=Date.now(),H=`${Q}-${k}-${p}-${v}`,se=window.lastHistoryUpdate||{};(!se[H]||V-se[H]>3e4)&&(ri({...e,id:e.id,type:k,season:p,episode:v}),window.lastHistoryUpdate={...se,[H]:V})}},6e4)},le=setTimeout(()=>{Y()},12e4);return()=>{window.removeEventListener("message",L),O&&clearInterval(O),le&&clearTimeout(le)}}},[a,Re,Q,k,p,v,e,G,Te]),u)return l("div",{class:"loading-state",children:[l("div",{class:"loading-spinner"}),l("p",{children:"Loading media details..."})]});if(!e)return l("div",{class:"container",children:l("div",{class:"error-state",children:[l("h2",{children:"Unable to Load Media"}),l("p",{children:"We couldn't load the details for this content. This could be due to:"}),l("ul",{children:[l("li",{children:"Network connectivity issues"}),l("li",{children:"The content may no longer be available"}),l("li",{children:"Server maintenance"})]}),l("button",{onClick:()=>window.location.reload(),class:"btn btn-primary",style:{marginTop:"20px"},children:"Try Again"})]})});const{title:nr,name:sr,overview:da,vote_average:Yu,release_date:cs,first_air_date:ls,runtime:us,number_of_seasons:ds,genres:hs,poster_path:fs}=e,ir=(k==="tv"||k==="anime")&&p&&v,or=ir?ss(e.id,p,v):ss(e.id),ps=cs||ls?new Date(cs||ls).getFullYear():"",ha=()=>{if(!Te){window.confirm("You need to log in to save favorites. Would you like to go to the login page?")&&je("/login");return}if(or)ir?ns(e.id,p,v):ns(e.id);else if(ir){const A=b?.episodes?.find(L=>L.episode_number===v);rs({...e,type:k,season_number:p,episode_number:v,episode_name:A?.name||`Episode ${v}`})}else rs({...e,type:k})};return l("div",{children:[l(Xt,{children:l("title",{children:[nr||sr," - FreeStream"]})}),l("div",{class:"player-container",children:[!a&&he&&l("div",{class:"stream-error-message",children:[l("p",{children:he.message}),he.canRetry&&l("div",{class:"error-actions",children:[l("button",{onClick:async()=>{Pe(!0),setTimeout(()=>{(async()=>{const L=`${we}/stream-url?type=${k}&id=${Q}&source=${w}${k==="tv"||k==="anime"?`&season=${p}&episode=${v}`:""}${k==="anime"?`&dub=${M}`:""}`;try{const O=await fetch(L),Y=await O.json();if(O.ok)c(Y.url),xe(Y.isDirectSource),Ce(Y.qualities||[]),$e(null);else throw new Error(Y.message)}catch(O){console.error("Retry failed:",O),$e({message:"Retry failed. Please try selecting a different source.",canRetry:!0})}Pe(!1)})()},1e3)},disabled:ve,class:"btn retry-btn",children:ve?"Retrying...":"Retry"}),l("p",{children:"Or try selecting a different source from the list below."})]})]}),!a&&!he&&l("div",{class:"stream-loading",children:l("p",{children:"Loading video stream..."})}),Re?l("video",{ref:Ue,src:a,controls:!0,autoPlay:!0,width:"100%"}):a&&l("iframe",{src:a,width:"100%",height:"100%",style:{position:"absolute",top:0,left:0,width:"100%",height:"100%"},frameBorder:"0",allowFullScreen:!0,allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share; fullscreen",title:"Video Player",loading:"eager",referrerPolicy:"no-referrer-when-downgrade",sandbox:"allow-same-origin allow-scripts allow-popups allow-forms allow-pointer-lock allow-popups-to-escape-sandbox",importance:"high",onLoad:()=>{console.log("🎬 Player iframe loaded"),C(!0),w!=="videasy"&&I>30?setTimeout(()=>{const A=document.querySelector("iframe");if(A&&A.contentWindow)try{A.contentWindow.postMessage({type:"SEEK_TO",time:I},"*"),console.log(`📍 Sent seek command to restore progress: ${I}s`)}catch(L){console.log("Could not send seek command:",L)}},500):console.log(w==="videasy"?"📍 Videasy native resume - no seeking needed":"📍 No significant progress to resume, starting from beginning")}}),G&&l("div",{class:"next-episode-prompt",children:l("div",{class:"next-episode-content",children:[l("h3",{children:"Up Next"}),l("p",{children:["Playing next episode in ",oe,"s..."]}),l("div",{class:"next-episode-buttons",children:[l("button",{onClick:as,class:"btn btn-primary",children:"Play Next"}),l("button",{onClick:()=>{re(!1),ee(null)},class:"btn",children:"Cancel"})]})]})})]}),l("div",{class:"container",children:[l("div",{class:"media-details-layout",children:[l("div",{class:"poster",children:[l("img",{src:qn(fs?`${Nn}${fs}`:"https://via.placeholder.com/500x750.png?text=No+Image"),alt:nr||sr}),is>0&&l("div",{class:"movie-progress-container",children:[l("div",{class:"movie-progress-bar",children:l("div",{class:"movie-progress",style:{width:`${Math.max(2,is)}%`}})}),l("div",{class:"movie-progress-text",children:S.duration_seconds>0?`${Math.floor(S.progress_seconds/60)}m / ${Math.floor(S.duration_seconds/60)}m watched`:`${Math.floor(S.progress_seconds/60)}m watched`})]})]}),l("div",{class:"details",children:[l("div",{class:"title-container",children:[l("h1",{children:nr||sr}),l("button",{onClick:ha,class:`favorite-btn ${or?"favorited":""}`,children:or?"♥ Favorited":"♡"}),!Te&&l("span",{class:"login-hint",children:l("small",{children:[l("a",{href:"/login",style:{color:"#007bff",textDecoration:"none"},children:"Log in"})," to save favorites, track progress & continue watching"]})})]}),l("div",{class:"meta",children:[l("span",{class:"rating",children:["★ ",e.vote_average?e.vote_average.toFixed(1):"N/A"]}),ps&&l("span",{children:ps}),us&&l("span",{children:[us," min"]}),ds&&l("span",{children:[ds," Seasons"]})]}),l("div",{class:"genres",children:hs&&hs.map(A=>l("span",{class:"genre-tag",children:A.name}))}),l("p",{class:"overview",children:da}),et.length>0&&l("div",{class:"quality-selector",children:[l("label",{children:"Quality:"}),et.map(A=>l("button",{class:`quality-btn ${a===A.url?"active":""}`,onClick:()=>c(A.url),children:[A.quality,"p"]}))]})]})]}),k==="anime"&&l("div",{class:"select-container",children:[l("label",{for:"dub-select",children:"Audio:"}),l("select",{id:"dub-select",value:M,onChange:A=>Z(A.target.value==="true"),children:[l("option",{value:"false",children:"Subbed"}),l("option",{value:"true",children:"Dubbed"})]})]}),l("div",{class:"selectors-container",children:[(k==="tv"||k==="anime")&&e&&e.seasons&&l("div",{class:"select-container",children:[l("label",{children:"Season:"}),l("div",{class:"selector-buttons",children:e.seasons.filter(A=>A.season_number>0).map(A=>l("button",{class:`selector-btn ${p===A.season_number?"active":""}`,onClick:()=>{console.log(`🎯 User manually selected season ${A.season_number}`),te.current=!0,qe.current=null;const L=`/watch/${k}/${Q}/season/${A.season_number}/episode/1`;je(L,!0)},children:A.name},A.id))})]}),_.length>1&&l("div",{class:"select-container",children:[l("label",{children:"Source:"}),l("div",{class:"selector-buttons",children:_.map(A=>l("button",{class:`selector-btn ${w===A?"active":""}`,onClick:()=>E(A),children:A},A))})]})]}),(k==="tv"||k==="anime")&&l("div",{class:"episodes-container",children:[l("h3",{children:"Episodes"}),D?l("div",{class:"loading-spinner"}):l(vt,{children:[l("div",{class:"episode-list",children:b?.episodes?.slice((R-1)*K,R*K)?.map(A=>{const L=N.find(Y=>Y.season_number===p&&Y.episode_number===A.episode_number),O=L&&L.progress_seconds>0?L.duration_seconds&&L.duration_seconds>0?Math.min(100,L.progress_seconds/L.duration_seconds*100):L.progress_seconds>30?5:2:0;return l("div",{class:`episode-card ${A.episode_number===v?"active":""}`,onClick:()=>{console.log(`🎯 User manually selected episode ${A.episode_number}`),te.current=!0,qe.current=null;const Y=`/watch/${k}/${Q}/season/${p}/episode/${A.episode_number}`;je(Y,!0)},children:[l("div",{class:"episode-card-image",children:[l("img",{src:qn(A.still_path?`${Nn}${A.still_path}`:`https://via.placeholder.com/300x169.png?text=${encodeURIComponent(A.name)}`),alt:A.name}),l("div",{class:"episode-number-badge",children:A.episode_number}),O>0&&l("div",{class:"episode-progress-bar",children:l("div",{class:"episode-progress",style:{width:`${Math.max(2,O)}%`}})})]}),l("div",{class:"episode-card-content",children:[l("h4",{children:A.name}),l("p",{class:"episode-overview",children:A.overview})]})]},A.id)})}),b?.episodes&&b.episodes.length>K&&l("div",{class:"pagination-controls",children:[l("button",{class:"pagination-btn",onClick:()=>F(A=>Math.max(1,A-1)),disabled:R===1,children:"← Previous"}),l("div",{class:"pagination-info",children:[l("span",{class:"page-numbers",children:Array.from({length:Math.ceil(b.episodes.length/K)},(A,L)=>L+1).map(A=>l("button",{class:`page-number ${A===R?"active":""}`,onClick:()=>F(A),children:A},A))}),l("span",{class:"page-text",children:["Page ",R," of ",Math.ceil(b.episodes.length/K),"(",b.episodes.length," episodes)"]})]}),l("button",{class:"pagination-btn",onClick:()=>F(A=>Math.min(Math.ceil(b.episodes.length/K),A+1)),disabled:R===Math.ceil(b.episodes.length/K),children:"Next →"})]})]})]}),i.length>0&&l("div",{class:"recommendations",children:[l("h2",{children:"More Like This"}),l("div",{class:"movie-grid",children:i.map(A=>l(bt,{item:A,type:k,progress:null,duration:null},`${A.media_type||k}-${A.id}`))})]})]})]})},Gu=n=>{const[e,t]=B([]),[r,s]=B(!1),[i,o]=B("");ie(()=>{const u=new URLSearchParams(n.url?.split("?")[1]||"").get("q");o(u||""),u?a(u):t([])},[n.url]);const a=async c=>{s(!0);try{const d=await(await fetch(`${we}/tmdb/search/multi?query=${encodeURIComponent(c)}`)).json();if(d&&d.results){const h=d.results.filter(f=>(f.media_type==="movie"||f.media_type==="tv")&&f.poster_path);t(h)}}catch(u){console.error("Error performing search:",u),t([])}finally{s(!1)}};return l("div",{class:"container home-page",children:[l("div",{class:"search-header",children:[l("h1",{class:"main-title",children:"Search Results"}),l("div",{class:"search-query-display",children:[l("span",{class:"search-label",children:"Showing results for:"}),l("span",{class:"search-query",children:['"',i,'"']})]})]}),r?l(Ko,{text:"Searching for movies and TV shows..."}):e.length>0?l("section",{class:"home-section",children:[l("h2",{children:["Found ",e.length," result",e.length!==1?"s":""]}),l("div",{class:"movie-grid",children:e.map(c=>l(bt,{item:c,type:c.media_type,progress:null,duration:null},`${c.media_type}-${c.id}`))})]}):i?l("div",{class:"no-results",children:[l("div",{class:"no-results-icon",children:"🔍"}),l("h3",{children:"No results found"}),l("p",{children:[`We couldn't find anything for "`,i,'". Try searching with different keywords.']}),l("div",{class:"search-suggestions",children:[l("p",{children:"Try searching for:"}),l("ul",{children:[l("li",{children:"Movie or TV show titles"}),l("li",{children:"Actor or director names"}),l("li",{children:'Genre names (e.g., "action", "comedy")'}),l("li",{children:"Keywords from the plot"})]})]})]}):l("div",{class:"search-welcome",children:[l("div",{class:"search-welcome-icon",children:"🎬"}),l("h3",{children:"Start your search"}),l("p",{children:"Use the search bar above to find your favorite movies and TV shows."})]})]})};function En(){const[n,e]=B(!1),[t,r]=B(""),[s,i]=B("");return l("div",{className:"auth-container",children:l("div",{className:"auth-form",children:[l("h1",{className:"header",children:"Login"}),l("p",{className:"description",children:"Sign in to your account."}),l("form",{onSubmit:async a=>{a.preventDefault();try{e(!0);const{error:c}=await X.auth.signInWithPassword({email:t,password:s});if(c)throw c;Qt.success("Logged in successfully!"),je("/",!0)}catch(c){Qt.error(c.error_description||c.message)}finally{e(!1)}},children:[l("div",{className:"input-group",children:[l("label",{htmlFor:"email",children:"Email"}),l("input",{id:"email",className:"input-field",type:"email",placeholder:"Your email",value:t,onChange:a=>r(a.target.value)})]}),l("div",{className:"input-group",children:[l("label",{htmlFor:"password",children:"Password"}),l("input",{id:"password",className:"input-field",type:"password",placeholder:"Your password",value:s,onChange:a=>i(a.target.value)})]}),l("div",{children:l("button",{className:"button",disabled:n,children:n?l("span",{children:"Loading..."}):l("span",{children:"Login"})})})]})]})})}function Ku(){const[n,e]=B(!1),[t,r]=B(""),[s,i]=B("");return l("div",{className:"auth-container",children:l("div",{className:"auth-form",children:[l("h1",{className:"header",children:"Create an account"}),l("p",{className:"description",children:"Sign up for a new account."}),l("form",{onSubmit:async a=>{a.preventDefault();try{e(!0);const{error:c}=await X.auth.signUp({email:t,password:s});if(c)throw c;Qt.success("Check your email for the confirmation link!")}catch(c){Qt.error(c.error_description||c.message)}finally{e(!1)}},children:[l("div",{className:"input-group",children:[l("label",{htmlFor:"email",children:"Email"}),l("input",{id:"email",className:"input-field",type:"email",placeholder:"Your email",value:t,onChange:a=>r(a.target.value)})]}),l("div",{className:"input-group",children:[l("label",{htmlFor:"password",children:"Password"}),l("input",{id:"password",className:"input-field",type:"password",placeholder:"Your password",value:s,onChange:a=>i(a.target.value)})]}),l("div",{children:l("button",{className:"button",disabled:n,children:n?l("span",{children:"Loading..."}):l("span",{children:"Sign Up"})})})]})]})})}const Vu=()=>{const[n,e]=B(!1);return ie(()=>{const r=()=>{window.pageYOffset>300?e(!0):e(!1)};return window.addEventListener("scroll",r),()=>window.removeEventListener("scroll",r)},[]),l("button",{class:`scroll-to-top ${n?"visible":""}`,onClick:()=>{window.scrollTo({top:0,behavior:"smooth"})},"aria-label":"Scroll to top",children:l("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:l("path",{d:"M18 15l-6-6-6 6"})})})},zu=()=>{const{user:n}=Ze();return l("div",{class:"app",children:[l(Nl,{position:"top-center"}),l(Bl,{}),l("main",{children:l(wo,{history:Oa(),children:[l(gr,{path:"/"}),l(gr,{path:"/movies"}),l(gr,{path:"/tv"}),n?l(Hu,{path:"/favorites"}):l(En,{path:"/favorites"}),n?l(Wu,{path:"/history"}):l(En,{path:"/history"}),l(po,{path:"/watch/:type/:id"}),l(po,{path:"/watch/:type/:id/season/:season/episode/:episode"}),l(Gu,{path:"/search"}),l(En,{path:"/login"}),l(Ku,{path:"/signup"})]})}),l(Wl,{}),l(Vu,{})]})},Ju=()=>(ie(()=>{Ml()},[]),l(Dl,{children:l(zu,{})}));ma(l(Ju,{}),document.getElementById("app"));
//# sourceMappingURL=index-CPv5YGDL.js.map
