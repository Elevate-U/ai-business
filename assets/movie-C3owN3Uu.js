import{O as U,A as y,u as e,n as Y,I as B,i as K}from"./index-_qC34Ia1.js";import{E as Q,d as m,y as X}from"./react-vendor-BYlzYzcd.js";import{i as Z,r as ee,a as te}from"./favorites-BlRffn-V.js";import{M as ne}from"./MovieCard-Co4wMSA7.js";async function _(s){try{const t=await fetch(s);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);return await t.json()}catch(t){return console.error("Fetch error:",t),null}}function T(s,t){const a=t==="movie",r=a?s.title:s.name;a?s.release_date:s.first_air_date;const i=s.media_type||t,d=document.createElement("div");return d.className="movie-card",d.innerHTML=`
        <a href="movie.html?id=${s.id}&type=${i}">
            <img src="${y}${s.poster_path}" alt="${r}" loading="lazy">
            <div class="movie-card-info">
                <h3>${r}</h3>
                <p>⭐ ${s.vote_average.toFixed(1)}</p>
            </div>
        </a>
    `,d.innerHTML}function W(){const s=document.getElementById("search-input"),t=document.getElementById("search-button"),a=()=>{const r=s.value.trim();r&&(window.location.href=`search.html?q=${encodeURIComponent(r)}`)};t&&t.addEventListener("click",a),s&&s.addEventListener("keypress",r=>{r.key==="Enter"&&a()})}document.addEventListener("DOMContentLoaded",()=>{({currentMediaType:"movie",heroSlideshowInterval:null,elements:{heroSection:document.getElementById("hero"),contentDisplay:document.getElementById("content-display"),genreResultsSection:document.getElementById("genre-results"),navLinks:document.querySelectorAll("header nav a[data-type]"),genreBar:document.getElementById("genre-bar"),trendingMoviesGrid:document.querySelector("#trending-movies .movie-grid"),topRatedMoviesGrid:document.querySelector("#top-rated-movies .movie-grid"),trendingTvGrid:document.querySelector("#trending-tv .movie-grid"),topRatedTvGrid:document.querySelector("#top-rated-tv .movie-grid"),genreResultsGrid:document.getElementById("genre-results-grid"),genreResultsTitle:document.getElementById("genre-results-title"),paginationContainer:document.getElementById("pagination"),continueWatchingSection:document.getElementById("continue-watching")},init(){this.displayContinueWatching(),this.setupEventListeners(),this.switchView(this.currentMediaType),this.elements.navLinks[0].classList.add("active"),W()},setupEventListeners(){this.elements.navLinks.forEach(t=>{t.addEventListener("click",a=>{a.preventDefault(),this.switchView(t.dataset.type)})})},switchView(t){this.currentMediaType=t,this.elements.navLinks.forEach(a=>{a.classList.toggle("active",a.dataset.type===t)}),this.elements.contentDisplay.classList.remove("hidden"),this.elements.genreResultsSection.classList.add("hidden"),this.fetchAndDisplaySections(t),this.fetchAndDisplayGenres(t)},async fetchAndDisplaySections(t){this.toggleSectionVisibility(t);const a=t==="movie"?this.elements.trendingMoviesGrid:this.elements.trendingTvGrid,r=t==="movie"?this.elements.topRatedMoviesGrid:this.elements.topRatedTvGrid;a.innerHTML="<p>Loading...</p>",r.innerHTML="<p>Loading...</p>";const i=`${y}/trending/${t}/week`,d=`${y}/${t}/top_rated?language=en-US&page=1`,[l,f]=await Promise.all([_(i),_(d)]);l&&l.results&&(this.displayGrid(l.results,a,t),this.startHeroSlideshow(l.results.slice(0,5),t)),f&&f.results&&this.displayGrid(f.results,r,t)},displayGrid(t,a,r){if(!t||t.length===0){a.innerHTML="<p>No items to display.</p>";return}a.innerHTML=t.map(i=>T(i,r)).join(""),attachFavoriteListeners()},toggleSectionVisibility(t){const a=t==="movie";document.getElementById("trending-movies").style.display=a?"block":"none",document.getElementById("top-rated-movies").style.display=a?"block":"none",document.getElementById("trending-tv").style.display=a?"none":"block",document.getElementById("top-rated-tv").style.display=a?"none":"block"},updateHeroContent(t,a){this.elements.heroSection.style.backgroundImage=`linear-gradient(to right, rgba(0, 0, 0, 0.7) 30%, transparent), url(${U}${t.backdrop_path})`;const r=a==="movie"?t.title:t.name,i=`movie.html?id=${t.id}&type=${a}`;this.elements.heroSection.innerHTML=`
                <div class="hero-content">
                    <h1 class="hero-title">${r}</h1>
                    <p class="hero-overview">${t.overview}</p>
                    <a href="${i}" class="btn btn-primary">▶ Watch Now</a>
                </div>
            `},startHeroSlideshow(t,a){if(!t||t.length===0)return;let r=0;this.updateHeroContent(t[r],a),clearInterval(this.heroSlideshowInterval),this.heroSlideshowInterval=setInterval(()=>{r=(r+1)%t.length,this.updateHeroContent(t[r],a)},7e3)},async fetchAndDisplayGenres(t){const a=`${y}/genre/${t}/list?language=en-US`,r=await _(a);!r||!r.genres||(this.elements.genreBar.innerHTML='<button class="genre-btn active" data-genre-id="all">All Genres</button>'+r.genres.map(i=>`<button class="genre-btn" data-genre-id="${i.id}">${i.name}</button>`).join(""),this.elements.genreBar.querySelectorAll(".genre-btn").forEach(i=>{i.addEventListener("click",()=>{this.elements.genreBar.querySelector(".genre-btn.active").classList.remove("active"),i.classList.add("active");const d=i.dataset.genreId,l=i.textContent;d==="all"?(this.elements.contentDisplay.classList.remove("hidden"),this.elements.genreResultsSection.classList.add("hidden")):this.fetchAndDisplayByGenre(t,d,l)})}))},async fetchAndDisplayByGenre(t,a,r,i=1){const d=`${y}/discover/${t}?with_genres=${a}&language=en-US&page=${i}`,l=await _(d);l&&(this.elements.contentDisplay.classList.add("hidden"),this.elements.genreResultsSection.classList.remove("hidden"),this.elements.genreResultsTitle.textContent=`${r}`,this.displayGrid(l.results,this.elements.genreResultsGrid,t),this.setupPagination(t,a,r,i,l.total_pages))},setupPagination(t,a,r,i,d){if(this.elements.paginationContainer.innerHTML="",d<=1)return;const l=(p,g,S=!1)=>{const u=document.createElement("button");return u.textContent=g,u.disabled=S,S||u.addEventListener("click",()=>this.fetchAndDisplayByGenre(t,a,r,p)),u};i>1&&this.elements.paginationContainer.appendChild(l(i-1,"« Prev"));const f=Math.max(1,i-2),h=Math.min(d,i+2);for(let p=f;p<=h;p++){const g=l(p,p);p===i&&(g.classList.add("active"),g.disabled=!0),this.elements.paginationContainer.appendChild(g)}i<d&&this.elements.paginationContainer.appendChild(l(i+1,"Next »"))},displayContinueWatching(){const t=getHistory();if(!t||t.length===0){this.elements.continueWatchingSection.classList.add("hidden");return}this.elements.continueWatchingSection.classList.remove("hidden");let r=t.slice(0,10).map(i=>{const d=T(i,i.type),l=document.createElement("div");l.innerHTML=d;const f=l.querySelector(".movie-info");let h=0;if(i.type==="movie"&&i.progress)h=i.progress;else if(i.type==="tv"&&i.watchedEpisodes){const p=Object.keys(i.watchedEpisodes).length,g=Object.values(i.watchedEpisodes).filter(S=>S.status==="completed").length;p>0&&(h=g/p*100)}return f&&h>0&&(f.innerHTML+=`<div class="progress-bar-container"><div class="progress-bar" style="width: ${h}%;"></div></div>`),l.innerHTML}).join("");this.elements.continueWatchingSection.innerHTML=`
                <h2>Continue Watching</h2>
                <div class="movie-grid">${r}</div>
            `,attachFavoriteListeners()}}).init()});const se=()=>{const[s,t]=m(null),[a,r]=m([]),[i,d]=m([]),[l,f]=m(null),[h,p]=m(null),[g,S]=m(!1),[u,P]=m(null),[ie,x]=m(null),[F,D]=m(!0),[G,q]=m(!1),[H,A]=m(1),[k,M]=m(1);X(()=>{const n=window.location.pathname.split("/"),o=n[1],c=n[2];f(c),p(o),S(Z(c));const $=Y().find(E=>E.id==c);$&&x($),c&&o&&j(c,o),W()},[l]);const j=async(n,o)=>{D(!0);const c=`${y}/tmdb/${o}/${n}?language=en-US`,$=`${y}/tmdb/${o}/${n}/videos?language=en-US`,E=`${y}/tmdb/${o}/${n}/recommendations?language=en-US`;try{const[b,w,L]=await Promise.all([_(c,"Error loading media details"),_($,"Error loading videos"),_(E,"Error loading recommendations")]);if(t(b),r(w?.results||[]),d(L?.results||[]),o==="tv"&&b&&b.seasons){const C=await R(n,b.seasons[0].season_number);P(C)}}catch(b){console.error("Failed to fetch page data",b)}finally{D(!1)}},R=async(n,o)=>{const c=`${y}/tmdb/tv/${n}/season/${o}?language=en-US`;return await _(c)},N=async n=>{const o=await R(l,n);P(o),A(1),M(1)},V=()=>{const n={id:s.id,type:h,title:s.name||s.title,poster_path:s.poster_path,vote_average:s.vote_average};g?(ee(s.id),S(!1)):(te(n),S(!0))},I=(n,o=null,c=null,$=!1)=>{const E=document.getElementById("video-player");if(!E)return;const b={id:s.id,type:h,title:s.name||s.title,poster_path:s.poster_path,vote_average:s.vote_average};K(b,o,c);let w="";h==="movie"?w=`${y}/stream-url?source=${n}&type=movie&id=${l}`:h==="tv"&&(w=`${y}/stream-url?source=${n}&type=tv&id=${l}&season=${o}&episode=${c}&dub=${$}`),fetch(w).then(L=>L.json()).then(L=>{L.url&&(E.src=L.url)})},O=()=>{const n=a.find(o=>o.type==="Trailer"&&o.site==="YouTube");return n?e("div",{id:"trailer-modal",class:"modal",children:e("div",{class:"modal-content",children:[e("span",{class:"close-button",onClick:()=>document.getElementById("trailer-modal").style.display="none",children:"×"}),e("iframe",{width:"560",height:"315",src:`https://www.youtube.com/embed/${n.key}`,frameborder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowfullscreen:!0})]})}):null};if(F)return e("div",{class:"loading-spinner"});if(!s)return e("p",{class:"container",children:"Could not load media details. Please try again later."});const z=s.backdrop_path?`${U}${s.backdrop_path}`:"";return e("div",{children:[e("div",{id:"backdrop",style:{backgroundImage:`url(${z})`}}),e("main",{class:"container",id:"media-details-content",children:[e("section",{id:"media-header",children:[e("div",{class:"poster",children:e("img",{src:`${B}${s.poster_path}`,alt:s.title||s.name})}),e("div",{class:"info",children:[e("div",{class:"title-container",children:[e("h1",{children:s.title||s.name}),e("button",{id:"favorite-btn",class:g?"favorited":"",onClick:V,children:g?"♥ Favorited":"♡ Add to Favorites"})]}),e("div",{class:"meta",children:[e("span",{children:s.release_date||s.first_air_date}),e("span",{children:s.genres.map(n=>n.name).join(", ")}),s.runtime&&e("span",{children:[s.runtime," min"]}),e("span",{class:"rating",children:["★ ",s.vote_average.toFixed(1)]})]}),e("p",{class:"overview",children:s.overview}),e("div",{class:"actions",children:a.find(n=>n.type==="Trailer")&&e("button",{id:"watch-trailer-btn",onClick:()=>document.getElementById("trailer-modal").style.display="block",children:"Watch Trailer"})})]})]}),e("section",{id:"playback",children:[e("h2",{children:"Watch Now"}),e("div",{class:"server-selection",children:[e("button",{class:"server-btn active",onClick:n=>I(n.target.dataset.server),"data-server":"videasy",children:"Videasy"}),e("button",{class:"server-btn",onClick:n=>I(n.target.dataset.server),"data-server":"vidsrc",children:"VidSrc"}),e("button",{class:"server-btn",onClick:n=>I(n.target.dataset.server),"data-server":"embedsu",children:"Embeds.su"})]}),e("div",{class:"video-container",children:e("iframe",{id:"video-player",allowfullscreen:!0})}),h==="tv"&&e("div",{class:"select-container",children:[e("label",{for:"dub-select",children:"Audio:"}),e("select",{id:"dub-select",value:G,onChange:n=>{q(n.target.value==="true");const o=document.querySelector(".server-btn.active").dataset.server,c=u?.episodes?.[0]?.episode_number||1;I(o,u?.season_number,c,n.target.value==="true")},children:[e("option",{value:"false",children:"Subbed"}),e("option",{value:"true",children:"Dubbed"})]})]})]}),h==="tv"&&s.seasons&&e("section",{id:"seasons-episodes",children:[e("h2",{children:"Seasons & Episodes"}),e("div",{class:"seasons-container",children:s.seasons.filter(n=>n.season_number>0).map(n=>e("div",{class:`season-card ${u?.season_number===n.season_number?"active":""}`,onClick:()=>N(n.season_number),children:[e("img",{src:n.poster_path?`${B}${n.poster_path}`:"https://via.placeholder.com/130x200?text=No+Image",alt:n.name}),e("span",{children:n.name})]}))}),u&&(()=>{const n=u.episodes.length,o=Math.ceil(n/episodesPerPage),c=Math.ceil(o/pagesPerPagination),$=(H-1)*episodesPerPage,E=$+episodesPerPage,b=u.episodes.slice($,E),w=(k-1)*pagesPerPagination,L=w+pagesPerPagination,C=Array.from({length:o},(v,J)=>J+1).slice(w,L);return e("div",{children:[e("div",{class:"episodes-container",children:[e("h3",{children:u.name}),b.map(v=>e("div",{class:"episode-card",onClick:()=>I(document.querySelector(".server-btn.active").dataset.server,u.season_number,v.episode_number,G),children:[e("div",{class:"episode-thumbnail",children:e("img",{src:v.still_path?`${B}${v.still_path}`:"https://via.placeholder.com/150x84?text=No+Image",alt:v.name})}),e("div",{class:"episode-info",children:[e("h4",{children:[v.episode_number,". ",v.name]}),e("p",{children:v.overview})]})]}))]}),o>1&&e("div",{class:"pagination-controls",children:[k>1&&e("button",{onClick:()=>M(k-1),children:e("i",{class:"fas fa-angle-double-left"})}),C.map(v=>e("button",{class:H===v?"active":"",onClick:()=>A(v),children:v},v)),k<c&&e("button",{onClick:()=>M(k+1),children:e("i",{class:"fas fa-angle-double-right"})})]})]})})()]}),i.length>0&&e("section",{id:"recommendations",children:[e("h2",{children:"Recommendations"}),e("div",{class:"movie-grid",children:i.map(n=>e(ne,{item:n,type:h}))})]})]}),O()]})};Q(e(se,{}),document.getElementById("app"));
//# sourceMappingURL=movie-C3owN3Uu.js.map
