import{a as Q,b as X,u as e,$ as Z,j as G,A as q,e as K,L as de}from"./index-MrGnfflC.js";import{d as b,y as V,q as j}from"./react-vendor-BYlzYzcd.js";/* empty css                  *//* empty css             */const J=({item:i,progress:y,duration:_,showDeleteButton:R,onDelete:T,onClick:k})=>{const{id:F,title:$,poster_path:C,overview:H,vote_average:I,first_air_date:A,status:f,episodes:w,format:l,nextAiringEpisode:N,studios:g,genres:h,season:U,seasonYear:S,source:M,meanScore:E,favourites:v,tags:P,trailer:z,isAdult:s,duration:a,season_number:t,episode_number:r,episode_name:c}=i,D=$?.english||$?.romaji||$||i.name||"Unknown Anime",m=y&&_>0?y/_*100:0,p=A?new Date(A).getFullYear():S,{user:L}=Q(),{addFavorite:ee,removeFavorite:ne,isShowFavorited:ie,favoritesFetched:se}=X(),W=ie(i.id||i.anilist_id,"anime",i.season_number,i.episode_number),ae=n=>{n.preventDefault(),n.stopPropagation(),L&&(W?ne(L.id,i.id||i.anilist_id,"anime",i.season_number,i.episode_number):ee(L.id,{...i,type:"anime"}))},B=n=>{if(n.preventDefault(),n.stopPropagation(),console.log("AnimeCard clicked:",i),k)k(i);else{let o;if(i.source==="tmdb"){const d=i.media_type||"tv",u=i.tmdb_id||i.id;o=`/watch/${d}/${u}`,d==="tv"&&(i.season_number&&i.episode_number?o+=`/season/${i.season_number}/episode/${i.episode_number}`:o+="/season/1/episode/1")}else o=`/watch/anime/${i.anilist_id||i.id}`,i.season_number&&i.episode_number?o+=`/season/${i.season_number}/episode/${i.episode_number}`:o+="/season/1/episode/1";if(i.source!=="tmdb"||i.media_type==="tv"){const d=localStorage.getItem("anime-audio-preference")||"subbed",u=new URLSearchParams;d==="dubbed"&&u.set("dub","true"),u.toString()&&(o+=`?${u.toString()}`)}console.log("Routing to:",o),Z(o)}},O=(()=>{if(t&&r)return`S${t} E${r}${c?`: ${c}`:""}`;const n=[];return p&&n.push(p.toString()),w&&n.push(`${w} episodes`),l&&l!=="TV"&&n.push(l),f==="RELEASING"&&n.push("Airing"),n.length>0?n.join(" • "):"Anime"})(),te=()=>{if(!f)return null;const o={RELEASING:{text:"Airing",class:"airing"},FINISHED:{text:"Completed",class:"completed"},NOT_YET_RELEASED:{text:"Upcoming",class:"upcoming"},CANCELLED:{text:"Cancelled",class:"cancelled"},HIATUS:{text:"Hiatus",class:"hiatus"}}[f];return o?e("div",{className:`anime-status-badge ${o.class}`,children:o.text}):null},oe=()=>{if(!N||f!=="RELEASING")return null;const n=N.timeUntilAiring;if(n<=0)return null;const o=Math.floor(n/(24*60*60)),d=Math.floor(n%(24*60*60)/(60*60)),u=Math.floor(n%(60*60)/60);let x="";return o>0?x=`${o}d ${d}h`:d>0?x=`${d}h ${u}m`:u>0?x=`${u}m`:x="Soon",e("div",{className:"next-episode-info",children:[e("span",{className:"next-ep-label",children:["Ep ",N.episode]}),e("span",{className:"next-ep-time",children:["in ",x]})]})},Y=()=>{if(!g||g.length===0)return null;const n=g.find(o=>o.isMain)||g[0];return n?.name||n},re=()=>!h||h.length===0?null:h.slice(0,2).map(n=>e("span",{className:"genre-tag",children:n},n)),le=n=>n?n.includes("anilist.co")||n.includes("anili.st")||n.includes("anilistcdn")?G(n):n.startsWith("http")?G(n):G(n):"https://via.placeholder.com/500x750/1a1a1a/ffffff?text=No+Image",ce=()=>{const n=E||I;return n?(n>10?n/10:n).toFixed(1):"N/A"};return e("div",{className:"anime-card-container",children:e("div",{className:"anime-card",onClick:B,style:{cursor:"pointer"},role:"button",tabIndex:0,onKeyDown:n=>{(n.key==="Enter"||n.key===" ")&&(n.preventDefault(),B(n))},children:e("div",{className:"anime-poster-wrapper",children:[e("img",{src:le(C),alt:D,loading:"lazy",width:"500",height:"750"}),e("div",{className:"anime-scrim"}),te(),m>.01&&e("div",{className:"anime-progress-container",children:e("div",{className:"anime-progress-bar",style:{width:`${Math.min(m,100)}%`}})}),e("div",{className:"streaming-indicator",children:e("span",{className:`source-badge ${(i.source||"tmdb")==="anilist"?"anilist":"tmdb"}`,children:(i.source||"tmdb")==="anilist"?"AniList":"TMDB"})}),e("div",{className:"anime-card-info",children:[e("div",{className:"anime-title-row",children:[e("h3",{className:"anime-card-title",children:D}),L&&e("button",{className:`anime-favorite-btn ${W?"favorited":""}`,onClick:ae,"aria-label":W?"Remove from favorites":"Add to favorites",disabled:!se,children:"♥︎"})]}),O&&e("p",{className:"anime-card-subtitle",children:O}),oe(),Y()&&e("p",{className:"anime-studio-info",children:Y()}),h&&h.length>0&&e("div",{className:"anime-genre-tags",children:re()}),e("div",{className:"anime-rating-row",children:[e("span",{className:"anime-rating",children:["★ ",ce()]}),v&&e("span",{className:"anime-favorites",children:["♥ ",v.toLocaleString()]})]})]}),R&&e("button",{className:"anime-delete-btn",onClick:n=>{n.preventDefault(),n.stopPropagation(),T&&T(i)},"aria-label":"Remove from continue watching",children:"×"})]})})})},ge=()=>{const[i,y]=b(!0),[_,R]=b([]),[T,k]=b([]),[F,$]=b([]),[C,H]=b([]),[I,A]=b(null),[f,w]=b(!0),{user:l}=Q(),{continueWatching:N,continueWatchingFetched:g,fetchContinueWatching:h}=X();V(()=>{l&&!g&&h(l.id)},[l,g,h]);const U=N.filter(s=>s.type==="anime"),S=j(async(s=3)=>{try{const a=await fetch(`${q}/trending/anime/combined`);if(!a.ok)throw new Error(`API error: ${a.status}`);return a.json()}catch(a){return console.error("Error fetching combined anime data:",a),s>0?(await new Promise(t=>setTimeout(t,1e3*(4-s))),S(s-1)):null}},[]),M=j(async s=>{let a,t,r;if(s.source==="tmdb"){if(a=s.media_type||"tv",t=s.tmdb_id||s.id,r=`/watch/${a}/${t}`,a==="tv")if(l){const c=await K(l.id,t);c?r+=`/season/${c.season}/episode/${c.episode}`:r+="/season/1/episode/1"}else r+="/season/1/episode/1"}else if(a="anime",t=s.anilist_id||s.id,r=`/watch/anime/${t}`,l){const c=await K(l.id,t);c?r+=`/season/${c.season}/episode/${c.episode}`:r+="/season/1/episode/1"}else r+="/season/1/episode/1";Z(r)},[l]),E=j(async()=>{try{const s=await fetch(`${q}/health/videasy`,{method:"GET",signal:AbortSignal.timeout(5e3)});w(s.ok)}catch(s){console.warn("Videasy availability check failed:",s),w(!1)}},[]);V(()=>{E()},[E]),V(()=>{(async()=>{y(!0),A(null);try{const a=await S();if(a){const t=m=>m.filter(p=>p.poster_path);R(t(a.combined||[]).slice(0,20)),k(t(a.seasonal||[]));const r=t(a.combined||[]),c=[...r].sort((m,p)=>(p.popularity||0)-(m.popularity||0));$(c.slice(0,20));const D=[...r].sort((m,p)=>(p.vote_average||0)-(m.vote_average||0));H(D.slice(0,20))}else throw new Error("Failed to fetch any anime data.")}catch(a){console.error("Error fetching anime data:",a),A("Failed to load anime data. Please refresh the page.")}finally{y(!1)}})()},[S]);const v=(s,a)=>!a||a.length===0?null:e("section",{class:"home-section",children:[e("h2",{children:s}),e("div",{class:"scrolling-row",children:a.map(t=>e(J,{item:t,onClick:()=>M(t)},`${s}-${t.id}`))})]}),P=()=>e("div",{class:"service-status",children:e("div",{class:`status-indicator ${f?"online":"offline"}`,children:[e("span",{class:"status-dot"}),"Videasy: ",f?"Online":"Offline"]})}),z=({error:s,onRetry:a})=>e("div",{class:"error-container",children:[e("div",{class:"error-message",children:[e("h3",{children:"Something went wrong"}),e("p",{children:s}),e("button",{onClick:a,class:"retry-button",children:"Try Again"})]}),e(P,{})]});return i?e("div",{class:"container home-page anime-page",children:[e("h1",{class:"main-title",children:"Anime"}),e(P,{}),e(de,{text:"Loading anime..."})]}):I?e("div",{class:"container home-page anime-page",children:[e("h1",{class:"main-title",children:"Anime"}),e(z,{error:I,onRetry:()=>{A(null),E()}})]}):e("div",{class:"container home-page anime-page",children:[e("h1",{class:"main-title",children:"Anime"}),e("div",{class:"anime-controls",children:e(P,{})}),U.length>0&&e("section",{class:"home-section",children:[e("h2",{children:"Continue Watching"}),e("div",{class:"scrolling-row scrolling-row--compact",children:U.map(s=>e(J,{item:s,progress:s.progress_seconds,duration:s.duration_seconds,onClick:()=>M(s)},`continue-watching-${s.id}`))})]}),v("Trending Now",_),v("This Season",T),v("Popular Anime",F),v("Top Rated Anime",C),!i&&_.length===0&&F.length===0&&C.length===0&&e("div",{class:"no-content",children:[e("h3",{children:"No anime content available"}),e("p",{children:"Please check your connection and try again."})]})]})};export{ge as default};
//# sourceMappingURL=Anime-CkdPj7sK.js.map
