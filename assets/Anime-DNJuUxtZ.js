import{a as Q,b as X,u as e,$ as R,j as V,A as K,e as le,L as de}from"./index-8EZUBNgj.js";import{d as f,y as j,q as H}from"./react-vendor-BYlzYzcd.js";/* empty css                  *//* empty css             */const J=({item:a,progress:b,duration:A,showDeleteButton:F,onDelete:x,onClick:T})=>{const{id:U,title:y,poster_path:k,overview:z,vote_average:C,first_air_date:v,status:m,episodes:N,format:r,nextAiringEpisode:w,studios:g,genres:d,season:M,seasonYear:S,source:W,meanScore:$,favourites:p,tags:I,trailer:B,isAdult:i,duration:t,season_number:s,episode_number:E,episode_name:P}=a,D=y?.english||y?.romaji||y||a.name||"Unknown Anime",u=b&&A>0?b/A*100:0,h=v?new Date(v).getFullYear():S,{user:L}=Q(),{addFavorite:Z,removeFavorite:ee,isShowFavorited:ne,favoritesFetched:ie}=X(),G=ne(a.id||a.anilist_id,"anime",a.season_number,a.episode_number),ae=n=>{n.preventDefault(),n.stopPropagation(),L&&(G?ee(L.id,a.id||a.anilist_id,"anime",a.season_number,a.episode_number):Z(L.id,{...a,type:"anime"}))},O=n=>{if(n.preventDefault(),n.stopPropagation(),console.log("AnimeCard clicked:",a),T)T(a);else{let c=`/watch/anime/${a.anilist_id||a.id}`;a.season_number&&a.episode_number?c+=`/season/${a.season_number}/episode/${a.episode_number}`:c+="/season/1/episode/1";const _=localStorage.getItem("anime-audio-preference")||"subbed",l=new URLSearchParams;_==="dubbed"&&l.set("dub","true"),l.toString()&&(c+=`?${l.toString()}`),console.log("Routing to:",c),R(c)}},Y=(()=>{if(s&&E)return`S${s} E${E}${P?`: ${P}`:""}`;const n=[];return h&&n.push(h.toString()),N&&n.push(`${N} episodes`),r&&r!=="TV"&&n.push(r),m==="RELEASING"&&n.push("Airing"),n.length>0?n.join(" • "):"Anime"})(),te=()=>{if(!m)return null;const o={RELEASING:{text:"Airing",class:"airing"},FINISHED:{text:"Completed",class:"completed"},NOT_YET_RELEASED:{text:"Upcoming",class:"upcoming"},CANCELLED:{text:"Cancelled",class:"cancelled"},HIATUS:{text:"Hiatus",class:"hiatus"}}[m];return o?e("div",{className:`anime-status-badge ${o.class}`,children:o.text}):null},se=()=>{if(!w||m!=="RELEASING")return null;const n=w.timeUntilAiring;if(n<=0)return null;const o=Math.floor(n/(24*60*60)),c=Math.floor(n%(24*60*60)/(60*60)),_=Math.floor(n%(60*60)/60);let l="";return o>0?l=`${o}d ${c}h`:c>0?l=`${c}h ${_}m`:_>0?l=`${_}m`:l="Soon",e("div",{className:"next-episode-info",children:[e("span",{className:"next-ep-label",children:["Ep ",w.episode]}),e("span",{className:"next-ep-time",children:["in ",l]})]})},q=()=>{if(!g||g.length===0)return null;const n=g.find(o=>o.isMain)||g[0];return n?.name||n},re=()=>!d||d.length===0?null:d.slice(0,2).map(n=>e("span",{className:"genre-tag",children:n},n)),oe=n=>n?n.includes("anilist.co")||n.includes("anili.st")||n.includes("anilistcdn")?V(n):n.startsWith("http")?V(n):V(n):"https://via.placeholder.com/500x750/1a1a1a/ffffff?text=No+Image",ce=()=>{const n=$||C;return n?(n>10?n/10:n).toFixed(1):"N/A"};return e("div",{className:"anime-card-container",children:e("div",{className:"anime-card",onClick:O,style:{cursor:"pointer"},role:"button",tabIndex:0,onKeyDown:n=>{(n.key==="Enter"||n.key===" ")&&(n.preventDefault(),O(n))},children:e("div",{className:"anime-poster-wrapper",children:[e("img",{src:oe(k),alt:D,loading:"lazy",width:"500",height:"750"}),e("div",{className:"anime-scrim"}),te(),u>.01&&e("div",{className:"anime-progress-container",children:e("div",{className:"anime-progress-bar",style:{width:`${Math.min(u,100)}%`}})}),e("div",{className:"streaming-indicator",children:e("span",{className:`source-badge ${(a.source||"tmdb")==="anilist"?"anilist":"tmdb"}`,children:(a.source||"tmdb")==="anilist"?"AniList":"TMDB"})}),e("div",{className:"anime-card-info",children:[e("div",{className:"anime-title-row",children:[e("h3",{className:"anime-card-title",children:D}),L&&e("button",{className:`anime-favorite-btn ${G?"favorited":""}`,onClick:ae,"aria-label":G?"Remove from favorites":"Add to favorites",disabled:!ie,children:"♥︎"})]}),Y&&e("p",{className:"anime-card-subtitle",children:Y}),se(),q()&&e("p",{className:"anime-studio-info",children:q()}),d&&d.length>0&&e("div",{className:"anime-genre-tags",children:re()}),e("div",{className:"anime-rating-row",children:[e("span",{className:"anime-rating",children:["★ ",ce()]}),p&&e("span",{className:"anime-favorites",children:["♥ ",p.toLocaleString()]})]})]}),F&&e("button",{className:"anime-delete-btn",onClick:n=>{n.preventDefault(),n.stopPropagation(),x&&x(a)},"aria-label":"Remove from continue watching",children:"×"})]})})})},fe=()=>{const[a,b]=f(!0),[A,F]=f([]),[x,T]=f([]),[U,y]=f([]),[k,z]=f([]),[C,v]=f(null),[m,N]=f(!0),{user:r}=Q(),{continueWatching:w,continueWatchingFetched:g,fetchContinueWatching:d}=X();j(()=>{r&&!g&&d(r.id)},[r,g,d]);const M=w.filter(i=>i.type==="anime"),S=H(async(i=3)=>{try{const t=await fetch(`${K}/trending/anime/combined`);if(!t.ok)throw new Error(`API error: ${t.status}`);return t.json()}catch(t){return console.error("Error fetching combined anime data:",t),i>0?(await new Promise(s=>setTimeout(s,1e3*(4-i))),S(i-1)):null}},[]),W=H(async i=>{const t="anime";if(r){const s=await le(r.id,i.id);s?R(`/watch/${t}/${i.id}/season/${s.season}/episode/${s.episode}`):R(`/watch/${t}/${i.id}/season/1/episode/1`)}else R(`/watch/${t}/${i.id}/season/1/episode/1`)},[r]),$=H(async()=>{try{const i=await fetch(`${K}/health/videasy`,{method:"GET",signal:AbortSignal.timeout(5e3)});N(i.ok)}catch(i){console.warn("Videasy availability check failed:",i),N(!1)}},[]);j(()=>{$()},[$]),j(()=>{(async()=>{b(!0),v(null);try{const t=await S();if(t){const s=u=>u.filter(h=>h.poster_path);F(s(t.combined||[]).slice(0,20)),T(s(t.seasonal||[]));const E=s(t.combined||[]),P=[...E].sort((u,h)=>(h.popularity||0)-(u.popularity||0));y(P.slice(0,20));const D=[...E].sort((u,h)=>(h.vote_average||0)-(u.vote_average||0));z(D.slice(0,20))}else throw new Error("Failed to fetch any anime data.")}catch(t){console.error("Error fetching anime data:",t),v("Failed to load anime data. Please refresh the page.")}finally{b(!1)}})()},[S]);const p=(i,t)=>!t||t.length===0?null:e("section",{class:"home-section",children:[e("h2",{children:i}),e("div",{class:"scrolling-row",children:t.map(s=>e(J,{item:s,onClick:()=>W(s)},`${i}-${s.id}`))})]}),I=()=>e("div",{class:"service-status",children:e("div",{class:`status-indicator ${m?"online":"offline"}`,children:[e("span",{class:"status-dot"}),"Videasy: ",m?"Online":"Offline"]})}),B=({error:i,onRetry:t})=>e("div",{class:"error-container",children:[e("div",{class:"error-message",children:[e("h3",{children:"Something went wrong"}),e("p",{children:i}),e("button",{onClick:t,class:"retry-button",children:"Try Again"})]}),e(I,{})]});return a?e("div",{class:"container home-page anime-page",children:[e("h1",{class:"main-title",children:"Anime"}),e(I,{}),e(de,{text:"Loading anime..."})]}):C?e("div",{class:"container home-page anime-page",children:[e("h1",{class:"main-title",children:"Anime"}),e(B,{error:C,onRetry:()=>{v(null),$()}})]}):e("div",{class:"container home-page anime-page",children:[e("h1",{class:"main-title",children:"Anime"}),e("div",{class:"anime-controls",children:e(I,{})}),M.length>0&&e("section",{class:"home-section",children:[e("h2",{children:"Continue Watching"}),e("div",{class:"scrolling-row scrolling-row--compact",children:M.map(i=>e(J,{item:i,progress:i.progress_seconds,duration:i.duration_seconds,onClick:()=>W(i)},`continue-watching-${i.id}`))})]}),p("Trending Now",A),p("This Season",x),p("Popular Anime",U),p("Top Rated Anime",k),!a&&A.length===0&&U.length===0&&k.length===0&&e("div",{class:"no-content",children:[e("h3",{children:"No anime content available"}),e("p",{children:"Please check your connection and try again."})]})]})};export{fe as default};
//# sourceMappingURL=Anime-DNJuUxtZ.js.map
