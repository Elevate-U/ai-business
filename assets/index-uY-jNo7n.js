(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();var Xt,V,Sa,Ea,it,oi,Ta,Pa,ka,bs,Zn,es,$a,Yt={},Aa=[],Kl=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,Zt=Array.isArray;function Me(r,e){for(var t in e)r[t]=e[t];return r}function ws(r){r&&r.parentNode&&r.parentNode.removeChild(r)}function ke(r,e,t){var n,s,i,o={};for(i in e)i=="key"?n=e[i]:i=="ref"?s=e[i]:o[i]=e[i];if(arguments.length>2&&(o.children=arguments.length>3?Xt.call(arguments,2):t),typeof r=="function"&&r.defaultProps!=null)for(i in r.defaultProps)o[i]===void 0&&(o[i]=r.defaultProps[i]);return Wt(r,o,n,s,null)}function Wt(r,e,t,n,s){var i={type:r,props:e,key:t,ref:n,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:s??++Sa,__i:-1,__u:0};return s==null&&V.vnode!=null&&V.vnode(i),i}function Ra(){return{current:null}}function be(r){return r.children}function Ce(r,e){this.props=r,this.context=e}function At(r,e){if(e==null)return r.__?At(r.__,r.__i+1):null;for(var t;e<r.__k.length;e++)if((t=r.__k[e])!=null&&t.__e!=null)return t.__e;return typeof r.type=="function"?At(r):null}function Oa(r){var e,t;if((r=r.__)!=null&&r.__c!=null){for(r.__e=r.__c.base=null,e=0;e<r.__k.length;e++)if((t=r.__k[e])!=null&&t.__e!=null){r.__e=r.__c.base=t.__e;break}return Oa(r)}}function ts(r){(!r.__d&&(r.__d=!0)&&it.push(r)&&!vr.__r++||oi!=V.debounceRendering)&&((oi=V.debounceRendering)||Ta)(vr)}function vr(){for(var r,e,t,n,s,i,o,a=1;it.length;)it.length>a&&it.sort(Pa),r=it.shift(),a=it.length,r.__d&&(t=void 0,s=(n=(e=r).__v).__e,i=[],o=[],e.__P&&((t=Me({},n)).__v=n.__v+1,V.vnode&&V.vnode(t),Ss(e.__P,t,n,e.__n,e.__P.namespaceURI,32&n.__u?[s]:null,i,s??At(n),!!(32&n.__u),o),t.__v=n.__v,t.__.__k[t.__i]=t,ja(i,t,o),t.__e!=s&&Oa(t)));vr.__r=0}function Ca(r,e,t,n,s,i,o,a,l,c,h){var u,f,p,g,v,_,y=n&&n.__k||Aa,b=e.length;for(l=zl(t,e,y,l,b),u=0;u<b;u++)(p=t.__k[u])!=null&&(f=p.__i==-1?Yt:y[p.__i]||Yt,p.__i=u,_=Ss(r,p,f,s,i,o,a,l,c,h),g=p.__e,p.ref&&f.ref!=p.ref&&(f.ref&&Es(f.ref,null,p),h.push(p.ref,p.__c||g,p)),v==null&&g!=null&&(v=g),4&p.__u||f.__k===p.__k?l=xa(p,l,r):typeof p.type=="function"&&_!==void 0?l=_:g&&(l=g.nextSibling),p.__u&=-7);return t.__e=v,l}function zl(r,e,t,n,s){var i,o,a,l,c,h=t.length,u=h,f=0;for(r.__k=new Array(s),i=0;i<s;i++)(o=e[i])!=null&&typeof o!="boolean"&&typeof o!="function"?(l=i+f,(o=r.__k[i]=typeof o=="string"||typeof o=="number"||typeof o=="bigint"||o.constructor==String?Wt(null,o,null,null,null):Zt(o)?Wt(be,{children:o},null,null,null):o.constructor==null&&o.__b>0?Wt(o.type,o.props,o.key,o.ref?o.ref:null,o.__v):o).__=r,o.__b=r.__b+1,a=null,(c=o.__i=Jl(o,t,l,u))!=-1&&(u--,(a=t[c])&&(a.__u|=2)),a==null||a.__v==null?(c==-1&&(s>h?f--:s<h&&f++),typeof o.type!="function"&&(o.__u|=4)):c!=l&&(c==l-1?f--:c==l+1?f++:(c>l?f--:f++,o.__u|=4))):r.__k[i]=null;if(u)for(i=0;i<h;i++)(a=t[i])!=null&&(2&a.__u)==0&&(a.__e==n&&(n=At(a)),Ua(a,a));return n}function xa(r,e,t){var n,s;if(typeof r.type=="function"){for(n=r.__k,s=0;n&&s<n.length;s++)n[s]&&(n[s].__=r,e=xa(n[s],e,t));return e}r.__e!=e&&(e&&r.type&&!t.contains(e)&&(e=At(r)),t.insertBefore(r.__e,e||null),e=r.__e);do e=e&&e.nextSibling;while(e!=null&&e.nodeType==8);return e}function xe(r,e){return e=e||[],r==null||typeof r=="boolean"||(Zt(r)?r.some(function(t){xe(t,e)}):e.push(r)),e}function Jl(r,e,t,n){var s,i,o=r.key,a=r.type,l=e[t];if(l===null&&r.key==null||l&&o==l.key&&a==l.type&&(2&l.__u)==0)return t;if(n>(l!=null&&(2&l.__u)==0?1:0))for(s=t-1,i=t+1;s>=0||i<e.length;){if(s>=0){if((l=e[s])&&(2&l.__u)==0&&o==l.key&&a==l.type)return s;s--}if(i<e.length){if((l=e[i])&&(2&l.__u)==0&&o==l.key&&a==l.type)return i;i++}}return-1}function ai(r,e,t){e[0]=="-"?r.setProperty(e,t??""):r[e]=t==null?"":typeof t!="number"||Kl.test(e)?t:t+"px"}function or(r,e,t,n,s){var i,o;e:if(e=="style")if(typeof t=="string")r.style.cssText=t;else{if(typeof n=="string"&&(r.style.cssText=n=""),n)for(e in n)t&&e in t||ai(r.style,e,"");if(t)for(e in t)n&&t[e]==n[e]||ai(r.style,e,t[e])}else if(e[0]=="o"&&e[1]=="n")i=e!=(e=e.replace(ka,"$1")),o=e.toLowerCase(),e=o in r||e=="onFocusOut"||e=="onFocusIn"?o.slice(2):e.slice(2),r.l||(r.l={}),r.l[e+i]=t,t?n?t.u=n.u:(t.u=bs,r.addEventListener(e,i?es:Zn,i)):r.removeEventListener(e,i?es:Zn,i);else{if(s=="http://www.w3.org/2000/svg")e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(e!="width"&&e!="height"&&e!="href"&&e!="list"&&e!="form"&&e!="tabIndex"&&e!="download"&&e!="rowSpan"&&e!="colSpan"&&e!="role"&&e!="popover"&&e in r)try{r[e]=t??"";break e}catch{}typeof t=="function"||(t==null||t===!1&&e[4]!="-"?r.removeAttribute(e):r.setAttribute(e,e=="popover"&&t==1?"":t))}}function li(r){return function(e){if(this.l){var t=this.l[e.type+r];if(e.t==null)e.t=bs++;else if(e.t<t.u)return;return t(V.event?V.event(e):e)}}}function Ss(r,e,t,n,s,i,o,a,l,c){var h,u,f,p,g,v,_,y,b,w,E,S,C,I,A,U,Q,L=e.type;if(e.constructor!=null)return null;128&t.__u&&(l=!!(32&t.__u),i=[a=e.__e=t.__e]),(h=V.__b)&&h(e);e:if(typeof L=="function")try{if(y=e.props,b="prototype"in L&&L.prototype.render,w=(h=L.contextType)&&n[h.__c],E=h?w?w.props.value:h.__:n,t.__c?_=(u=e.__c=t.__c).__=u.__E:(b?e.__c=u=new L(y,E):(e.__c=u=new Ce(y,E),u.constructor=L,u.render=Ql),w&&w.sub(u),u.props=y,u.state||(u.state={}),u.context=E,u.__n=n,f=u.__d=!0,u.__h=[],u._sb=[]),b&&u.__s==null&&(u.__s=u.state),b&&L.getDerivedStateFromProps!=null&&(u.__s==u.state&&(u.__s=Me({},u.__s)),Me(u.__s,L.getDerivedStateFromProps(y,u.__s))),p=u.props,g=u.state,u.__v=e,f)b&&L.getDerivedStateFromProps==null&&u.componentWillMount!=null&&u.componentWillMount(),b&&u.componentDidMount!=null&&u.__h.push(u.componentDidMount);else{if(b&&L.getDerivedStateFromProps==null&&y!==p&&u.componentWillReceiveProps!=null&&u.componentWillReceiveProps(y,E),!u.__e&&u.shouldComponentUpdate!=null&&u.shouldComponentUpdate(y,u.__s,E)===!1||e.__v==t.__v){for(e.__v!=t.__v&&(u.props=y,u.state=u.__s,u.__d=!1),e.__e=t.__e,e.__k=t.__k,e.__k.some(function(X){X&&(X.__=e)}),S=0;S<u._sb.length;S++)u.__h.push(u._sb[S]);u._sb=[],u.__h.length&&o.push(u);break e}u.componentWillUpdate!=null&&u.componentWillUpdate(y,u.__s,E),b&&u.componentDidUpdate!=null&&u.__h.push(function(){u.componentDidUpdate(p,g,v)})}if(u.context=E,u.props=y,u.__P=r,u.__e=!1,C=V.__r,I=0,b){for(u.state=u.__s,u.__d=!1,C&&C(e),h=u.render(u.props,u.state,u.context),A=0;A<u._sb.length;A++)u.__h.push(u._sb[A]);u._sb=[]}else do u.__d=!1,C&&C(e),h=u.render(u.props,u.state,u.context),u.state=u.__s;while(u.__d&&++I<25);u.state=u.__s,u.getChildContext!=null&&(n=Me(Me({},n),u.getChildContext())),b&&!f&&u.getSnapshotBeforeUpdate!=null&&(v=u.getSnapshotBeforeUpdate(p,g)),U=h,h!=null&&h.type===be&&h.key==null&&(U=Ia(h.props.children)),a=Ca(r,Zt(U)?U:[U],e,t,n,s,i,o,a,l,c),u.base=e.__e,e.__u&=-161,u.__h.length&&o.push(u),_&&(u.__E=u.__=null)}catch(X){if(e.__v=null,l||i!=null)if(X.then){for(e.__u|=l?160:128;a&&a.nodeType==8&&a.nextSibling;)a=a.nextSibling;i[i.indexOf(a)]=null,e.__e=a}else for(Q=i.length;Q--;)ws(i[Q]);else e.__e=t.__e,e.__k=t.__k;V.__e(X,e,t)}else i==null&&e.__v==t.__v?(e.__k=t.__k,e.__e=t.__e):a=e.__e=Yl(t.__e,e,t,n,s,i,o,l,c);return(h=V.diffed)&&h(e),128&e.__u?void 0:a}function ja(r,e,t){for(var n=0;n<t.length;n++)Es(t[n],t[++n],t[++n]);V.__c&&V.__c(e,r),r.some(function(s){try{r=s.__h,s.__h=[],r.some(function(i){i.call(s)})}catch(i){V.__e(i,s.__v)}})}function Ia(r){return typeof r!="object"||r==null||r.__b&&r.__b>0?r:Zt(r)?r.map(Ia):Me({},r)}function Yl(r,e,t,n,s,i,o,a,l){var c,h,u,f,p,g,v,_=t.props,y=e.props,b=e.type;if(b=="svg"?s="http://www.w3.org/2000/svg":b=="math"?s="http://www.w3.org/1998/Math/MathML":s||(s="http://www.w3.org/1999/xhtml"),i!=null){for(c=0;c<i.length;c++)if((p=i[c])&&"setAttribute"in p==!!b&&(b?p.localName==b:p.nodeType==3)){r=p,i[c]=null;break}}if(r==null){if(b==null)return document.createTextNode(y);r=document.createElementNS(s,b,y.is&&y),a&&(V.__m&&V.__m(e,i),a=!1),i=null}if(b==null)_===y||a&&r.data==y||(r.data=y);else{if(i=i&&Xt.call(r.childNodes),_=t.props||Yt,!a&&i!=null)for(_={},c=0;c<r.attributes.length;c++)_[(p=r.attributes[c]).name]=p.value;for(c in _)if(p=_[c],c!="children"){if(c=="dangerouslySetInnerHTML")u=p;else if(!(c in y)){if(c=="value"&&"defaultValue"in y||c=="checked"&&"defaultChecked"in y)continue;or(r,c,null,p,s)}}for(c in y)p=y[c],c=="children"?f=p:c=="dangerouslySetInnerHTML"?h=p:c=="value"?g=p:c=="checked"?v=p:a&&typeof p!="function"||_[c]===p||or(r,c,p,_[c],s);if(h)a||u&&(h.__html==u.__html||h.__html==r.innerHTML)||(r.innerHTML=h.__html),e.__k=[];else if(u&&(r.innerHTML=""),Ca(e.type=="template"?r.content:r,Zt(f)?f:[f],e,t,n,b=="foreignObject"?"http://www.w3.org/1999/xhtml":s,i,o,i?i[0]:t.__k&&At(t,0),a,l),i!=null)for(c=i.length;c--;)ws(i[c]);a||(c="value",b=="progress"&&g==null?r.removeAttribute("value"):g!=null&&(g!==r[c]||b=="progress"&&!g||b=="option"&&g!=_[c])&&or(r,c,g,_[c],s),c="checked",v!=null&&v!=r[c]&&or(r,c,v,_[c],s))}return r}function Es(r,e,t){try{if(typeof r=="function"){var n=typeof r.__u=="function";n&&r.__u(),n&&e==null||(r.__u=r(e))}else r.current=e}catch(s){V.__e(s,t)}}function Ua(r,e,t){var n,s;if(V.unmount&&V.unmount(r),(n=r.ref)&&(n.current&&n.current!=r.__e||Es(n,null,e)),(n=r.__c)!=null){if(n.componentWillUnmount)try{n.componentWillUnmount()}catch(i){V.__e(i,e)}n.base=n.__P=null}if(n=r.__k)for(s=0;s<n.length;s++)n[s]&&Ua(n[s],e,t||typeof r.type!="function");t||ws(r.__e),r.__c=r.__=r.__e=void 0}function Ql(r,e,t){return this.constructor(r,t)}function lt(r,e,t){var n,s,i,o;e==document&&(e=document.documentElement),V.__&&V.__(r,e),s=(n=typeof t=="function")?null:t&&t.__k||e.__k,i=[],o=[],Ss(e,r=(!n&&t||e).__k=ke(be,null,[r]),s||Yt,Yt,e.namespaceURI,!n&&t?[t]:s?null:e.firstChild?Xt.call(e.childNodes):null,i,!n&&t?t:s?s.__e:e.firstChild,n,o),ja(i,r,o)}function Ts(r,e){lt(r,e,Ts)}function Ps(r,e,t){var n,s,i,o,a=Me({},r.props);for(i in r.type&&r.type.defaultProps&&(o=r.type.defaultProps),e)i=="key"?n=e[i]:i=="ref"?s=e[i]:a[i]=e[i]===void 0&&o!=null?o[i]:e[i];return arguments.length>2&&(a.children=arguments.length>3?Xt.call(arguments,2):t),Wt(r.type,a,n||r.key,s||r.ref,null)}function Er(r){function e(t){var n,s;return this.getChildContext||(n=new Set,(s={})[e.__c]=this,this.getChildContext=function(){return s},this.componentWillUnmount=function(){n=null},this.shouldComponentUpdate=function(i){this.props.value!=i.value&&n.forEach(function(o){o.__e=!0,ts(o)})},this.sub=function(i){n.add(i);var o=i.componentWillUnmount;i.componentWillUnmount=function(){n&&n.delete(i),o&&o.call(i)}}),t.children}return e.__c="__cC"+$a++,e.__=r,e.Provider=e.__l=(e.Consumer=function(t,n){return t.children(n)}).contextType=e,e}Xt=Aa.slice,V={__e:function(r,e,t,n){for(var s,i,o;e=e.__;)if((s=e.__c)&&!s.__)try{if((i=s.constructor)&&i.getDerivedStateFromError!=null&&(s.setState(i.getDerivedStateFromError(r)),o=s.__d),s.componentDidCatch!=null&&(s.componentDidCatch(r,n||{}),o=s.__d),o)return s.__E=s}catch(a){r=a}throw r}},Sa=0,Ea=function(r){return r!=null&&r.constructor==null},Ce.prototype.setState=function(r,e){var t;t=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=Me({},this.state),typeof r=="function"&&(r=r(Me({},t),this.props)),r&&Me(t,r),r!=null&&this.__v&&(e&&this._sb.push(e),ts(this))},Ce.prototype.forceUpdate=function(r){this.__v&&(this.__e=!0,r&&this.__h.push(r),ts(this))},Ce.prototype.render=be,it=[],Ta=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,Pa=function(r,e){return r.__v.__b-e.__v.__b},vr.__r=0,ka=/(PointerCapture)$|Capture$/i,bs=0,Zn=li(!1),es=li(!0),$a=0;const Xl=Object.freeze(Object.defineProperty({__proto__:null,Component:Ce,Fragment:be,cloneElement:Ps,createContext:Er,createElement:ke,createRef:Ra,h:ke,hydrate:Ts,get isValidElement(){return Ea},get options(){return V},render:lt,toChildArray:xe},Symbol.toStringTag,{value:"Module"}));var Zl=0;function d(r,e,t,n,s,i){e||(e={});var o,a,l=e;if("ref"in l)for(a in l={},e)a=="ref"?o=e[a]:l[a]=e[a];var c={type:r,props:l,key:t,ref:o,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:--Zl,__i:-1,__u:0,__source:s,__self:i};if(typeof r=="function"&&(o=r.defaultProps))for(a in o)l[a]===void 0&&(l[a]=o[a]);return V.vnode&&V.vnode(c),c}var et,ae,Ir,ci,Rt=0,Na=[],ce=V,ui=ce.__b,di=ce.__r,hi=ce.diffed,fi=ce.__c,pi=ce.unmount,_i=ce.__;function It(r,e){ce.__h&&ce.__h(ae,r,Rt||e),Rt=0;var t=ae.__H||(ae.__H={__:[],__h:[]});return r>=t.__.length&&t.__.push({}),t.__[r]}function q(r){return Rt=1,ks(qa,r)}function ks(r,e,t){var n=It(et++,2);if(n.t=r,!n.__c&&(n.__=[t?t(e):qa(void 0,e),function(a){var l=n.__N?n.__N[0]:n.__[0],c=n.t(l,a);l!==c&&(n.__N=[c,n.__[1]],n.__c.setState({}))}],n.__c=ae,!ae.__f)){var s=function(a,l,c){if(!n.__c.__H)return!0;var h=n.__c.__H.__.filter(function(f){return!!f.__c});if(h.every(function(f){return!f.__N}))return!i||i.call(this,a,l,c);var u=n.__c.props!==a;return h.forEach(function(f){if(f.__N){var p=f.__[0];f.__=f.__N,f.__N=void 0,p!==f.__[0]&&(u=!0)}}),i&&i.call(this,a,l,c)||u};ae.__f=!0;var i=ae.shouldComponentUpdate,o=ae.componentWillUpdate;ae.componentWillUpdate=function(a,l,c){if(this.__e){var h=i;i=void 0,s(a,l,c),i=h}o&&o.call(this,a,l,c)},ae.shouldComponentUpdate=s}return n.__N||n.__}function se(r,e){var t=It(et++,3);!ce.__s&&As(t.__H,e)&&(t.__=r,t.u=e,ae.__H.__h.push(t))}function er(r,e){var t=It(et++,4);!ce.__s&&As(t.__H,e)&&(t.__=r,t.u=e,ae.__h.push(t))}function me(r){return Rt=5,tr(function(){return{current:r}},[])}function Da(r,e,t){Rt=6,er(function(){if(typeof r=="function"){var n=r(e());return function(){r(null),n&&typeof n=="function"&&n()}}if(r)return r.current=e(),function(){return r.current=null}},t==null?t:t.concat(r))}function tr(r,e){var t=It(et++,7);return As(t.__H,e)&&(t.__=r(),t.__H=e,t.__h=r),t.__}function $s(r,e){return Rt=8,tr(function(){return r},e)}function Tr(r){var e=ae.context[r.__c],t=It(et++,9);return t.c=r,e?(t.__==null&&(t.__=!0,e.sub(ae)),e.props.value):r.__}function La(r,e){ce.useDebugValue&&ce.useDebugValue(e?e(r):r)}function Ma(){var r=It(et++,11);if(!r.__){for(var e=ae.__v;e!==null&&!e.__m&&e.__!==null;)e=e.__;var t=e.__m||(e.__m=[0,0]);r.__="P"+t[0]+"-"+t[1]++}return r.__}function ec(){for(var r;r=Na.shift();)if(r.__P&&r.__H)try{r.__H.__h.forEach(_r),r.__H.__h.forEach(rs),r.__H.__h=[]}catch(e){r.__H.__h=[],ce.__e(e,r.__v)}}ce.__b=function(r){ae=null,ui&&ui(r)},ce.__=function(r,e){r&&e.__k&&e.__k.__m&&(r.__m=e.__k.__m),_i&&_i(r,e)},ce.__r=function(r){di&&di(r),et=0;var e=(ae=r.__c).__H;e&&(Ir===ae?(e.__h=[],ae.__h=[],e.__.forEach(function(t){t.__N&&(t.__=t.__N),t.u=t.__N=void 0})):(e.__h.forEach(_r),e.__h.forEach(rs),e.__h=[],et=0)),Ir=ae},ce.diffed=function(r){hi&&hi(r);var e=r.__c;e&&e.__H&&(e.__H.__h.length&&(Na.push(e)!==1&&ci===ce.requestAnimationFrame||((ci=ce.requestAnimationFrame)||tc)(ec)),e.__H.__.forEach(function(t){t.u&&(t.__H=t.u),t.u=void 0})),Ir=ae=null},ce.__c=function(r,e){e.some(function(t){try{t.__h.forEach(_r),t.__h=t.__h.filter(function(n){return!n.__||rs(n)})}catch(n){e.some(function(s){s.__h&&(s.__h=[])}),e=[],ce.__e(n,t.__v)}}),fi&&fi(r,e)},ce.unmount=function(r){pi&&pi(r);var e,t=r.__c;t&&t.__H&&(t.__H.__.forEach(function(n){try{_r(n)}catch(s){e=s}}),t.__H=void 0,e&&ce.__e(e,t.__v))};var gi=typeof requestAnimationFrame=="function";function tc(r){var e,t=function(){clearTimeout(n),gi&&cancelAnimationFrame(e),setTimeout(r)},n=setTimeout(t,35);gi&&(e=requestAnimationFrame(t))}function _r(r){var e=ae,t=r.__c;typeof t=="function"&&(r.__c=void 0,t()),ae=e}function rs(r){var e=ae;r.__c=r.__(),ae=e}function As(r,e){return!r||r.length!==e.length||e.some(function(t,n){return t!==r[n]})}function qa(r,e){return typeof e=="function"?e(r):e}var rc={};function Ft(r,e){for(var t in e)r[t]=e[t];return r}function ns(r,e,t){var n,s=/(?:\?([^#]*))?(#.*)?$/,i=r.match(s),o={};if(i&&i[1])for(var a=i[1].split("&"),l=0;l<a.length;l++){var c=a[l].split("=");o[decodeURIComponent(c[0])]=decodeURIComponent(c.slice(1).join("="))}r=ss(r.replace(s,"")),e=ss(e||"");for(var h=Math.max(r.length,e.length),u=0;u<h;u++)if(e[u]&&e[u].charAt(0)===":"){var f=e[u].replace(/(^:|[+*?]+$)/g,""),p=(e[u].match(/[+*?]+$/)||rc)[0]||"",g=~p.indexOf("+"),v=~p.indexOf("*"),_=r[u]||"";if(!_&&!v&&(p.indexOf("?")<0||g)){n=!1;break}if(o[f]=decodeURIComponent(_),g||v){o[f]=r.slice(u).map(decodeURIComponent).join("/");break}}else if(e[u]!==r[u]){n=!1;break}return(t.default===!0||n!==!1)&&o}function nc(r,e){return r.rank<e.rank?1:r.rank>e.rank?-1:r.index-e.index}function sc(r,e){return r.index=e,r.rank=function(t){return t.props.default?0:ss(t.props.path).map(ic).join("")}(r),r.props}function ss(r){return r.replace(/(^\/+|\/+$)/g,"").split("/")}function ic(r){return r.charAt(0)==":"?1+"*+?".indexOf(r.charAt(r.length-1))||4:5}var oc={},at=[],Gt=[],Re=null,Rs={url:Os()},Fa=Er(Rs);function ac(){var r=Tr(Fa);if(r===Rs){var e=q()[1];se(function(){return Gt.push(e),function(){return Gt.splice(Gt.indexOf(e),1)}},[])}return[r,Ue]}function Os(){var r;return""+((r=Re&&Re.location?Re.location:Re&&Re.getCurrentLocation?Re.getCurrentLocation():typeof location<"u"?location:oc).pathname||"")+(r.search||"")}function Ue(r,e){return e===void 0&&(e=!1),typeof r!="string"&&r.url&&(e=r.replace,r=r.url),function(t){for(var n=at.length;n--;)if(at[n].canRoute(t))return!0;return!1}(r)&&function(t,n){n===void 0&&(n="push"),Re&&Re[n]?Re[n](t):typeof history<"u"&&history[n+"State"]&&history[n+"State"](null,null,t)}(r,e?"replace":"push"),Ba(r)}function Ba(r){for(var e=!1,t=0;t<at.length;t++)at[t].routeTo(r)&&(e=!0);return e}function lc(r){if(r&&r.getAttribute){var e=r.getAttribute("href"),t=r.getAttribute("target");if(e&&e.match(/^\//g)&&(!t||t.match(/^_?self$/i)))return Ue(e)}}function cc(r){return r.stopImmediatePropagation&&r.stopImmediatePropagation(),r.stopPropagation&&r.stopPropagation(),r.preventDefault(),!1}function Ha(r){if(!(r.ctrlKey||r.metaKey||r.altKey||r.shiftKey||r.button)){var e=r.target;do if(e.localName==="a"&&e.getAttribute("href")){if(e.hasAttribute("data-native")||e.hasAttribute("native"))return;if(lc(e))return cc(r)}while(e=e.parentNode)}}var vi=!1;function Wa(r){r.history&&(Re=r.history),this.state={url:r.url||Os()}}Ft(Wa.prototype=new Ce,{shouldComponentUpdate:function(r){return r.static!==!0||r.url!==this.props.url||r.onChange!==this.props.onChange},canRoute:function(r){var e=xe(this.props.children);return this.g(e,r)!==void 0},routeTo:function(r){this.setState({url:r});var e=this.canRoute(r);return this.p||this.forceUpdate(),e},componentWillMount:function(){this.p=!0},componentDidMount:function(){var r=this;vi||(vi=!0,Re||addEventListener("popstate",function(){Ba(Os())}),addEventListener("click",Ha)),at.push(this),Re&&(this.u=Re.listen(function(e){var t=e.location||e;r.routeTo(""+(t.pathname||"")+(t.search||""))})),this.p=!1},componentWillUnmount:function(){typeof this.u=="function"&&this.u(),at.splice(at.indexOf(this),1)},componentWillUpdate:function(){this.p=!0},componentDidUpdate:function(){this.p=!1},g:function(r,e){r=r.filter(sc).sort(nc);for(var t=0;t<r.length;t++){var n=r[t],s=ns(e,n.props.path,n.props);if(s)return[n,s]}},render:function(r,e){var t,n,s=r.onChange,i=e.url,o=this.c,a=this.g(xe(r.children),i);if(a&&(n=Ps(a[0],Ft(Ft({url:i,matches:t=a[1]},t),{key:void 0,ref:void 0}))),i!==(o&&o.url)){Ft(Rs,o=this.c={url:i,previous:o&&o.url,current:n,path:n?n.props.path:null,matches:t}),o.router=this,o.active=n?[n]:[];for(var l=Gt.length;l--;)Gt[l]({});typeof s=="function"&&s(o)}return ke(Fa.Provider,{value:o},n)}});var Le=function(r){return ke("a",Ft({onClick:Ha},r))};function mr(){return mr=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)({}).hasOwnProperty.call(t,n)&&(r[n]=t[n])}return r},mr.apply(null,arguments)}var $t;(function(r){r.Pop="POP",r.Push="PUSH",r.Replace="REPLACE"})($t||($t={}));var mi=function(r){return r},yi="beforeunload",uc="hashchange",dc="popstate";function hc(r){r===void 0&&(r={});var e=r,t=e.window,n=t===void 0?document.defaultView:t,s=n.history;function i(){var A=Si(n.location.hash.substr(1)),U=A.pathname,Q=U===void 0?"/":U,L=A.search,X=L===void 0?"":L,le=A.hash,re=le===void 0?"":le,_e=s.state||{};return[_e.idx,mi({pathname:Q,search:X,hash:re,state:_e.usr||null,key:_e.key||"default"})]}var o=null;function a(){if(o)p.call(o),o=null;else{var A=$t.Pop,U=i(),Q=U[0],L=U[1];if(p.length){if(Q!=null){var X=h-Q;X&&(o={action:A,location:L,retry:function(){C(X*-1)}},C(X))}}else w(A)}}n.addEventListener(dc,a),n.addEventListener(uc,function(){var A=i(),U=A[1];Ur(U)!==Ur(u)&&a()});var l=$t.Pop,c=i(),h=c[0],u=c[1],f=wi(),p=wi();h==null&&(h=0,s.replaceState(mr({},s.state,{idx:h}),""));function g(){var A=document.querySelector("base"),U="";if(A&&A.getAttribute("href")){var Q=n.location.href,L=Q.indexOf("#");U=L===-1?Q:Q.slice(0,L)}return U}function v(A){return g()+"#"+(typeof A=="string"?A:Ur(A))}function _(A,U){return U===void 0&&(U=null),mi(mr({pathname:u.pathname,hash:"",search:""},typeof A=="string"?Si(A):A,{state:U,key:fc()}))}function y(A,U){return[{usr:A.state,key:A.key,idx:U},v(A)]}function b(A,U,Q){return!p.length||(p.call({action:A,location:U,retry:Q}),!1)}function w(A){l=A;var U=i();h=U[0],u=U[1],f.call({action:l,location:u})}function E(A,U){var Q=$t.Push,L=_(A,U);function X(){E(A,U)}if(b(Q,L,X)){var le=y(L,h+1),re=le[0],_e=le[1];try{s.pushState(re,"",_e)}catch{n.location.assign(_e)}w(Q)}}function S(A,U){var Q=$t.Replace,L=_(A,U);function X(){S(A,U)}if(b(Q,L,X)){var le=y(L,h),re=le[0],_e=le[1];s.replaceState(re,"",_e),w(Q)}}function C(A){s.go(A)}var I={get action(){return l},get location(){return u},createHref:v,push:E,replace:S,go:C,back:function(){C(-1)},forward:function(){C(1)},listen:function(U){return f.push(U)},block:function(U){var Q=p.push(U);return p.length===1&&n.addEventListener(yi,bi),function(){Q(),p.length||n.removeEventListener(yi,bi)}}};return I}function bi(r){r.preventDefault(),r.returnValue=""}function wi(){var r=[];return{get length(){return r.length},push:function(t){return r.push(t),function(){r=r.filter(function(n){return n!==t})}},call:function(t){r.forEach(function(n){return n&&n(t)})}}}function fc(){return Math.random().toString(36).substr(2,8)}function Ur(r){var e=r.pathname,t=e===void 0?"/":e,n=r.search,s=n===void 0?"":n,i=r.hash,o=i===void 0?"":i;return s&&s!=="?"&&(t+=s.charAt(0)==="?"?s:"?"+s),o&&o!=="#"&&(t+=o.charAt(0)==="#"?o:"#"+o),t}function Si(r){var e={};if(r){var t=r.indexOf("#");t>=0&&(e.hash=r.substr(t),r=r.substr(0,t));var n=r.indexOf("?");n>=0&&(e.search=r.substr(n),r=r.substr(0,n)),r&&(e.pathname=r)}return e}const pc="modulepreload",_c=function(r){return"/"+r},Ei={},rr=function(e,t,n){let s=Promise.resolve();if(t&&t.length>0){let c=function(h){return Promise.all(h.map(u=>Promise.resolve(u).then(f=>({status:"fulfilled",value:f}),f=>({status:"rejected",reason:f}))))};var o=c;document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),l=a?.nonce||a?.getAttribute("nonce");s=c(t.map(h=>{if(h=_c(h),h in Ei)return;Ei[h]=!0;const u=h.endsWith(".css"),f=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${h}"]${f}`))return;const p=document.createElement("link");if(p.rel=u?"stylesheet":pc,u||(p.as="script"),p.crossOrigin="",p.href=h,l&&p.setAttribute("nonce",l),document.head.appendChild(p),u)return new Promise((g,v)=>{p.addEventListener("load",g),p.addEventListener("error",()=>v(new Error(`Unable to preload CSS for ${h}`)))})}))}function i(a){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=a,window.dispatchEvent(l),!l.defaultPrevented)throw a}return s.then(a=>{for(const l of a||[])l.status==="rejected"&&i(l.reason);return e().catch(i)})},gc=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>rr(async()=>{const{default:n}=await Promise.resolve().then(()=>Ut);return{default:n}},void 0).then(({default:n})=>n(...t)):e=fetch,(...t)=>e(...t)};class Cs extends Error{constructor(e,t="FunctionsError",n){super(e),this.name=t,this.context=n}}class vc extends Cs{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class Ti extends Cs{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class Pi extends Cs{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var is;(function(r){r.Any="any",r.ApNortheast1="ap-northeast-1",r.ApNortheast2="ap-northeast-2",r.ApSouth1="ap-south-1",r.ApSoutheast1="ap-southeast-1",r.ApSoutheast2="ap-southeast-2",r.CaCentral1="ca-central-1",r.EuCentral1="eu-central-1",r.EuWest1="eu-west-1",r.EuWest2="eu-west-2",r.EuWest3="eu-west-3",r.SaEast1="sa-east-1",r.UsEast1="us-east-1",r.UsWest1="us-west-1",r.UsWest2="us-west-2"})(is||(is={}));var mc=function(r,e,t,n){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(h){try{c(n.next(h))}catch(u){o(u)}}function l(h){try{c(n.throw(h))}catch(u){o(u)}}function c(h){h.done?i(h.value):s(h.value).then(a,l)}c((n=n.apply(r,e||[])).next())})};class yc{constructor(e,{headers:t={},customFetch:n,region:s=is.Any}={}){this.url=e,this.headers=t,this.region=s,this.fetch=gc(n)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var n;return mc(this,void 0,void 0,function*(){try{const{headers:s,method:i,body:o}=t;let a={},{region:l}=t;l||(l=this.region);const c=new URL(`${this.url}/${e}`);l&&l!=="any"&&(a["x-region"]=l,c.searchParams.set("forceFunctionRegion",l));let h;o&&(s&&!Object.prototype.hasOwnProperty.call(s,"Content-Type")||!s)&&(typeof Blob<"u"&&o instanceof Blob||o instanceof ArrayBuffer?(a["Content-Type"]="application/octet-stream",h=o):typeof o=="string"?(a["Content-Type"]="text/plain",h=o):typeof FormData<"u"&&o instanceof FormData?h=o:(a["Content-Type"]="application/json",h=JSON.stringify(o)));const u=yield this.fetch(c.toString(),{method:i||"POST",headers:Object.assign(Object.assign(Object.assign({},a),this.headers),s),body:h}).catch(v=>{throw new vc(v)}),f=u.headers.get("x-relay-error");if(f&&f==="true")throw new Ti(u);if(!u.ok)throw new Pi(u);let p=((n=u.headers.get("Content-Type"))!==null&&n!==void 0?n:"text/plain").split(";")[0].trim(),g;return p==="application/json"?g=yield u.json():p==="application/octet-stream"?g=yield u.blob():p==="text/event-stream"?g=u:p==="multipart/form-data"?g=yield u.formData():g=yield u.text(),{data:g,error:null,response:u}}catch(s){return{data:null,error:s,response:s instanceof Pi||s instanceof Ti?s.context:void 0}}})}}function Ga(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function Va(r){if(Object.prototype.hasOwnProperty.call(r,"__esModule"))return r;var e=r.default;if(typeof e=="function"){var t=function n(){var s=!1;try{s=this instanceof n}catch{}return s?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(r).forEach(function(n){var s=Object.getOwnPropertyDescriptor(r,n);Object.defineProperty(t,n,s.get?s:{enumerable:!0,get:function(){return r[n]}})}),t}var fe={},gt={},vt={},mt={},yt={},bt={},bc=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},Ot=bc();const wc=Ot.fetch,Ka=Ot.fetch.bind(Ot),za=Ot.Headers,Sc=Ot.Request,Ec=Ot.Response,Ut=Object.freeze(Object.defineProperty({__proto__:null,Headers:za,Request:Sc,Response:Ec,default:Ka,fetch:wc},Symbol.toStringTag,{value:"Module"})),Tc=Va(Ut);var ar={},ki;function Ja(){if(ki)return ar;ki=1,Object.defineProperty(ar,"__esModule",{value:!0});class r extends Error{constructor(t){super(t.message),this.name="PostgrestError",this.details=t.details,this.hint=t.hint,this.code=t.code}}return ar.default=r,ar}var $i;function Ya(){if($i)return bt;$i=1;var r=bt&&bt.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(bt,"__esModule",{value:!0});const e=r(Tc),t=r(Ja());class n{constructor(i){this.shouldThrowOnError=!1,this.method=i.method,this.url=i.url,this.headers=i.headers,this.schema=i.schema,this.body=i.body,this.shouldThrowOnError=i.shouldThrowOnError,this.signal=i.signal,this.isMaybeSingle=i.isMaybeSingle,i.fetch?this.fetch=i.fetch:typeof fetch>"u"?this.fetch=e.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(i,o){return this.headers=Object.assign({},this.headers),this.headers[i]=o,this}then(i,o){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");const a=this.fetch;let l=a(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async c=>{var h,u,f;let p=null,g=null,v=null,_=c.status,y=c.statusText;if(c.ok){if(this.method!=="HEAD"){const S=await c.text();S===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?g=S:g=JSON.parse(S))}const w=(h=this.headers.Prefer)===null||h===void 0?void 0:h.match(/count=(exact|planned|estimated)/),E=(u=c.headers.get("content-range"))===null||u===void 0?void 0:u.split("/");w&&E&&E.length>1&&(v=parseInt(E[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(g)&&(g.length>1?(p={code:"PGRST116",details:`Results contain ${g.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},g=null,v=null,_=406,y="Not Acceptable"):g.length===1?g=g[0]:g=null)}else{const w=await c.text();try{p=JSON.parse(w),Array.isArray(p)&&c.status===404&&(g=[],p=null,_=200,y="OK")}catch{c.status===404&&w===""?(_=204,y="No Content"):p={message:w}}if(p&&this.isMaybeSingle&&(!((f=p?.details)===null||f===void 0)&&f.includes("0 rows"))&&(p=null,_=200,y="OK"),p&&this.shouldThrowOnError)throw new t.default(p)}return{error:p,data:g,count:v,status:_,statusText:y}});return this.shouldThrowOnError||(l=l.catch(c=>{var h,u,f;return{error:{message:`${(h=c?.name)!==null&&h!==void 0?h:"FetchError"}: ${c?.message}`,details:`${(u=c?.stack)!==null&&u!==void 0?u:""}`,hint:"",code:`${(f=c?.code)!==null&&f!==void 0?f:""}`},data:null,count:null,status:0,statusText:""}})),l.then(i,o)}returns(){return this}overrideTypes(){return this}}return bt.default=n,bt}var Ai;function Qa(){if(Ai)return yt;Ai=1;var r=yt&&yt.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(yt,"__esModule",{value:!0});const e=r(Ya());class t extends e.default{select(s){let i=!1;const o=(s??"*").split("").map(a=>/\s/.test(a)&&!i?"":(a==='"'&&(i=!i),a)).join("");return this.url.searchParams.set("select",o),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(s,{ascending:i=!0,nullsFirst:o,foreignTable:a,referencedTable:l=a}={}){const c=l?`${l}.order`:"order",h=this.url.searchParams.get(c);return this.url.searchParams.set(c,`${h?`${h},`:""}${s}.${i?"asc":"desc"}${o===void 0?"":o?".nullsfirst":".nullslast"}`),this}limit(s,{foreignTable:i,referencedTable:o=i}={}){const a=typeof o>"u"?"limit":`${o}.limit`;return this.url.searchParams.set(a,`${s}`),this}range(s,i,{foreignTable:o,referencedTable:a=o}={}){const l=typeof a>"u"?"offset":`${a}.offset`,c=typeof a>"u"?"limit":`${a}.limit`;return this.url.searchParams.set(l,`${s}`),this.url.searchParams.set(c,`${i-s+1}`),this}abortSignal(s){return this.signal=s,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:s=!1,verbose:i=!1,settings:o=!1,buffers:a=!1,wal:l=!1,format:c="text"}={}){var h;const u=[s?"analyze":null,i?"verbose":null,o?"settings":null,a?"buffers":null,l?"wal":null].filter(Boolean).join("|"),f=(h=this.headers.Accept)!==null&&h!==void 0?h:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${c}; for="${f}"; options=${u};`,c==="json"?this:this}rollback(){var s;return((s=this.headers.Prefer)!==null&&s!==void 0?s:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}}return yt.default=t,yt}var Ri;function xs(){if(Ri)return mt;Ri=1;var r=mt&&mt.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(mt,"__esModule",{value:!0});const e=r(Qa());class t extends e.default{eq(s,i){return this.url.searchParams.append(s,`eq.${i}`),this}neq(s,i){return this.url.searchParams.append(s,`neq.${i}`),this}gt(s,i){return this.url.searchParams.append(s,`gt.${i}`),this}gte(s,i){return this.url.searchParams.append(s,`gte.${i}`),this}lt(s,i){return this.url.searchParams.append(s,`lt.${i}`),this}lte(s,i){return this.url.searchParams.append(s,`lte.${i}`),this}like(s,i){return this.url.searchParams.append(s,`like.${i}`),this}likeAllOf(s,i){return this.url.searchParams.append(s,`like(all).{${i.join(",")}}`),this}likeAnyOf(s,i){return this.url.searchParams.append(s,`like(any).{${i.join(",")}}`),this}ilike(s,i){return this.url.searchParams.append(s,`ilike.${i}`),this}ilikeAllOf(s,i){return this.url.searchParams.append(s,`ilike(all).{${i.join(",")}}`),this}ilikeAnyOf(s,i){return this.url.searchParams.append(s,`ilike(any).{${i.join(",")}}`),this}is(s,i){return this.url.searchParams.append(s,`is.${i}`),this}in(s,i){const o=Array.from(new Set(i)).map(a=>typeof a=="string"&&new RegExp("[,()]").test(a)?`"${a}"`:`${a}`).join(",");return this.url.searchParams.append(s,`in.(${o})`),this}contains(s,i){return typeof i=="string"?this.url.searchParams.append(s,`cs.${i}`):Array.isArray(i)?this.url.searchParams.append(s,`cs.{${i.join(",")}}`):this.url.searchParams.append(s,`cs.${JSON.stringify(i)}`),this}containedBy(s,i){return typeof i=="string"?this.url.searchParams.append(s,`cd.${i}`):Array.isArray(i)?this.url.searchParams.append(s,`cd.{${i.join(",")}}`):this.url.searchParams.append(s,`cd.${JSON.stringify(i)}`),this}rangeGt(s,i){return this.url.searchParams.append(s,`sr.${i}`),this}rangeGte(s,i){return this.url.searchParams.append(s,`nxl.${i}`),this}rangeLt(s,i){return this.url.searchParams.append(s,`sl.${i}`),this}rangeLte(s,i){return this.url.searchParams.append(s,`nxr.${i}`),this}rangeAdjacent(s,i){return this.url.searchParams.append(s,`adj.${i}`),this}overlaps(s,i){return typeof i=="string"?this.url.searchParams.append(s,`ov.${i}`):this.url.searchParams.append(s,`ov.{${i.join(",")}}`),this}textSearch(s,i,{config:o,type:a}={}){let l="";a==="plain"?l="pl":a==="phrase"?l="ph":a==="websearch"&&(l="w");const c=o===void 0?"":`(${o})`;return this.url.searchParams.append(s,`${l}fts${c}.${i}`),this}match(s){return Object.entries(s).forEach(([i,o])=>{this.url.searchParams.append(i,`eq.${o}`)}),this}not(s,i,o){return this.url.searchParams.append(s,`not.${i}.${o}`),this}or(s,{foreignTable:i,referencedTable:o=i}={}){const a=o?`${o}.or`:"or";return this.url.searchParams.append(a,`(${s})`),this}filter(s,i,o){return this.url.searchParams.append(s,`${i}.${o}`),this}}return mt.default=t,mt}var Oi;function Xa(){if(Oi)return vt;Oi=1;var r=vt&&vt.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(vt,"__esModule",{value:!0});const e=r(xs());class t{constructor(s,{headers:i={},schema:o,fetch:a}){this.url=s,this.headers=i,this.schema=o,this.fetch=a}select(s,{head:i=!1,count:o}={}){const a=i?"HEAD":"GET";let l=!1;const c=(s??"*").split("").map(h=>/\s/.test(h)&&!l?"":(h==='"'&&(l=!l),h)).join("");return this.url.searchParams.set("select",c),o&&(this.headers.Prefer=`count=${o}`),new e.default({method:a,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(s,{count:i,defaultToNull:o=!0}={}){const a="POST",l=[];if(this.headers.Prefer&&l.push(this.headers.Prefer),i&&l.push(`count=${i}`),o||l.push("missing=default"),this.headers.Prefer=l.join(","),Array.isArray(s)){const c=s.reduce((h,u)=>h.concat(Object.keys(u)),[]);if(c.length>0){const h=[...new Set(c)].map(u=>`"${u}"`);this.url.searchParams.set("columns",h.join(","))}}return new e.default({method:a,url:this.url,headers:this.headers,schema:this.schema,body:s,fetch:this.fetch,allowEmpty:!1})}upsert(s,{onConflict:i,ignoreDuplicates:o=!1,count:a,defaultToNull:l=!0}={}){const c="POST",h=[`resolution=${o?"ignore":"merge"}-duplicates`];if(i!==void 0&&this.url.searchParams.set("on_conflict",i),this.headers.Prefer&&h.push(this.headers.Prefer),a&&h.push(`count=${a}`),l||h.push("missing=default"),this.headers.Prefer=h.join(","),Array.isArray(s)){const u=s.reduce((f,p)=>f.concat(Object.keys(p)),[]);if(u.length>0){const f=[...new Set(u)].map(p=>`"${p}"`);this.url.searchParams.set("columns",f.join(","))}}return new e.default({method:c,url:this.url,headers:this.headers,schema:this.schema,body:s,fetch:this.fetch,allowEmpty:!1})}update(s,{count:i}={}){const o="PATCH",a=[];return this.headers.Prefer&&a.push(this.headers.Prefer),i&&a.push(`count=${i}`),this.headers.Prefer=a.join(","),new e.default({method:o,url:this.url,headers:this.headers,schema:this.schema,body:s,fetch:this.fetch,allowEmpty:!1})}delete({count:s}={}){const i="DELETE",o=[];return s&&o.push(`count=${s}`),this.headers.Prefer&&o.unshift(this.headers.Prefer),this.headers.Prefer=o.join(","),new e.default({method:i,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}}return vt.default=t,vt}var Mt={},qt={},Ci;function Pc(){return Ci||(Ci=1,Object.defineProperty(qt,"__esModule",{value:!0}),qt.version=void 0,qt.version="0.0.0-automated"),qt}var xi;function kc(){if(xi)return Mt;xi=1,Object.defineProperty(Mt,"__esModule",{value:!0}),Mt.DEFAULT_HEADERS=void 0;const r=Pc();return Mt.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${r.version}`},Mt}var ji;function $c(){if(ji)return gt;ji=1;var r=gt&&gt.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(gt,"__esModule",{value:!0});const e=r(Xa()),t=r(xs()),n=kc();class s{constructor(o,{headers:a={},schema:l,fetch:c}={}){this.url=o,this.headers=Object.assign(Object.assign({},n.DEFAULT_HEADERS),a),this.schemaName=l,this.fetch=c}from(o){const a=new URL(`${this.url}/${o}`);return new e.default(a,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(o){return new s(this.url,{headers:this.headers,schema:o,fetch:this.fetch})}rpc(o,a={},{head:l=!1,get:c=!1,count:h}={}){let u;const f=new URL(`${this.url}/rpc/${o}`);let p;l||c?(u=l?"HEAD":"GET",Object.entries(a).filter(([v,_])=>_!==void 0).map(([v,_])=>[v,Array.isArray(_)?`{${_.join(",")}}`:`${_}`]).forEach(([v,_])=>{f.searchParams.append(v,_)})):(u="POST",p=a);const g=Object.assign({},this.headers);return h&&(g.Prefer=`count=${h}`),new t.default({method:u,url:f,headers:g,schema:this.schemaName,body:p,fetch:this.fetch,allowEmpty:!1})}}return gt.default=s,gt}var Ii;function Ac(){if(Ii)return fe;Ii=1;var r=fe&&fe.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(fe,"__esModule",{value:!0}),fe.PostgrestError=fe.PostgrestBuilder=fe.PostgrestTransformBuilder=fe.PostgrestFilterBuilder=fe.PostgrestQueryBuilder=fe.PostgrestClient=void 0;const e=r($c());fe.PostgrestClient=e.default;const t=r(Xa());fe.PostgrestQueryBuilder=t.default;const n=r(xs());fe.PostgrestFilterBuilder=n.default;const s=r(Qa());fe.PostgrestTransformBuilder=s.default;const i=r(Ya());fe.PostgrestBuilder=i.default;const o=r(Ja());return fe.PostgrestError=o.default,fe.default={PostgrestClient:e.default,PostgrestQueryBuilder:t.default,PostgrestFilterBuilder:n.default,PostgrestTransformBuilder:s.default,PostgrestBuilder:i.default,PostgrestError:o.default},fe}var Rc=Ac();const Oc=Ga(Rc),{PostgrestClient:Cc,PostgrestQueryBuilder:df,PostgrestFilterBuilder:hf,PostgrestTransformBuilder:ff,PostgrestBuilder:pf,PostgrestError:_f}=Oc;function xc(){if(typeof WebSocket<"u")return WebSocket;if(typeof global.WebSocket<"u")return global.WebSocket;if(typeof window.WebSocket<"u")return window.WebSocket;if(typeof self.WebSocket<"u")return self.WebSocket;throw new Error("`WebSocket` is not supported in this environment")}const jc=xc(),Ic="2.11.15",Uc=`realtime-js/${Ic}`,Nc="1.0.0",Za=1e4,Dc=1e3;var Vt;(function(r){r[r.connecting=0]="connecting",r[r.open=1]="open",r[r.closing=2]="closing",r[r.closed=3]="closed"})(Vt||(Vt={}));var ye;(function(r){r.closed="closed",r.errored="errored",r.joined="joined",r.joining="joining",r.leaving="leaving"})(ye||(ye={}));var Ie;(function(r){r.close="phx_close",r.error="phx_error",r.join="phx_join",r.reply="phx_reply",r.leave="phx_leave",r.access_token="access_token"})(Ie||(Ie={}));var os;(function(r){r.websocket="websocket"})(os||(os={}));var ot;(function(r){r.Connecting="connecting",r.Open="open",r.Closing="closing",r.Closed="closed"})(ot||(ot={}));class Lc{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),n=new TextDecoder;return this._decodeBroadcast(e,t,n)}_decodeBroadcast(e,t,n){const s=t.getUint8(1),i=t.getUint8(2);let o=this.HEADER_LENGTH+2;const a=n.decode(e.slice(o,o+s));o=o+s;const l=n.decode(e.slice(o,o+i));o=o+i;const c=JSON.parse(n.decode(e.slice(o,e.byteLength)));return{ref:null,topic:a,event:l,payload:c}}}class el{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var ie;(function(r){r.abstime="abstime",r.bool="bool",r.date="date",r.daterange="daterange",r.float4="float4",r.float8="float8",r.int2="int2",r.int4="int4",r.int4range="int4range",r.int8="int8",r.int8range="int8range",r.json="json",r.jsonb="jsonb",r.money="money",r.numeric="numeric",r.oid="oid",r.reltime="reltime",r.text="text",r.time="time",r.timestamp="timestamp",r.timestamptz="timestamptz",r.timetz="timetz",r.tsrange="tsrange",r.tstzrange="tstzrange"})(ie||(ie={}));const Ui=(r,e,t={})=>{var n;const s=(n=t.skipTypes)!==null&&n!==void 0?n:[];return Object.keys(e).reduce((i,o)=>(i[o]=Mc(o,r,e,s),i),{})},Mc=(r,e,t,n)=>{const s=e.find(a=>a.name===r),i=s?.type,o=t[r];return i&&!n.includes(i)?tl(i,o):as(o)},tl=(r,e)=>{if(r.charAt(0)==="_"){const t=r.slice(1,r.length);return Hc(e,t)}switch(r){case ie.bool:return qc(e);case ie.float4:case ie.float8:case ie.int2:case ie.int4:case ie.int8:case ie.numeric:case ie.oid:return Fc(e);case ie.json:case ie.jsonb:return Bc(e);case ie.timestamp:return Wc(e);case ie.abstime:case ie.date:case ie.daterange:case ie.int4range:case ie.int8range:case ie.money:case ie.reltime:case ie.text:case ie.time:case ie.timestamptz:case ie.timetz:case ie.tsrange:case ie.tstzrange:return as(e);default:return as(e)}},as=r=>r,qc=r=>{switch(r){case"t":return!0;case"f":return!1;default:return r}},Fc=r=>{if(typeof r=="string"){const e=parseFloat(r);if(!Number.isNaN(e))return e}return r},Bc=r=>{if(typeof r=="string")try{return JSON.parse(r)}catch(e){return console.log(`JSON parse error: ${e}`),r}return r},Hc=(r,e)=>{if(typeof r!="string")return r;const t=r.length-1,n=r[t];if(r[0]==="{"&&n==="}"){let i;const o=r.slice(1,t);try{i=JSON.parse("["+o+"]")}catch{i=o?o.split(","):[]}return i.map(a=>tl(e,a))}return r},Wc=r=>typeof r=="string"?r.replace(" ","T"):r,rl=r=>{let e=r;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")};class Nr{constructor(e,t,n={},s=Za){this.channel=e,this.event=t,this.payload=n,this.timeout=s,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var n;return this._hasReceived(e)&&t((n=this.receivedResp)===null||n===void 0?void 0:n.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(n=>n.status===e).forEach(n=>n.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var Ni;(function(r){r.SYNC="sync",r.JOIN="join",r.LEAVE="leave"})(Ni||(Ni={}));class Kt{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const n=t?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(n.state,{},s=>{const{onJoin:i,onLeave:o,onSync:a}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Kt.syncState(this.state,s,i,o),this.pendingDiffs.forEach(l=>{this.state=Kt.syncDiff(this.state,l,i,o)}),this.pendingDiffs=[],a()}),this.channel._on(n.diff,{},s=>{const{onJoin:i,onLeave:o,onSync:a}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(s):(this.state=Kt.syncDiff(this.state,s,i,o),a())}),this.onJoin((s,i,o)=>{this.channel._trigger("presence",{event:"join",key:s,currentPresences:i,newPresences:o})}),this.onLeave((s,i,o)=>{this.channel._trigger("presence",{event:"leave",key:s,currentPresences:i,leftPresences:o})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,n,s){const i=this.cloneDeep(e),o=this.transformState(t),a={},l={};return this.map(i,(c,h)=>{o[c]||(l[c]=h)}),this.map(o,(c,h)=>{const u=i[c];if(u){const f=h.map(_=>_.presence_ref),p=u.map(_=>_.presence_ref),g=h.filter(_=>p.indexOf(_.presence_ref)<0),v=u.filter(_=>f.indexOf(_.presence_ref)<0);g.length>0&&(a[c]=g),v.length>0&&(l[c]=v)}else a[c]=h}),this.syncDiff(i,{joins:a,leaves:l},n,s)}static syncDiff(e,t,n,s){const{joins:i,leaves:o}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return n||(n=()=>{}),s||(s=()=>{}),this.map(i,(a,l)=>{var c;const h=(c=e[a])!==null&&c!==void 0?c:[];if(e[a]=this.cloneDeep(l),h.length>0){const u=e[a].map(p=>p.presence_ref),f=h.filter(p=>u.indexOf(p.presence_ref)<0);e[a].unshift(...f)}n(a,h,l)}),this.map(o,(a,l)=>{let c=e[a];if(!c)return;const h=l.map(u=>u.presence_ref);c=c.filter(u=>h.indexOf(u.presence_ref)<0),e[a]=c,s(a,c,l),c.length===0&&delete e[a]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(n=>t(n,e[n]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,n)=>{const s=e[n];return"metas"in s?t[n]=s.metas.map(i=>(i.presence_ref=i.phx_ref,delete i.phx_ref,delete i.phx_ref_prev,i)):t[n]=s,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var Di;(function(r){r.ALL="*",r.INSERT="INSERT",r.UPDATE="UPDATE",r.DELETE="DELETE"})(Di||(Di={}));var Li;(function(r){r.BROADCAST="broadcast",r.PRESENCE="presence",r.POSTGRES_CHANGES="postgres_changes",r.SYSTEM="system"})(Li||(Li={}));var Ve;(function(r){r.SUBSCRIBED="SUBSCRIBED",r.TIMED_OUT="TIMED_OUT",r.CLOSED="CLOSED",r.CHANNEL_ERROR="CHANNEL_ERROR"})(Ve||(Ve={}));class js{constructor(e,t={config:{}},n){this.topic=e,this.params=t,this.socket=n,this.bindings={},this.state=ye.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new Nr(this,Ie.join,this.params,this.timeout),this.rejoinTimer=new el(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=ye.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(s=>s.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=ye.closed,this.socket._remove(this)}),this._onError(s=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,s),this.state=ye.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=ye.errored,this.rejoinTimer.scheduleTimeout())}),this._on(Ie.reply,{},(s,i)=>{this._trigger(this._replyEventName(i),s)}),this.presence=new Kt(this),this.broadcastEndpointURL=rl(this.socket.endPoint)+"/api/broadcast",this.private=this.params.config.private||!1}subscribe(e,t=this.timeout){var n,s;if(this.socket.isConnected()||this.socket.connect(),this.state==ye.closed){const{config:{broadcast:i,presence:o,private:a}}=this.params;this._onError(h=>e?.(Ve.CHANNEL_ERROR,h)),this._onClose(()=>e?.(Ve.CLOSED));const l={},c={broadcast:i,presence:o,postgres_changes:(s=(n=this.bindings.postgres_changes)===null||n===void 0?void 0:n.map(h=>h.filter))!==null&&s!==void 0?s:[],private:a};this.socket.accessTokenValue&&(l.access_token=this.socket.accessTokenValue),this.updateJoinPayload(Object.assign({config:c},l)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:h})=>{var u;if(this.socket.setAuth(),h===void 0){e?.(Ve.SUBSCRIBED);return}else{const f=this.bindings.postgres_changes,p=(u=f?.length)!==null&&u!==void 0?u:0,g=[];for(let v=0;v<p;v++){const _=f[v],{filter:{event:y,schema:b,table:w,filter:E}}=_,S=h&&h[v];if(S&&S.event===y&&S.schema===b&&S.table===w&&S.filter===E)g.push(Object.assign(Object.assign({},_),{id:S.id}));else{this.unsubscribe(),this.state=ye.errored,e?.(Ve.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=g,e&&e(Ve.SUBSCRIBED);return}}).receive("error",h=>{this.state=ye.errored,e?.(Ve.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(h).join(", ")||"error")))}).receive("timeout",()=>{e?.(Ve.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,n){return this._on(e,t,n)}async send(e,t={}){var n,s;if(!this._canPush()&&e.type==="broadcast"){const{event:i,payload:o}=e,l={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:o,private:this.private}]})};try{const c=await this._fetchWithTimeout(this.broadcastEndpointURL,l,(n=t.timeout)!==null&&n!==void 0?n:this.timeout);return await((s=c.body)===null||s===void 0?void 0:s.cancel()),c.ok?"ok":"error"}catch(c){return c.name==="AbortError"?"timed out":"error"}}else return new Promise(i=>{var o,a,l;const c=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((l=(a=(o=this.params)===null||o===void 0?void 0:o.config)===null||a===void 0?void 0:a.broadcast)===null||l===void 0)&&l.ack)&&i("ok"),c.receive("ok",()=>i("ok")),c.receive("error",()=>i("error")),c.receive("timeout",()=>i("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=ye.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(Ie.close,"leave",this._joinRef())};this.joinPush.destroy();let n=null;return new Promise(s=>{n=new Nr(this,Ie.leave,{},e),n.receive("ok",()=>{t(),s("ok")}).receive("timeout",()=>{t(),s("timed out")}).receive("error",()=>{s("error")}),n.send(),this._canPush()||n.trigger("ok",{})}).finally(()=>{n?.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.rejoinTimer&&clearTimeout(this.rejoinTimer.timer),this.joinPush.destroy()}async _fetchWithTimeout(e,t,n){const s=new AbortController,i=setTimeout(()=>s.abort(),n),o=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:s.signal}));return clearTimeout(i),o}_push(e,t,n=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let s=new Nr(this,e,t,n);return this._canPush()?s.send():(s.startTimeout(),this.pushBuffer.push(s)),s}_onMessage(e,t,n){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,n){var s,i;const o=e.toLocaleLowerCase(),{close:a,error:l,leave:c,join:h}=Ie;if(n&&[a,l,c,h].indexOf(o)>=0&&n!==this._joinRef())return;let f=this._onMessage(o,t,n);if(t&&!f)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(o)?(s=this.bindings.postgres_changes)===null||s===void 0||s.filter(p=>{var g,v,_;return((g=p.filter)===null||g===void 0?void 0:g.event)==="*"||((_=(v=p.filter)===null||v===void 0?void 0:v.event)===null||_===void 0?void 0:_.toLocaleLowerCase())===o}).map(p=>p.callback(f,n)):(i=this.bindings[o])===null||i===void 0||i.filter(p=>{var g,v,_,y,b,w;if(["broadcast","presence","postgres_changes"].includes(o))if("id"in p){const E=p.id,S=(g=p.filter)===null||g===void 0?void 0:g.event;return E&&((v=t.ids)===null||v===void 0?void 0:v.includes(E))&&(S==="*"||S?.toLocaleLowerCase()===((_=t.data)===null||_===void 0?void 0:_.type.toLocaleLowerCase()))}else{const E=(b=(y=p?.filter)===null||y===void 0?void 0:y.event)===null||b===void 0?void 0:b.toLocaleLowerCase();return E==="*"||E===((w=t?.event)===null||w===void 0?void 0:w.toLocaleLowerCase())}else return p.type.toLocaleLowerCase()===o}).map(p=>{if(typeof f=="object"&&"ids"in f){const g=f.data,{schema:v,table:_,commit_timestamp:y,type:b,errors:w}=g;f=Object.assign(Object.assign({},{schema:v,table:_,commit_timestamp:y,eventType:b,new:{},old:{},errors:w}),this._getPayloadRecords(g))}p.callback(f,n)})}_isClosed(){return this.state===ye.closed}_isJoined(){return this.state===ye.joined}_isJoining(){return this.state===ye.joining}_isLeaving(){return this.state===ye.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,n){const s=e.toLocaleLowerCase(),i={type:s,filter:t,callback:n};return this.bindings[s]?this.bindings[s].push(i):this.bindings[s]=[i],this}_off(e,t){const n=e.toLocaleLowerCase();return this.bindings[n]=this.bindings[n].filter(s=>{var i;return!(((i=s.type)===null||i===void 0?void 0:i.toLocaleLowerCase())===n&&js.isEqual(s.filter,t))}),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const n in e)if(e[n]!==t[n])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(Ie.close,{},e)}_onError(e){this._on(Ie.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=ye.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=Ui(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=Ui(e.columns,e.old_record)),t}}const Mi=()=>{},Gc=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class Vc{constructor(e,t){var n;this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=Za,this.heartbeatIntervalMs=25e3,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=Mi,this.ref=0,this.logger=Mi,this.conn=null,this.sendBuffer=[],this.serializer=new Lc,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._resolveFetch=i=>{let o;return i?o=i:typeof fetch>"u"?o=(...a)=>rr(async()=>{const{default:l}=await Promise.resolve().then(()=>Ut);return{default:l}},void 0).then(({default:l})=>l(...a)):o=fetch,(...a)=>o(...a)},this.endPoint=`${e}/${os.websocket}`,this.httpEndpoint=rl(e),t?.transport?this.transport=t.transport:this.transport=null,t?.params&&(this.params=t.params),t?.timeout&&(this.timeout=t.timeout),t?.logger&&(this.logger=t.logger),(t?.logLevel||t?.log_level)&&(this.logLevel=t.logLevel||t.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),t?.heartbeatIntervalMs&&(this.heartbeatIntervalMs=t.heartbeatIntervalMs);const s=(n=t?.params)===null||n===void 0?void 0:n.apikey;if(s&&(this.accessTokenValue=s,this.apiKey=s),this.reconnectAfterMs=t?.reconnectAfterMs?t.reconnectAfterMs:i=>[1e3,2e3,5e3,1e4][i-1]||1e4,this.encode=t?.encode?t.encode:(i,o)=>o(JSON.stringify(i)),this.decode=t?.decode?t.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new el(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this._resolveFetch(t?.fetch),t?.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.worker=t?.worker||!1,this.workerUrl=t?.workerUrl}this.accessToken=t?.accessToken||null}connect(){if(!this.conn){if(this.transport||(this.transport=jc),!this.transport)throw new Error("No transport provided");this.conn=new this.transport(this.endpointURL()),this.setupConnection()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:Nc}))}disconnect(e,t){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,t??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset(),this.channels.forEach(n=>n.teardown()))}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,t,n){this.logger(e,t,n)}connectionState(){switch(this.conn&&this.conn.readyState){case Vt.connecting:return ot.Connecting;case Vt.open:return ot.Open;case Vt.closing:return ot.Closing;default:return ot.Closed}}isConnected(){return this.connectionState()===ot.Open}channel(e,t={config:{}}){const n=`realtime:${e}`,s=this.getChannels().find(i=>i.topic===n);if(s)return s;{const i=new js(`realtime:${e}`,t,this);return this.channels.push(i),i}}push(e){const{topic:t,event:n,payload:s,ref:i}=e,o=()=>{this.encode(e,a=>{var l;(l=this.conn)===null||l===void 0||l.send(a)})};this.log("push",`${t} ${n} (${i})`,s),this.isConnected()?o():this.sendBuffer.push(o)}async setAuth(e=null){let t=e||this.accessToken&&await this.accessToken()||this.accessTokenValue;this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach(n=>{const s={access_token:t,version:Uc};t&&n.updateJoinPayload(s),n.joinedOnce&&n._isJoined()&&n._push(Ie.access_token,{access_token:t})}))}async sendHeartbeat(){var e;if(!this.isConnected()){this.heartbeatCallback("disconnected");return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),this.heartbeatCallback("timeout"),(e=this.conn)===null||e===void 0||e.close(Dc,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.heartbeatCallback("sent"),await this.setAuth()}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(n=>n.topic===e&&(n._isJoined()||n._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_onConnMessage(e){this.decode(e.data,t=>{let{topic:n,event:s,payload:i,ref:o}=t;n==="phoenix"&&s==="phx_reply"&&this.heartbeatCallback(t.payload.status=="ok"?"ok":"error"),o&&o===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null),this.log("receive",`${i.status||""} ${n} ${s} ${o&&"("+o+")"||""}`,i),Array.from(this.channels).filter(a=>a._isMember(n)).forEach(a=>a._trigger(s,i,o)),this.stateChangeCallbacks.message.forEach(a=>a(t))})}_onConnOpen(){this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this.reconnectTimer.reset(),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this.stateChangeCallbacks.open.forEach(e=>e())}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this.workerRef.terminate()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(t=>t(e))}_onConnError(e){this.log("transport",`${e}`),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(t=>t(e))}_triggerChanError(){this.channels.forEach(e=>e._trigger(Ie.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const n=e.match(/\?/)?"&":"?",s=new URLSearchParams(t);return`${e}${n}${s}`}_workerObjectUrl(e){let t;if(e)t=e;else{const n=new Blob([Gc],{type:"application/javascript"});t=URL.createObjectURL(n)}return t}}class Is extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function pe(r){return typeof r=="object"&&r!==null&&"__isStorageError"in r}class Kc extends Is{constructor(e,t){super(e),this.name="StorageApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class ls extends Is{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var zc=function(r,e,t,n){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(h){try{c(n.next(h))}catch(u){o(u)}}function l(h){try{c(n.throw(h))}catch(u){o(u)}}function c(h){h.done?i(h.value):s(h.value).then(a,l)}c((n=n.apply(r,e||[])).next())})};const nl=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>rr(async()=>{const{default:n}=await Promise.resolve().then(()=>Ut);return{default:n}},void 0).then(({default:n})=>n(...t)):e=fetch,(...t)=>e(...t)},Jc=()=>zc(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield rr(()=>Promise.resolve().then(()=>Ut),void 0)).Response:Response}),cs=r=>{if(Array.isArray(r))return r.map(t=>cs(t));if(typeof r=="function"||r!==Object(r))return r;const e={};return Object.entries(r).forEach(([t,n])=>{const s=t.replace(/([-_][a-z])/gi,i=>i.toUpperCase().replace(/[-_]/g,""));e[s]=cs(n)}),e};var ct=function(r,e,t,n){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(h){try{c(n.next(h))}catch(u){o(u)}}function l(h){try{c(n.throw(h))}catch(u){o(u)}}function c(h){h.done?i(h.value):s(h.value).then(a,l)}c((n=n.apply(r,e||[])).next())})};const Dr=r=>r.msg||r.message||r.error_description||r.error||JSON.stringify(r),Yc=(r,e,t)=>ct(void 0,void 0,void 0,function*(){const n=yield Jc();r instanceof n&&!t?.noResolveJson?r.json().then(s=>{e(new Kc(Dr(s),r.status||500))}).catch(s=>{e(new ls(Dr(s),s))}):e(new ls(Dr(r),r))}),Qc=(r,e,t,n)=>{const s={method:r,headers:e?.headers||{}};return r==="GET"?s:(s.headers=Object.assign({"Content-Type":"application/json"},e?.headers),n&&(s.body=JSON.stringify(n)),Object.assign(Object.assign({},s),t))};function nr(r,e,t,n,s,i){return ct(this,void 0,void 0,function*(){return new Promise((o,a)=>{r(t,Qc(e,n,s,i)).then(l=>{if(!l.ok)throw l;return n?.noResolveJson?l:l.json()}).then(l=>o(l)).catch(l=>Yc(l,a,n))})})}function yr(r,e,t,n){return ct(this,void 0,void 0,function*(){return nr(r,"GET",e,t,n)})}function Xe(r,e,t,n,s){return ct(this,void 0,void 0,function*(){return nr(r,"POST",e,n,s,t)})}function Xc(r,e,t,n,s){return ct(this,void 0,void 0,function*(){return nr(r,"PUT",e,n,s,t)})}function Zc(r,e,t,n){return ct(this,void 0,void 0,function*(){return nr(r,"HEAD",e,Object.assign(Object.assign({},t),{noResolveJson:!0}),n)})}function sl(r,e,t,n,s){return ct(this,void 0,void 0,function*(){return nr(r,"DELETE",e,n,s,t)})}var Ee=function(r,e,t,n){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(h){try{c(n.next(h))}catch(u){o(u)}}function l(h){try{c(n.throw(h))}catch(u){o(u)}}function c(h){h.done?i(h.value):s(h.value).then(a,l)}c((n=n.apply(r,e||[])).next())})};const eu={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},qi={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class tu{constructor(e,t={},n,s){this.url=e,this.headers=t,this.bucketId=n,this.fetch=nl(s)}uploadOrUpdate(e,t,n,s){return Ee(this,void 0,void 0,function*(){try{let i;const o=Object.assign(Object.assign({},qi),s);let a=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(o.upsert)});const l=o.metadata;typeof Blob<"u"&&n instanceof Blob?(i=new FormData,i.append("cacheControl",o.cacheControl),l&&i.append("metadata",this.encodeMetadata(l)),i.append("",n)):typeof FormData<"u"&&n instanceof FormData?(i=n,i.append("cacheControl",o.cacheControl),l&&i.append("metadata",this.encodeMetadata(l))):(i=n,a["cache-control"]=`max-age=${o.cacheControl}`,a["content-type"]=o.contentType,l&&(a["x-metadata"]=this.toBase64(this.encodeMetadata(l)))),s?.headers&&(a=Object.assign(Object.assign({},a),s.headers));const c=this._removeEmptyFolders(t),h=this._getFinalPath(c),u=yield this.fetch(`${this.url}/object/${h}`,Object.assign({method:e,body:i,headers:a},o?.duplex?{duplex:o.duplex}:{})),f=yield u.json();return u.ok?{data:{path:c,id:f.Id,fullPath:f.Key},error:null}:{data:null,error:f}}catch(i){if(pe(i))return{data:null,error:i};throw i}})}upload(e,t,n){return Ee(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,n)})}uploadToSignedUrl(e,t,n,s){return Ee(this,void 0,void 0,function*(){const i=this._removeEmptyFolders(e),o=this._getFinalPath(i),a=new URL(this.url+`/object/upload/sign/${o}`);a.searchParams.set("token",t);try{let l;const c=Object.assign({upsert:qi.upsert},s),h=Object.assign(Object.assign({},this.headers),{"x-upsert":String(c.upsert)});typeof Blob<"u"&&n instanceof Blob?(l=new FormData,l.append("cacheControl",c.cacheControl),l.append("",n)):typeof FormData<"u"&&n instanceof FormData?(l=n,l.append("cacheControl",c.cacheControl)):(l=n,h["cache-control"]=`max-age=${c.cacheControl}`,h["content-type"]=c.contentType);const u=yield this.fetch(a.toString(),{method:"PUT",body:l,headers:h}),f=yield u.json();return u.ok?{data:{path:i,fullPath:f.Key},error:null}:{data:null,error:f}}catch(l){if(pe(l))return{data:null,error:l};throw l}})}createSignedUploadUrl(e,t){return Ee(this,void 0,void 0,function*(){try{let n=this._getFinalPath(e);const s=Object.assign({},this.headers);t?.upsert&&(s["x-upsert"]="true");const i=yield Xe(this.fetch,`${this.url}/object/upload/sign/${n}`,{},{headers:s}),o=new URL(this.url+i.url),a=o.searchParams.get("token");if(!a)throw new Is("No token returned by API");return{data:{signedUrl:o.toString(),path:e,token:a},error:null}}catch(n){if(pe(n))return{data:null,error:n};throw n}})}update(e,t,n){return Ee(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,n)})}move(e,t,n){return Ee(this,void 0,void 0,function*(){try{return{data:yield Xe(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:n?.destinationBucket},{headers:this.headers}),error:null}}catch(s){if(pe(s))return{data:null,error:s};throw s}})}copy(e,t,n){return Ee(this,void 0,void 0,function*(){try{return{data:{path:(yield Xe(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:n?.destinationBucket},{headers:this.headers})).Key},error:null}}catch(s){if(pe(s))return{data:null,error:s};throw s}})}createSignedUrl(e,t,n){return Ee(this,void 0,void 0,function*(){try{let s=this._getFinalPath(e),i=yield Xe(this.fetch,`${this.url}/object/sign/${s}`,Object.assign({expiresIn:t},n?.transform?{transform:n.transform}:{}),{headers:this.headers});const o=n?.download?`&download=${n.download===!0?"":n.download}`:"";return i={signedUrl:encodeURI(`${this.url}${i.signedURL}${o}`)},{data:i,error:null}}catch(s){if(pe(s))return{data:null,error:s};throw s}})}createSignedUrls(e,t,n){return Ee(this,void 0,void 0,function*(){try{const s=yield Xe(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),i=n?.download?`&download=${n.download===!0?"":n.download}`:"";return{data:s.map(o=>Object.assign(Object.assign({},o),{signedUrl:o.signedURL?encodeURI(`${this.url}${o.signedURL}${i}`):null})),error:null}}catch(s){if(pe(s))return{data:null,error:s};throw s}})}download(e,t){return Ee(this,void 0,void 0,function*(){const s=typeof t?.transform<"u"?"render/image/authenticated":"object",i=this.transformOptsToQueryString(t?.transform||{}),o=i?`?${i}`:"";try{const a=this._getFinalPath(e);return{data:yield(yield yr(this.fetch,`${this.url}/${s}/${a}${o}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(a){if(pe(a))return{data:null,error:a};throw a}})}info(e){return Ee(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const n=yield yr(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:cs(n),error:null}}catch(n){if(pe(n))return{data:null,error:n};throw n}})}exists(e){return Ee(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield Zc(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(n){if(pe(n)&&n instanceof ls){const s=n.originalError;if([400,404].includes(s?.status))return{data:!1,error:n}}throw n}})}getPublicUrl(e,t){const n=this._getFinalPath(e),s=[],i=t?.download?`download=${t.download===!0?"":t.download}`:"";i!==""&&s.push(i);const a=typeof t?.transform<"u"?"render/image":"object",l=this.transformOptsToQueryString(t?.transform||{});l!==""&&s.push(l);let c=s.join("&");return c!==""&&(c=`?${c}`),{data:{publicUrl:encodeURI(`${this.url}/${a}/public/${n}${c}`)}}}remove(e){return Ee(this,void 0,void 0,function*(){try{return{data:yield sl(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(pe(t))return{data:null,error:t};throw t}})}list(e,t,n){return Ee(this,void 0,void 0,function*(){try{const s=Object.assign(Object.assign(Object.assign({},eu),t),{prefix:e||""});return{data:yield Xe(this.fetch,`${this.url}/object/list/${this.bucketId}`,s,{headers:this.headers},n),error:null}}catch(s){if(pe(s))return{data:null,error:s};throw s}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const ru="2.7.1",nu={"X-Client-Info":`storage-js/${ru}`};var wt=function(r,e,t,n){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(h){try{c(n.next(h))}catch(u){o(u)}}function l(h){try{c(n.throw(h))}catch(u){o(u)}}function c(h){h.done?i(h.value):s(h.value).then(a,l)}c((n=n.apply(r,e||[])).next())})};class su{constructor(e,t={},n){this.url=e,this.headers=Object.assign(Object.assign({},nu),t),this.fetch=nl(n)}listBuckets(){return wt(this,void 0,void 0,function*(){try{return{data:yield yr(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(pe(e))return{data:null,error:e};throw e}})}getBucket(e){return wt(this,void 0,void 0,function*(){try{return{data:yield yr(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(pe(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return wt(this,void 0,void 0,function*(){try{return{data:yield Xe(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(n){if(pe(n))return{data:null,error:n};throw n}})}updateBucket(e,t){return wt(this,void 0,void 0,function*(){try{return{data:yield Xc(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(n){if(pe(n))return{data:null,error:n};throw n}})}emptyBucket(e){return wt(this,void 0,void 0,function*(){try{return{data:yield Xe(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(pe(t))return{data:null,error:t};throw t}})}deleteBucket(e){return wt(this,void 0,void 0,function*(){try{return{data:yield sl(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(pe(t))return{data:null,error:t};throw t}})}}class iu extends su{constructor(e,t={},n){super(e,t,n)}from(e){return new tu(this.url,this.headers,e,this.fetch)}}const ou="2.50.5";let Bt="";typeof Deno<"u"?Bt="deno":typeof document<"u"?Bt="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Bt="react-native":Bt="node";const au={"X-Client-Info":`supabase-js-${Bt}/${ou}`},lu={headers:au},cu={schema:"public"},uu={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},du={};var hu=function(r,e,t,n){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(h){try{c(n.next(h))}catch(u){o(u)}}function l(h){try{c(n.throw(h))}catch(u){o(u)}}function c(h){h.done?i(h.value):s(h.value).then(a,l)}c((n=n.apply(r,e||[])).next())})};const fu=r=>{let e;return r?e=r:typeof fetch>"u"?e=Ka:e=fetch,(...t)=>e(...t)},pu=()=>typeof Headers>"u"?za:Headers,_u=(r,e,t)=>{const n=fu(t),s=pu();return(i,o)=>hu(void 0,void 0,void 0,function*(){var a;const l=(a=yield e())!==null&&a!==void 0?a:r;let c=new s(o?.headers);return c.has("apikey")||c.set("apikey",r),c.has("Authorization")||c.set("Authorization",`Bearer ${l}`),n(i,Object.assign(Object.assign({},o),{headers:c}))})};var gu=function(r,e,t,n){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(h){try{c(n.next(h))}catch(u){o(u)}}function l(h){try{c(n.throw(h))}catch(u){o(u)}}function c(h){h.done?i(h.value):s(h.value).then(a,l)}c((n=n.apply(r,e||[])).next())})};function vu(r){return r.endsWith("/")?r:r+"/"}function mu(r,e){var t,n;const{db:s,auth:i,realtime:o,global:a}=r,{db:l,auth:c,realtime:h,global:u}=e,f={db:Object.assign(Object.assign({},l),s),auth:Object.assign(Object.assign({},c),i),realtime:Object.assign(Object.assign({},h),o),global:Object.assign(Object.assign(Object.assign({},u),a),{headers:Object.assign(Object.assign({},(t=u?.headers)!==null&&t!==void 0?t:{}),(n=a?.headers)!==null&&n!==void 0?n:{})}),accessToken:()=>gu(this,void 0,void 0,function*(){return""})};return r.accessToken?f.accessToken=r.accessToken:delete f.accessToken,f}const il="2.70.0",kt=30*1e3,us=3,Lr=us*kt,yu="http://localhost:9999",bu="supabase.auth.token",wu={"X-Client-Info":`gotrue-js/${il}`},ds="X-Supabase-Api-Version",ol={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},Su=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,Eu=6e5;class Us extends Error{constructor(e,t,n){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=n}}function G(r){return typeof r=="object"&&r!==null&&"__isAuthError"in r}class Tu extends Us{constructor(e,t,n){super(e,t,n),this.name="AuthApiError",this.status=t,this.code=n}}function Pu(r){return G(r)&&r.name==="AuthApiError"}class al extends Us{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class tt extends Us{constructor(e,t,n,s){super(e,n,s),this.name=t,this.status=n}}class Ye extends tt{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function ku(r){return G(r)&&r.name==="AuthSessionMissingError"}class lr extends tt{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class cr extends tt{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class ur extends tt{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function $u(r){return G(r)&&r.name==="AuthImplicitGrantRedirectError"}class Fi extends tt{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class hs extends tt{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function Mr(r){return G(r)&&r.name==="AuthRetryableFetchError"}class Bi extends tt{constructor(e,t,n){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=n}}class zt extends tt{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const br="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),Hi=` 	
\r=`.split(""),Au=(()=>{const r=new Array(128);for(let e=0;e<r.length;e+=1)r[e]=-1;for(let e=0;e<Hi.length;e+=1)r[Hi[e].charCodeAt(0)]=-2;for(let e=0;e<br.length;e+=1)r[br[e].charCodeAt(0)]=e;return r})();function Wi(r,e,t){if(r!==null)for(e.queue=e.queue<<8|r,e.queuedBits+=8;e.queuedBits>=6;){const n=e.queue>>e.queuedBits-6&63;t(br[n]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const n=e.queue>>e.queuedBits-6&63;t(br[n]),e.queuedBits-=6}}function ll(r,e,t){const n=Au[r];if(n>-1)for(e.queue=e.queue<<6|n,e.queuedBits+=6;e.queuedBits>=8;)t(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(n===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(r)}"`)}}function Gi(r){const e=[],t=o=>{e.push(String.fromCodePoint(o))},n={utf8seq:0,codepoint:0},s={queue:0,queuedBits:0},i=o=>{Cu(o,n,t)};for(let o=0;o<r.length;o+=1)ll(r.charCodeAt(o),s,i);return e.join("")}function Ru(r,e){if(r<=127){e(r);return}else if(r<=2047){e(192|r>>6),e(128|r&63);return}else if(r<=65535){e(224|r>>12),e(128|r>>6&63),e(128|r&63);return}else if(r<=1114111){e(240|r>>18),e(128|r>>12&63),e(128|r>>6&63),e(128|r&63);return}throw new Error(`Unrecognized Unicode codepoint: ${r.toString(16)}`)}function Ou(r,e){for(let t=0;t<r.length;t+=1){let n=r.charCodeAt(t);if(n>55295&&n<=56319){const s=(n-55296)*1024&65535;n=(r.charCodeAt(t+1)-56320&65535|s)+65536,t+=1}Ru(n,e)}}function Cu(r,e,t){if(e.utf8seq===0){if(r<=127){t(r);return}for(let n=1;n<6;n+=1)if((r>>7-n&1)===0){e.utf8seq=n;break}if(e.utf8seq===2)e.codepoint=r&31;else if(e.utf8seq===3)e.codepoint=r&15;else if(e.utf8seq===4)e.codepoint=r&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(r<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|r&63,e.utf8seq-=1,e.utf8seq===0&&t(e.codepoint)}}function xu(r){const e=[],t={queue:0,queuedBits:0},n=s=>{e.push(s)};for(let s=0;s<r.length;s+=1)ll(r.charCodeAt(s),t,n);return new Uint8Array(e)}function ju(r){const e=[];return Ou(r,t=>e.push(t)),new Uint8Array(e)}function Iu(r){const e=[],t={queue:0,queuedBits:0},n=s=>{e.push(s)};return r.forEach(s=>Wi(s,t,n)),Wi(null,t,n),e.join("")}function Uu(r){return Math.round(Date.now()/1e3)+r}function Nu(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(r){const e=Math.random()*16|0;return(r=="x"?e:e&3|8).toString(16)})}const je=()=>typeof window<"u"&&typeof document<"u",rt={tested:!1,writable:!1},Jt=()=>{if(!je())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(rt.tested)return rt.writable;const r=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(r,r),globalThis.localStorage.removeItem(r),rt.tested=!0,rt.writable=!0}catch{rt.tested=!0,rt.writable=!1}return rt.writable};function Du(r){const e={},t=new URL(r);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((s,i)=>{e[i]=s})}catch{}return t.searchParams.forEach((n,s)=>{e[s]=n}),e}const cl=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>rr(async()=>{const{default:n}=await Promise.resolve().then(()=>Ut);return{default:n}},void 0).then(({default:n})=>n(...t)):e=fetch,(...t)=>e(...t)},Lu=r=>typeof r=="object"&&r!==null&&"status"in r&&"ok"in r&&"json"in r&&typeof r.json=="function",ul=async(r,e,t)=>{await r.setItem(e,JSON.stringify(t))},dr=async(r,e)=>{const t=await r.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},hr=async(r,e)=>{await r.removeItem(e)};class Pr{constructor(){this.promise=new Pr.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}Pr.promiseConstructor=Promise;function qr(r){const e=r.split(".");if(e.length!==3)throw new zt("Invalid JWT structure");for(let n=0;n<e.length;n++)if(!Su.test(e[n]))throw new zt("JWT not in base64url format");return{header:JSON.parse(Gi(e[0])),payload:JSON.parse(Gi(e[1])),signature:xu(e[2]),raw:{header:e[0],payload:e[1]}}}async function Mu(r){return await new Promise(e=>{setTimeout(()=>e(null),r)})}function qu(r,e){return new Promise((n,s)=>{(async()=>{for(let i=0;i<1/0;i++)try{const o=await r(i);if(!e(i,null,o)){n(o);return}}catch(o){if(!e(i,o)){s(o);return}}})()})}function Fu(r){return("0"+r.toString(16)).substr(-2)}function Bu(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",n=t.length;let s="";for(let i=0;i<56;i++)s+=t.charAt(Math.floor(Math.random()*n));return s}return crypto.getRandomValues(e),Array.from(e,Fu).join("")}async function Hu(r){const t=new TextEncoder().encode(r),n=await crypto.subtle.digest("SHA-256",t),s=new Uint8Array(n);return Array.from(s).map(i=>String.fromCharCode(i)).join("")}async function Wu(r){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),r;const t=await Hu(r);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function St(r,e,t=!1){const n=Bu();let s=n;t&&(s+="/PASSWORD_RECOVERY"),await ul(r,`${e}-code-verifier`,s);const i=await Wu(n);return[i,n===i?"plain":"s256"]}const Gu=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function Vu(r){const e=r.headers.get(ds);if(!e||!e.match(Gu))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function Ku(r){if(!r)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(r<=e)throw new Error("JWT has expired")}function zu(r){switch(r){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const Ju=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function Et(r){if(!Ju.test(r))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}var Yu=function(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(r);s<n.length;s++)e.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(r,n[s])&&(t[n[s]]=r[n[s]]);return t};const st=r=>r.msg||r.message||r.error_description||r.error||JSON.stringify(r),Qu=[502,503,504];async function Vi(r){var e;if(!Lu(r))throw new hs(st(r),0);if(Qu.includes(r.status))throw new hs(st(r),r.status);let t;try{t=await r.json()}catch(i){throw new al(st(i),i)}let n;const s=Vu(r);if(s&&s.getTime()>=ol["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?n=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(n=t.error_code),n){if(n==="weak_password")throw new Bi(st(t),r.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(n==="session_not_found")throw new Ye}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((i,o)=>i&&typeof o=="string",!0))throw new Bi(st(t),r.status,t.weak_password.reasons);throw new Tu(st(t),r.status||500,n)}const Xu=(r,e,t,n)=>{const s={method:r,headers:e?.headers||{}};return r==="GET"?s:(s.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e?.headers),s.body=JSON.stringify(n),Object.assign(Object.assign({},s),t))};async function J(r,e,t,n){var s;const i=Object.assign({},n?.headers);i[ds]||(i[ds]=ol["2024-01-01"].name),n?.jwt&&(i.Authorization=`Bearer ${n.jwt}`);const o=(s=n?.query)!==null&&s!==void 0?s:{};n?.redirectTo&&(o.redirect_to=n.redirectTo);const a=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",l=await Zu(r,e,t+a,{headers:i,noResolveJson:n?.noResolveJson},{},n?.body);return n?.xform?n?.xform(l):{data:Object.assign({},l),error:null}}async function Zu(r,e,t,n,s,i){const o=Xu(e,n,s,i);let a;try{a=await r(t,Object.assign({},o))}catch(l){throw console.error(l),new hs(st(l),0)}if(a.ok||await Vi(a),n?.noResolveJson)return a;try{return await a.json()}catch(l){await Vi(l)}}function Ge(r){var e;let t=null;nd(r)&&(t=Object.assign({},r),r.expires_at||(t.expires_at=Uu(r.expires_in)));const n=(e=r.user)!==null&&e!==void 0?e:r;return{data:{session:t,user:n},error:null}}function Ki(r){const e=Ge(r);return!e.error&&r.weak_password&&typeof r.weak_password=="object"&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.message&&typeof r.weak_password.message=="string"&&r.weak_password.reasons.reduce((t,n)=>t&&typeof n=="string",!0)&&(e.data.weak_password=r.weak_password),e}function Ze(r){var e;return{data:{user:(e=r.user)!==null&&e!==void 0?e:r},error:null}}function ed(r){return{data:r,error:null}}function td(r){const{action_link:e,email_otp:t,hashed_token:n,redirect_to:s,verification_type:i}=r,o=Yu(r,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),a={action_link:e,email_otp:t,hashed_token:n,redirect_to:s,verification_type:i},l=Object.assign({},o);return{data:{properties:a,user:l},error:null}}function rd(r){return r}function nd(r){return r.access_token&&r.refresh_token&&r.expires_in}const Fr=["global","local","others"];var sd=function(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(r);s<n.length;s++)e.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(r,n[s])&&(t[n[s]]=r[n[s]]);return t};class id{constructor({url:e="",headers:t={},fetch:n}){this.url=e,this.headers=t,this.fetch=cl(n),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t=Fr[0]){if(Fr.indexOf(t)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${Fr.join(", ")}`);try{return await J(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(n){if(G(n))return{data:null,error:n};throw n}}async inviteUserByEmail(e,t={}){try{return await J(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:Ze})}catch(n){if(G(n))return{data:{user:null},error:n};throw n}}async generateLink(e){try{const{options:t}=e,n=sd(e,["options"]),s=Object.assign(Object.assign({},n),t);return"newEmail"in n&&(s.new_email=n?.newEmail,delete s.newEmail),await J(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:s,headers:this.headers,xform:td,redirectTo:t?.redirectTo})}catch(t){if(G(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await J(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:Ze})}catch(t){if(G(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,n,s,i,o,a,l;try{const c={nextPage:null,lastPage:0,total:0},h=await J(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(n=(t=e?.page)===null||t===void 0?void 0:t.toString())!==null&&n!==void 0?n:"",per_page:(i=(s=e?.perPage)===null||s===void 0?void 0:s.toString())!==null&&i!==void 0?i:""},xform:rd});if(h.error)throw h.error;const u=await h.json(),f=(o=h.headers.get("x-total-count"))!==null&&o!==void 0?o:0,p=(l=(a=h.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&l!==void 0?l:[];return p.length>0&&(p.forEach(g=>{const v=parseInt(g.split(";")[0].split("=")[1].substring(0,1)),_=JSON.parse(g.split(";")[1].split("=")[1]);c[`${_}Page`]=v}),c.total=parseInt(f)),{data:Object.assign(Object.assign({},u),c),error:null}}catch(c){if(G(c))return{data:{users:[]},error:c};throw c}}async getUserById(e){Et(e);try{return await J(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:Ze})}catch(t){if(G(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){Et(e);try{return await J(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:Ze})}catch(n){if(G(n))return{data:{user:null},error:n};throw n}}async deleteUser(e,t=!1){Et(e);try{return await J(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:Ze})}catch(n){if(G(n))return{data:{user:null},error:n};throw n}}async _listFactors(e){Et(e.userId);try{const{data:t,error:n}=await J(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:s=>({data:{factors:s},error:null})});return{data:t,error:n}}catch(t){if(G(t))return{data:null,error:t};throw t}}async _deleteFactor(e){Et(e.userId),Et(e.id);try{return{data:await J(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(G(t))return{data:null,error:t};throw t}}}const od={getItem:r=>Jt()?globalThis.localStorage.getItem(r):null,setItem:(r,e)=>{Jt()&&globalThis.localStorage.setItem(r,e)},removeItem:r=>{Jt()&&globalThis.localStorage.removeItem(r)}};function zi(r={}){return{getItem:e=>r[e]||null,setItem:(e,t)=>{r[e]=t},removeItem:e=>{delete r[e]}}}function ad(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const Tt={debug:!!(globalThis&&Jt()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class dl extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class ld extends dl{}async function cd(r,e,t){Tt.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",r,e);const n=new globalThis.AbortController;return e>0&&setTimeout(()=>{n.abort(),Tt.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",r)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(r,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:n.signal},async s=>{if(s){Tt.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",r,s.name);try{return await t()}finally{Tt.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",r,s.name)}}else{if(e===0)throw Tt.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",r),new ld(`Acquiring an exclusive Navigator LockManager lock "${r}" immediately failed`);if(Tt.debug)try{const i=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(i,null,"  "))}catch(i){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",i)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}}))}ad();const ud={url:yu,storageKey:bu,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:wu,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function Ji(r,e,t){return await t()}class Qt{constructor(e){var t,n;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=Qt.nextInstanceID,Qt.nextInstanceID+=1,this.instanceID>0&&je()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const s=Object.assign(Object.assign({},ud),e);if(this.logDebugMessages=!!s.debug,typeof s.debug=="function"&&(this.logger=s.debug),this.persistSession=s.persistSession,this.storageKey=s.storageKey,this.autoRefreshToken=s.autoRefreshToken,this.admin=new id({url:s.url,headers:s.headers,fetch:s.fetch}),this.url=s.url,this.headers=s.headers,this.fetch=cl(s.fetch),this.lock=s.lock||Ji,this.detectSessionInUrl=s.detectSessionInUrl,this.flowType=s.flowType,this.hasCustomAuthorizationHeader=s.hasCustomAuthorizationHeader,s.lock?this.lock=s.lock:je()&&(!((t=globalThis?.navigator)===null||t===void 0)&&t.locks)?this.lock=cd:this.lock=Ji,this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?s.storage?this.storage=s.storage:Jt()?this.storage=od:(this.memoryStorage={},this.storage=zi(this.memoryStorage)):(this.memoryStorage={},this.storage=zi(this.memoryStorage)),je()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(i){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",i)}(n=this.broadcastChannel)===null||n===void 0||n.addEventListener("message",async i=>{this._debug("received broadcast notification from other tab or client",i),await this._notifyAllSubscribers(i.data.event,i.data.session,!1)})}this.initialize()}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${il}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{const t=Du(window.location.href);let n="none";if(this._isImplicitGrantCallback(t)?n="implicit":await this._isPKCECallback(t)&&(n="pkce"),je()&&this.detectSessionInUrl&&n!=="none"){const{data:s,error:i}=await this._getSessionFromURL(t,n);if(i){if(this._debug("#_initialize()","error detecting session from URL",i),$u(i)){const l=(e=i.details)===null||e===void 0?void 0:e.code;if(l==="identity_already_exists"||l==="identity_not_found"||l==="single_identity_not_deletable")return{error:i}}return await this._removeSession(),{error:i}}const{session:o,redirectType:a}=s;return this._debug("#_initialize()","detected session in URL",o,"redirect type",a),await this._saveSession(o),setTimeout(async()=>{a==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",o):await this._notifyAllSubscribers("SIGNED_IN",o)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return G(t)?{error:t}:{error:new al("Unexpected error during initialization",t)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,n,s;try{const i=await J(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(n=(t=e?.options)===null||t===void 0?void 0:t.data)!==null&&n!==void 0?n:{},gotrue_meta_security:{captcha_token:(s=e?.options)===null||s===void 0?void 0:s.captchaToken}},xform:Ge}),{data:o,error:a}=i;if(a||!o)return{data:{user:null,session:null},error:a};const l=o.session,c=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:c,session:l},error:null}}catch(i){if(G(i))return{data:{user:null,session:null},error:i};throw i}}async signUp(e){var t,n,s;try{let i;if("email"in e){const{email:h,password:u,options:f}=e;let p=null,g=null;this.flowType==="pkce"&&([p,g]=await St(this.storage,this.storageKey)),i=await J(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:f?.emailRedirectTo,body:{email:h,password:u,data:(t=f?.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:f?.captchaToken},code_challenge:p,code_challenge_method:g},xform:Ge})}else if("phone"in e){const{phone:h,password:u,options:f}=e;i=await J(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:h,password:u,data:(n=f?.data)!==null&&n!==void 0?n:{},channel:(s=f?.channel)!==null&&s!==void 0?s:"sms",gotrue_meta_security:{captcha_token:f?.captchaToken}},xform:Ge})}else throw new cr("You must provide either an email or phone number and a password");const{data:o,error:a}=i;if(a||!o)return{data:{user:null,session:null},error:a};const l=o.session,c=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:c,session:l},error:null}}catch(i){if(G(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithPassword(e){try{let t;if("email"in e){const{email:i,password:o,options:a}=e;t=await J(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:i,password:o,gotrue_meta_security:{captcha_token:a?.captchaToken}},xform:Ki})}else if("phone"in e){const{phone:i,password:o,options:a}=e;t=await J(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:i,password:o,gotrue_meta_security:{captcha_token:a?.captchaToken}},xform:Ki})}else throw new cr("You must provide either an email or phone number and a password");const{data:n,error:s}=t;return s?{data:{user:null,session:null},error:s}:!n||!n.session||!n.user?{data:{user:null,session:null},error:new lr}:(n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",n.session)),{data:Object.assign({user:n.user,session:n.session},n.weak_password?{weakPassword:n.weak_password}:null),error:s})}catch(t){if(G(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,n,s,i;return await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(n=e.options)===null||n===void 0?void 0:n.scopes,queryParams:(s=e.options)===null||s===void 0?void 0:s.queryParams,skipBrowserRedirect:(i=e.options)===null||i===void 0?void 0:i.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:t}=e;if(t==="solana")return await this.signInWithSolana(e);throw new Error(`@supabase/auth-js: Unsupported chain "${t}"`)}async signInWithSolana(e){var t,n,s,i,o,a,l,c,h,u,f,p;let g,v;if("message"in e)g=e.message,v=e.signature;else{const{chain:_,wallet:y,statement:b,options:w}=e;let E;if(je())if(typeof y=="object")E=y;else{const C=window;if("solana"in C&&typeof C.solana=="object"&&("signIn"in C.solana&&typeof C.solana.signIn=="function"||"signMessage"in C.solana&&typeof C.solana.signMessage=="function"))E=C.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof y!="object"||!w?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");E=y}const S=new URL((t=w?.url)!==null&&t!==void 0?t:window.location.href);if("signIn"in E&&E.signIn){const C=await E.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},w?.signInWithSolana),{version:"1",domain:S.host,uri:S.href}),b?{statement:b}:null));let I;if(Array.isArray(C)&&C[0]&&typeof C[0]=="object")I=C[0];else if(C&&typeof C=="object"&&"signedMessage"in C&&"signature"in C)I=C;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in I&&"signature"in I&&(typeof I.signedMessage=="string"||I.signedMessage instanceof Uint8Array)&&I.signature instanceof Uint8Array)g=typeof I.signedMessage=="string"?I.signedMessage:new TextDecoder().decode(I.signedMessage),v=I.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in E)||typeof E.signMessage!="function"||!("publicKey"in E)||typeof E!="object"||!E.publicKey||!("toBase58"in E.publicKey)||typeof E.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");g=[`${S.host} wants you to sign in with your Solana account:`,E.publicKey.toBase58(),...b?["",b,""]:[""],"Version: 1",`URI: ${S.href}`,`Issued At: ${(s=(n=w?.signInWithSolana)===null||n===void 0?void 0:n.issuedAt)!==null&&s!==void 0?s:new Date().toISOString()}`,...!((i=w?.signInWithSolana)===null||i===void 0)&&i.notBefore?[`Not Before: ${w.signInWithSolana.notBefore}`]:[],...!((o=w?.signInWithSolana)===null||o===void 0)&&o.expirationTime?[`Expiration Time: ${w.signInWithSolana.expirationTime}`]:[],...!((a=w?.signInWithSolana)===null||a===void 0)&&a.chainId?[`Chain ID: ${w.signInWithSolana.chainId}`]:[],...!((l=w?.signInWithSolana)===null||l===void 0)&&l.nonce?[`Nonce: ${w.signInWithSolana.nonce}`]:[],...!((c=w?.signInWithSolana)===null||c===void 0)&&c.requestId?[`Request ID: ${w.signInWithSolana.requestId}`]:[],...!((u=(h=w?.signInWithSolana)===null||h===void 0?void 0:h.resources)===null||u===void 0)&&u.length?["Resources",...w.signInWithSolana.resources.map(I=>`- ${I}`)]:[]].join(`
`);const C=await E.signMessage(new TextEncoder().encode(g),"utf8");if(!C||!(C instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");v=C}}try{const{data:_,error:y}=await J(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:g,signature:Iu(v)},!((f=e.options)===null||f===void 0)&&f.captchaToken?{gotrue_meta_security:{captcha_token:(p=e.options)===null||p===void 0?void 0:p.captchaToken}}:null),xform:Ge});if(y)throw y;return!_||!_.session||!_.user?{data:{user:null,session:null},error:new lr}:(_.session&&(await this._saveSession(_.session),await this._notifyAllSubscribers("SIGNED_IN",_.session)),{data:Object.assign({},_),error:y})}catch(_){if(G(_))return{data:{user:null,session:null},error:_};throw _}}async _exchangeCodeForSession(e){const t=await dr(this.storage,`${this.storageKey}-code-verifier`),[n,s]=(t??"").split("/");try{const{data:i,error:o}=await J(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:n},xform:Ge});if(await hr(this.storage,`${this.storageKey}-code-verifier`),o)throw o;return!i||!i.session||!i.user?{data:{user:null,session:null,redirectType:null},error:new lr}:(i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",i.session)),{data:Object.assign(Object.assign({},i),{redirectType:s??null}),error:o})}catch(i){if(G(i))return{data:{user:null,session:null,redirectType:null},error:i};throw i}}async signInWithIdToken(e){try{const{options:t,provider:n,token:s,access_token:i,nonce:o}=e,a=await J(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:n,id_token:s,access_token:i,nonce:o,gotrue_meta_security:{captcha_token:t?.captchaToken}},xform:Ge}),{data:l,error:c}=a;return c?{data:{user:null,session:null},error:c}:!l||!l.session||!l.user?{data:{user:null,session:null},error:new lr}:(l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),{data:l,error:c})}catch(t){if(G(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,n,s,i,o;try{if("email"in e){const{email:a,options:l}=e;let c=null,h=null;this.flowType==="pkce"&&([c,h]=await St(this.storage,this.storageKey));const{error:u}=await J(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:a,data:(t=l?.data)!==null&&t!==void 0?t:{},create_user:(n=l?.shouldCreateUser)!==null&&n!==void 0?n:!0,gotrue_meta_security:{captcha_token:l?.captchaToken},code_challenge:c,code_challenge_method:h},redirectTo:l?.emailRedirectTo});return{data:{user:null,session:null},error:u}}if("phone"in e){const{phone:a,options:l}=e,{data:c,error:h}=await J(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:a,data:(s=l?.data)!==null&&s!==void 0?s:{},create_user:(i=l?.shouldCreateUser)!==null&&i!==void 0?i:!0,gotrue_meta_security:{captcha_token:l?.captchaToken},channel:(o=l?.channel)!==null&&o!==void 0?o:"sms"}});return{data:{user:null,session:null,messageId:c?.message_id},error:h}}throw new cr("You must provide either an email or phone number.")}catch(a){if(G(a))return{data:{user:null,session:null},error:a};throw a}}async verifyOtp(e){var t,n;try{let s,i;"options"in e&&(s=(t=e.options)===null||t===void 0?void 0:t.redirectTo,i=(n=e.options)===null||n===void 0?void 0:n.captchaToken);const{data:o,error:a}=await J(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:i}}),redirectTo:s,xform:Ge});if(a)throw a;if(!o)throw new Error("An error occurred on token verification.");const l=o.session,c=o.user;return l?.access_token&&(await this._saveSession(l),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",l)),{data:{user:c,session:l},error:null}}catch(s){if(G(s))return{data:{user:null,session:null},error:s};throw s}}async signInWithSSO(e){var t,n,s;try{let i=null,o=null;return this.flowType==="pkce"&&([i,o]=await St(this.storage,this.storageKey)),await J(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(n=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&n!==void 0?n:void 0}),!((s=e?.options)===null||s===void 0)&&s.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:i,code_challenge_method:o}),headers:this.headers,xform:ed})}catch(i){if(G(i))return{data:null,error:i};throw i}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:n}=e;if(n)throw n;if(!t)throw new Ye;const{error:s}=await J(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:s}})}catch(e){if(G(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:n,type:s,options:i}=e,{error:o}=await J(this.fetch,"POST",t,{headers:this.headers,body:{email:n,type:s,gotrue_meta_security:{captcha_token:i?.captchaToken}},redirectTo:i?.emailRedirectTo});return{data:{user:null,session:null},error:o}}else if("phone"in e){const{phone:n,type:s,options:i}=e,{data:o,error:a}=await J(this.fetch,"POST",t,{headers:this.headers,body:{phone:n,type:s,gotrue_meta_security:{captcha_token:i?.captchaToken}}});return{data:{user:null,session:null,messageId:o?.message_id},error:a}}throw new cr("You must provide either an email or phone number and a type")}catch(t){if(G(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async t=>t))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const n=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),s=(async()=>(await n,await t()))();return this.pendingInLock.push((async()=>{try{await s}catch{}})()),s}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const n=t();for(this.pendingInLock.push((async()=>{try{await n}catch{}})()),await n;this.pendingInLock.length;){const s=[...this.pendingInLock];await Promise.all(s),this.pendingInLock.splice(0,s.length)}return await n}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await dr(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const n=e.expires_at?e.expires_at*1e3-Date.now()<Lr:!1;if(this._debug("#__loadSession()",`session has${n?"":" not"} expired`,"expires_at",e.expires_at),!n){if(this.storage.isServer){let o=this.suppressGetSessionWarning;e=new Proxy(e,{get:(l,c,h)=>(!o&&c==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),o=!0,this.suppressGetSessionWarning=!0),Reflect.get(l,c,h))})}return{data:{session:e},error:null}}const{session:s,error:i}=await this._callRefreshToken(e.refresh_token);return i?{data:{session:null},error:i}:{data:{session:s},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await J(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:Ze}):await this._useSession(async t=>{var n,s,i;const{data:o,error:a}=t;if(a)throw a;return!(!((n=o.session)===null||n===void 0)&&n.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Ye}:await J(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(i=(s=o.session)===null||s===void 0?void 0:s.access_token)!==null&&i!==void 0?i:void 0,xform:Ze})})}catch(t){if(G(t))return ku(t)&&(await this._removeSession(),await hr(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async n=>{const{data:s,error:i}=n;if(i)throw i;if(!s.session)throw new Ye;const o=s.session;let a=null,l=null;this.flowType==="pkce"&&e.email!=null&&([a,l]=await St(this.storage,this.storageKey));const{data:c,error:h}=await J(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t?.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:a,code_challenge_method:l}),jwt:o.access_token,xform:Ze});if(h)throw h;return o.user=c.user,await this._saveSession(o),await this._notifyAllSubscribers("USER_UPDATED",o),{data:{user:o.user},error:null}})}catch(n){if(G(n))return{data:{user:null},error:n};throw n}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new Ye;const t=Date.now()/1e3;let n=t,s=!0,i=null;const{payload:o}=qr(e.access_token);if(o.exp&&(n=o.exp,s=n<=t),s){const{session:a,error:l}=await this._callRefreshToken(e.refresh_token);if(l)return{data:{user:null,session:null},error:l};if(!a)return{data:{user:null,session:null},error:null};i=a}else{const{data:a,error:l}=await this._getUser(e.access_token);if(l)throw l;i={access_token:e.access_token,refresh_token:e.refresh_token,user:a.user,token_type:"bearer",expires_in:n-t,expires_at:n},await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)}return{data:{user:i.user,session:i},error:null}}catch(t){if(G(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var n;if(!e){const{data:o,error:a}=t;if(a)throw a;e=(n=o.session)!==null&&n!==void 0?n:void 0}if(!e?.refresh_token)throw new Ye;const{session:s,error:i}=await this._callRefreshToken(e.refresh_token);return i?{data:{user:null,session:null},error:i}:s?{data:{user:s.user,session:s},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if(G(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e,t){try{if(!je())throw new ur("No browser detected.");if(e.error||e.error_description||e.error_code)throw new ur(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if(this.flowType==="pkce")throw new Fi("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new ur("Not a valid implicit grant flow url.");break;default:}if(t==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new Fi("No code detected.");const{data:b,error:w}=await this._exchangeCodeForSession(e.code);if(w)throw w;const E=new URL(window.location.href);return E.searchParams.delete("code"),window.history.replaceState(window.history.state,"",E.toString()),{data:{session:b.session,redirectType:null},error:null}}const{provider_token:n,provider_refresh_token:s,access_token:i,refresh_token:o,expires_in:a,expires_at:l,token_type:c}=e;if(!i||!a||!o||!c)throw new ur("No session defined in URL");const h=Math.round(Date.now()/1e3),u=parseInt(a);let f=h+u;l&&(f=parseInt(l));const p=f-h;p*1e3<=kt&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${p}s, should have been closer to ${u}s`);const g=f-u;h-g>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",g,f,h):h-g<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",g,f,h);const{data:v,error:_}=await this._getUser(i);if(_)throw _;const y={provider_token:n,provider_refresh_token:s,access_token:i,expires_in:u,expires_at:f,refresh_token:o,token_type:c,user:v.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:y,redirectType:e.type},error:null}}catch(n){if(G(n))return{data:{session:null,redirectType:null},error:n};throw n}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await dr(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var n;const{data:s,error:i}=t;if(i)return{error:i};const o=(n=s.session)===null||n===void 0?void 0:n.access_token;if(o){const{error:a}=await this.admin.signOut(o,e);if(a&&!(Pu(a)&&(a.status===404||a.status===401||a.status===403)))return{error:a}}return e!=="others"&&(await this._removeSession(),await hr(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const t=Nu(),n={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,n),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:n}}}async _emitInitialSession(e){return await this._useSession(async t=>{var n,s;try{const{data:{session:i},error:o}=t;if(o)throw o;await((n=this.stateChangeEmitters.get(e))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",i)),this._debug("INITIAL_SESSION","callback id",e,"session",i)}catch(i){await((s=this.stateChangeEmitters.get(e))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",i),console.error(i)}})}async resetPasswordForEmail(e,t={}){let n=null,s=null;this.flowType==="pkce"&&([n,s]=await St(this.storage,this.storageKey,!0));try{return await J(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:n,code_challenge_method:s,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(i){if(G(i))return{data:null,error:i};throw i}}async getUserIdentities(){var e;try{const{data:t,error:n}=await this.getUser();if(n)throw n;return{data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(t){if(G(t))return{data:null,error:t};throw t}}async linkIdentity(e){var t;try{const{data:n,error:s}=await this._useSession(async i=>{var o,a,l,c,h;const{data:u,error:f}=i;if(f)throw f;const p=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(o=e.options)===null||o===void 0?void 0:o.redirectTo,scopes:(a=e.options)===null||a===void 0?void 0:a.scopes,queryParams:(l=e.options)===null||l===void 0?void 0:l.queryParams,skipBrowserRedirect:!0});return await J(this.fetch,"GET",p,{headers:this.headers,jwt:(h=(c=u.session)===null||c===void 0?void 0:c.access_token)!==null&&h!==void 0?h:void 0})});if(s)throw s;return je()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(n?.url),{data:{provider:e.provider,url:n?.url},error:null}}catch(n){if(G(n))return{data:{provider:e.provider,url:null},error:n};throw n}}async unlinkIdentity(e){try{return await this._useSession(async t=>{var n,s;const{data:i,error:o}=t;if(o)throw o;return await J(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(s=(n=i.session)===null||n===void 0?void 0:n.access_token)!==null&&s!==void 0?s:void 0})})}catch(t){if(G(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const n=Date.now();return await qu(async s=>(s>0&&await Mu(200*Math.pow(2,s-1)),this._debug(t,"refreshing attempt",s),await J(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:Ge})),(s,i)=>{const o=200*Math.pow(2,s);return i&&Mr(i)&&Date.now()+o-n<kt})}catch(n){if(this._debug(t,"error",n),G(n))return{data:{session:null,user:null},error:n};throw n}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const n=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",n),je()&&!t.skipBrowserRedirect&&window.location.assign(n),{data:{provider:e,url:n},error:null}}async _recoverAndRefresh(){var e;const t="#_recoverAndRefresh()";this._debug(t,"begin");try{const n=await dr(this.storage,this.storageKey);if(this._debug(t,"session from storage",n),!this._isValidSession(n)){this._debug(t,"session is not valid"),n!==null&&await this._removeSession();return}const s=((e=n.expires_at)!==null&&e!==void 0?e:1/0)*1e3-Date.now()<Lr;if(this._debug(t,`session has${s?"":" not"} expired with margin of ${Lr}s`),s){if(this.autoRefreshToken&&n.refresh_token){const{error:i}=await this._callRefreshToken(n.refresh_token);i&&(console.error(i),Mr(i)||(this._debug(t,"refresh failed with a non-retryable error, removing the session",i),await this._removeSession()))}}else await this._notifyAllSubscribers("SIGNED_IN",n)}catch(n){this._debug(t,"error",n),console.error(n);return}finally{this._debug(t,"end")}}async _callRefreshToken(e){var t,n;if(!e)throw new Ye;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const s=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(s,"begin");try{this.refreshingDeferred=new Pr;const{data:i,error:o}=await this._refreshAccessToken(e);if(o)throw o;if(!i.session)throw new Ye;await this._saveSession(i.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",i.session);const a={session:i.session,error:null};return this.refreshingDeferred.resolve(a),a}catch(i){if(this._debug(s,"error",i),G(i)){const o={session:null,error:i};return Mr(i)||await this._removeSession(),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(o),o}throw(n=this.refreshingDeferred)===null||n===void 0||n.reject(i),i}finally{this.refreshingDeferred=null,this._debug(s,"end")}}async _notifyAllSubscribers(e,t,n=!0){const s=`#_notifyAllSubscribers(${e})`;this._debug(s,"begin",t,`broadcast = ${n}`);try{this.broadcastChannel&&n&&this.broadcastChannel.postMessage({event:e,session:t});const i=[],o=Array.from(this.stateChangeEmitters.values()).map(async a=>{try{await a.callback(e,t)}catch(l){i.push(l)}});if(await Promise.all(o),i.length>0){for(let a=0;a<i.length;a+=1)console.error(i[a]);throw i[0]}}finally{this._debug(s,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await ul(this.storage,this.storageKey,e)}async _removeSession(){this._debug("#_removeSession()"),await hr(this.storage,this.storageKey),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&je()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),kt);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:n}}=t;if(!n||!n.refresh_token||!n.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const s=Math.floor((n.expires_at*1e3-e)/kt);this._debug("#_autoRefreshTokenTick()",`access token expires in ${s} ticks, a tick lasts ${kt}ms, refresh threshold is ${us} ticks`),s<=us&&await this._callRefreshToken(n.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof dl)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!je()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,n){const s=[`provider=${encodeURIComponent(t)}`];if(n?.redirectTo&&s.push(`redirect_to=${encodeURIComponent(n.redirectTo)}`),n?.scopes&&s.push(`scopes=${encodeURIComponent(n.scopes)}`),this.flowType==="pkce"){const[i,o]=await St(this.storage,this.storageKey),a=new URLSearchParams({code_challenge:`${encodeURIComponent(i)}`,code_challenge_method:`${encodeURIComponent(o)}`});s.push(a.toString())}if(n?.queryParams){const i=new URLSearchParams(n.queryParams);s.push(i.toString())}return n?.skipBrowserRedirect&&s.push(`skip_http_redirect=${n.skipBrowserRedirect}`),`${e}?${s.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var n;const{data:s,error:i}=t;return i?{data:null,error:i}:await J(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(n=s?.session)===null||n===void 0?void 0:n.access_token})})}catch(t){if(G(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var n,s;const{data:i,error:o}=t;if(o)return{data:null,error:o};const a=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:{issuer:e.issuer}),{data:l,error:c}=await J(this.fetch,"POST",`${this.url}/factors`,{body:a,headers:this.headers,jwt:(n=i?.session)===null||n===void 0?void 0:n.access_token});return c?{data:null,error:c}:(e.factorType==="totp"&&(!((s=l?.totp)===null||s===void 0)&&s.qr_code)&&(l.totp.qr_code=`data:image/svg+xml;utf-8,${l.totp.qr_code}`),{data:l,error:null})})}catch(t){if(G(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var n;const{data:s,error:i}=t;if(i)return{data:null,error:i};const{data:o,error:a}=await J(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(n=s?.session)===null||n===void 0?void 0:n.access_token});return a?{data:null,error:a}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+o.expires_in},o)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",o),{data:o,error:a})})}catch(t){if(G(t))return{data:null,error:t};throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var n;const{data:s,error:i}=t;return i?{data:null,error:i}:await J(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:(n=s?.session)===null||n===void 0?void 0:n.access_token})})}catch(t){if(G(t))return{data:null,error:t};throw t}})}async _challengeAndVerify(e){const{data:t,error:n}=await this._challenge({factorId:e.factorId});return n?{data:null,error:n}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const n=e?.factors||[],s=n.filter(o=>o.factor_type==="totp"&&o.status==="verified"),i=n.filter(o=>o.factor_type==="phone"&&o.status==="verified");return{data:{all:n,totp:s,phone:i},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,n;const{data:{session:s},error:i}=e;if(i)return{data:null,error:i};if(!s)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:o}=qr(s.access_token);let a=null;o.aal&&(a=o.aal);let l=a;((n=(t=s.user.factors)===null||t===void 0?void 0:t.filter(u=>u.status==="verified"))!==null&&n!==void 0?n:[]).length>0&&(l="aal2");const h=o.amr||[];return{data:{currentLevel:a,nextLevel:l,currentAuthenticationMethods:h},error:null}}))}async fetchJwk(e,t={keys:[]}){let n=t.keys.find(o=>o.kid===e);if(n||(n=this.jwks.keys.find(o=>o.kid===e),n&&this.jwks_cached_at+Eu>Date.now()))return n;const{data:s,error:i}=await J(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(i)throw i;if(!s.keys||s.keys.length===0)throw new zt("JWKS is empty");if(this.jwks=s,this.jwks_cached_at=Date.now(),n=s.keys.find(o=>o.kid===e),!n)throw new zt("No matching signing key found in JWKS");return n}async getClaims(e,t={keys:[]}){try{let n=e;if(!n){const{data:p,error:g}=await this.getSession();if(g||!p.session)return{data:null,error:g};n=p.session.access_token}const{header:s,payload:i,signature:o,raw:{header:a,payload:l}}=qr(n);if(Ku(i.exp),!s.kid||s.alg==="HS256"||!("crypto"in globalThis&&"subtle"in globalThis.crypto)){const{error:p}=await this.getUser(n);if(p)throw p;return{data:{claims:i,header:s,signature:o},error:null}}const c=zu(s.alg),h=await this.fetchJwk(s.kid,t),u=await crypto.subtle.importKey("jwk",h,c,!0,["verify"]);if(!await crypto.subtle.verify(c,u,o,ju(`${a}.${l}`)))throw new zt("Invalid JWT signature");return{data:{claims:i,header:s,signature:o},error:null}}catch(n){if(G(n))return{data:null,error:n};throw n}}}Qt.nextInstanceID=0;const dd=Qt;class hd extends dd{constructor(e){super(e)}}var fd=function(r,e,t,n){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(h){try{c(n.next(h))}catch(u){o(u)}}function l(h){try{c(n.throw(h))}catch(u){o(u)}}function c(h){h.done?i(h.value):s(h.value).then(a,l)}c((n=n.apply(r,e||[])).next())})};class pd{constructor(e,t,n){var s,i,o;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const a=vu(e),l=new URL(a);this.realtimeUrl=new URL("realtime/v1",l),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",l),this.storageUrl=new URL("storage/v1",l),this.functionsUrl=new URL("functions/v1",l);const c=`sb-${l.hostname.split(".")[0]}-auth-token`,h={db:cu,realtime:du,auth:Object.assign(Object.assign({},uu),{storageKey:c}),global:lu},u=mu(n??{},h);this.storageKey=(s=u.auth.storageKey)!==null&&s!==void 0?s:"",this.headers=(i=u.global.headers)!==null&&i!==void 0?i:{},u.accessToken?(this.accessToken=u.accessToken,this.auth=new Proxy({},{get:(f,p)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(p)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((o=u.auth)!==null&&o!==void 0?o:{},this.headers,u.global.fetch),this.fetch=_u(t,this._getAccessToken.bind(this),u.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},u.realtime)),this.rest=new Cc(new URL("rest/v1",l).href,{headers:this.headers,schema:u.db.schema,fetch:this.fetch}),u.accessToken||this._listenForAuthEvents()}get functions(){return new yc(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}get storage(){return new iu(this.storageUrl.href,this.headers,this.fetch)}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},n={}){return this.rest.rpc(e,t,n)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return fd(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:n}=yield this.auth.getSession();return(t=(e=n.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:null})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:n,storage:s,storageKey:i,flowType:o,lock:a,debug:l},c,h){const u={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new hd({url:this.authUrl.href,headers:Object.assign(Object.assign({},u),c),storageKey:i,autoRefreshToken:e,persistSession:t,detectSessionInUrl:n,storage:s,flowType:o,lock:a,debug:l,fetch:h,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(e){return new Vc(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,n)=>{this._handleTokenChanged(t,"CLIENT",n?.access_token)})}_handleTokenChanged(e,t,n){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==n?this.changedAccessToken=n:e==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const _d=(r,e,t)=>new pd(r,e,t),gd=void 0,vd=void 0;console.error("Supabase URL or Anon Key is missing. Make sure to set VITE_SUPABASE_URL and VITE_SUPABASE_ANON_KEY in your .env file.");const te=_d(gd,vd,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!1,storageKey:"sb-auth-token",flowType:"pkce"},db:{schema:"public"},global:{headers:{"Content-Type":"application/json"},fetch:(r,e={})=>fetch(r,{...e,signal:AbortSignal.timeout(1e4)})}}),hl=async()=>{try{console.log("Testing Supabase connection...");const{data:r,error:e}=await te.from("watch_history").select("count").limit(1);return e?(console.error("Supabase connection test failed:",e),!1):(console.log("Supabase connection test successful"),!0)}catch(r){return console.error("Supabase connection test error:",r),!1}};typeof window<"u"&&(window.supabase=te,window.testSupabaseConnection=hl);const fl=Er();function md({children:r}){const[e,t]=q(null),[n,s]=q(null),[i,o]=q(!0);se(()=>{(async()=>{const{data:{session:h}}=await te.auth.getSession();t(h),s(h?.user??null),o(!1)})();const{data:c}=te.auth.onAuthStateChange((h,u)=>{t(u),s(u?.user??null)});return()=>{c.subscription.unsubscribe()}},[]);const a={session:e,user:n,signOut:()=>te.auth.signOut()};return d(fl.Provider,{value:a,children:!i&&r})}function ut(){return Tr(fl)}let yd=0,Ct=null;const wr={success:(r,e={})=>fr(r,"success",e),error:(r,e={})=>fr(r,"error",e),info:(r,e={})=>fr(r,"info",e),warning:(r,e={})=>fr(r,"warning",e)},fr=(r,e="info",t={})=>{if(!Ct)return;const n=yd++,s=t.duration||(e==="error"?6e3:4e3),i={id:n,message:r,type:e,duration:s,timestamp:Date.now()};return Ct(o=>[...o,i]),setTimeout(()=>{fs(n)},s),n},fs=r=>{Ct&&Ct(e=>e.filter(t=>t.id!==r))},bd=({position:r="top-center"})=>{const[e,t]=q([]);return se(()=>(Ct=t,()=>{Ct=null}),[]),e.length===0?null:d("div",{class:`toast-container toast-container--${r}`,children:e.map(n=>d("div",{class:`toast toast--${n.type}`,onClick:()=>fs(n.id),children:[d("div",{class:"toast__content",children:[n.type==="success"&&d("span",{class:"toast__icon",children:"✅"}),n.type==="error"&&d("span",{class:"toast__icon",children:"❌"}),n.type==="warning"&&d("span",{class:"toast__icon",children:"⚠️"}),n.type==="info"&&d("span",{class:"toast__icon",children:"ℹ️"}),d("span",{class:"toast__message",children:n.message})]}),d("button",{class:"toast__close",onClick:s=>{s.stopPropagation(),fs(n.id)},children:"×"})]},n.id))})},Pe={DARK:"dark",LIGHT:"light"},Ns=()=>{const r=localStorage.getItem("theme");return r&&Object.values(Pe).includes(r)?r:window.matchMedia("(prefers-color-scheme: dark)").matches?Pe.DARK:Pe.LIGHT},ps=r=>{Object.values(Pe).includes(r)||(console.warn(`Invalid theme: ${r}. Using default dark theme.`),r=Pe.DARK),r===Pe.LIGHT?document.documentElement.setAttribute("data-theme","light"):document.documentElement.removeAttribute("data-theme"),localStorage.setItem("theme",r),window.dispatchEvent(new CustomEvent("themeChanged",{detail:{theme:r}}))},wd=()=>{const e=Ns()===Pe.LIGHT?Pe.DARK:Pe.LIGHT;return ps(e),e},Sd=()=>{const r=Ns();ps(r),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",e=>{localStorage.getItem("theme")||ps(e.matches?Pe.DARK:Pe.LIGHT)})},Ed=()=>{const[r,e]=q(!0);return se(()=>{const n=Ns();e(n===Pe.DARK);const s=i=>{e(i.detail.theme===Pe.DARK)};return window.addEventListener("themeChanged",s),()=>{window.removeEventListener("themeChanged",s)}},[]),d("button",{class:`theme-toggle ${r?"dark":"light"}`,onClick:()=>{const n=wd();e(n===Pe.DARK)},"aria-label":`Switch to ${r?"light":"dark"} mode`,title:`Switch to ${r?"light":"dark"} mode`,children:d("div",{class:"toggle-track",children:d("div",{class:"toggle-thumb",children:d("div",{class:"icon",children:r?d("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:d("path",{d:"M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"})}):d("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[d("circle",{cx:"12",cy:"12",r:"5"}),d("line",{x1:"12",y1:"1",x2:"12",y2:"3"}),d("line",{x1:"12",y1:"21",x2:"12",y2:"23"}),d("line",{x1:"4.22",y1:"4.22",x2:"5.64",y2:"5.64"}),d("line",{x1:"18.36",y1:"18.36",x2:"19.78",y2:"19.78"}),d("line",{x1:"1",y1:"12",x2:"3",y2:"12"}),d("line",{x1:"21",y1:"12",x2:"23",y2:"12"}),d("line",{x1:"4.22",y1:"19.78",x2:"5.64",y2:"18.36"}),d("line",{x1:"18.36",y1:"5.64",x2:"19.78",y2:"4.22"})]})})})})})},Td=()=>{const[r,e]=q(""),[t,n]=q(!1),[s,i]=q(!1),{user:o,signOut:a}=ut(),l=f=>{f.preventDefault(),r.trim()&&(Ue(`/search?q=${encodeURIComponent(r.trim())}`),e(""),i(!1))},c=async()=>{await a(),Ue("/")},h=()=>{n(!t),i(!1)};return d("header",{children:d("div",{class:"container",children:[d("div",{class:"header-left",children:[d(Le,{href:"/",class:"logo",children:"FreeStream"}),d("nav",{class:t?"active":"",children:d("ul",{onClick:()=>n(!1),children:[d("li",{children:d(Le,{activeClassName:"active",href:"/movies",children:"Movies"})}),d("li",{children:d(Le,{activeClassName:"active",href:"/tv",children:"TV"})}),o?d(be,{children:[d("li",{children:d(Le,{activeClassName:"active",href:"/favorites",children:"Favorites"})}),d("li",{children:d(Le,{activeClassName:"active",href:"/history",children:"History"})})]}):d(be,{children:[d("li",{children:d("a",{href:"/login",style:{color:"#999",fontSize:"0.9em"},children:"Favorites (Login Required)"})}),d("li",{children:d("a",{href:"/login",style:{color:"#999",fontSize:"0.9em"},children:"History (Login Required)"})})]})]})})]}),s&&d("div",{class:"mobile-search-overlay",children:d("form",{class:"mobile-search-form",onSubmit:l,children:[d("input",{type:"text",placeholder:"Search movies & TV shows...",value:r,onInput:f=>e(f.target.value),class:"mobile-search-input",autoFocus:!0}),d("button",{type:"submit",class:"mobile-search-submit",children:d("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2",children:[d("circle",{cx:"11",cy:"11",r:"8"}),d("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"})]})})]})}),d("div",{class:"header-right",children:[d("form",{class:"search-container desktop-only",onSubmit:l,children:d("input",{type:"text",placeholder:"Search...",value:r,onInput:f=>e(f.target.value),class:"glass-light"})}),d("button",{class:"search-toggle mobile-only",onClick:()=>{i(!s),n(!1)},"aria-label":"Toggle search",children:d("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2",children:[d("circle",{cx:"11",cy:"11",r:"8"}),d("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"})]})}),d(Ed,{}),d("div",{class:"auth-links",children:o?d(be,{children:[d("span",{class:"user-email",children:o.email}),d("button",{onClick:c,class:"auth-button",children:"Logout"})]}):d(be,{children:[d(Le,{href:"/login",class:"auth-link",children:"Login"}),d(Le,{href:"/signup",class:"auth-link",children:"Sign Up"})]})})]}),d("button",{class:"hamburger",onClick:h,"aria-label":"Toggle menu",children:[d("span",{class:"bar"}),d("span",{class:"bar"}),d("span",{class:"bar"})]})]})})};var Pd=["className","activeClass","activeClassName","path"];function Qe(r){var e=r.className,t=r.activeClass,n=r.activeClassName,s=r.path,i=function(h,u){if(h==null)return{};var f,p,g={},v=Object.keys(h);for(p=0;p<v.length;p++)u.indexOf(f=v[p])>=0||(g[f]=h[f]);return g}(r,Pd),o=ac()[0],a=s&&o.path&&ns(o.path,s,{})||ns(o.url,i.href,{}),l=i.class||e||"",c=a&&(t||n)||"";return i.class=l+(l&&c&&" ")+c,ke(Le,i)}const kd=()=>d("footer",{class:"app-footer",children:[d("div",{class:"footer-content",children:[d("div",{class:"footer-brand",children:[d(Qe,{href:"/",class:"logo",children:"FreeStream"}),d("p",{children:"Your gateway to unlimited entertainment. Built with passion."})]}),d("div",{class:"footer-links",children:[d("div",{class:"footer-section",children:[d("h4",{children:"Platform"}),d("ul",{children:[d("li",{children:d(Qe,{href:"/",children:"Home"})}),d("li",{children:d(Qe,{href:"/movies",children:"Movies"})}),d("li",{children:d(Qe,{href:"/tv",children:"TV Shows"})})]})]}),d("div",{class:"footer-section",children:[d("h4",{children:"Account"}),d("ul",{children:[d("li",{children:d(Qe,{href:"/login",children:"Login"})}),d("li",{children:d(Qe,{href:"/signup",children:"Sign Up"})}),d("li",{children:d(Qe,{href:"/favorites",children:"Favorites"})})]})]}),d("div",{class:"footer-section",children:[d("h4",{children:"Legal"}),d("ul",{children:[d("li",{children:d("a",{href:"#",children:"Terms of Service"})}),d("li",{children:d("a",{href:"#",children:"Privacy Policy"})})]})]})]})]}),d("div",{class:"footer-bottom",children:[d("p",{children:"© 2024 FreeStream. All Rights Reserved. Not a real streaming service."}),d("div",{class:"footer-socials",children:[d("a",{href:"#","aria-label":"Github",children:d("i",{class:"fab fa-github"})}),d("a",{href:"#","aria-label":"Twitter",children:d("i",{class:"fab fa-twitter"})})]})]})]}),Yi=r=>{let e;const t=new Set,n=(c,h)=>{const u=typeof c=="function"?c(e):c;if(!Object.is(u,e)){const f=e;e=h??(typeof u!="object"||u===null)?u:Object.assign({},e,u),t.forEach(p=>p(e,f))}},s=()=>e,a={setState:n,getState:s,getInitialState:()=>l,subscribe:c=>(t.add(c),()=>t.delete(c))},l=e=r(n,s,a);return a},$d=r=>r?Yi(r):Yi;function pl(r,e){for(var t in e)r[t]=e[t];return r}function _s(r,e){for(var t in r)if(t!=="__source"&&!(t in e))return!0;for(var n in e)if(n!=="__source"&&r[n]!==e[n])return!0;return!1}function _l(r,e){var t=e(),n=q({t:{__:t,u:e}}),s=n[0].t,i=n[1];return er(function(){s.__=t,s.u=e,Br(s)&&i({t:s})},[r,t,e]),se(function(){return Br(s)&&i({t:s}),r(function(){Br(s)&&i({t:s})})},[r]),t}function Br(r){var e,t,n=r.u,s=r.__;try{var i=n();return!((e=s)===(t=i)&&(e!==0||1/e==1/t)||e!=e&&t!=t)}catch{return!0}}function gl(r){r()}function vl(r){return r}function ml(){return[!1,gl]}var yl=er;function gs(r,e){this.props=r,this.context=e}function Ad(r,e){function t(s){var i=this.props.ref,o=i==s.ref;return!o&&i&&(i.call?i(null):i.current=null),e?!e(this.props,s)||!o:_s(this.props,s)}function n(s){return this.shouldComponentUpdate=t,ke(r,s)}return n.displayName="Memo("+(r.displayName||r.name)+")",n.prototype.isReactComponent=!0,n.__f=!0,n}(gs.prototype=new Ce).isPureReactComponent=!0,gs.prototype.shouldComponentUpdate=function(r,e){return _s(this.props,r)||_s(this.state,e)};var Qi=V.__b;V.__b=function(r){r.type&&r.type.__f&&r.ref&&(r.props.ref=r.ref,r.ref=null),Qi&&Qi(r)};var Rd=typeof Symbol<"u"&&Symbol.for&&Symbol.for("react.forward_ref")||3911;function Od(r){function e(t){var n=pl({},t);return delete n.ref,r(n,t.ref||null)}return e.$$typeof=Rd,e.render=e,e.prototype.isReactComponent=e.__f=!0,e.displayName="ForwardRef("+(r.displayName||r.name)+")",e}var Xi=function(r,e){return r==null?null:xe(xe(r).map(e))},Cd={map:Xi,forEach:Xi,count:function(r){return r?xe(r).length:0},only:function(r){var e=xe(r);if(e.length!==1)throw"Children.only";return e[0]},toArray:xe},xd=V.__e;V.__e=function(r,e,t,n){if(r.then){for(var s,i=e;i=i.__;)if((s=i.__c)&&s.__c)return e.__e==null&&(e.__e=t.__e,e.__k=t.__k),s.__c(r,e)}xd(r,e,t,n)};var Zi=V.unmount;function bl(r,e,t){return r&&(r.__c&&r.__c.__H&&(r.__c.__H.__.forEach(function(n){typeof n.__c=="function"&&n.__c()}),r.__c.__H=null),(r=pl({},r)).__c!=null&&(r.__c.__P===t&&(r.__c.__P=e),r.__c.__e=!0,r.__c=null),r.__k=r.__k&&r.__k.map(function(n){return bl(n,e,t)})),r}function wl(r,e,t){return r&&t&&(r.__v=null,r.__k=r.__k&&r.__k.map(function(n){return wl(n,e,t)}),r.__c&&r.__c.__P===e&&(r.__e&&t.appendChild(r.__e),r.__c.__e=!0,r.__c.__P=t)),r}function gr(){this.__u=0,this.o=null,this.__b=null}function Sl(r){var e=r.__.__c;return e&&e.__a&&e.__a(r)}function jd(r){var e,t,n;function s(i){if(e||(e=r()).then(function(o){t=o.default||o},function(o){n=o}),n)throw n;if(!t)throw e;return ke(t,i)}return s.displayName="Lazy",s.__f=!0,s}function Ht(){this.i=null,this.l=null}V.unmount=function(r){var e=r.__c;e&&e.__R&&e.__R(),e&&32&r.__u&&(r.type=null),Zi&&Zi(r)},(gr.prototype=new Ce).__c=function(r,e){var t=e.__c,n=this;n.o==null&&(n.o=[]),n.o.push(t);var s=Sl(n.__v),i=!1,o=function(){i||(i=!0,t.__R=null,s?s(a):a())};t.__R=o;var a=function(){if(!--n.__u){if(n.state.__a){var l=n.state.__a;n.__v.__k[0]=wl(l,l.__c.__P,l.__c.__O)}var c;for(n.setState({__a:n.__b=null});c=n.o.pop();)c.forceUpdate()}};n.__u++||32&e.__u||n.setState({__a:n.__b=n.__v.__k[0]}),r.then(o,o)},gr.prototype.componentWillUnmount=function(){this.o=[]},gr.prototype.render=function(r,e){if(this.__b){if(this.__v.__k){var t=document.createElement("div"),n=this.__v.__k[0].__c;this.__v.__k[0]=bl(this.__b,t,n.__O=n.__P)}this.__b=null}var s=e.__a&&ke(be,null,r.fallback);return s&&(s.__u&=-33),[ke(be,null,e.__a?null:r.children),s]};var eo=function(r,e,t){if(++t[1]===t[0]&&r.l.delete(e),r.props.revealOrder&&(r.props.revealOrder[0]!=="t"||!r.l.size))for(t=r.i;t;){for(;t.length>3;)t.pop()();if(t[1]<t[0])break;r.i=t=t[2]}};function Id(r){return this.getChildContext=function(){return r.context},r.children}function Ud(r){var e=this,t=r.h;if(e.componentWillUnmount=function(){lt(null,e.v),e.v=null,e.h=null},e.h&&e.h!==t&&e.componentWillUnmount(),!e.v){for(var n=e.__v;n!==null&&!n.__m&&n.__!==null;)n=n.__;e.h=t,e.v={nodeType:1,parentNode:t,childNodes:[],__k:{__m:n.__m},contains:function(){return!0},insertBefore:function(s,i){this.childNodes.push(s),e.h.insertBefore(s,i)},removeChild:function(s){this.childNodes.splice(this.childNodes.indexOf(s)>>>1,1),e.h.removeChild(s)}}}lt(ke(Id,{context:e.context},r.__v),e.v)}function Nd(r,e){var t=ke(Ud,{__v:r,h:e});return t.containerInfo=e,t}(Ht.prototype=new Ce).__a=function(r){var e=this,t=Sl(e.__v),n=e.l.get(r);return n[0]++,function(s){var i=function(){e.props.revealOrder?(n.push(s),eo(e,r,n)):s()};t?t(i):i()}},Ht.prototype.render=function(r){this.i=null,this.l=new Map;var e=xe(r.children);r.revealOrder&&r.revealOrder[0]==="b"&&e.reverse();for(var t=e.length;t--;)this.l.set(e[t],this.i=[1,0,this.i]);return r.children},Ht.prototype.componentDidUpdate=Ht.prototype.componentDidMount=function(){var r=this;this.l.forEach(function(e,t){eo(r,t,e)})};var El=typeof Symbol<"u"&&Symbol.for&&Symbol.for("react.element")||60103,Dd=/^(?:accent|alignment|arabic|baseline|cap|clip(?!PathU)|color|dominant|fill|flood|font|glyph(?!R)|horiz|image(!S)|letter|lighting|marker(?!H|W|U)|overline|paint|pointer|shape|stop|strikethrough|stroke|text(?!L)|transform|underline|unicode|units|v|vector|vert|word|writing|x(?!C))[A-Z]/,Ld=/^on(Ani|Tra|Tou|BeforeInp|Compo)/,Md=/[A-Z0-9]/g,qd=typeof document<"u",Fd=function(r){return(typeof Symbol<"u"&&typeof Symbol()=="symbol"?/fil|che|rad/:/fil|che|ra/).test(r)};function Bd(r,e,t){return e.__k==null&&(e.textContent=""),lt(r,e),typeof t=="function"&&t(),r?r.__c:null}function Hd(r,e,t){return Ts(r,e),typeof t=="function"&&t(),r?r.__c:null}Ce.prototype.isReactComponent={},["componentWillMount","componentWillReceiveProps","componentWillUpdate"].forEach(function(r){Object.defineProperty(Ce.prototype,r,{configurable:!0,get:function(){return this["UNSAFE_"+r]},set:function(e){Object.defineProperty(this,r,{configurable:!0,writable:!0,value:e})}})});var to=V.event;function Wd(){}function Gd(){return this.cancelBubble}function Vd(){return this.defaultPrevented}V.event=function(r){return to&&(r=to(r)),r.persist=Wd,r.isPropagationStopped=Gd,r.isDefaultPrevented=Vd,r.nativeEvent=r};var Ds,Kd={enumerable:!1,configurable:!0,get:function(){return this.class}},ro=V.vnode;V.vnode=function(r){typeof r.type=="string"&&function(e){var t=e.props,n=e.type,s={},i=n.indexOf("-")===-1;for(var o in t){var a=t[o];if(!(o==="value"&&"defaultValue"in t&&a==null||qd&&o==="children"&&n==="noscript"||o==="class"||o==="className")){var l=o.toLowerCase();o==="defaultValue"&&"value"in t&&t.value==null?o="value":o==="download"&&a===!0?a="":l==="translate"&&a==="no"?a=!1:l[0]==="o"&&l[1]==="n"?l==="ondoubleclick"?o="ondblclick":l!=="onchange"||n!=="input"&&n!=="textarea"||Fd(t.type)?l==="onfocus"?o="onfocusin":l==="onblur"?o="onfocusout":Ld.test(o)&&(o=l):l=o="oninput":i&&Dd.test(o)?o=o.replace(Md,"-$&").toLowerCase():a===null&&(a=void 0),l==="oninput"&&s[o=l]&&(o="oninputCapture"),s[o]=a}}n=="select"&&s.multiple&&Array.isArray(s.value)&&(s.value=xe(t.children).forEach(function(c){c.props.selected=s.value.indexOf(c.props.value)!=-1})),n=="select"&&s.defaultValue!=null&&(s.value=xe(t.children).forEach(function(c){c.props.selected=s.multiple?s.defaultValue.indexOf(c.props.value)!=-1:s.defaultValue==c.props.value})),t.class&&!t.className?(s.class=t.class,Object.defineProperty(s,"className",Kd)):(t.className&&!t.class||t.class&&t.className)&&(s.class=s.className=t.className),e.props=s}(r),r.$$typeof=El,ro&&ro(r)};var no=V.__r;V.__r=function(r){no&&no(r),Ds=r.__c};var so=V.diffed;V.diffed=function(r){so&&so(r);var e=r.props,t=r.__e;t!=null&&r.type==="textarea"&&"value"in e&&e.value!==t.value&&(t.value=e.value==null?"":e.value),Ds=null};var zd={ReactCurrentDispatcher:{current:{readContext:function(r){return Ds.__n[r.__c].props.value},useCallback:$s,useContext:Tr,useDebugValue:La,useDeferredValue:vl,useEffect:se,useId:Ma,useImperativeHandle:Da,useInsertionEffect:yl,useLayoutEffect:er,useMemo:tr,useReducer:ks,useRef:me,useState:q,useSyncExternalStore:_l,useTransition:ml}}};function Jd(r){return ke.bind(null,r)}function kr(r){return!!r&&r.$$typeof===El}function Yd(r){return kr(r)&&r.type===be}function Qd(r){return!!r&&!!r.displayName&&(typeof r.displayName=="string"||r.displayName instanceof String)&&r.displayName.startsWith("Memo(")}function Xd(r){return kr(r)?Ps.apply(null,arguments):r}function Zd(r){return!!r.__k&&(lt(null,r),!0)}function eh(r){return r&&(r.base||r.nodeType===1&&r)||null}var th=function(r,e){return r(e)},rh=function(r,e){return r(e)},nh=be,sh=kr,io={useState:q,useId:Ma,useReducer:ks,useEffect:se,useLayoutEffect:er,useInsertionEffect:yl,useTransition:ml,useDeferredValue:vl,useSyncExternalStore:_l,startTransition:gl,useRef:me,useImperativeHandle:Da,useMemo:tr,useCallback:$s,useContext:Tr,useDebugValue:La,version:"18.3.1",Children:Cd,render:Bd,hydrate:Hd,unmountComponentAtNode:Zd,createPortal:Nd,createElement:ke,createContext:Er,createFactory:Jd,cloneElement:Xd,createRef:Ra,Fragment:be,isValidElement:kr,isElement:sh,isFragment:Yd,isMemo:Qd,findDOMNode:eh,Component:Ce,PureComponent:gs,memo:Ad,forwardRef:Od,flushSync:rh,unstable_batchedUpdates:th,StrictMode:nh,Suspense:gr,SuspenseList:Ht,lazy:jd,__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:zd};const ih=r=>r;function oh(r,e=ih){const t=io.useSyncExternalStore(r.subscribe,()=>e(r.getState()),()=>e(r.getInitialState()));return io.useDebugValue(t),t}const oo=r=>{const e=$d(r),t=n=>oh(e,n);return Object.assign(t,e),t},ah=r=>r?oo(r):oo;function lh(r,e){let t;try{t=r()}catch{return}return{getItem:s=>{var i;const o=l=>l===null?null:JSON.parse(l,void 0),a=(i=t.getItem(s))!=null?i:null;return a instanceof Promise?a.then(o):o(a)},setItem:(s,i)=>t.setItem(s,JSON.stringify(i,void 0)),removeItem:s=>t.removeItem(s)}}const vs=r=>e=>{try{const t=r(e);return t instanceof Promise?t:{then(n){return vs(n)(t)},catch(n){return this}}}catch(t){return{then(n){return this},catch(n){return vs(n)(t)}}}},ch=(r,e)=>(t,n,s)=>{let i={storage:lh(()=>localStorage),partialize:v=>v,version:0,merge:(v,_)=>({..._,...v}),...e},o=!1;const a=new Set,l=new Set;let c=i.storage;if(!c)return r((...v)=>{console.warn(`[zustand persist middleware] Unable to update item '${i.name}', the given storage is currently unavailable.`),t(...v)},n,s);const h=()=>{const v=i.partialize({...n()});return c.setItem(i.name,{state:v,version:i.version})},u=s.setState;s.setState=(v,_)=>{u(v,_),h()};const f=r((...v)=>{t(...v),h()},n,s);s.getInitialState=()=>f;let p;const g=()=>{var v,_;if(!c)return;o=!1,a.forEach(b=>{var w;return b((w=n())!=null?w:f)});const y=((_=i.onRehydrateStorage)==null?void 0:_.call(i,(v=n())!=null?v:f))||void 0;return vs(c.getItem.bind(c))(i.name).then(b=>{if(b)if(typeof b.version=="number"&&b.version!==i.version){if(i.migrate){const w=i.migrate(b.state,b.version);return w instanceof Promise?w.then(E=>[!0,E]):[!0,w]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,b.state];return[!1,void 0]}).then(b=>{var w;const[E,S]=b;if(p=i.merge(S,(w=n())!=null?w:f),t(p,!0),E)return h()}).then(()=>{y?.(p,void 0),p=n(),o=!0,l.forEach(b=>b(p))}).catch(b=>{y?.(void 0,b)})};return s.persist={setOptions:v=>{i={...i,...v},v.storage&&(c=v.storage)},clearStorage:()=>{c?.removeItem(i.name)},getOptions:()=>i,rehydrate:()=>g(),hasHydrated:()=>o,onHydrate:v=>(a.add(v),()=>{a.delete(v)}),onFinishHydration:v=>(l.add(v),()=>{l.delete(v)})},i.skipHydration||g(),p||f},uh=ch,ms="https://image.tmdb.org/t/p/w500",dh=()=>window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"||window.location.port==="5173"?"http://localhost:3001/api":"/api",Te=dh();function ys(r){return r?`${Te}/image-proxy?url=${encodeURIComponent(r)}`:""}console.log(`🚀 API Base URL: ${Te}`);console.log("🌍 Environment: production");const qe=async()=>{let e=0;for(;e<2;)try{const t=new Promise((o,a)=>setTimeout(()=>a(new Error("Auth timeout")),5e3)),n=te.auth.getSession(),{data:{session:s},error:i}=await Promise.race([n,t]);if(i){if(console.error("Error getting current session:",i),i.message&&i.message.includes("NetworkError")&&e<1){e++,console.log(`Retrying auth session (attempt ${e+1}/2)`),await new Promise(o=>setTimeout(o,500*e));continue}return null}return s?.user?.id||null}catch(t){if(console.error("Error in getCurrentUserId:",t),t.message&&(t.message.includes("NetworkError")||t.message.includes("timeout"))&&e<1){e++,console.log(`Retrying auth due to network error (attempt ${e+1}/2)`),await new Promise(n=>setTimeout(n,500*e));continue}return null}return console.error("Failed to get user session after all retry attempts"),null},hh=async()=>{let e=0;for(;e<3;)try{const t=await qe();if(!t)return console.log("No authenticated user, returning empty watch history"),[];const n=new Promise((a,l)=>setTimeout(()=>l(new Error("Request timeout")),1e4)),s=te.from("watch_history").select("*").eq("user_id",t).order("watched_at",{ascending:!1}),{data:i,error:o}=await Promise.race([s,n]);if(o){if(console.error("Error fetching watch history:",o),o.message&&o.message.includes("NetworkError")&&e<2){e++,console.log(`Retrying watch history fetch (attempt ${e+1}/3)`),await new Promise(a=>setTimeout(a,1e3*e));continue}return[]}return i||[]}catch(t){if(console.error("Error in getWatchHistory:",t),t.message&&(t.message.includes("NetworkError")||t.message.includes("timeout"))&&e<2){e++,console.log(`Retrying watch history fetch due to network error (attempt ${e+1}/3)`),await new Promise(n=>setTimeout(n,1e3*e));continue}return[]}return console.error("Failed to fetch watch history after all retry attempts"),[]},Hr=async(r,e,t,n)=>{try{const s=await qe();if(!s)return console.log("No authenticated user, returning null progress"),null;let i=te.from("watch_progress").select("progress_seconds, duration_seconds").eq("user_id",s).eq("media_id",r).eq("media_type",e);e!=="movie"&&(i=i.eq("season_number",t).eq("episode_number",n));const{data:o,error:a}=await i;return a?(console.error("Error fetching watch progress:",a),null):o&&o.length>0?o[0]:null}catch(s){return console.error("Error in getWatchProgressForMedia:",s),null}},fh=async()=>{try{const r=await qe();if(!r)return console.log("No authenticated user, returning empty continue watching list"),[];console.log("🔍 Fetching continue watching from watch_history...");const{data:e,error:t}=await te.from("watch_history").select("media_id, media_type, season_number, episode_number, watched_at").eq("user_id",r).order("watched_at",{ascending:!1});if(t)return console.error("Error fetching watch history for continue watching:",t),[];if(!e||e.length===0)return console.log("📭 No watch history found"),[];console.log(`📊 Found ${e.length} watch history entries`);const n=new Map;e.forEach(c=>{const h=c.media_id;n.has(h)||n.set(h,[]),n.get(h).push(c)});const s=[];for(const[c,h]of n){const f=h.sort((p,g)=>p.media_type==="movie"?new Date(g.watched_at)-new Date(p.watched_at):p.season_number!==g.season_number?(g.season_number||0)-(p.season_number||0):(g.episode_number||0)-(p.episode_number||0))[0];console.log(`📺 Most advanced for media ${c}: S${f.season_number}E${f.episode_number} (${f.media_type})`),s.push(f)}const o=(await Promise.all(s.map(async c=>{try{let h=te.from("watch_progress").select("progress_seconds, duration_seconds, updated_at").eq("user_id",r).eq("media_id",c.media_id).eq("media_type",c.media_type);c.media_type!=="movie"&&(h=h.eq("season_number",c.season_number).eq("episode_number",c.episode_number));const{data:u,error:f}=await h;if(f)return console.error(`Error fetching progress for ${c.media_id}:`,f),null;const p=u&&u.length>0?u[0]:null,g=p&&p.progress_seconds>30,v=new Date(c.watched_at)>new Date(Date.now()-7*24*60*60*1e3);if(g||v){if(p&&p.duration_seconds>0&&p.progress_seconds/p.duration_seconds>=.9){if(c.media_type!=="movie"){const y=await Tl(c.media_id,c.season_number,c.episode_number,c.media_type);if(y)return console.log(`✅ Episode completed, suggesting next: S${y.season}E${y.episode}`),{...c,season_number:y.season,episode_number:y.episode,progress_seconds:0,duration_seconds:null,updated_at:p.updated_at}}return null}return{...c,progress_seconds:p?.progress_seconds||0,duration_seconds:p?.duration_seconds||null,updated_at:p?.updated_at||c.watched_at}}return null}catch(h){return console.error(`Error processing continue watching entry for ${c.media_id}:`,h),null}}))).filter(Boolean).sort((c,h)=>new Date(h.updated_at)-new Date(c.updated_at));console.log(`📺 Found ${o.length} valid continue watching entries`);const l=(await Promise.all(o.map(async c=>{try{const h=await fetch(`${Te}/tmdb/${c.media_type}/${c.media_id}`);return h.ok?{...await h.json(),type:c.media_type,progress_seconds:c.progress_seconds,duration_seconds:c.duration_seconds,season_number:c.season_number,episode_number:c.episode_number,updated_at:c.updated_at,media_id:c.media_id}:null}catch(h){return console.error("Error fetching TMDB details for continue watching item:",h),null}}))).filter(Boolean);return console.log(`🎬 Returning ${l.length} continue watching items`),l}catch(r){return console.error("Error in getContinueWatching:",r),[]}},ao=async(r,e,t,n=!1)=>{const s=await qe();if(!s)return console.error("❌ Cannot save watch progress: No authenticated user"),!1;if(!r||typeof e>"u"||e<0)return console.error("❌ Invalid progress data:",{item:r,progress:e,durationInSeconds:t}),!1;const i={p_media_id:r.id,p_media_type:r.type,p_season_number:r.season||null,p_episode_number:r.episode||null,p_progress_seconds:e>0?Math.ceil(e):0,p_duration_seconds:t?Math.round(t):null,p_force_history_entry:n};console.log("💾 Saving watch progress (v2)...",i);const{error:o}=await te.rpc("save_watch_progress",i);if(!o)return console.log("✅ Watch progress saved successfully via RPC (v2)"),!0;console.warn(`⚠️ RPC (v2) failed, trying legacy (v1). Error: ${o.message}`);const{p_force_history_entry:a,...l}=i,{error:c}=await te.rpc("save_watch_progress",l);if(!c)return console.log("✅ Watch progress saved successfully via RPC (v1)"),!0;console.warn(`⚠️ RPC (v1) also failed, attempting direct DB write. Error: ${c.message}`);try{if(await ph(s,r,e,t,n))return!0}catch(h){console.error("❌ Direct DB write fallback threw an exception:",h)}return console.error("❌ All methods to save progress failed."),!1},ph=async(r,e,t,n,s)=>{try{console.log("🔄 Using direct database fallback for watch progress");const{error:i}=await te.from("watch_progress").upsert({user_id:r,media_id:e.id,media_type:e.type,season_number:e.season||null,episode_number:e.episode||null,progress_seconds:t>0?Math.ceil(t):0,duration_seconds:n?Math.round(n):null,updated_at:new Date().toISOString()},{onConflict:"user_id,media_id,media_type,season_number,episode_number"});if(i)return console.error("❌ Direct progress insert error:",i),!1;if(s||t>60){const{error:o}=await te.from("watch_history").upsert({user_id:r,media_id:e.id,media_type:e.type,season_number:e.season||null,episode_number:e.episode||null,watched_at:new Date().toISOString()},{onConflict:"user_id,media_id,media_type,season_number,episode_number"});o&&console.error("❌ Direct history insert error:",o)}return console.log("✅ Watch progress saved via direct database fallback"),!0}catch(i){return console.error("❌ Direct database fallback failed:",i),!1}},lo=async r=>{try{const e=await qe();if(!e){console.log("Cannot add watch history entry: No authenticated user");return}if(!r)return;const{error:t}=await te.from("watch_history").upsert({user_id:e,media_id:r.id,media_type:r.type,season_number:r.season||null,episode_number:r.episode||null,watched_at:new Date().toISOString()},{onConflict:"user_id,media_id,media_type,season_number,episode_number"});t&&console.error("Error adding watch history entry:",t)}catch(e){console.error("Unexpected error adding watch history entry:",e)}},_h=async r=>{try{if(!r)return;if(!await qe()){console.log("Cannot delete watch item: No authenticated user");return}const{error:t}=await te.rpc("delete_watch_item",{p_media_id:r.media_id,p_media_type:r.media_type,p_season_number:r.season_number,p_episode_number:r.episode_number});t&&console.error("Error deleting watch item:",t)}catch(e){console.error("Error in deleteWatchItem:",e)}},gh=async r=>{try{const e=await qe();if(!e)return[];const{data:t,error:n}=await te.from("watch_progress").select("media_id, media_type, season_number, episode_number, progress_seconds, duration_seconds").eq("user_id",e).eq("media_id",r);return n?(console.error("Error fetching series history:",n),[]):t||[]}catch(e){return console.error("Error in getSeriesHistory:",e),[]}},Tl=async(r,e,t,n="tv")=>{try{const s=n==="anime"?"tv":n,i=await fetch(`${Te}/tmdb/${s}/${r}`);if(!i.ok)return console.error(`Failed to fetch series details: ${i.status}`),null;const o=await i.json();if(!o.seasons||o.seasons.length===0)return console.error("No seasons found in series details"),null;const a=await fetch(`${Te}/tmdb/${s}/${r}/season/${e}`);if(!a.ok)return console.error(`Failed to fetch season ${e} details: ${a.status}`),null;const l=await a.json();if(!l.episodes||l.episodes.length===0)return console.error(`No episodes found in season ${e}`),null;const c=l.episodes.length;if(console.log(`Current season ${e} has ${c} episodes, current episode: ${t}`),t<c)return console.log(`Next episode: S${e}E${t+1}`),{season:e,episode:t+1};const u=o.seasons.filter(f=>f.season_number>0).find(f=>f.season_number===e+1);return u&&u.episode_count>0?(console.log(`Next season found: S${u.season_number}E1`),{season:u.season_number,episode:1}):(console.log("No next episode available - series may be completed"),null)}catch(s){return console.error("Error getting next episode:",s),null}},vh=async r=>{try{const e=await qe();if(!e)return console.log("No authenticated user, returning null for last watched episode with progress"),null;console.log(`🔍 Looking for last watched episode for series ${r} from watch_history`);const{data:t,error:n}=await te.from("watch_history").select("season_number, episode_number, watched_at, media_type").eq("user_id",e).eq("media_id",r).order("watched_at",{ascending:!1});if(n)return console.error("Error fetching watch history:",n),null;if(!t||t.length===0)return console.log("📭 No episodes found in watch history"),null;console.log(`📊 Found ${t.length} episodes in watch history for series ${r}`);const i=t.sort((c,h)=>c.season_number!==h.season_number?h.season_number-c.season_number:h.episode_number-c.episode_number)[0];console.log(`📺 Most advanced episode from history: S${i.season_number}E${i.episode_number} (watched: ${i.watched_at})`);const{data:o,error:a}=await te.from("watch_progress").select("progress_seconds, duration_seconds, updated_at").eq("user_id",e).eq("media_id",r).eq("season_number",i.season_number).eq("episode_number",i.episode_number);if(a)return console.error("Error fetching progress data:",a),{season:i.season_number,episode:i.episode_number};const l=o&&o.length>0?o[0]:null;if(l){console.log(`📊 Progress data found: ${l.progress_seconds}/${l.duration_seconds}s`);let c=!1;if(l.duration_seconds>0){const h=l.progress_seconds/l.duration_seconds;c=h>=.9,console.log(`📊 Completion: ${(h*100).toFixed(1)}% - ${c?"COMPLETED":"INCOMPLETE"}`)}if(c){console.log(`✅ Most advanced episode S${i.season_number}E${i.episode_number} was completed, finding next episode`);const h=await Tl(r,i.season_number,i.episode_number,i.media_type);return h?(console.log(`🎯 Next episode found: S${h.season}E${h.episode}`),h):(console.log('🏁 No next episode available, series may be completed. No "continue watching" will be triggered.'),null)}else return console.log(`⏯️ Resuming incomplete episode S${i.season_number}E${i.episode_number}`),{season:i.season_number,episode:i.episode_number}}else return console.log(`📝 No progress data, but episode is in watch history: S${i.season_number}E${i.episode_number}`),{season:i.season_number,episode:i.episode_number}}catch(e){return console.error("Error in getLastWatchedEpisodeWithProgress:",e),null}},Pl=async r=>{try{const e=await qe();if(!e||!r||r.length===0)return{};const t={};return await Promise.all(r.map(async n=>{try{let s=te.from("watch_progress").select("progress_seconds, duration_seconds").eq("user_id",e).eq("media_id",n.media_id).eq("media_type",n.media_type);n.media_type==="tv"&&(n.season_number!=null&&(s=s.eq("season_number",n.season_number)),n.episode_number!=null&&(s=s.eq("episode_number",n.episode_number)));const{data:i,error:o}=await s;if(o)console.error(`Error fetching progress for ${n.media_type} ${n.media_id}:`,o);else if(i&&i.length>0){const a=i[0],l=`${n.media_id}-${n.media_type}-${n.season_number||0}-${n.episode_number||0}`;a.progress_seconds>=0&&a.duration_seconds>0&&(t[l]={progress_seconds:a.progress_seconds,duration_seconds:a.duration_seconds})}}catch(s){console.error(`Error fetching progress for item ${n.media_id}:`,s)}})),t}catch(e){return console.error("Error in getProgressForHistoryItems:",e),{}}},mh=async()=>{let e=0;for(;e<3;)try{const t=await qe();if(!t)return console.log("No authenticated user, returning empty watch history with progress"),[];console.log("🔄 Fetching combined watch history and progress data...");const[n,s]=await Promise.all([te.from("watch_history").select("*").eq("user_id",t).order("watched_at",{ascending:!1}),te.from("watch_progress").select("media_id, media_type, season_number, episode_number, progress_seconds, duration_seconds").eq("user_id",t)]);if(n.error)throw n.error;s.error&&console.warn("Error fetching progress data, continuing without progress:",s.error);const i=n.data||[],o=s.data||[],a={};o.forEach(c=>{const h=`${c.media_id}-${c.media_type}-${c.season_number||0}-${c.episode_number||0}`;a[h]=c});const l=i.map(c=>{const h=`${c.media_id}-${c.media_type}-${c.season_number||0}-${c.episode_number||0}`,u=a[h];return{...c,progress_seconds:u?.progress_seconds||null,duration_seconds:u?.duration_seconds||null}});return console.log("✅ Successfully fetched combined data:",{totalItems:l.length,itemsWithProgress:l.filter(c=>c.progress_seconds>0).length}),l}catch(t){if(console.error("Error in getWatchHistoryWithProgress:",t),t.message&&(t.message.includes("NetworkError")||t.message.includes("timeout"))&&e<2){e++,console.log(`Retrying combined fetch due to network error (attempt ${e+1}/3)`),await new Promise(n=>setTimeout(n,1e3*e));continue}try{console.log("📋 All retries failed, trying fallback approach...");const n=await hh(),s=await Pl(n);return n.map(i=>{const o=`${i.media_id}-${i.media_type}-${i.season_number||0}-${i.episode_number||0}`,a=s[o];return{...i,progress_seconds:a?.progress_seconds||null,duration_seconds:a?.duration_seconds||null}})}catch(n){return console.error("Fallback approach also failed:",n),[]}}return console.error("Failed to fetch combined watch history and progress after all retry attempts"),[]},nt=async(r,e=3)=>{let t=[];for(let n=1;n<=e;n++)try{const s=await fetch(`${r}?page=${n}`);if(s.ok){const i=await s.json();t=[...t,...i.results||[]]}}catch(s){console.error(`Error fetching page ${n} from ${r}:`,s)}return t},xt=ah(uh((r,e)=>({trending:[],popularMovies:[],popularTv:[],topRatedMovies:[],topRatedTv:[],upcomingMovies:[],nowPlayingMovies:[],airingTodayTv:[],favorites:[],favoritesFetched:!1,currentMediaItem:null,continueWatching:[],continueWatchingFetched:!1,fetchContinueWatching:async()=>{const{data:{user:t}}=await te.auth.getUser();if(!t){r({continueWatching:[],continueWatchingFetched:!0});return}const n=await fh();if(!n||n.length===0){r({continueWatching:[],continueWatchingFetched:!0});return}const s=n.reduce((i,o)=>(i.some(a=>a.media_id===o.media_id)||i.push(o),i),[]);r({continueWatching:s,continueWatchingFetched:!0})},removeContinueWatchingItem:t=>{r(n=>({continueWatching:n.continueWatching.filter(s=>s.media_id!==t)}))},setCurrentMediaItem:t=>r({currentMediaItem:t}),fetchTrending:async()=>{if(!(e().trending.length>0))try{const t=await fetch("/api/tmdb/trending/all/week");if(t.ok){const n=await t.json();r({trending:n.results||[]})}}catch(t){console.error("Error fetching trending:",t)}},fetchPopularMovies:async()=>{if(e().popularMovies.length>0)return;const t=await nt("/api/tmdb/movie/popular");r({popularMovies:t})},fetchPopularTv:async()=>{if(e().popularTv.length>0)return;const t=await nt("/api/tmdb/tv/popular");r({popularTv:t})},fetchTopRatedMovies:async()=>{if(e().topRatedMovies.length>0)return;const t=await nt("/api/tmdb/movie/top_rated");r({topRatedMovies:t})},fetchTopRatedTv:async()=>{if(e().topRatedTv.length>0)return;const t=await nt("/api/tmdb/tv/top_rated");r({topRatedTv:t})},fetchUpcomingMovies:async()=>{if(e().upcomingMovies.length>0)return;const t=await nt("/api/tmdb/movie/upcoming");r({upcomingMovies:t})},fetchNowPlayingMovies:async()=>{if(e().nowPlayingMovies.length>0)return;const t=await nt("/api/tmdb/movie/now_playing");r({nowPlayingMovies:t})},fetchAiringTodayTv:async()=>{if(e().airingTodayTv.length>0)return;const t=await nt("/api/tmdb/tv/airing_today");r({airingTodayTv:t})},fetchFavorites:async()=>{const{data:{user:t}}=await te.auth.getUser();if(!t){r({favorites:[],favoritesFetched:!0});return}const{data:n,error:s}=await te.from("favorites").select("media_id, media_type, season_number, episode_number, episode_name").eq("user_id",t.id);if(s){console.error("Error fetching favorites:",s),r({favoritesFetched:!0});return}const i=await Promise.all(n.map(async o=>{const a=await fetch(`/api/tmdb/${o.media_type}/${o.media_id}`);if(a.ok){const l=await a.json();if(o.media_type==="tv"&&o.season_number&&o.episode_number){try{const c=await fetch(`/api/tmdb/tv/${o.media_id}/season/${o.season_number}/episode/${o.episode_number}`);if(c.ok){const h=await c.json();return{...l,type:o.media_type,season_number:o.season_number,episode_number:o.episode_number,episode_name:h.name||o.episode_name,still_path:h.still_path,vote_average:h.vote_average||l.vote_average,overview:h.overview||l.overview}}}catch(c){console.error("Error fetching episode details:",c)}return{...l,type:o.media_type,season_number:o.season_number,episode_number:o.episode_number,episode_name:o.episode_name}}return{...l,type:o.media_type}}return null}));r({favorites:i.filter(Boolean),favoritesFetched:!0})},addFavorite:async t=>{const{data:{user:n}}=await te.auth.getUser();if(!n)return;r(o=>({favorites:[t,...o.favorites]}));const s={user_id:n.id,media_id:t.id,media_type:t.type};t.type==="tv"&&t.season_number&&t.episode_number&&(s.season_number=t.season_number,s.episode_number=t.episode_number,s.episode_name=t.episode_name);const{error:i}=await te.from("favorites").insert(s);i&&(console.error("Error adding favorite:",i),r(o=>({favorites:o.favorites.filter(a=>a.id!==t.id||a.season_number!==t.season_number||a.episode_number!==t.episode_number)})))},removeFavorite:async(t,n=null,s=null)=>{const{data:{user:i}}=await te.auth.getUser();if(!i)return;const o=e().favorites;r(c=>({favorites:c.favorites.filter(h=>!(h.id===t&&h.season_number===n&&h.episode_number===s))}));const a=te.from("favorites").delete().match({user_id:i.id,media_id:t});n!==null&&s!==null?a.match({season_number:n,episode_number:s}):a.is("season_number",null).is("episode_number",null);const{error:l}=await a;l&&(console.error("Error removing favorite:",l),r({favorites:o}))},isFavorited:(t,n=null,s=null)=>{const{favorites:i,favoritesFetched:o}=e();return o?i.some(a=>a.id===t&&a.season_number===n&&a.episode_number===s):!1}}),{name:"freestream-storage",storage:localStorage,partialize:r=>({favorites:r.favorites,trending:r.trending,popularMovies:r.popularMovies,popularTv:r.popularTv,topRatedMovies:r.topRatedMovies,topRatedTv:r.topRatedTv,upcomingMovies:r.upcomingMovies,nowPlayingMovies:r.nowPlayingMovies,airingTodayTv:r.airingTodayTv,continueWatching:r.continueWatching})})),jt=({item:r,type:e,progress:t,duration:n,showDeleteButton:s,onDelete:i})=>{const{id:o,title:a,name:l,poster_path:c,still_path:h,vote_average:u,episode_name:f,season_number:p,episode_number:g,first_air_date:v,release_date:_,number_of_seasons:y}=r,b=h||c,w=l||a,E=t&&n>0?t/n*100:0,S=_||v?new Date(_||v).getFullYear():null,{addFavorite:C,removeFavorite:I,isFavorited:A}=xt(),U=A(r.id,r.season_number,r.episode_number),Q=re=>{re.preventDefault(),re.stopPropagation(),U?I(r.id,r.season_number,r.episode_number):C({...r,type:e})};let L=`/watch/${e}/${r.id}`;e==="tv"&&r.season_number&&r.episode_number&&(L+=`/season/${r.season_number}/episode/${r.episode_number}`);const le=e==="tv"&&p&&g?`S${p} E${g}${f?`: ${f}`:""}`:e==="tv"&&y?`${S||"Unknown"} • ${y} Season${y!==1?"s":""}`:e==="movie"&&S?S.toString():null;return d("div",{className:"movie-card-container",children:d(Qe,{href:L,className:"movie-card",children:d("div",{className:"poster-wrapper",children:[d("img",{src:ys(b?`${ms}${b}`:"https://via.placeholder.com/500x750/1a1a1a/ffffff?text=No+Image"),alt:w,loading:"lazy"}),d("div",{className:"scrim"}),E>.01&&d("div",{className:"progress-bar-container",children:d("div",{className:"progress-bar",style:{width:`${Math.min(E,100)}%`}})}),d("div",{className:"card-info",children:[d("div",{className:"title-row",children:[d("h3",{className:"card-title",children:w}),d("button",{className:`favorite-btn ${U?"favorited":""}`,onClick:Q,children:U?"♥":"♡"})]}),le&&d("p",{className:"card-subtitle",children:le}),d("span",{className:"rating",children:["★ ",u?u.toFixed(1):"N/A"]})]}),s&&d("button",{className:"delete-btn",onClick:re=>{re.preventDefault(),re.stopPropagation(),i&&i(r)},children:"×"})]})})})},yh=()=>d("div",{class:"features-showcase",children:[d("div",{class:"features-hero",children:d("div",{class:"features-hero-content",children:[d("h2",{class:"features-title",children:d("span",{class:"gradient-text",children:"Sign in for the full experience"})}),d("p",{class:"features-subtitle",children:"Get personalized recommendations, track your progress, and never lose your place"})]})}),d("div",{class:"features-grid",children:[{icon:"⏯️",title:"Continue Watching",description:"Pick up exactly where you left off across all your devices. Never lose your place again.",highlight:!0},{icon:"❤️",title:"Favorites Collection",description:"Save your favorite movies and TV shows in one place for quick access anytime.",highlight:!1},{icon:"📚",title:"Watch History",description:"Keep track of everything you've watched and easily find content you enjoyed.",highlight:!1},{icon:"🎯",title:"Personal Progress",description:"Sync your watch progress across devices and resume on any screen seamlessly.",highlight:!1},{icon:"🔍",title:"Smart Recommendations",description:"Get personalized suggestions based on your viewing history and preferences.",highlight:!1},{icon:"⚡",title:"Enhanced Experience",description:"Unlock the full potential of FreeStream with user-specific features and settings.",highlight:!1}].map((e,t)=>d("div",{class:`feature-card ${e.highlight?"featured":""}`,children:[d("div",{class:"feature-icon",children:e.icon}),d("h3",{class:"feature-title",children:e.title}),d("p",{class:"feature-description",children:e.description})]},t))}),d("div",{class:"features-footer",children:[d("div",{class:"features-stats",children:[d("div",{class:"stat",children:[d("span",{class:"stat-number",children:"10K+"}),d("span",{class:"stat-label",children:"Movies & Shows"})]}),d("div",{class:"stat",children:[d("span",{class:"stat-number",children:"4K"}),d("span",{class:"stat-label",children:"Ultra HD Quality"})]}),d("div",{class:"stat",children:[d("span",{class:"stat-number",children:"∞"}),d("span",{class:"stat-label",children:"Unlimited Access"})]})]}),d("p",{class:"features-note",children:[d(Le,{href:"/login",class:"subtle-link",children:"Sign in"})," or ",d(Le,{href:"/signup",class:"subtle-link",children:"create an account"})," to unlock these features"]})]})]}),kl=({size:r="medium",text:e="Loading..."})=>{const t={small:"spinner-small",medium:"spinner-medium",large:"spinner-large"}[r];return d("div",{class:"loading-container",children:[d("div",{class:`loading-spinner ${t}`,children:[d("div",{class:"spinner-ring"}),d("div",{class:"spinner-ring"}),d("div",{class:"spinner-ring"}),d("div",{class:"spinner-ring"})]}),e&&d("p",{class:"loading-text",children:e})]})},bh=()=>{const{user:r}=ut();if(!r)return null;const e=()=>{const n=new Date().getHours();return n<12?"Good morning":n<17?"Good afternoon":"Good evening"},t=()=>r.user_metadata?.full_name?r.user_metadata.full_name.split(" ")[0]:r.email.split("@")[0];return d("div",{class:"welcome-message",children:[d("div",{class:"welcome-content",children:[d("h2",{class:"welcome-title",children:[e(),", ",d("span",{class:"user-name",children:t()}),"!"]}),d("p",{class:"welcome-subtitle",children:"What would you like to watch today?"})]}),d("div",{class:"welcome-stats",children:[d("div",{class:"stat-item",children:[d("span",{class:"stat-icon",children:"🎬"}),d("span",{class:"stat-text",children:"Unlimited Movies"})]}),d("div",{class:"stat-item",children:[d("span",{class:"stat-icon",children:"📺"}),d("span",{class:"stat-text",children:"TV Shows"})]}),d("div",{class:"stat-item",children:[d("span",{class:"stat-icon",children:"⚡"}),d("span",{class:"stat-text",children:"HD Streaming"})]})]})]})},Wr=r=>{const{trending:e,popularMovies:t,popularTv:n,topRatedMovies:s,topRatedTv:i,upcomingMovies:o,nowPlayingMovies:a,airingTodayTv:l,fetchTrending:c,fetchPopularMovies:h,fetchPopularTv:u,fetchTopRatedMovies:f,fetchTopRatedTv:p,fetchUpcomingMovies:g,fetchNowPlayingMovies:v,fetchAiringTodayTv:_,continueWatching:y,continueWatchingFetched:b,fetchContinueWatching:w}=xt(),{user:E}=ut(),[S,C]=q("all");se(()=>{r.path==="/movies"?C("movie"):r.path==="/tv"?C("tv"):C("all")},[r.path]),se(()=>{c(),h(),u(),f(),p(),g(),v(),_()},[c,h,u,f,p,g,v,_]),se(()=>{E&&!b&&w()},[E,b,w]);const I=(A,U,Q)=>!U||U.length===0?null:d("section",{class:"home-section",children:[d("h2",{children:A}),d("div",{class:"scrolling-row",children:U.map(L=>d(jt,{item:L,type:Q||L.media_type},`${A}-${L.id}`))})]});return d("div",{class:"container home-page",children:[d("h1",{class:"main-title",children:[S==="movie"&&"Movies",S==="tv"&&"TV Shows",S==="all"&&"Discover"]}),!E&&S==="all"&&d(be,{children:[d("div",{class:"guest-info-banner",style:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"8px",padding:"16px",marginBottom:"24px",textAlign:"center"},children:[d("h3",{style:{margin:"0 0 8px 0",color:"var(--text-primary)"},children:"🎬 Start Streaming Instantly"}),d("p",{style:{margin:"0",color:"var(--text-secondary)"},children:["No account required! Click any movie or TV show to start watching immediately.",d("a",{href:"/login",style:{color:"var(--accent-color)",textDecoration:"none",marginLeft:"4px"},children:"Sign up"})," to save favorites, track progress, and continue watching across devices."]})]}),d(yh,{})]}),E&&S==="all"&&d(bh,{}),b?y.length>0&&d("section",{class:"home-section",children:[d("h2",{children:"Continue Watching"}),d("div",{class:"scrolling-row scrolling-row--compact",children:y.map(A=>d(jt,{item:A,type:A.type,progress:A.progress_seconds,duration:A.duration_seconds},`continue-watching-${A.type}-${A.id}`))})]}):d(kl,{text:"Loading your continue watching..."}),S==="all"&&I("Trending This Week",e,"movie"),S!=="tv"&&I("Popular Movies",t,"movie"),S!=="tv"&&I("Now Playing Movies",a,"movie"),S!=="movie"&&I("Popular TV Shows",n,"tv"),(S==="all"||S==="movie")&&I("Top Rated Movies",s,"movie"),(S==="all"||S==="movie")&&I("Upcoming Movies",o,"movie"),(S==="all"||S==="tv")&&I("Top Rated TV Shows",i,"tv"),(S==="all"||S==="tv")&&I("Airing Today",l,"tv")]})};var pr={exports:{}};const $l=Va(Xl);var Gr,co;function wh(){if(co)return Gr;co=1;var r=$l;function e(i,o){var a={};for(var l in i)o.indexOf(l)>=0||Object.prototype.hasOwnProperty.call(i,l)&&(a[l]=i[l]);return a}function t(i,o){if(!(i instanceof o))throw new TypeError("Cannot call a class as a function")}function n(i,o){if(!i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o&&(typeof o=="object"||typeof o=="function")?o:i}function s(i,o){if(typeof o!="function"&&o!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof o);i.prototype=Object.create(o&&o.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),o&&(Object.setPrototypeOf?Object.setPrototypeOf(i,o):i.__proto__=o)}return Gr=function(o,a,l){if(typeof o!="function")throw new Error("Expected reducePropsToState to be a function.");if(typeof a!="function")throw new Error("Expected handleStateChangeOnClient to be a function.");if(typeof l<"u"&&typeof l!="function")throw new Error("Expected mapStateOnServer to either be undefined or a function.");function c(u){return u.displayName||u.name||"Component"}return function(f){if(typeof f!="function")throw new Error("Expected WrappedComponent to be a React component.");var p=[],g=void 0;function v(){g=o(p.map(function(y){return y.props})),_.canUseDOM?a(g):l&&(g=l(g))}var _=function(y){s(b,y);function b(){return t(this,b),n(this,y.apply(this,arguments))}return b.peek=function(){return g},b.rewind=function(){if(b.canUseDOM)throw new Error("You may only call rewind() on the server. Call peek() to read the current state.");var E=g;return g=void 0,p=[],E},b.prototype.shouldComponentUpdate=function(E){var S=E.children,C=e(E,["children"]);return S&&S.length&&(C.children=S),h(C,this.props)},b.prototype.componentWillMount=function(){p.push(this),v()},b.prototype.componentDidUpdate=function(){v()},b.prototype.componentWillUnmount=function(){var E=p.indexOf(this);p.splice(E,1),v()},b.prototype.render=function(){return(0,r.h)(f,this.props)},b}(r.Component);return _.displayName="SideEffect("+c(f)+")",_.canUseDOM=!!(typeof window<"u"&&window.document&&window.document.createElement),_};function h(u,f){for(var p in u)if(!(p in f))return!0;for(var g in f)if(u[g]!==f[g])return!0;return!1}},Gr}var Vr,uo;function Al(){if(uo)return Vr;uo=1;var r=Object.prototype.toString;return Vr=function(t){var n=r.call(t),s=n==="[object Arguments]";return s||(s=n!=="[object Array]"&&t!==null&&typeof t=="object"&&typeof t.length=="number"&&t.length>=0&&r.call(t.callee)==="[object Function]"),s},Vr}var Kr,ho;function Sh(){if(ho)return Kr;ho=1;var r;if(!Object.keys){var e=Object.prototype.hasOwnProperty,t=Object.prototype.toString,n=Al(),s=Object.prototype.propertyIsEnumerable,i=!s.call({toString:null},"toString"),o=s.call(function(){},"prototype"),a=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],l=function(f){var p=f.constructor;return p&&p.prototype===f},c={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},h=function(){if(typeof window>"u")return!1;for(var f in window)try{if(!c["$"+f]&&e.call(window,f)&&window[f]!==null&&typeof window[f]=="object")try{l(window[f])}catch{return!0}}catch{return!0}return!1}(),u=function(f){if(typeof window>"u"||!h)return l(f);try{return l(f)}catch{return!1}};r=function(p){var g=p!==null&&typeof p=="object",v=t.call(p)==="[object Function]",_=n(p),y=g&&t.call(p)==="[object String]",b=[];if(!g&&!v&&!_)throw new TypeError("Object.keys called on a non-object");var w=o&&v;if(y&&p.length>0&&!e.call(p,0))for(var E=0;E<p.length;++E)b.push(String(E));if(_&&p.length>0)for(var S=0;S<p.length;++S)b.push(String(S));else for(var C in p)!(w&&C==="prototype")&&e.call(p,C)&&b.push(String(C));if(i)for(var I=u(p),A=0;A<a.length;++A)!(I&&a[A]==="constructor")&&e.call(p,a[A])&&b.push(a[A]);return b}}return Kr=r,Kr}var zr,fo;function Rl(){if(fo)return zr;fo=1;var r=Array.prototype.slice,e=Al(),t=Object.keys,n=t?function(o){return t(o)}:Sh(),s=Object.keys;return n.shim=function(){if(Object.keys){var o=function(){var a=Object.keys(arguments);return a&&a.length===arguments.length}(1,2);o||(Object.keys=function(l){return e(l)?s(r.call(l)):s(l)})}else Object.keys=n;return Object.keys||n},zr=n,zr}var Jr,po;function Ol(){return po||(po=1,Jr=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var e={},t=Symbol("test"),n=Object(t);if(typeof t=="string"||Object.prototype.toString.call(t)!=="[object Symbol]"||Object.prototype.toString.call(n)!=="[object Symbol]")return!1;var s=42;e[t]=s;for(var i in e)return!1;if(typeof Object.keys=="function"&&Object.keys(e).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(e).length!==0)return!1;var o=Object.getOwnPropertySymbols(e);if(o.length!==1||o[0]!==t||!Object.prototype.propertyIsEnumerable.call(e,t))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var a=Object.getOwnPropertyDescriptor(e,t);if(a.value!==s||a.enumerable!==!0)return!1}return!0}),Jr}var Yr,_o;function Ls(){if(_o)return Yr;_o=1;var r=Ol();return Yr=function(){return r()&&!!Symbol.toStringTag},Yr}var Qr,go;function Cl(){return go||(go=1,Qr=Object),Qr}var Xr,vo;function xl(){return vo||(vo=1,Xr=Error),Xr}var Zr,mo;function Eh(){return mo||(mo=1,Zr=EvalError),Zr}var en,yo;function Th(){return yo||(yo=1,en=RangeError),en}var tn,bo;function Ph(){return bo||(bo=1,tn=ReferenceError),tn}var rn,wo;function jl(){return wo||(wo=1,rn=SyntaxError),rn}var nn,So;function Nt(){return So||(So=1,nn=TypeError),nn}var sn,Eo;function kh(){return Eo||(Eo=1,sn=URIError),sn}var on,To;function $h(){return To||(To=1,on=Math.abs),on}var an,Po;function Ah(){return Po||(Po=1,an=Math.floor),an}var ln,ko;function Rh(){return ko||(ko=1,ln=Math.max),ln}var cn,$o;function Oh(){return $o||($o=1,cn=Math.min),cn}var un,Ao;function Ch(){return Ao||(Ao=1,un=Math.pow),un}var dn,Ro;function xh(){return Ro||(Ro=1,dn=Math.round),dn}var hn,Oo;function jh(){return Oo||(Oo=1,hn=Number.isNaN||function(e){return e!==e}),hn}var fn,Co;function Ih(){if(Co)return fn;Co=1;var r=jh();return fn=function(t){return r(t)||t===0?t:t<0?-1:1},fn}var pn,xo;function Uh(){return xo||(xo=1,pn=Object.getOwnPropertyDescriptor),pn}var _n,jo;function Dt(){if(jo)return _n;jo=1;var r=Uh();if(r)try{r([],"length")}catch{r=null}return _n=r,_n}var gn,Io;function $r(){if(Io)return gn;Io=1;var r=Object.defineProperty||!1;if(r)try{r({},"a",{value:1})}catch{r=!1}return gn=r,gn}var vn,Uo;function Nh(){if(Uo)return vn;Uo=1;var r=typeof Symbol<"u"&&Symbol,e=Ol();return vn=function(){return typeof r!="function"||typeof Symbol!="function"||typeof r("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:e()},vn}var mn,No;function Il(){return No||(No=1,mn=typeof Reflect<"u"&&Reflect.getPrototypeOf||null),mn}var yn,Do;function Ul(){if(Do)return yn;Do=1;var r=Cl();return yn=r.getPrototypeOf||null,yn}var bn,Lo;function Dh(){if(Lo)return bn;Lo=1;var r="Function.prototype.bind called on incompatible ",e=Object.prototype.toString,t=Math.max,n="[object Function]",s=function(l,c){for(var h=[],u=0;u<l.length;u+=1)h[u]=l[u];for(var f=0;f<c.length;f+=1)h[f+l.length]=c[f];return h},i=function(l,c){for(var h=[],u=c,f=0;u<l.length;u+=1,f+=1)h[f]=l[u];return h},o=function(a,l){for(var c="",h=0;h<a.length;h+=1)c+=a[h],h+1<a.length&&(c+=l);return c};return bn=function(l){var c=this;if(typeof c!="function"||e.apply(c)!==n)throw new TypeError(r+c);for(var h=i(arguments,1),u,f=function(){if(this instanceof u){var y=c.apply(this,s(h,arguments));return Object(y)===y?y:this}return c.apply(l,s(h,arguments))},p=t(0,c.length-h.length),g=[],v=0;v<p;v++)g[v]="$"+v;if(u=Function("binder","return function ("+o(g,",")+"){ return binder.apply(this,arguments); }")(f),c.prototype){var _=function(){};_.prototype=c.prototype,u.prototype=new _,_.prototype=null}return u},bn}var wn,Mo;function sr(){if(Mo)return wn;Mo=1;var r=Dh();return wn=Function.prototype.bind||r,wn}var Sn,qo;function Ms(){return qo||(qo=1,Sn=Function.prototype.call),Sn}var En,Fo;function qs(){return Fo||(Fo=1,En=Function.prototype.apply),En}var Tn,Bo;function Lh(){return Bo||(Bo=1,Tn=typeof Reflect<"u"&&Reflect&&Reflect.apply),Tn}var Pn,Ho;function Nl(){if(Ho)return Pn;Ho=1;var r=sr(),e=qs(),t=Ms(),n=Lh();return Pn=n||r.call(t,e),Pn}var kn,Wo;function Fs(){if(Wo)return kn;Wo=1;var r=sr(),e=Nt(),t=Ms(),n=Nl();return kn=function(i){if(i.length<1||typeof i[0]!="function")throw new e("a function is required");return n(r,t,i)},kn}var $n,Go;function Mh(){if(Go)return $n;Go=1;var r=Fs(),e=Dt(),t;try{t=[].__proto__===Array.prototype}catch(o){if(!o||typeof o!="object"||!("code"in o)||o.code!=="ERR_PROTO_ACCESS")throw o}var n=!!t&&e&&e(Object.prototype,"__proto__"),s=Object,i=s.getPrototypeOf;return $n=n&&typeof n.get=="function"?r([n.get]):typeof i=="function"?function(a){return i(a==null?a:s(a))}:!1,$n}var An,Vo;function Dl(){if(Vo)return An;Vo=1;var r=Il(),e=Ul(),t=Mh();return An=r?function(s){return r(s)}:e?function(s){if(!s||typeof s!="object"&&typeof s!="function")throw new TypeError("getProto: not an object");return e(s)}:t?function(s){return t(s)}:null,An}var Rn,Ko;function Ll(){if(Ko)return Rn;Ko=1;var r=Function.prototype.call,e=Object.prototype.hasOwnProperty,t=sr();return Rn=t.call(r,e),Rn}var On,zo;function Ml(){if(zo)return On;zo=1;var r,e=Cl(),t=xl(),n=Eh(),s=Th(),i=Ph(),o=jl(),a=Nt(),l=kh(),c=$h(),h=Ah(),u=Rh(),f=Oh(),p=Ch(),g=xh(),v=Ih(),_=Function,y=function(N){try{return _('"use strict"; return ('+N+").constructor;")()}catch{}},b=Dt(),w=$r(),E=function(){throw new a},S=b?function(){try{return arguments.callee,E}catch{try{return b(arguments,"callee").get}catch{return E}}}():E,C=Nh()(),I=Dl(),A=Ul(),U=Il(),Q=qs(),L=Ms(),X={},le=typeof Uint8Array>"u"||!I?r:I(Uint8Array),re={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?r:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?r:ArrayBuffer,"%ArrayIteratorPrototype%":C&&I?I([][Symbol.iterator]()):r,"%AsyncFromSyncIteratorPrototype%":r,"%AsyncFunction%":X,"%AsyncGenerator%":X,"%AsyncGeneratorFunction%":X,"%AsyncIteratorPrototype%":X,"%Atomics%":typeof Atomics>"u"?r:Atomics,"%BigInt%":typeof BigInt>"u"?r:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?r:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?r:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?r:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":t,"%eval%":eval,"%EvalError%":n,"%Float16Array%":typeof Float16Array>"u"?r:Float16Array,"%Float32Array%":typeof Float32Array>"u"?r:Float32Array,"%Float64Array%":typeof Float64Array>"u"?r:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?r:FinalizationRegistry,"%Function%":_,"%GeneratorFunction%":X,"%Int8Array%":typeof Int8Array>"u"?r:Int8Array,"%Int16Array%":typeof Int16Array>"u"?r:Int16Array,"%Int32Array%":typeof Int32Array>"u"?r:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":C&&I?I(I([][Symbol.iterator]())):r,"%JSON%":typeof JSON=="object"?JSON:r,"%Map%":typeof Map>"u"?r:Map,"%MapIteratorPrototype%":typeof Map>"u"||!C||!I?r:I(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":e,"%Object.getOwnPropertyDescriptor%":b,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?r:Promise,"%Proxy%":typeof Proxy>"u"?r:Proxy,"%RangeError%":s,"%ReferenceError%":i,"%Reflect%":typeof Reflect>"u"?r:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?r:Set,"%SetIteratorPrototype%":typeof Set>"u"||!C||!I?r:I(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?r:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":C&&I?I(""[Symbol.iterator]()):r,"%Symbol%":C?Symbol:r,"%SyntaxError%":o,"%ThrowTypeError%":S,"%TypedArray%":le,"%TypeError%":a,"%Uint8Array%":typeof Uint8Array>"u"?r:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?r:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?r:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?r:Uint32Array,"%URIError%":l,"%WeakMap%":typeof WeakMap>"u"?r:WeakMap,"%WeakRef%":typeof WeakRef>"u"?r:WeakRef,"%WeakSet%":typeof WeakSet>"u"?r:WeakSet,"%Function.prototype.call%":L,"%Function.prototype.apply%":Q,"%Object.defineProperty%":w,"%Object.getPrototypeOf%":A,"%Math.abs%":c,"%Math.floor%":h,"%Math.max%":u,"%Math.min%":f,"%Math.pow%":p,"%Math.round%":g,"%Math.sign%":v,"%Reflect.getPrototypeOf%":U};if(I)try{null.error}catch(N){var _e=I(I(N));re["%Error.prototype%"]=_e}var Ne=function N(j){var D;if(j==="%AsyncFunction%")D=y("async function () {}");else if(j==="%GeneratorFunction%")D=y("function* () {}");else if(j==="%AsyncGeneratorFunction%")D=y("async function* () {}");else if(j==="%AsyncGenerator%"){var R=N("%AsyncGeneratorFunction%");R&&(D=R.prototype)}else if(j==="%AsyncIteratorPrototype%"){var H=N("%AsyncGenerator%");H&&I&&(D=I(H.prototype))}return re[j]=D,D},we={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},Oe=sr(),De=Ll(),Fe=Oe.call(L,Array.prototype.concat),dt=Oe.call(Q,Array.prototype.splice),Be=Oe.call(L,String.prototype.replace),He=Oe.call(L,String.prototype.slice),F=Oe.call(L,RegExp.prototype.exec),m=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,T=/\\(\\)?/g,P=function(j){var D=He(j,0,1),R=He(j,-1);if(D==="%"&&R!=="%")throw new o("invalid intrinsic syntax, expected closing `%`");if(R==="%"&&D!=="%")throw new o("invalid intrinsic syntax, expected opening `%`");var H=[];return Be(j,m,function(K,ue,Y,ne){H[H.length]=Y?Be(ne,T,"$1"):ue||K}),H},x=function(j,D){var R=j,H;if(De(we,R)&&(H=we[R],R="%"+H[0]+"%"),De(re,R)){var K=re[R];if(K===X&&(K=Ne(R)),typeof K>"u"&&!D)throw new a("intrinsic "+j+" exists, but is not available. Please file an issue!");return{alias:H,name:R,value:K}}throw new o("intrinsic "+j+" does not exist!")};return On=function(j,D){if(typeof j!="string"||j.length===0)throw new a("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof D!="boolean")throw new a('"allowMissing" argument must be a boolean');if(F(/^%?[^%]*%?$/,j)===null)throw new o("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var R=P(j),H=R.length>0?R[0]:"",K=x("%"+H+"%",D),ue=K.name,Y=K.value,ne=!1,$e=K.alias;$e&&(H=$e[0],dt(R,Fe([0,1],$e)));for(var ge=1,ve=!0;ge<R.length;ge+=1){var de=R[ge],Se=He(de,0,1),ht=He(de,-1);if((Se==='"'||Se==="'"||Se==="`"||ht==='"'||ht==="'"||ht==="`")&&Se!==ht)throw new o("property names with quotes must have matching quotes");if((de==="constructor"||!ve)&&(ne=!0),H+="."+de,ue="%"+H+"%",De(re,ue))Y=re[ue];else if(Y!=null){if(!(de in Y)){if(!D)throw new a("base intrinsic for "+j+" exists, but the property is not available.");return}if(b&&ge+1>=R.length){var Ke=b(Y,de);ve=!!Ke,ve&&"get"in Ke&&!("originalValue"in Ke.get)?Y=Ke.get:Y=Y[de]}else ve=De(Y,de),Y=Y[de];ve&&!ne&&(re[ue]=Y)}}return Y},On}var Cn,Jo;function Bs(){if(Jo)return Cn;Jo=1;var r=Ml(),e=Fs(),t=e([r("%String.prototype.indexOf%")]);return Cn=function(s,i){var o=r(s,!!i);return typeof o=="function"&&t(s,".prototype.")>-1?e([o]):o},Cn}var xn,Yo;function qh(){if(Yo)return xn;Yo=1;var r=Ls()(),e=Bs(),t=e("Object.prototype.toString"),n=function(a){return r&&a&&typeof a=="object"&&Symbol.toStringTag in a?!1:t(a)==="[object Arguments]"},s=function(a){return n(a)?!0:a!==null&&typeof a=="object"&&"length"in a&&typeof a.length=="number"&&a.length>=0&&t(a)!=="[object Array]"&&"callee"in a&&t(a.callee)==="[object Function]"},i=function(){return n(arguments)}();return n.isLegacyArguments=s,xn=i?n:s,xn}var jn,Qo;function Hs(){if(Qo)return jn;Qo=1;var r=$r(),e=jl(),t=Nt(),n=Dt();return jn=function(i,o,a){if(!i||typeof i!="object"&&typeof i!="function")throw new t("`obj` must be an object or a function`");if(typeof o!="string"&&typeof o!="symbol")throw new t("`property` must be a string or a symbol`");if(arguments.length>3&&typeof arguments[3]!="boolean"&&arguments[3]!==null)throw new t("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&typeof arguments[4]!="boolean"&&arguments[4]!==null)throw new t("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&typeof arguments[5]!="boolean"&&arguments[5]!==null)throw new t("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&typeof arguments[6]!="boolean")throw new t("`loose`, if provided, must be a boolean");var l=arguments.length>3?arguments[3]:null,c=arguments.length>4?arguments[4]:null,h=arguments.length>5?arguments[5]:null,u=arguments.length>6?arguments[6]:!1,f=!!n&&n(i,o);if(r)r(i,o,{configurable:h===null&&f?f.configurable:!h,enumerable:l===null&&f?f.enumerable:!l,value:a,writable:c===null&&f?f.writable:!c});else if(u||!l&&!c&&!h)i[o]=a;else throw new e("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.")},jn}var In,Xo;function Ws(){if(Xo)return In;Xo=1;var r=$r(),e=function(){return!!r};return e.hasArrayLengthDefineBug=function(){if(!r)return null;try{return r([],"length",{value:1}).length!==1}catch{return!0}},In=e,In}var Un,Zo;function ir(){if(Zo)return Un;Zo=1;var r=Rl(),e=typeof Symbol=="function"&&typeof Symbol("foo")=="symbol",t=Object.prototype.toString,n=Array.prototype.concat,s=Hs(),i=function(c){return typeof c=="function"&&t.call(c)==="[object Function]"},o=Ws()(),a=function(c,h,u,f){if(h in c){if(f===!0){if(c[h]===u)return}else if(!i(f)||!f())return}o?s(c,h,u,!0):s(c,h,u)},l=function(c,h){var u=arguments.length>2?arguments[2]:{},f=r(h);e&&(f=n.call(f,Object.getOwnPropertySymbols(h)));for(var p=0;p<f.length;p+=1)a(c,f[p],h[f[p]],u[f[p]])};return l.supportsDescriptors=!!o,Un=l,Un}var Nn={exports:{}},Dn,ea;function Fh(){if(ea)return Dn;ea=1;var r=Ml(),e=Hs(),t=Ws()(),n=Dt(),s=Nt(),i=r("%Math.floor%");return Dn=function(a,l){if(typeof a!="function")throw new s("`fn` is not a function");if(typeof l!="number"||l<0||l>4294967295||i(l)!==l)throw new s("`length` must be a positive 32-bit integer");var c=arguments.length>2&&!!arguments[2],h=!0,u=!0;if("length"in a&&n){var f=n(a,"length");f&&!f.configurable&&(h=!1),f&&!f.writable&&(u=!1)}return(h||u||!c)&&(t?e(a,"length",l,!0,!0):e(a,"length",l)),a},Dn}var Ln,ta;function Bh(){if(ta)return Ln;ta=1;var r=sr(),e=qs(),t=Nl();return Ln=function(){return t(r,e,arguments)},Ln}var ra;function ql(){return ra||(ra=1,function(r){var e=Fh(),t=$r(),n=Fs(),s=Bh();r.exports=function(o){var a=n(arguments),l=o.length-(arguments.length-1);return e(a,1+(l>0?l:0),!0)},t?t(r.exports,"apply",{value:s}):r.exports.apply=s}(Nn)),Nn.exports}var Mn,na;function Fl(){if(na)return Mn;na=1;var r=function(e){return e!==e};return Mn=function(t,n){return t===0&&n===0?1/t===1/n:!!(t===n||r(t)&&r(n))},Mn}var qn,sa;function Bl(){if(sa)return qn;sa=1;var r=Fl();return qn=function(){return typeof Object.is=="function"?Object.is:r},qn}var Fn,ia;function Hh(){if(ia)return Fn;ia=1;var r=Bl(),e=ir();return Fn=function(){var n=r();return e(Object,{is:n},{is:function(){return Object.is!==n}}),n},Fn}var Bn,oa;function Wh(){if(oa)return Bn;oa=1;var r=ir(),e=ql(),t=Fl(),n=Bl(),s=Hh(),i=e(n(),Object);return r(i,{getPolyfill:n,implementation:t,shim:s}),Bn=i,Bn}var Hn,aa;function Gh(){if(aa)return Hn;aa=1;var r=Bs(),e=Ls()(),t=Ll(),n=Dt(),s;if(e){var i=r("RegExp.prototype.exec"),o={},a=function(){throw o},l={toString:a,valueOf:a};typeof Symbol.toPrimitive=="symbol"&&(l[Symbol.toPrimitive]=a),s=function(f){if(!f||typeof f!="object")return!1;var p=n(f,"lastIndex"),g=p&&t(p,"value");if(!g)return!1;try{i(f,l)}catch(v){return v===o}}}else{var c=r("Object.prototype.toString"),h="[object RegExp]";s=function(f){return!f||typeof f!="object"&&typeof f!="function"?!1:c(f)===h}}return Hn=s,Hn}var Wn,la;function Vh(){if(la)return Wn;la=1;var r=function(){return typeof(function(){}).name=="string"},e=Object.getOwnPropertyDescriptor;if(e)try{e([],"length")}catch{e=null}r.functionsHaveConfigurableNames=function(){if(!r()||!e)return!1;var s=e(function(){},"name");return!!s&&!!s.configurable};var t=Function.prototype.bind;return r.boundFunctionsHaveNames=function(){return r()&&typeof t=="function"&&(function(){}).bind().name!==""},Wn=r,Wn}var Gn,ca;function Kh(){if(ca)return Gn;ca=1;var r=Hs(),e=Ws()(),t=Vh().functionsHaveConfigurableNames(),n=Nt();return Gn=function(i,o){if(typeof i!="function")throw new n("`fn` is not a function");var a=arguments.length>2&&!!arguments[2];return(!a||t)&&(e?r(i,"name",o,!0,!0):r(i,"name",o)),i},Gn}var Vn,ua;function Hl(){if(ua)return Vn;ua=1;var r=Kh(),e=Nt(),t=Object;return Vn=r(function(){if(this==null||this!==t(this))throw new e("RegExp.prototype.flags getter called on non-object");var s="";return this.hasIndices&&(s+="d"),this.global&&(s+="g"),this.ignoreCase&&(s+="i"),this.multiline&&(s+="m"),this.dotAll&&(s+="s"),this.unicode&&(s+="u"),this.unicodeSets&&(s+="v"),this.sticky&&(s+="y"),s},"get flags",!0),Vn}var Kn,da;function Wl(){if(da)return Kn;da=1;var r=Hl(),e=ir().supportsDescriptors,t=Object.getOwnPropertyDescriptor;return Kn=function(){if(e&&/a/mig.flags==="gim"){var s=t(RegExp.prototype,"flags");if(s&&typeof s.get=="function"&&"dotAll"in RegExp.prototype&&"hasIndices"in RegExp.prototype){var i="",o={};if(Object.defineProperty(o,"hasIndices",{get:function(){i+="d"}}),Object.defineProperty(o,"sticky",{get:function(){i+="y"}}),s.get.call(o),i==="dy")return s.get}}return r},Kn}var zn,ha;function zh(){if(ha)return zn;ha=1;var r=ir().supportsDescriptors,e=Wl(),t=Dt(),n=Object.defineProperty,s=xl(),i=Dl(),o=/a/;return zn=function(){if(!r||!i)throw new s("RegExp.prototype.flags requires a true ES5 environment that supports property descriptors");var l=e(),c=i(o),h=t(c,"flags");return(!h||h.get!==l)&&n(c,"flags",{configurable:!0,enumerable:!1,get:l}),l},zn}var Jn,fa;function Jh(){if(fa)return Jn;fa=1;var r=ir(),e=ql(),t=Hl(),n=Wl(),s=zh(),i=e(n());return r(i,{getPolyfill:n,implementation:t,shim:s}),Jn=i,Jn}var Yn,pa;function Yh(){if(pa)return Yn;pa=1;var r=Bs(),e=r("Date.prototype.getDay"),t=function(a){try{return e(a),!0}catch{return!1}},n=r("Object.prototype.toString"),s="[object Date]",i=Ls()();return Yn=function(a){return typeof a!="object"||a===null?!1:i?t(a):n(a)===s},Yn}var Qn,_a;function Qh(){if(_a)return Qn;_a=1;var r=Rl(),e=qh(),t=Wh(),n=Gh(),s=Jh(),i=Yh(),o=Date.prototype.getTime;function a(u,f,p){var g=p||{};return(g.strict?t(u,f):u===f)?!0:!u||!f||typeof u!="object"&&typeof f!="object"?g.strict?t(u,f):u==f:h(u,f,g)}function l(u){return u==null}function c(u){return!(!u||typeof u!="object"||typeof u.length!="number"||typeof u.copy!="function"||typeof u.slice!="function"||u.length>0&&typeof u[0]!="number")}function h(u,f,p){var g,v;if(typeof u!=typeof f||l(u)||l(f)||u.prototype!==f.prototype||e(u)!==e(f))return!1;var _=n(u),y=n(f);if(_!==y)return!1;if(_||y)return u.source===f.source&&s(u)===s(f);if(i(u)&&i(f))return o.call(u)===o.call(f);var b=c(u),w=c(f);if(b!==w)return!1;if(b||w){if(u.length!==f.length)return!1;for(g=0;g<u.length;g++)if(u[g]!==f[g])return!1;return!0}if(typeof u!=typeof f)return!1;try{var E=r(u),S=r(f)}catch{return!1}if(E.length!==S.length)return!1;for(E.sort(),S.sort(),g=E.length-1;g>=0;g--)if(E[g]!=S[g])return!1;for(g=E.length-1;g>=0;g--)if(v=E[g],!a(u[v],f[v],p))return!1;return!0}return Qn=a,Qn}/*
object-assign
(c) Sindre Sorhus
@license MIT
*/var Xn,ga;function Xh(){if(ga)return Xn;ga=1;var r=Object.getOwnPropertySymbols,e=Object.prototype.hasOwnProperty,t=Object.prototype.propertyIsEnumerable;function n(i){if(i==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(i)}function s(){try{if(!Object.assign)return!1;var i=new String("abc");if(i[5]="de",Object.getOwnPropertyNames(i)[0]==="5")return!1;for(var o={},a=0;a<10;a++)o["_"+String.fromCharCode(a)]=a;var l=Object.getOwnPropertyNames(o).map(function(h){return o[h]});if(l.join("")!=="0123456789")return!1;var c={};return"abcdefghijklmnopqrst".split("").forEach(function(h){c[h]=h}),Object.keys(Object.assign({},c)).join("")==="abcdefghijklmnopqrst"}catch{return!1}}return Xn=s()?Object.assign:function(i,o){for(var a,l=n(i),c,h=1;h<arguments.length;h++){a=Object(arguments[h]);for(var u in a)e.call(a,u)&&(l[u]=a[u]);if(r){c=r(a);for(var f=0;f<c.length;f++)t.call(a,c[f])&&(l[c[f]]=a[c[f]])}}return l},Xn}var Pt={},va;function Zh(){return va||(va=1,Pt.__esModule=!0,Pt.TAG_NAMES={HTML:"htmlAttributes",TITLE:"title",BASE:"base",META:"meta",LINK:"link",SCRIPT:"script",NOSCRIPT:"noscript",STYLE:"style"},Pt.TAG_PROPERTIES={NAME:"name",CHARSET:"charset",HTTPEQUIV:"http-equiv",REL:"rel",HREF:"href",PROPERTY:"property",SRC:"src",INNER_HTML:"innerHTML",CSS_TEXT:"cssText",ITEM_PROP:"itemprop"},Pt.PREACT_TAG_MAP={charset:"charSet","http-equiv":"httpEquiv",itemprop:"itemProp",class:"className"}),Pt}var ma;function ef(){return ma||(ma=1,function(r,e){e.__esModule=!0;var t=function(){function F(m,T){for(var P=0;P<T.length;P++){var x=T[P];x.enumerable=x.enumerable||!1,x.configurable=!0,"value"in x&&(x.writable=!0),Object.defineProperty(m,x.key,x)}}return function(m,T,P){return T&&F(m.prototype,T),P&&F(m,P),m}}(),n=Object.assign||function(F){for(var m=1;m<arguments.length;m++){var T=arguments[m];for(var P in T)Object.prototype.hasOwnProperty.call(T,P)&&(F[P]=T[P])}return F},s=$l,i=wh(),o=f(i),a=Qh(),l=f(a),c=Xh(),h=f(c),u=Zh();function f(F){return F&&F.__esModule?F:{default:F}}function p(F,m){if(!(F instanceof m))throw new TypeError("Cannot call a class as a function")}function g(F,m){if(!F)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return m&&(typeof m=="object"||typeof m=="function")?m:F}function v(F,m){if(typeof m!="function"&&m!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof m);F.prototype=Object.create(m&&m.prototype,{constructor:{value:F,enumerable:!1,writable:!0,configurable:!0}}),m&&(Object.setPrototypeOf?Object.setPrototypeOf(F,m):F.__proto__=m)}function _(F,m,T){return m in F?Object.defineProperty(F,m,{value:T,enumerable:!0,configurable:!0,writable:!0}):F[m]=T,F}var y="data-preact-helmet",b=function(m){return String(m).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;")},w=function(m,T){for(var P=m.length-1;P>=0;P--){var x=m[P];if(x[T])return x[T]}return null},E=function(m){var T=w(m,"title"),P=w(m,"titleTemplate");if(P&&T)return P.replace(/%s/g,function(){return T});var x=w(m,"defaultTitle");return T||x||""},S=function(m){return w(m,"onChangeClientState")||function(){}},C=function(m,T){return T.filter(function(P){return typeof P[m]<"u"}).map(function(P){return P[m]}).reduce(function(P,x){return n({},P,x)},{})},I=function(m,T){return T.filter(function(P){return typeof P[u.TAG_NAMES.BASE]<"u"}).map(function(P){return P[u.TAG_NAMES.BASE]}).reverse().reduce(function(P,x){if(!P.length)for(var N=Object.keys(x),j=0;j<N.length;j++){var D=N[j],R=D.toLowerCase();if(m.indexOf(R)!==-1&&x[R])return P.concat(x)}return P},[])},A=function(m,T,P){var x={};return P.filter(function(N){return typeof N[m]<"u"}).map(function(N){return N[m]}).reverse().reduce(function(N,j){var D={};j.filter(function(Y){for(var ne=void 0,$e=Object.keys(Y),ge=0;ge<$e.length;ge++){var ve=$e[ge],de=ve.toLowerCase();T.indexOf(de)!==-1&&!(ne===u.TAG_PROPERTIES.REL&&Y[ne].toLowerCase()==="canonical")&&!(de===u.TAG_PROPERTIES.REL&&Y[de].toLowerCase()==="stylesheet")&&(ne=de),T.indexOf(ve)!==-1&&(ve===u.TAG_PROPERTIES.INNER_HTML||ve===u.TAG_PROPERTIES.CSS_TEXT||ve===u.TAG_PROPERTIES.ITEM_PROP)&&(ne=ve)}if(!ne||!Y[ne])return!1;var Se=Y[ne].toLowerCase();return x[ne]||(x[ne]={}),D[ne]||(D[ne]={}),x[ne][Se]?!1:(D[ne][Se]=!0,!0)}).reverse().forEach(function(Y){return N.push(Y)});for(var R=Object.keys(D),H=0;H<R.length;H++){var K=R[H],ue=(0,h.default)({},x[K],D[K]);x[K]=ue}return N},[]).reverse()},U=function(m,T){document.title=m||document.title,Q(u.TAG_NAMES.TITLE,T)},Q=function(m,T){for(var P=document.getElementsByTagName(m)[0],x=P.getAttribute(y),N=x?x.split(","):[],j=[].concat(N),D=Object.keys(T),R=0;R<D.length;R++){var H=D[R],K=T[H]||"";P.setAttribute(H,K),N.indexOf(H)===-1&&N.push(H);var ue=j.indexOf(H);ue!==-1&&j.splice(ue,1)}for(var Y=j.length-1;Y>=0;Y--)P.removeAttribute(j[Y]);N.length===j.length?P.removeAttribute(y):P.setAttribute(y,N.join(","))},L=function(m,T){var P=document.head||document.querySelector("head"),x=P.querySelectorAll(m+"["+y+"]"),N=Array.prototype.slice.call(x),j=[],D=void 0;return T&&T.length&&T.forEach(function(R){var H=document.createElement(m);for(var K in R)if(R.hasOwnProperty(K))if(K==="innerHTML")H.innerHTML=R.innerHTML;else if(K==="cssText")H.styleSheet?H.styleSheet.cssText=R.cssText:H.appendChild(document.createTextNode(R.cssText));else{var ue=typeof R[K]>"u"?"":R[K];H.setAttribute(K,ue)}H.setAttribute(y,"true"),N.some(function(Y,ne){return D=ne,H.isEqualNode(Y)})?N.splice(D,1):j.push(H)}),N.forEach(function(R){return R.parentNode.removeChild(R)}),j.forEach(function(R){return P.appendChild(R)}),{oldTags:N,newTags:j}},X=function(m){return Object.keys(m).reduce(function(T,P){var x=typeof m[P]<"u"?P+'="'+m[P]+'"':""+P;return T?T+" "+x:x},"")},le=function(m,T,P){var x=X(P);return x?"<"+m+" "+y+" "+x+">"+b(T)+"</"+m+">":"<"+m+" "+y+">"+b(T)+"</"+m+">"},re=function(m,T){return T.reduce(function(P,x){var N=Object.keys(x).filter(function(R){return!(R==="innerHTML"||R==="cssText")}).reduce(function(R,H){var K=typeof x[H]>"u"?H:H+'="'+b(x[H])+'"';return R?R+" "+K:K},""),j=x.innerHTML||x.cssText||"",D=[u.TAG_NAMES.NOSCRIPT,u.TAG_NAMES.SCRIPT,u.TAG_NAMES.STYLE].indexOf(m)===-1;return P+"<"+m+" "+y+" "+N+(D?">":">"+j+"</"+m+">")},"")},_e=function(m,T,P){var x=_({key:T},y,!0),N=Object.keys(P).reduce(function(j,D){return j[D]=P[D],j},x);return[(0,s.h)(u.TAG_NAMES.TITLE,N,T)]},Ne=function(m,T){return T.map(function(P,x){var N=_({key:x},y,!0);return Object.keys(P).forEach(function(j){var D=j;if(D==="innerHTML"||D==="cssText"){var R=P.innerHTML||P.cssText;N.dangerouslySetInnerHTML={__html:R}}else N[D]=P[j]}),(0,s.h)(m,N)})},we=function(m,T){switch(m){case u.TAG_NAMES.TITLE:return{toComponent:function(){return _e(m,T.title,T.titleAttributes)},toString:function(){return le(m,T.title,T.titleAttributes)}};case u.TAG_NAMES.HTML:return{toComponent:function(){return T},toString:function(){return X(T)}};default:return{toComponent:function(){return Ne(m,T)},toString:function(){return re(m,T)}}}},Oe=function(m){var T=m.htmlAttributes,P=m.title,x=m.titleAttributes,N=m.baseTag,j=m.metaTags,D=m.linkTags,R=m.scriptTags,H=m.noscriptTags,K=m.styleTags;return{htmlAttributes:we(u.TAG_NAMES.HTML,T),title:we(u.TAG_NAMES.TITLE,{title:P,titleAttributes:x}),base:we(u.TAG_NAMES.BASE,N),meta:we(u.TAG_NAMES.META,j),link:we(u.TAG_NAMES.LINK,D),script:we(u.TAG_NAMES.SCRIPT,R),noscript:we(u.TAG_NAMES.NOSCRIPT,H),style:we(u.TAG_NAMES.STYLE,K)}},De=function(m){var T,P;return P=T=function(x){v(N,x);function N(){return p(this,N),g(this,(N.__proto__||Object.getPrototypeOf(N)).apply(this,arguments))}return t(N,[{key:"shouldComponentUpdate",value:function(D){var R=n({},D);return(!R.children||!R.children.length)&&delete R.children,!(0,l.default)(this.props,R)}},{key:"render",value:function(){return(0,s.h)(m,this.props)}}],[{key:"canUseDOM",set:function(D){m.canUseDOM=D}}]),N}(s.Component),T.peek=m.peek,T.rewind=function(){var x=m.rewind();return x||(x=Oe({htmlAttributes:{},title:"",titleAttributes:{},baseTag:[],metaTags:[],linkTags:[],scriptTags:[],noscriptTags:[],styleTags:[]})),x},P},Fe=function(m){return{htmlAttributes:C(u.TAG_NAMES.HTML,m),title:E(m),titleAttributes:C("titleAttributes",m),baseTag:I([u.TAG_PROPERTIES.HREF],m),metaTags:A(u.TAG_NAMES.META,[u.TAG_PROPERTIES.NAME,u.TAG_PROPERTIES.CHARSET,u.TAG_PROPERTIES.HTTPEQUIV,u.TAG_PROPERTIES.PROPERTY,u.TAG_PROPERTIES.ITEM_PROP],m),linkTags:A(u.TAG_NAMES.LINK,[u.TAG_PROPERTIES.REL,u.TAG_PROPERTIES.HREF],m),scriptTags:A(u.TAG_NAMES.SCRIPT,[u.TAG_PROPERTIES.SRC,u.TAG_PROPERTIES.INNER_HTML],m),noscriptTags:A(u.TAG_NAMES.NOSCRIPT,[u.TAG_PROPERTIES.INNER_HTML],m),styleTags:A(u.TAG_NAMES.STYLE,[u.TAG_PROPERTIES.CSS_TEXT],m),onChangeClientState:S(m)}},dt=function(m){var T=m.htmlAttributes,P=m.title,x=m.titleAttributes,N=m.baseTag,j=m.metaTags,D=m.linkTags,R=m.scriptTags,H=m.noscriptTags,K=m.styleTags,ue=m.onChangeClientState;Q("html",T),U(P,x);var Y={baseTag:L(u.TAG_NAMES.BASE,N),metaTags:L(u.TAG_NAMES.META,j),linkTags:L(u.TAG_NAMES.LINK,D),scriptTags:L(u.TAG_NAMES.SCRIPT,R),noscriptTags:L(u.TAG_NAMES.NOSCRIPT,H),styleTags:L(u.TAG_NAMES.STYLE,K)},ne={},$e={};Object.keys(Y).forEach(function(ge){var ve=Y[ge],de=ve.newTags,Se=ve.oldTags;de.length&&(ne[ge]=de),Se.length&&($e[ge]=Y[ge].oldTags)}),ue(m,ne,$e)},Be=function(){return null},He=(0,o.default)(Fe,dt,Oe)(Be);e.default=De(He),r.exports=e.default}(pr,pr.exports)),pr.exports}var tf=ef();const Sr=Ga(tf),rf=()=>{const{user:r}=ut(),e=xt(i=>i.favorites),t=xt(i=>i.fetchFavorites),[n,s]=q({});return se(()=>{document.title="My Favorites - FreeStream",r&&t()},[r,t]),se(()=>{(async()=>{if(r&&e.length>0){const o=e.map(a=>({media_id:a.id,media_type:a.type,season_number:a.season_number||null,episode_number:a.episode_number||null}));try{const a=await Pl(o);s(a)}catch(a){console.error("Error fetching progress data for favorites:",a),s({})}}else s({})})()},[r,e]),d("div",{class:"container",children:[d(Sr,{children:d("title",{children:"My Favorites - FreeStream"})}),d("h1",{children:"My Favorites"}),e.length>0?d("div",{class:"movie-grid",children:e.map(i=>{const o=`${i.id}-${i.type}-${i.season_number||0}-${i.episode_number||0}`,a=n[o];return d(jt,{item:i,type:i.type,progress:a?.progress_seconds,duration:a?.duration_seconds},`${i.type}-${i.id}-${i.season_number||0}-${i.episode_number||0}`)})}):d("p",{children:"You haven't added any favorites yet."})]})},ya=async(r,e=3,t=1e3)=>{for(let n=0;n<e;n++)try{const s=new Promise((a,l)=>{setTimeout(()=>l(new Error("Request timeout")),1e4)}),i=fetch(r,{headers:{Accept:"application/json","Content-Type":"application/json"}}),o=await Promise.race([i,s]);if(!o.ok)throw new Error(`HTTP ${o.status}: ${o.statusText}`);return o}catch(s){if(console.warn(`Fetch attempt ${n+1} failed for ${r}:`,s.message),n===e-1)throw s;await new Promise(i=>setTimeout(i,t*(n+1)))}},nf=()=>{const{user:r}=ut(),[e,t]=q([]),[n,s]=q(!0),[i,o]=q(null),{removeContinueWatchingItem:a,fetchContinueWatching:l}=xt(),c=$s(async()=>{if(!r){s(!1);return}s(!0),o(null);try{if(!await hl())throw new Error("Supabase connection test failed. Please check your internet connection and try again.");const p=await mh();if(!p||p.length===0){t([]),s(!1);return}console.log("📚 Combined history data received:",{totalItems:p.length,itemsWithProgress:p.filter(_=>_.progress_seconds>0).length});const v=(await Promise.allSettled(p.map(async _=>{try{const b=await(await ya(`${Te}/tmdb/${_.media_type}/${_.media_id}`)).json(),w={...b,id:b.id,watch_id:`${_.user_id}-${_.media_id}-${_.media_type}-${_.season_number||0}-${_.episode_number||0}`,type:_.media_type,media_type:_.media_type,media_id:_.media_id,season_number:_.season_number,episode_number:_.episode_number,watched_at:_.watched_at,progress_seconds:_.progress_seconds,duration_seconds:_.duration_seconds};if(_.media_type==="tv"&&_.season_number&&_.episode_number)try{const S=await(await ya(`${Te}/tmdb/tv/${_.media_id}/season/${_.season_number}/episode/${_.episode_number}`)).json();return{...w,episode_name:S.name,still_path:S.still_path,episode_overview:S.overview}}catch(E){console.error("Error fetching episode details:",E)}return w}catch(y){return console.error(`Error fetching details for ${_.media_type} ${_.media_id}:`,y),{id:_.media_id,watch_id:`${_.user_id}-${_.media_id}-${_.media_type}-${_.season_number||0}-${_.episode_number||0}`,type:_.media_type,media_type:_.media_type,media_id:_.media_id,season_number:_.season_number,episode_number:_.episode_number,watched_at:_.watched_at,title:_.media_type==="tv"?"Unknown TV Show":"Unknown Movie",name:_.media_type==="tv"?"Unknown TV Show":void 0,poster_path:null,overview:"Details could not be loaded",_failed_to_load:!0,progress_seconds:_.progress_seconds,duration_seconds:_.duration_seconds}}}))).filter(_=>_.status==="fulfilled"&&_.value).map(_=>_.value);t(v)}catch(f){console.error("Error fetching watch history:",f),o("Failed to load watch history. Please try again."),t([])}finally{s(!1)}},[r]);se(()=>{c()},[c]);const h=async f=>{t(e.filter(p=>p.watch_id!==f.watch_id)),a(f.media_id);try{await _h(f),await l()}catch(p){console.error("Failed to delete item or refetch continue watching:",p)}},u=()=>{c()};return n?d("div",{class:"container",children:d("p",{children:"Loading watch history..."})}):i?d("div",{class:"container",children:[d(Sr,{children:d("title",{children:"Watch History - FreeStream"})}),d("h1",{children:"Watch History"}),d("div",{class:"error-message",children:[d("p",{children:i}),d("button",{onClick:u,class:"retry-button",children:"Retry"})]})]}):d("div",{class:"container",children:[d(Sr,{children:d("title",{children:"Watch History - FreeStream"})}),d("h1",{children:"Watch History"}),e.length>0?d("div",{class:"movie-grid",children:e.map(f=>d(jt,{item:f,type:f.type,progress:f.progress_seconds,duration:f.duration_seconds,showDeleteButton:!0,onDelete:h},f.watch_id))}):d("p",{children:"Your watch history is empty."})]})},ba=r=>{const[e,t]=q(null),[n,s]=q([]),[i,o]=q([]),[a,l]=q(""),[c,h]=q(!0),[u,f]=q(!1),[p,g]=q(1),[v,_]=q(1),[y,b]=q("videasy"),[w,E]=q(["videasy","vidsrc","embedsu"]),[S,C]=q(null),[I,A]=q(!1),[U,Q]=q(!1),[L,X]=q(!1),[le,re]=q(null),[_e,Ne]=q(null),[we,Oe]=q(!1),[De,Fe]=q(!1),[dt,Be]=q([]),He=me(null),[F,m]=q([]),[T,P]=q(null),[x,N]=q(!1),[j,D]=q(0),[R,H]=q(1),K=6,ue=me(!1),Y=me(null),ne=me(!1),$e=me(!1),ge=me(!1),ve=me(null),de=me(!1),Se=me(new Set),ht=me(0);me(0);const Ke=me(null),{id:ee,type:k,season:ft,episode:pt}=r.matches,{user:Ae}=ut(),{addFavorite:Gs,removeFavorite:Vs,isFavorited:Ks,setCurrentMediaItem:Ar}=xt(),zs=tr(()=>k!=="movie"||!T||!T.progress_seconds||T.progress_seconds<=0?0:T.duration_seconds>0?Math.min(100,T.progress_seconds/T.duration_seconds*100):T.progress_seconds>30?5:2,[k,T]),Rr=Ae?.id,Js=me(Rr);me(0),se(()=>{Js.current=Rr},[Rr]),se(()=>()=>{Se.current.forEach($=>clearTimeout($)),Se.current.clear()},[p,v]),se(()=>(e&&Ar({...e,type:k}),()=>{Ar(null)}),[e,k,Ar]),se(()=>{if(!ee||!k){Ue("/");return}l(""),Fe(!1),Be([]),t(null),h(!0),X(!1),re(null),m([]),ne.current=!1,$e.current=!1,ge.current=!1,ve.current=null,de.current=!1,Se.current.forEach(M=>clearTimeout(M)),Se.current.clear(),ht.current=0,Ke.current=null,(async()=>{h(!0);try{const M=new AbortController,O=setTimeout(()=>M.abort(),15e3),[Z,he,z]=await Promise.all([fetch(`${Te}/tmdb/${k}/${ee}`,{signal:M.signal}).then(W=>{if(!W.ok)throw new Error(`HTTP ${W.status}: ${W.statusText}`);return W.json()}).catch(W=>{throw console.error("Error fetching media details:",W),W}),fetch(`${Te}/tmdb/${k}/${ee}/videos`,{signal:M.signal}).then(W=>{if(!W.ok)throw new Error(`HTTP ${W.status}: ${W.statusText}`);return W.json()}).catch(W=>(console.error("Error fetching videos:",W),{results:[]})),fetch(`${Te}/tmdb/${k}/${ee}/recommendations`,{signal:M.signal}).then(W=>{if(!W.ok)throw new Error(`HTTP ${W.status}: ${W.statusText}`);return W.json()}).catch(W=>(console.error("Error fetching recommendations:",W),{results:[]}))]);if(clearTimeout(O),t(Z),s(he.results||[]),o(z.results||[]),(k==="tv"||k==="anime")&&Z.seasons&&Z.seasons.length>0)if(ft&&pt&&!isNaN(parseInt(ft))&&!isNaN(parseInt(pt))){ge.current?ge.current=!1:ne.current=!0;const oe=parseInt(ft,10),B=parseInt(pt,10);(oe!==p||B!==v)&&(g(oe),_(B))}else{const oe=Z.seasons.find(B=>B.season_number>0)||Z.seasons[0];(oe.season_number!==p||v!==1)&&(g(oe.season_number),_(1))}}catch{t(null),s([]),o([])}finally{h(!1)}})()},[ee,k,ft,pt]),se(()=>{(async()=>{if(!Ae||!e||!ee||!k){k==="movie"?P(null):(k==="tv"||k==="anime")&&m([]);return}try{if((k==="tv"||k==="anime")&&e.seasons&&e.seasons.length>0&&!(ft&&pt&&!isNaN(parseInt(ft))&&!isNaN(parseInt(pt)))&&!$e.current){console.log("🎬 Checking for continue watching episode...");const O=await vh(ee);O&&O.season&&O.episode?(console.log(`🔄 Continue watching: S${O.season}E${O.episode}`),setTimeout(()=>{g(O.season),_(O.episode);const Z=`/watch/${k}/${ee}/season/${O.season}/episode/${O.episode}`;Ue(Z,!0)},100)):console.log("📭 No continue watching data found, starting from beginning"),$e.current=!0}if(k==="tv"||k==="anime"){const M=await gh(ee);m(M)}else if(k==="movie"){const M=await Hr(ee,k);console.log("Movie progress data loaded:",M),P(M)}}catch(M){console.error("Error loading user-specific data:",M)}})()},[Ae,e,ee,k]),se(()=>{H(1)},[p]),se(()=>{(async()=>{if(!(k!=="tv"&&k!=="anime"||!ee||!p)){A(!0);try{const M=new AbortController,O=setTimeout(()=>M.abort(),1e4),Z=await fetch(`${Te}/tmdb/${k}/${ee}/season/${p}`,{signal:M.signal});if(clearTimeout(O),Z.ok){const he=await Z.json();C(he)}else C(null)}catch{C(null)}finally{A(!1)}}})()},[ee,k,p]),se(()=>{const $=`${p}-${v}`,M=Y.current&&Y.current!==$;if(Y.current=$,ue.current&&!M){ue.current=!1;return}M&&(ue.current=!1),(async()=>{if(!ee||!k)return;X(!1),re(null),Ne(null),Oe(!1);let Z=0;if(Js.current)try{const z=await Hr(ee,k,p,v);z&&z.progress_seconds>30?(Z=z.progress_seconds,D(z.progress_seconds)):D(0)}catch(z){console.error("Error fetching progress for stream URL:",z),D(0)}else D(0);let he=`${Te}/stream-url?type=${k}&id=${ee}&source=${y}`;(k==="tv"||k==="anime")&&(he+=`&season=${p}&episode=${v}`,k==="anime"&&(he+=`&dub=${U}`)),y==="videasy"&&Z>30&&(he+=`&progress=${Math.floor(Z)}`);try{const z=new AbortController,W=setTimeout(()=>z.abort(),2e4),oe=await fetch(he,{signal:z.signal});clearTimeout(W);const B=await oe.json();if(!oe.ok)throw new Error(B.message||`HTTP ${oe.status}`);let We=B.url;B.isDirectSource?(l(We),Be(B.qualities||[]),Fe(!0)):(l(We),Fe(!1),Be([])),B.currentSource&&B.currentSource!==y&&(ue.current=!0,b(B.currentSource)),B.availableSources&&E(B.availableSources),Ne(null)}catch(z){let W="Could not load the video stream.",oe=!0;z.name==="AbortError"?W="Stream request timed out. Please try again.":z.message.includes("unavailable")?W="All streaming sources are currently unavailable. This is usually temporary.":z.message.includes("503")?W="Streaming service is temporarily down. Please try again in a few minutes.":z.message.includes("404")?W="This content is not available from the current source.":z.message.includes("NetworkError")||z.message.includes("fetch")?W="Network connection issue. Please check your internet and try again.":W="Unable to load video stream. This might be due to leaving and returning to the browser.",Ne({message:W,canRetry:oe}),l(""),Fe(!1)}})()},[ee,k,p,v,y,U]);const Ys=()=>{if(!S||!S.episodes)return;const $=S.episodes.findIndex(M=>M.episode_number===v);if($!==-1&&$<S.episodes.length-1){const M=S.episodes[$+1];_(M.episode_number)}X(!1),re(null)};if(se(()=>{if(L&&le===null&&re(15),le>0){const $=setTimeout(()=>{re(le-1)},1e3);return()=>clearTimeout($)}else le===0&&Ys()},[L,le]),se(()=>{if(Ae&&e){const $=`${ee}-${k}-${p}-${v}`,M=Date.now(),O=window.lastHistoryUpdate||{};(!O[$]||M-O[$]>5e3)&&(console.log("📝 Adding immediate watch history entry:",{mediaId:ee,type:k,season:p,episode:v,title:e.title||e.name}),lo({...e,id:e.id,type:k,season:p,episode:v}).then(()=>{console.log("✅ Watch history entry added successfully")}).catch(Z=>{console.error("❌ Failed to add watch history entry:",Z)}),window.lastHistoryUpdate={...O,[$]:M})}else console.log("⚠️ Skipping watch history entry:",{hasUser:!!Ae,hasMediaDetails:!!e})},[Ae,e,k,p,v,ee]),se(()=>{if(console.log("🔐 Progress tracking setup:",{hasUser:!!Ae,userId:Ae?.id,hasMediaDetails:!!e}),!Ae||!e){console.log("⚠️ Progress tracking disabled - missing user or media details");return}const $=async(O,Z)=>{if(console.log(`📊 Progress update received via ${Z}:`,O),O&&O.progress>=0&&O.duration>0){const he=Date.now(),z=`${ee}-${k}-${p}-${v}`,W=window.lastProgressSave||{};!W[z]||he-W[z]>5e3?(console.log(`🎬 Attempting to save progress for ${k} ${ee}:`,{progress:O.progress,duration:O.duration,season:p,episode:v}),await ao({...e,id:e.id,type:k,season:p,episode:v},O.progress,O.duration)?(console.log("✅ Progress saved successfully"),window.lastProgressSave={...W,[z]:he},k==="movie"?P({progress_seconds:O.progress,duration_seconds:O.duration}):(k==="tv"||k==="anime")&&m(We=>{const ze=[...We],Lt=ze.findIndex(_t=>_t.season_number===p&&_t.episode_number===v),Je={media_id:parseInt(ee,10),media_type:k,season_number:p,episode_number:v,progress_seconds:O.progress,duration_seconds:O.duration};return Lt>-1?ze[Lt]={...ze[Lt],...Je}:ze.push(Je),ze})):console.error("❌ Failed to save progress")):console.log("⏭️ Progress save skipped (too recent):",{timeSinceLastSave:he-W[z],threshold:5e3});const oe=O.duration-O.progress;oe<=15&&oe>0&&!L&&(k==="tv"||k==="anime")&&X(!0)}else console.log("⚠️ Progress update ignored (insufficient data):",{hasProgressData:!!O,progress:O?.progress,duration:O?.duration,meetsThreshold:O?.progress>=0&&O?.duration>0})};let M;if(De){const O=He.current;if(!O)return;const Z=async()=>{const z=await Hr(ee,k,p,v);z&&z.progress_seconds&&(O.currentTime=z.progress_seconds)},he=async()=>{if(O.currentTime>0){const z=Date.now(),W=`${ee}-${k}-${p}-${v}`,oe=window.lastProgressSave||{};if(!oe[W]||z-oe[W]>5e3){const B={progress:Math.round(O.currentTime),duration:Math.round(O.duration),percentage:O.duration>0?O.currentTime/O.duration*100:0};console.log("🎬 Direct video - saving progress:",B),await ao({...e,id:e.id,type:k,season:p,episode:v},B.progress,B.duration)?(console.log("✅ Direct video progress saved successfully"),window.lastProgressSave={...oe,[W]:z},k==="movie"?P({progress_seconds:B.progress,duration_seconds:B.duration}):(k==="tv"||k==="anime")&&m(Lt=>{const Je=[...Lt],_t=Je.findIndex(ii=>ii.season_number===p&&ii.episode_number===v),si={media_id:parseInt(ee,10),media_type:k,season_number:p,episode_number:v,progress_seconds:B.progress,duration_seconds:B.duration};return _t>-1?Je[_t]={...Je[_t],...si}:Je.push(si),Je})):console.error("❌ Failed to save direct video progress");const ze=B.duration-B.progress;ze<=15&&ze>0&&!L&&(k==="tv"||k==="anime")&&X(!0)}}};return O.addEventListener("loadedmetadata",Z),O.addEventListener("timeupdate",he),()=>{O.removeEventListener("loadedmetadata",Z),O.removeEventListener("timeupdate",he)}}else{M=z=>{const W=["player.videasy.net","vidsrc.to","embed.su","vidsrc.xyz","vidsrc.in","vidsrc.pm"],oe=new URL(z.origin);if(W.includes(oe.hostname))try{let B;if(typeof z.data=="string")try{B=JSON.parse(z.data)}catch(We){console.error("Error parsing player message:",We);return}else B=z.data;if(B.type==="PLAYER_EVENT"&&B.data)if(B.data.event==="timeupdate"){const We={progress:B.data.currentTime,duration:B.data.duration,mediaId:B.data.id,mediaType:B.data.mediaType,season:B.data.season,episode:B.data.episode};$(We,oe.hostname)}else B.data.event==="ended"?handleMediaEnded():B.data.event==="play"?f(!0):B.data.event==="pause"&&f(!1);else B.type==="MEDIA_DATA"||(B.type==="VIDEASY_EVENT"&&B.event==="player_ready"?(N(!0),console.log("🎉 Videasy Player is ready!"),postPlayerMessage({action:"get_history"})):B.type==="request_seek"&&B.time&&(console.log(`Seeking to ${B.time}`),postPlayerMessage({action:"seek",time:B.time})))}catch(B){console.error("Error handling message from player:",B)}},window.addEventListener("message",M);let O;const Z=()=>{O&&clearInterval(O),O=setInterval(()=>{if(Ae&&e&&a){const z=Date.now(),W=`${ee}-${k}-${p}-${v}`,oe=window.lastHistoryUpdate||{};(!oe[W]||z-oe[W]>3e4)&&(lo({...e,id:e.id,type:k,season:p,episode:v}),window.lastHistoryUpdate={...oe,[W]:z})}},6e4)},he=setTimeout(()=>{Z()},12e4);return()=>{window.removeEventListener("message",M),O&&clearInterval(O),he&&clearTimeout(he)}}},[a,De,ee,k,p,v,e,L,Ae]),c)return d("div",{class:"loading-state",children:[d("div",{class:"loading-spinner"}),d("p",{children:"Loading media details..."})]});if(!e)return d("div",{class:"container",children:d("div",{class:"error-state",children:[d("h2",{children:"Unable to Load Media"}),d("p",{children:"We couldn't load the details for this content. This could be due to:"}),d("ul",{children:[d("li",{children:"Network connectivity issues"}),d("li",{children:"The content may no longer be available"}),d("li",{children:"Server maintenance"})]}),d("button",{onClick:()=>window.location.reload(),class:"btn btn-primary",style:{marginTop:"20px"},children:"Try Again"})]})});const{title:Or,name:Cr,overview:Gl,vote_average:uf,release_date:Qs,first_air_date:Xs,runtime:Zs,number_of_seasons:ei,genres:ti,poster_path:ri}=e,xr=(k==="tv"||k==="anime")&&p&&v,jr=xr?Ks(e.id,p,v):Ks(e.id),ni=Qs||Xs?new Date(Qs||Xs).getFullYear():"",Vl=()=>{if(!Ae){window.confirm("You need to log in to save favorites. Would you like to go to the login page?")&&Ue("/login");return}if(jr)xr?Vs(e.id,p,v):Vs(e.id);else if(xr){const $=S?.episodes?.find(M=>M.episode_number===v);Gs({...e,type:k,season_number:p,episode_number:v,episode_name:$?.name||`Episode ${v}`})}else Gs({...e,type:k})};return d("div",{children:[d(Sr,{children:d("title",{children:[Or||Cr," - FreeStream"]})}),d("div",{class:"player-container",children:[!a&&_e&&d("div",{class:"stream-error-message",children:[d("p",{children:_e.message}),_e.canRetry&&d("div",{class:"error-actions",children:[d("button",{onClick:async()=>{Oe(!0),setTimeout(()=>{(async()=>{const M=`${Te}/stream-url?type=${k}&id=${ee}&source=${y}${k==="tv"||k==="anime"?`&season=${p}&episode=${v}`:""}${k==="anime"?`&dub=${U}`:""}`;try{const O=await fetch(M),Z=await O.json();if(O.ok)l(Z.url),Fe(Z.isDirectSource),Be(Z.qualities||[]),Ne(null);else throw new Error(Z.message)}catch(O){console.error("Retry failed:",O),Ne({message:"Retry failed. Please try selecting a different source.",canRetry:!0})}Oe(!1)})()},1e3)},disabled:we,class:"btn retry-btn",children:we?"Retrying...":"Retry"}),d("p",{children:"Or try selecting a different source from the list below."})]})]}),!a&&!_e&&d("div",{class:"stream-loading",children:d("p",{children:"Loading video stream..."})}),De?d("video",{ref:He,src:a,controls:!0,autoPlay:!0,width:"100%"}):a&&d("iframe",{src:a,width:"100%",height:"100%",style:{position:"absolute",top:0,left:0,width:"100%",height:"100%"},frameBorder:"0",allowFullScreen:!0,allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share; fullscreen",title:"Video Player",loading:"eager",referrerPolicy:"no-referrer-when-downgrade",sandbox:"allow-same-origin allow-scripts allow-popups allow-forms allow-pointer-lock allow-popups-to-escape-sandbox",importance:"high",onLoad:()=>{console.log("🎬 Player iframe loaded"),N(!0),y!=="videasy"&&j>30?setTimeout(()=>{const $=document.querySelector("iframe");if($&&$.contentWindow)try{$.contentWindow.postMessage({type:"SEEK_TO",time:j},"*"),console.log(`📍 Sent seek command to restore progress: ${j}s`)}catch(M){console.log("Could not send seek command:",M)}},500):console.log(y==="videasy"?"📍 Videasy native resume - no seeking needed":"📍 No significant progress to resume, starting from beginning")}}),L&&d("div",{class:"next-episode-prompt",children:d("div",{class:"next-episode-content",children:[d("h3",{children:"Up Next"}),d("p",{children:["Playing next episode in ",le,"s..."]}),d("div",{class:"next-episode-buttons",children:[d("button",{onClick:Ys,class:"btn btn-primary",children:"Play Next"}),d("button",{onClick:()=>{X(!1),re(null)},class:"btn",children:"Cancel"})]})]})})]}),d("div",{class:"container",children:[d("div",{class:"media-details-layout",children:[d("div",{class:"poster",children:[d("img",{src:ys(ri?`${ms}${ri}`:"https://via.placeholder.com/500x750.png?text=No+Image"),alt:Or||Cr}),zs>0&&d("div",{class:"movie-progress-container",children:[d("div",{class:"movie-progress-bar",children:d("div",{class:"movie-progress",style:{width:`${Math.max(2,zs)}%`}})}),d("div",{class:"movie-progress-text",children:T.duration_seconds>0?`${Math.floor(T.progress_seconds/60)}m / ${Math.floor(T.duration_seconds/60)}m watched`:`${Math.floor(T.progress_seconds/60)}m watched`})]})]}),d("div",{class:"details",children:[d("div",{class:"title-container",children:[d("h1",{children:Or||Cr}),d("button",{onClick:Vl,class:`favorite-btn ${jr?"favorited":""}`,children:jr?"♥ Favorited":"♡"}),!Ae&&d("span",{class:"login-hint",children:d("small",{children:[d("a",{href:"/login",style:{color:"#007bff",textDecoration:"none"},children:"Log in"})," to save favorites, track progress & continue watching"]})})]}),d("div",{class:"meta",children:[d("span",{class:"rating",children:["★ ",e.vote_average?e.vote_average.toFixed(1):"N/A"]}),ni&&d("span",{children:ni}),Zs&&d("span",{children:[Zs," min"]}),ei&&d("span",{children:[ei," Seasons"]})]}),d("div",{class:"genres",children:ti&&ti.map($=>d("span",{class:"genre-tag",children:$.name}))}),d("p",{class:"overview",children:Gl}),dt.length>0&&d("div",{class:"quality-selector",children:[d("label",{children:"Quality:"}),dt.map($=>d("button",{class:`quality-btn ${a===$.url?"active":""}`,onClick:()=>l($.url),children:[$.quality,"p"]}))]})]})]}),k==="anime"&&d("div",{class:"select-container",children:[d("label",{for:"dub-select",children:"Audio:"}),d("select",{id:"dub-select",value:U,onChange:$=>Q($.target.value==="true"),children:[d("option",{value:"false",children:"Subbed"}),d("option",{value:"true",children:"Dubbed"})]})]}),d("div",{class:"selectors-container",children:[(k==="tv"||k==="anime")&&e&&e.seasons&&d("div",{class:"select-container",children:[d("label",{children:"Season:"}),d("div",{class:"selector-buttons",children:e.seasons.filter($=>$.season_number>0).map($=>d("button",{class:`selector-btn ${p===$.season_number?"active":""}`,onClick:()=>{console.log(`🎯 User manually selected season ${$.season_number}`),ne.current=!0,Ke.current=null;const M=`/watch/${k}/${ee}/season/${$.season_number}/episode/1`;Ue(M,!0)},children:$.name},$.id))})]}),w.length>1&&d("div",{class:"select-container",children:[d("label",{children:"Source:"}),d("div",{class:"selector-buttons",children:w.map($=>d("button",{class:`selector-btn ${y===$?"active":""}`,onClick:()=>b($),children:$},$))})]})]}),(k==="tv"||k==="anime")&&d("div",{class:"episodes-container",children:[d("h3",{children:"Episodes"}),I?d("div",{class:"loading-spinner"}):d(be,{children:[d("div",{class:"episode-list",children:S?.episodes?.slice((R-1)*K,R*K)?.map($=>{const M=F.find(Z=>Z.season_number===p&&Z.episode_number===$.episode_number),O=M&&M.progress_seconds>0?M.duration_seconds&&M.duration_seconds>0?Math.min(100,M.progress_seconds/M.duration_seconds*100):M.progress_seconds>30?5:2:0;return d("div",{class:`episode-card ${$.episode_number===v?"active":""}`,onClick:()=>{console.log(`🎯 User manually selected episode ${$.episode_number}`),ne.current=!0,Ke.current=null;const Z=`/watch/${k}/${ee}/season/${p}/episode/${$.episode_number}`;Ue(Z,!0)},children:[d("div",{class:"episode-card-image",children:[d("img",{src:ys($.still_path?`${ms}${$.still_path}`:`https://via.placeholder.com/300x169.png?text=${encodeURIComponent($.name)}`),alt:$.name}),d("div",{class:"episode-number-badge",children:$.episode_number}),O>0&&d("div",{class:"episode-progress-bar",children:d("div",{class:"episode-progress",style:{width:`${Math.max(2,O)}%`}})})]}),d("div",{class:"episode-card-content",children:[d("h4",{children:$.name}),d("p",{class:"episode-overview",children:$.overview})]})]},$.id)})}),S?.episodes&&S.episodes.length>K&&d("div",{class:"pagination-controls",children:[d("button",{class:"pagination-btn",onClick:()=>H($=>Math.max(1,$-1)),disabled:R===1,children:"← Previous"}),d("div",{class:"pagination-info",children:[d("span",{class:"page-numbers",children:Array.from({length:Math.ceil(S.episodes.length/K)},($,M)=>M+1).map($=>d("button",{class:`page-number ${$===R?"active":""}`,onClick:()=>H($),children:$},$))}),d("span",{class:"page-text",children:["Page ",R," of ",Math.ceil(S.episodes.length/K),"(",S.episodes.length," episodes)"]})]}),d("button",{class:"pagination-btn",onClick:()=>H($=>Math.min(Math.ceil(S.episodes.length/K),$+1)),disabled:R===Math.ceil(S.episodes.length/K),children:"Next →"})]})]})]}),i.length>0&&d("div",{class:"recommendations",children:[d("h2",{children:"More Like This"}),d("div",{class:"movie-grid",children:i.map($=>d(jt,{item:$,type:k,progress:null,duration:null},`${$.media_type||k}-${$.id}`))})]})]})]})},sf=r=>{const[e,t]=q([]),[n,s]=q(!1),[i,o]=q("");se(()=>{const c=new URLSearchParams(r.url?.split("?")[1]||"").get("q");o(c||""),c?a(c):t([])},[r.url]);const a=async l=>{s(!0);try{const h=await(await fetch(`${Te}/tmdb/search/multi?query=${encodeURIComponent(l)}`)).json();if(h&&h.results){const u=h.results.filter(f=>(f.media_type==="movie"||f.media_type==="tv")&&f.poster_path);t(u)}}catch(c){console.error("Error performing search:",c),t([])}finally{s(!1)}};return d("div",{class:"container home-page",children:[d("div",{class:"search-header",children:[d("h1",{class:"main-title",children:"Search Results"}),d("div",{class:"search-query-display",children:[d("span",{class:"search-label",children:"Showing results for:"}),d("span",{class:"search-query",children:['"',i,'"']})]})]}),n?d(kl,{text:"Searching for movies and TV shows..."}):e.length>0?d("section",{class:"home-section",children:[d("h2",{children:["Found ",e.length," result",e.length!==1?"s":""]}),d("div",{class:"movie-grid",children:e.map(l=>d(jt,{item:l,type:l.media_type,progress:null,duration:null},`${l.media_type}-${l.id}`))})]}):i?d("div",{class:"no-results",children:[d("div",{class:"no-results-icon",children:"🔍"}),d("h3",{children:"No results found"}),d("p",{children:[`We couldn't find anything for "`,i,'". Try searching with different keywords.']}),d("div",{class:"search-suggestions",children:[d("p",{children:"Try searching for:"}),d("ul",{children:[d("li",{children:"Movie or TV show titles"}),d("li",{children:"Actor or director names"}),d("li",{children:'Genre names (e.g., "action", "comedy")'}),d("li",{children:"Keywords from the plot"})]})]})]}):d("div",{class:"search-welcome",children:[d("div",{class:"search-welcome-icon",children:"🎬"}),d("h3",{children:"Start your search"}),d("p",{children:"Use the search bar above to find your favorite movies and TV shows."})]})]})};function of(){const[r,e]=q(!1),[t,n]=q(""),[s,i]=q("");return d("div",{className:"auth-container",children:d("div",{className:"auth-form",children:[d("h1",{className:"header",children:"Login"}),d("p",{className:"description",children:"Sign in to your account."}),d("form",{onSubmit:async a=>{a.preventDefault();try{e(!0);const{error:l}=await te.auth.signInWithPassword({email:t,password:s});if(l)throw l;wr.success("Logged in successfully!"),Ue("/",!0)}catch(l){wr.error(l.error_description||l.message)}finally{e(!1)}},children:[d("div",{className:"input-group",children:[d("label",{htmlFor:"email",children:"Email"}),d("input",{id:"email",className:"input-field",type:"email",placeholder:"Your email",value:t,onChange:a=>n(a.target.value)})]}),d("div",{className:"input-group",children:[d("label",{htmlFor:"password",children:"Password"}),d("input",{id:"password",className:"input-field",type:"password",placeholder:"Your password",value:s,onChange:a=>i(a.target.value)})]}),d("div",{children:d("button",{className:"button",disabled:r,children:r?d("span",{children:"Loading..."}):d("span",{children:"Login"})})})]})]})})}function af(){const[r,e]=q(!1),[t,n]=q(""),[s,i]=q("");return d("div",{className:"auth-container",children:d("div",{className:"auth-form",children:[d("h1",{className:"header",children:"Create an account"}),d("p",{className:"description",children:"Sign up for a new account."}),d("form",{onSubmit:async a=>{a.preventDefault();try{e(!0);const{error:l}=await te.auth.signUp({email:t,password:s});if(l)throw l;wr.success("Check your email for the confirmation link!")}catch(l){wr.error(l.error_description||l.message)}finally{e(!1)}},children:[d("div",{className:"input-group",children:[d("label",{htmlFor:"email",children:"Email"}),d("input",{id:"email",className:"input-field",type:"email",placeholder:"Your email",value:t,onChange:a=>n(a.target.value)})]}),d("div",{className:"input-group",children:[d("label",{htmlFor:"password",children:"Password"}),d("input",{id:"password",className:"input-field",type:"password",placeholder:"Your password",value:s,onChange:a=>i(a.target.value)})]}),d("div",{children:d("button",{className:"button",disabled:r,children:r?d("span",{children:"Loading..."}):d("span",{children:"Sign Up"})})})]})]})})}const wa=({component:r,...e})=>{const{user:t}=ut();return t?d(r,{...e}):(Ue("/login",!0),null)},lf=()=>{const[r,e]=q(!1);return se(()=>{const n=()=>{window.pageYOffset>300?e(!0):e(!1)};return window.addEventListener("scroll",n),()=>window.removeEventListener("scroll",n)},[]),d("button",{class:`scroll-to-top ${r?"visible":""}`,onClick:()=>{window.scrollTo({top:0,behavior:"smooth"})},"aria-label":"Scroll to top",children:d("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:d("path",{d:"M18 15l-6-6-6 6"})})})},cf=()=>(se(()=>{Sd()},[]),d(md,{children:d("div",{class:"app",children:[d(bd,{position:"top-center"}),d(Td,{}),d("main",{children:d(Wa,{history:hc(),children:[d(Wr,{path:"/"}),d(Wr,{path:"/movies"}),d(Wr,{path:"/tv"}),d(wa,{component:rf,path:"/favorites"}),d(wa,{component:nf,path:"/history"}),d(ba,{path:"/watch/:type/:id"}),d(ba,{path:"/watch/:type/:id/season/:season/episode/:episode"}),d(sf,{path:"/search"}),d(of,{path:"/login"}),d(af,{path:"/signup"})]})}),d(kd,{}),d(lf,{})]})}));lt(d(cf,{}),document.getElementById("app"));
