import{a as F,u as e,k as m,s as y,t as u}from"./index-BkQRV82z.js";import{d as i,A as P,y as D}from"./react-vendor-BYlzYzcd.js";const b=(t,r)=>t?.avatar_url?m(t.avatar_url):r?.user_metadata?.picture?m(r.user_metadata.picture):r?.user_metadata?.avatar_url?m(r.user_metadata.avatar_url):"/assets/default-avatar.png",L=()=>{const{user:t,profile:r,updateUser:N}=F(),[d,f]=i(r?.full_name||t?.user_metadata?.full_name||""),[_,p]=i(()=>b(r,t)),[c,A]=i(null),[S,h]=i(!1),[C,n]=i("Save Changes"),x=P();return D(()=>{p(b(r,t)),r?.full_name!==d&&f(r.full_name||"")},[r,t]),t?e("div",{className:"profile-container",children:e("div",{className:"profile-form",style:{maxWidth:420},children:e("form",{onSubmit:async l=>{l.preventDefault(),h(!0),n("Saving...");try{let a=null;if(c){const U=c.name.split(".").pop(),v=`${t.id}/avatar.${U}`,{error:g}=await y.storage.from("avatars").upload(v,c,{upsert:!0,cacheControl:"3600"});if(g)throw g;const{data:w}=y.storage.from("avatars").getPublicUrl(v);a=`${w.publicUrl}?t=${new Date().getTime()}`}const s={data:{full_name:d,...a&&{avatar_url:a}}},{error:o}=await N({...s,id:t.id});if(o)throw o;u.success("Profile updated successfully!"),n("Saved!"),setTimeout(()=>{n("Save Changes")},2e3)}catch(a){console.error("Profile update failed:",a),u.error(a.message||"An error occurred while updating your profile."),n("Save Changes")}finally{h(!1)}},children:[e("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",marginBottom:24},children:e("label",{htmlFor:"avatar-upload",style:{cursor:"pointer"},children:[e("img",{src:_,alt:"Profile avatar",style:{width:96,height:96,borderRadius:"50%",objectFit:"cover",marginBottom:8,border:"2px solid var(--brand-primary)"}}),e("input",{id:"avatar-upload",type:"file",accept:"image/*",style:{display:"none"},ref:x,onChange:l=>{const a=l.target.files[0];if(!a)return;if(!a.type.startsWith("image/")){u.error("Please select a valid image file.");return}if(a.size>50*1024*1024){u.error("Avatar must be less than 50MB.");return}A(a);const s=new FileReader;s.onload=o=>p(o.target.result),s.readAsDataURL(a)},"aria-label":"Change profile picture"}),e("div",{style:{color:"var(--brand-primary)",fontSize:14,textAlign:"center"},children:"Change Avatar"})]})}),e("div",{className:"input-group",children:[e("label",{htmlFor:"full-name",children:"Full Name"}),e("input",{id:"full-name",className:"input-field",type:"text",value:d,onInput:l=>f(l.target.value),placeholder:"Your name",maxLength:40,required:!0})]}),e("div",{className:"input-group",children:[e("label",{children:"Email"}),e("input",{className:"input-field",type:"email",value:t.email,disabled:!0,readOnly:!0})]}),e("button",{className:"button",type:"submit",disabled:S,style:{marginTop:16},children:C})]})})}):e("div",{className:"profile-container",children:e("div",{className:"profile-form",children:e("h2",{children:"Not logged in"})})})};export{L as default};
//# sourceMappingURL=Profile-DKMT8F9O.js.map
