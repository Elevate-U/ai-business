import{l as hs,K as lo,H as fs,J as la,_ as Dn,x as ca,a as co,d as N,y as ee,R as ps,k as ft,p as ua,q as da,A as ye,T as ha,E as fa}from"./react-vendor-BYlzYzcd.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();var pa=0;function l(n,e,t,r,s,i){e||(e={});var o,a,c=e;if("ref"in c)for(a in c={},e)a=="ref"?o=e[a]:c[a]=e[a];var u={type:n,props:c,key:t,ref:o,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:--pa,__i:-1,__u:0,__source:s,__self:i};if(typeof n=="function"&&(o=n.defaultProps))for(a in o)c[a]===void 0&&(c[a]=o[a]);return hs.vnode&&hs.vnode(u),u}var ga={};function kt(n,e){for(var t in e)n[t]=e[t];return n}function Sn(n,e,t){var r,s=/(?:\?([^#]*))?(#.*)?$/,i=n.match(s),o={};if(i&&i[1])for(var a=i[1].split("&"),c=0;c<a.length;c++){var u=a[c].split("=");o[decodeURIComponent(u[0])]=decodeURIComponent(u.slice(1).join("="))}n=En(n.replace(s,"")),e=En(e||"");for(var h=Math.max(n.length,e.length),d=0;d<h;d++)if(e[d]&&e[d].charAt(0)===":"){var f=e[d].replace(/(^:|[+*?]+$)/g,""),p=(e[d].match(/[+*?]+$/)||ga)[0]||"",g=~p.indexOf("+"),m=~p.indexOf("*"),v=n[d]||"";if(!v&&!m&&(p.indexOf("?")<0||g)){r=!1;break}if(o[f]=decodeURIComponent(v),g||m){o[f]=n.slice(d).map(decodeURIComponent).join("/");break}}else if(e[d]!==n[d]){r=!1;break}return(t.default===!0||r!==!1)&&o}function va(n,e){return n.rank<e.rank?1:n.rank>e.rank?-1:n.index-e.index}function ma(n,e){return n.index=e,n.rank=function(t){return t.props.default?0:En(t.props.path).map(ya).join("")}(n),n.props}function En(n){return n.replace(/(^\/+|\/+$)/g,"").split("/")}function ya(n){return n.charAt(0)==":"?1+"*+?".indexOf(n.charAt(n.length-1))||4:5}var _a={},et=[],$t=[],Ee=null,Ln={url:qn()},uo=lo(Ln);function wa(){var n=co(uo);if(n===Ln){var e=N()[1];ee(function(){return $t.push(e),function(){return $t.splice($t.indexOf(e),1)}},[])}return[n,$e]}function qn(){var n;return""+((n=Ee&&Ee.location?Ee.location:Ee&&Ee.getCurrentLocation?Ee.getCurrentLocation():typeof location<"u"?location:_a).pathname||"")+(n.search||"")}function $e(n,e){return e===void 0&&(e=!1),typeof n!="string"&&n.url&&(e=n.replace,n=n.url),function(t){for(var r=et.length;r--;)if(et[r].canRoute(t))return!0;return!1}(n)&&function(t,r){r===void 0&&(r="push"),Ee&&Ee[r]?Ee[r](t):typeof history<"u"&&history[r+"State"]&&history[r+"State"](null,null,t)}(n,e?"replace":"push"),ho(n)}function ho(n){for(var e=!1,t=0;t<et.length;t++)et[t].routeTo(n)&&(e=!0);return e}function ba(n){if(n&&n.getAttribute){var e=n.getAttribute("href"),t=n.getAttribute("target");if(e&&e.match(/^\//g)&&(!t||t.match(/^_?self$/i)))return $e(e)}}function Sa(n){return n.stopImmediatePropagation&&n.stopImmediatePropagation(),n.stopPropagation&&n.stopPropagation(),n.preventDefault(),!1}function fo(n){if(!(n.ctrlKey||n.metaKey||n.altKey||n.shiftKey||n.button)){var e=n.target;do if(e.localName==="a"&&e.getAttribute("href")){if(e.hasAttribute("data-native")||e.hasAttribute("native"))return;if(ba(e))return Sa(n)}while(e=e.parentNode)}}var gs=!1;function po(n){n.history&&(Ee=n.history),this.state={url:n.url||qn()}}kt(po.prototype=new ca,{shouldComponentUpdate:function(n){return n.static!==!0||n.url!==this.props.url||n.onChange!==this.props.onChange},canRoute:function(n){var e=fs(this.props.children);return this.g(e,n)!==void 0},routeTo:function(n){this.setState({url:n});var e=this.canRoute(n);return this.p||this.forceUpdate(),e},componentWillMount:function(){this.p=!0},componentDidMount:function(){var n=this;gs||(gs=!0,Ee||addEventListener("popstate",function(){ho(qn())}),addEventListener("click",fo)),et.push(this),Ee&&(this.u=Ee.listen(function(e){var t=e.location||e;n.routeTo(""+(t.pathname||"")+(t.search||""))})),this.p=!1},componentWillUnmount:function(){typeof this.u=="function"&&this.u(),et.splice(et.indexOf(this),1)},componentWillUpdate:function(){this.p=!0},componentDidUpdate:function(){this.p=!1},g:function(n,e){n=n.filter(ma).sort(va);for(var t=0;t<n.length;t++){var r=n[t],s=Sn(e,r.props.path,r.props);if(s)return[r,s]}},render:function(n,e){var t,r,s=n.onChange,i=e.url,o=this.c,a=this.g(fs(n.children),i);if(a&&(r=la(a[0],kt(kt({url:i,matches:t=a[1]},t),{key:void 0,ref:void 0}))),i!==(o&&o.url)){kt(Ln,o=this.c={url:i,previous:o&&o.url,current:r,path:r?r.props.path:null,matches:t}),o.router=this,o.active=r?[r]:[];for(var c=$t.length;c--;)$t[c]({});typeof s=="function"&&s(o)}return Dn(uo.Provider,{value:o},r)}});var Ne=function(n){return Dn("a",kt({onClick:fo},n))};function Kt(){return Kt=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},Kt.apply(null,arguments)}var pt;(function(n){n.Pop="POP",n.Push="PUSH",n.Replace="REPLACE"})(pt||(pt={}));var vs=function(n){return n},ms="beforeunload",Ea="hashchange",Ta="popstate";function Pa(n){n===void 0&&(n={});var e=n,t=e.window,r=t===void 0?document.defaultView:t,s=r.history;function i(){var T=ws(r.location.hash.substr(1)),M=T.pathname,K=M===void 0?"/":M,H=T.search,Z=H===void 0?"":H,le=T.hash,te=le===void 0?"":le,oe=s.state||{};return[oe.idx,vs({pathname:K,search:Z,hash:te,state:oe.usr||null,key:oe.key||"default"})]}var o=null;function a(){if(o)p.call(o),o=null;else{var T=pt.Pop,M=i(),K=M[0],H=M[1];if(p.length){if(K!=null){var Z=h-K;Z&&(o={action:T,location:H,retry:function(){U(Z*-1)}},U(Z))}}else _(T)}}r.addEventListener(Ta,a),r.addEventListener(Ea,function(){var T=i(),M=T[1];sr(M)!==sr(d)&&a()});var c=pt.Pop,u=i(),h=u[0],d=u[1],f=_s(),p=_s();h==null&&(h=0,s.replaceState(Kt({},s.state,{idx:h}),""));function g(){var T=document.querySelector("base"),M="";if(T&&T.getAttribute("href")){var K=r.location.href,H=K.indexOf("#");M=H===-1?K:K.slice(0,H)}return M}function m(T){return g()+"#"+(typeof T=="string"?T:sr(T))}function v(T,M){return M===void 0&&(M=null),vs(Kt({pathname:d.pathname,hash:"",search:""},typeof T=="string"?ws(T):T,{state:M,key:ka()}))}function w(T,M){return[{usr:T.state,key:T.key,idx:M},m(T)]}function E(T,M,K){return!p.length||(p.call({action:T,location:M,retry:K}),!1)}function _(T){c=T;var M=i();h=M[0],d=M[1],f.call({action:c,location:d})}function P(T,M){var K=pt.Push,H=v(T,M);function Z(){P(T,M)}if(E(K,H,Z)){var le=w(H,h+1),te=le[0],oe=le[1];try{s.pushState(te,"",oe)}catch{r.location.assign(oe)}_(K)}}function j(T,M){var K=pt.Replace,H=v(T,M);function Z(){j(T,M)}if(E(K,H,Z)){var le=w(H,h),te=le[0],oe=le[1];s.replaceState(te,"",oe),_(K)}}function U(T){s.go(T)}var q={get action(){return c},get location(){return d},createHref:m,push:P,replace:j,go:U,back:function(){U(-1)},forward:function(){U(1)},listen:function(M){return f.push(M)},block:function(M){var K=p.push(M);return p.length===1&&r.addEventListener(ms,ys),function(){K(),p.length||r.removeEventListener(ms,ys)}}};return q}function ys(n){n.preventDefault(),n.returnValue=""}function _s(){var n=[];return{get length(){return n.length},push:function(t){return n.push(t),function(){n=n.filter(function(r){return r!==t})}},call:function(t){n.forEach(function(r){return r&&r(t)})}}}function ka(){return Math.random().toString(36).substr(2,8)}function sr(n){var e=n.pathname,t=e===void 0?"/":e,r=n.search,s=r===void 0?"":r,i=n.hash,o=i===void 0?"":i;return s&&s!=="?"&&(t+=s.charAt(0)==="?"?s:"?"+s),o&&o!=="#"&&(t+=o.charAt(0)==="#"?o:"#"+o),t}function ws(n){var e={};if(n){var t=n.indexOf("#");t>=0&&(e.hash=n.substr(t),n=n.substr(0,t));var r=n.indexOf("?");r>=0&&(e.search=n.substr(r),n=n.substr(0,r)),n&&(e.pathname=n)}return e}const Aa="modulepreload",$a=function(n){return"/"+n},bs={},xt=function(e,t,r){let s=Promise.resolve();if(t&&t.length>0){let c=function(u){return Promise.all(u.map(h=>Promise.resolve(h).then(d=>({status:"fulfilled",value:d}),d=>({status:"rejected",reason:d}))))};document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),a=o?.nonce||o?.getAttribute("nonce");s=c(t.map(u=>{if(u=$a(u),u in bs)return;bs[u]=!0;const h=u.endsWith(".css"),d=h?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${u}"]${d}`))return;const f=document.createElement("link");if(f.rel=h?"stylesheet":Aa,h||(f.as="script"),f.crossOrigin="",f.href=u,a&&f.setAttribute("nonce",a),document.head.appendChild(f),h)return new Promise((p,g)=>{f.addEventListener("load",p),f.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${u}`)))})}))}function i(o){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=o,window.dispatchEvent(a),!a.defaultPrevented)throw o}return s.then(o=>{for(const a of o||[])a.status==="rejected"&&i(a.reason);return e().catch(i)})},Ra=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>xt(async()=>{const{default:r}=await Promise.resolve().then(()=>yt);return{default:r}},void 0).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)};class Mn extends Error{constructor(e,t="FunctionsError",r){super(e),this.name=t,this.context=r}}class Oa extends Mn{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class Ss extends Mn{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class Es extends Mn{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var Tn;(function(n){n.Any="any",n.ApNortheast1="ap-northeast-1",n.ApNortheast2="ap-northeast-2",n.ApSouth1="ap-south-1",n.ApSoutheast1="ap-southeast-1",n.ApSoutheast2="ap-southeast-2",n.CaCentral1="ca-central-1",n.EuCentral1="eu-central-1",n.EuWest1="eu-west-1",n.EuWest2="eu-west-2",n.EuWest3="eu-west-3",n.SaEast1="sa-east-1",n.UsEast1="us-east-1",n.UsWest1="us-west-1",n.UsWest2="us-west-2"})(Tn||(Tn={}));var ja=function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(h){try{u(r.next(h))}catch(d){o(d)}}function c(h){try{u(r.throw(h))}catch(d){o(d)}}function u(h){h.done?i(h.value):s(h.value).then(a,c)}u((r=r.apply(n,e||[])).next())})};class Ca{constructor(e,{headers:t={},customFetch:r,region:s=Tn.Any}={}){this.url=e,this.headers=t,this.region=s,this.fetch=Ra(r)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var r;return ja(this,void 0,void 0,function*(){try{const{headers:s,method:i,body:o}=t;let a={},{region:c}=t;c||(c=this.region);const u=new URL(`${this.url}/${e}`);c&&c!=="any"&&(a["x-region"]=c,u.searchParams.set("forceFunctionRegion",c));let h;o&&(s&&!Object.prototype.hasOwnProperty.call(s,"Content-Type")||!s)&&(typeof Blob<"u"&&o instanceof Blob||o instanceof ArrayBuffer?(a["Content-Type"]="application/octet-stream",h=o):typeof o=="string"?(a["Content-Type"]="text/plain",h=o):typeof FormData<"u"&&o instanceof FormData?h=o:(a["Content-Type"]="application/json",h=JSON.stringify(o)));const d=yield this.fetch(u.toString(),{method:i||"POST",headers:Object.assign(Object.assign(Object.assign({},a),this.headers),s),body:h}).catch(m=>{throw new Oa(m)}),f=d.headers.get("x-relay-error");if(f&&f==="true")throw new Ss(d);if(!d.ok)throw new Es(d);let p=((r=d.headers.get("Content-Type"))!==null&&r!==void 0?r:"text/plain").split(";")[0].trim(),g;return p==="application/json"?g=yield d.json():p==="application/octet-stream"?g=yield d.blob():p==="text/event-stream"?g=d:p==="multipart/form-data"?g=yield d.formData():g=yield d.text(),{data:g,error:null,response:d}}catch(s){return{data:null,error:s,response:s instanceof Es||s instanceof Ss?s.context:void 0}}})}}function go(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function vo(n){if(Object.prototype.hasOwnProperty.call(n,"__esModule"))return n;var e=n.default;if(typeof e=="function"){var t=function r(){var s=!1;try{s=this instanceof r}catch{}return s?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(r){var s=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(t,r,s.get?s:{enumerable:!0,get:function(){return n[r]}})}),t}var ue={},rt={},nt={},st={},it={},ot={},Ia=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},gt=Ia();const xa=gt.fetch,mo=gt.fetch.bind(gt),yo=gt.Headers,Na=gt.Request,Ua=gt.Response,yt=Object.freeze(Object.defineProperty({__proto__:null,Headers:yo,Request:Na,Response:Ua,default:mo,fetch:xa},Symbol.toStringTag,{value:"Module"})),Da=vo(yt);var Lt={},Ts;function _o(){if(Ts)return Lt;Ts=1,Object.defineProperty(Lt,"__esModule",{value:!0});class n extends Error{constructor(t){super(t.message),this.name="PostgrestError",this.details=t.details,this.hint=t.hint,this.code=t.code}}return Lt.default=n,Lt}var Ps;function wo(){if(Ps)return ot;Ps=1;var n=ot&&ot.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(ot,"__esModule",{value:!0});const e=n(Da),t=n(_o());class r{constructor(i){this.shouldThrowOnError=!1,this.method=i.method,this.url=i.url,this.headers=i.headers,this.schema=i.schema,this.body=i.body,this.shouldThrowOnError=i.shouldThrowOnError,this.signal=i.signal,this.isMaybeSingle=i.isMaybeSingle,i.fetch?this.fetch=i.fetch:typeof fetch>"u"?this.fetch=e.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(i,o){return this.headers=Object.assign({},this.headers),this.headers[i]=o,this}then(i,o){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");const a=this.fetch;let c=a(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async u=>{var h,d,f;let p=null,g=null,m=null,v=u.status,w=u.statusText;if(u.ok){if(this.method!=="HEAD"){const j=await u.text();j===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?g=j:g=JSON.parse(j))}const _=(h=this.headers.Prefer)===null||h===void 0?void 0:h.match(/count=(exact|planned|estimated)/),P=(d=u.headers.get("content-range"))===null||d===void 0?void 0:d.split("/");_&&P&&P.length>1&&(m=parseInt(P[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(g)&&(g.length>1?(p={code:"PGRST116",details:`Results contain ${g.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},g=null,m=null,v=406,w="Not Acceptable"):g.length===1?g=g[0]:g=null)}else{const _=await u.text();try{p=JSON.parse(_),Array.isArray(p)&&u.status===404&&(g=[],p=null,v=200,w="OK")}catch{u.status===404&&_===""?(v=204,w="No Content"):p={message:_}}if(p&&this.isMaybeSingle&&(!((f=p?.details)===null||f===void 0)&&f.includes("0 rows"))&&(p=null,v=200,w="OK"),p&&this.shouldThrowOnError)throw new t.default(p)}return{error:p,data:g,count:m,status:v,statusText:w}});return this.shouldThrowOnError||(c=c.catch(u=>{var h,d,f;return{error:{message:`${(h=u?.name)!==null&&h!==void 0?h:"FetchError"}: ${u?.message}`,details:`${(d=u?.stack)!==null&&d!==void 0?d:""}`,hint:"",code:`${(f=u?.code)!==null&&f!==void 0?f:""}`},data:null,count:null,status:0,statusText:""}})),c.then(i,o)}returns(){return this}overrideTypes(){return this}}return ot.default=r,ot}var ks;function bo(){if(ks)return it;ks=1;var n=it&&it.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(it,"__esModule",{value:!0});const e=n(wo());class t extends e.default{select(s){let i=!1;const o=(s??"*").split("").map(a=>/\s/.test(a)&&!i?"":(a==='"'&&(i=!i),a)).join("");return this.url.searchParams.set("select",o),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(s,{ascending:i=!0,nullsFirst:o,foreignTable:a,referencedTable:c=a}={}){const u=c?`${c}.order`:"order",h=this.url.searchParams.get(u);return this.url.searchParams.set(u,`${h?`${h},`:""}${s}.${i?"asc":"desc"}${o===void 0?"":o?".nullsfirst":".nullslast"}`),this}limit(s,{foreignTable:i,referencedTable:o=i}={}){const a=typeof o>"u"?"limit":`${o}.limit`;return this.url.searchParams.set(a,`${s}`),this}range(s,i,{foreignTable:o,referencedTable:a=o}={}){const c=typeof a>"u"?"offset":`${a}.offset`,u=typeof a>"u"?"limit":`${a}.limit`;return this.url.searchParams.set(c,`${s}`),this.url.searchParams.set(u,`${i-s+1}`),this}abortSignal(s){return this.signal=s,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:s=!1,verbose:i=!1,settings:o=!1,buffers:a=!1,wal:c=!1,format:u="text"}={}){var h;const d=[s?"analyze":null,i?"verbose":null,o?"settings":null,a?"buffers":null,c?"wal":null].filter(Boolean).join("|"),f=(h=this.headers.Accept)!==null&&h!==void 0?h:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${u}; for="${f}"; options=${d};`,u==="json"?this:this}rollback(){var s;return((s=this.headers.Prefer)!==null&&s!==void 0?s:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}}return it.default=t,it}var As;function Fn(){if(As)return st;As=1;var n=st&&st.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(st,"__esModule",{value:!0});const e=n(bo());class t extends e.default{eq(s,i){return this.url.searchParams.append(s,`eq.${i}`),this}neq(s,i){return this.url.searchParams.append(s,`neq.${i}`),this}gt(s,i){return this.url.searchParams.append(s,`gt.${i}`),this}gte(s,i){return this.url.searchParams.append(s,`gte.${i}`),this}lt(s,i){return this.url.searchParams.append(s,`lt.${i}`),this}lte(s,i){return this.url.searchParams.append(s,`lte.${i}`),this}like(s,i){return this.url.searchParams.append(s,`like.${i}`),this}likeAllOf(s,i){return this.url.searchParams.append(s,`like(all).{${i.join(",")}}`),this}likeAnyOf(s,i){return this.url.searchParams.append(s,`like(any).{${i.join(",")}}`),this}ilike(s,i){return this.url.searchParams.append(s,`ilike.${i}`),this}ilikeAllOf(s,i){return this.url.searchParams.append(s,`ilike(all).{${i.join(",")}}`),this}ilikeAnyOf(s,i){return this.url.searchParams.append(s,`ilike(any).{${i.join(",")}}`),this}is(s,i){return this.url.searchParams.append(s,`is.${i}`),this}in(s,i){const o=Array.from(new Set(i)).map(a=>typeof a=="string"&&new RegExp("[,()]").test(a)?`"${a}"`:`${a}`).join(",");return this.url.searchParams.append(s,`in.(${o})`),this}contains(s,i){return typeof i=="string"?this.url.searchParams.append(s,`cs.${i}`):Array.isArray(i)?this.url.searchParams.append(s,`cs.{${i.join(",")}}`):this.url.searchParams.append(s,`cs.${JSON.stringify(i)}`),this}containedBy(s,i){return typeof i=="string"?this.url.searchParams.append(s,`cd.${i}`):Array.isArray(i)?this.url.searchParams.append(s,`cd.{${i.join(",")}}`):this.url.searchParams.append(s,`cd.${JSON.stringify(i)}`),this}rangeGt(s,i){return this.url.searchParams.append(s,`sr.${i}`),this}rangeGte(s,i){return this.url.searchParams.append(s,`nxl.${i}`),this}rangeLt(s,i){return this.url.searchParams.append(s,`sl.${i}`),this}rangeLte(s,i){return this.url.searchParams.append(s,`nxr.${i}`),this}rangeAdjacent(s,i){return this.url.searchParams.append(s,`adj.${i}`),this}overlaps(s,i){return typeof i=="string"?this.url.searchParams.append(s,`ov.${i}`):this.url.searchParams.append(s,`ov.{${i.join(",")}}`),this}textSearch(s,i,{config:o,type:a}={}){let c="";a==="plain"?c="pl":a==="phrase"?c="ph":a==="websearch"&&(c="w");const u=o===void 0?"":`(${o})`;return this.url.searchParams.append(s,`${c}fts${u}.${i}`),this}match(s){return Object.entries(s).forEach(([i,o])=>{this.url.searchParams.append(i,`eq.${o}`)}),this}not(s,i,o){return this.url.searchParams.append(s,`not.${i}.${o}`),this}or(s,{foreignTable:i,referencedTable:o=i}={}){const a=o?`${o}.or`:"or";return this.url.searchParams.append(a,`(${s})`),this}filter(s,i,o){return this.url.searchParams.append(s,`${i}.${o}`),this}}return st.default=t,st}var $s;function So(){if($s)return nt;$s=1;var n=nt&&nt.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(nt,"__esModule",{value:!0});const e=n(Fn());class t{constructor(s,{headers:i={},schema:o,fetch:a}){this.url=s,this.headers=i,this.schema=o,this.fetch=a}select(s,{head:i=!1,count:o}={}){const a=i?"HEAD":"GET";let c=!1;const u=(s??"*").split("").map(h=>/\s/.test(h)&&!c?"":(h==='"'&&(c=!c),h)).join("");return this.url.searchParams.set("select",u),o&&(this.headers.Prefer=`count=${o}`),new e.default({method:a,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(s,{count:i,defaultToNull:o=!0}={}){const a="POST",c=[];if(this.headers.Prefer&&c.push(this.headers.Prefer),i&&c.push(`count=${i}`),o||c.push("missing=default"),this.headers.Prefer=c.join(","),Array.isArray(s)){const u=s.reduce((h,d)=>h.concat(Object.keys(d)),[]);if(u.length>0){const h=[...new Set(u)].map(d=>`"${d}"`);this.url.searchParams.set("columns",h.join(","))}}return new e.default({method:a,url:this.url,headers:this.headers,schema:this.schema,body:s,fetch:this.fetch,allowEmpty:!1})}upsert(s,{onConflict:i,ignoreDuplicates:o=!1,count:a,defaultToNull:c=!0}={}){const u="POST",h=[`resolution=${o?"ignore":"merge"}-duplicates`];if(i!==void 0&&this.url.searchParams.set("on_conflict",i),this.headers.Prefer&&h.push(this.headers.Prefer),a&&h.push(`count=${a}`),c||h.push("missing=default"),this.headers.Prefer=h.join(","),Array.isArray(s)){const d=s.reduce((f,p)=>f.concat(Object.keys(p)),[]);if(d.length>0){const f=[...new Set(d)].map(p=>`"${p}"`);this.url.searchParams.set("columns",f.join(","))}}return new e.default({method:u,url:this.url,headers:this.headers,schema:this.schema,body:s,fetch:this.fetch,allowEmpty:!1})}update(s,{count:i}={}){const o="PATCH",a=[];return this.headers.Prefer&&a.push(this.headers.Prefer),i&&a.push(`count=${i}`),this.headers.Prefer=a.join(","),new e.default({method:o,url:this.url,headers:this.headers,schema:this.schema,body:s,fetch:this.fetch,allowEmpty:!1})}delete({count:s}={}){const i="DELETE",o=[];return s&&o.push(`count=${s}`),this.headers.Prefer&&o.unshift(this.headers.Prefer),this.headers.Prefer=o.join(","),new e.default({method:i,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}}return nt.default=t,nt}var Tt={},Pt={},Rs;function La(){return Rs||(Rs=1,Object.defineProperty(Pt,"__esModule",{value:!0}),Pt.version=void 0,Pt.version="0.0.0-automated"),Pt}var Os;function qa(){if(Os)return Tt;Os=1,Object.defineProperty(Tt,"__esModule",{value:!0}),Tt.DEFAULT_HEADERS=void 0;const n=La();return Tt.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${n.version}`},Tt}var js;function Ma(){if(js)return rt;js=1;var n=rt&&rt.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(rt,"__esModule",{value:!0});const e=n(So()),t=n(Fn()),r=qa();class s{constructor(o,{headers:a={},schema:c,fetch:u}={}){this.url=o,this.headers=Object.assign(Object.assign({},r.DEFAULT_HEADERS),a),this.schemaName=c,this.fetch=u}from(o){const a=new URL(`${this.url}/${o}`);return new e.default(a,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(o){return new s(this.url,{headers:this.headers,schema:o,fetch:this.fetch})}rpc(o,a={},{head:c=!1,get:u=!1,count:h}={}){let d;const f=new URL(`${this.url}/rpc/${o}`);let p;c||u?(d=c?"HEAD":"GET",Object.entries(a).filter(([m,v])=>v!==void 0).map(([m,v])=>[m,Array.isArray(v)?`{${v.join(",")}}`:`${v}`]).forEach(([m,v])=>{f.searchParams.append(m,v)})):(d="POST",p=a);const g=Object.assign({},this.headers);return h&&(g.Prefer=`count=${h}`),new t.default({method:d,url:f,headers:g,schema:this.schemaName,body:p,fetch:this.fetch,allowEmpty:!1})}}return rt.default=s,rt}var Cs;function Fa(){if(Cs)return ue;Cs=1;var n=ue&&ue.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(ue,"__esModule",{value:!0}),ue.PostgrestError=ue.PostgrestBuilder=ue.PostgrestTransformBuilder=ue.PostgrestFilterBuilder=ue.PostgrestQueryBuilder=ue.PostgrestClient=void 0;const e=n(Ma());ue.PostgrestClient=e.default;const t=n(So());ue.PostgrestQueryBuilder=t.default;const r=n(Fn());ue.PostgrestFilterBuilder=r.default;const s=n(bo());ue.PostgrestTransformBuilder=s.default;const i=n(wo());ue.PostgrestBuilder=i.default;const o=n(_o());return ue.PostgrestError=o.default,ue.default={PostgrestClient:e.default,PostgrestQueryBuilder:t.default,PostgrestFilterBuilder:r.default,PostgrestTransformBuilder:s.default,PostgrestBuilder:i.default,PostgrestError:o.default},ue}var Ba=Fa();const Wa=go(Ba),{PostgrestClient:Ha,PostgrestQueryBuilder:Qu,PostgrestFilterBuilder:Xu,PostgrestTransformBuilder:Zu,PostgrestBuilder:ed,PostgrestError:td}=Wa;function Ga(){if(typeof WebSocket<"u")return WebSocket;if(typeof global.WebSocket<"u")return global.WebSocket;if(typeof window.WebSocket<"u")return window.WebSocket;if(typeof self.WebSocket<"u")return self.WebSocket;throw new Error("`WebSocket` is not supported in this environment")}const Ka=Ga(),Va="2.11.15",za=`realtime-js/${Va}`,Ja="1.0.0",Eo=1e4,Ya=1e3;var Rt;(function(n){n[n.connecting=0]="connecting",n[n.open=1]="open",n[n.closing=2]="closing",n[n.closed=3]="closed"})(Rt||(Rt={}));var pe;(function(n){n.closed="closed",n.errored="errored",n.joined="joined",n.joining="joining",n.leaving="leaving"})(pe||(pe={}));var Ce;(function(n){n.close="phx_close",n.error="phx_error",n.join="phx_join",n.reply="phx_reply",n.leave="phx_leave",n.access_token="access_token"})(Ce||(Ce={}));var Pn;(function(n){n.websocket="websocket"})(Pn||(Pn={}));var Ze;(function(n){n.Connecting="connecting",n.Open="open",n.Closing="closing",n.Closed="closed"})(Ze||(Ze={}));class Qa{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),r=new TextDecoder;return this._decodeBroadcast(e,t,r)}_decodeBroadcast(e,t,r){const s=t.getUint8(1),i=t.getUint8(2);let o=this.HEADER_LENGTH+2;const a=r.decode(e.slice(o,o+s));o=o+s;const c=r.decode(e.slice(o,o+i));o=o+i;const u=JSON.parse(r.decode(e.slice(o,e.byteLength)));return{ref:null,topic:a,event:c,payload:u}}}class To{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var re;(function(n){n.abstime="abstime",n.bool="bool",n.date="date",n.daterange="daterange",n.float4="float4",n.float8="float8",n.int2="int2",n.int4="int4",n.int4range="int4range",n.int8="int8",n.int8range="int8range",n.json="json",n.jsonb="jsonb",n.money="money",n.numeric="numeric",n.oid="oid",n.reltime="reltime",n.text="text",n.time="time",n.timestamp="timestamp",n.timestamptz="timestamptz",n.timetz="timetz",n.tsrange="tsrange",n.tstzrange="tstzrange"})(re||(re={}));const Is=(n,e,t={})=>{var r;const s=(r=t.skipTypes)!==null&&r!==void 0?r:[];return Object.keys(e).reduce((i,o)=>(i[o]=Xa(o,n,e,s),i),{})},Xa=(n,e,t,r)=>{const s=e.find(a=>a.name===n),i=s?.type,o=t[n];return i&&!r.includes(i)?Po(i,o):kn(o)},Po=(n,e)=>{if(n.charAt(0)==="_"){const t=n.slice(1,n.length);return rl(e,t)}switch(n){case re.bool:return Za(e);case re.float4:case re.float8:case re.int2:case re.int4:case re.int8:case re.numeric:case re.oid:return el(e);case re.json:case re.jsonb:return tl(e);case re.timestamp:return nl(e);case re.abstime:case re.date:case re.daterange:case re.int4range:case re.int8range:case re.money:case re.reltime:case re.text:case re.time:case re.timestamptz:case re.timetz:case re.tsrange:case re.tstzrange:return kn(e);default:return kn(e)}},kn=n=>n,Za=n=>{switch(n){case"t":return!0;case"f":return!1;default:return n}},el=n=>{if(typeof n=="string"){const e=parseFloat(n);if(!Number.isNaN(e))return e}return n},tl=n=>{if(typeof n=="string")try{return JSON.parse(n)}catch(e){return console.log(`JSON parse error: ${e}`),n}return n},rl=(n,e)=>{if(typeof n!="string")return n;const t=n.length-1,r=n[t];if(n[0]==="{"&&r==="}"){let i;const o=n.slice(1,t);try{i=JSON.parse("["+o+"]")}catch{i=o?o.split(","):[]}return i.map(a=>Po(e,a))}return n},nl=n=>typeof n=="string"?n.replace(" ","T"):n,ko=n=>{let e=n;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")};class ir{constructor(e,t,r={},s=Eo){this.channel=e,this.event=t,this.payload=r,this.timeout=s,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var r;return this._hasReceived(e)&&t((r=this.receivedResp)===null||r===void 0?void 0:r.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(r=>r.status===e).forEach(r=>r.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var xs;(function(n){n.SYNC="sync",n.JOIN="join",n.LEAVE="leave"})(xs||(xs={}));class Ot{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=t?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},s=>{const{onJoin:i,onLeave:o,onSync:a}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Ot.syncState(this.state,s,i,o),this.pendingDiffs.forEach(c=>{this.state=Ot.syncDiff(this.state,c,i,o)}),this.pendingDiffs=[],a()}),this.channel._on(r.diff,{},s=>{const{onJoin:i,onLeave:o,onSync:a}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(s):(this.state=Ot.syncDiff(this.state,s,i,o),a())}),this.onJoin((s,i,o)=>{this.channel._trigger("presence",{event:"join",key:s,currentPresences:i,newPresences:o})}),this.onLeave((s,i,o)=>{this.channel._trigger("presence",{event:"leave",key:s,currentPresences:i,leftPresences:o})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,r,s){const i=this.cloneDeep(e),o=this.transformState(t),a={},c={};return this.map(i,(u,h)=>{o[u]||(c[u]=h)}),this.map(o,(u,h)=>{const d=i[u];if(d){const f=h.map(v=>v.presence_ref),p=d.map(v=>v.presence_ref),g=h.filter(v=>p.indexOf(v.presence_ref)<0),m=d.filter(v=>f.indexOf(v.presence_ref)<0);g.length>0&&(a[u]=g),m.length>0&&(c[u]=m)}else a[u]=h}),this.syncDiff(i,{joins:a,leaves:c},r,s)}static syncDiff(e,t,r,s){const{joins:i,leaves:o}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return r||(r=()=>{}),s||(s=()=>{}),this.map(i,(a,c)=>{var u;const h=(u=e[a])!==null&&u!==void 0?u:[];if(e[a]=this.cloneDeep(c),h.length>0){const d=e[a].map(p=>p.presence_ref),f=h.filter(p=>d.indexOf(p.presence_ref)<0);e[a].unshift(...f)}r(a,h,c)}),this.map(o,(a,c)=>{let u=e[a];if(!u)return;const h=c.map(d=>d.presence_ref);u=u.filter(d=>h.indexOf(d.presence_ref)<0),e[a]=u,s(a,u,c),u.length===0&&delete e[a]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(r=>t(r,e[r]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,r)=>{const s=e[r];return"metas"in s?t[r]=s.metas.map(i=>(i.presence_ref=i.phx_ref,delete i.phx_ref,delete i.phx_ref_prev,i)):t[r]=s,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var Ns;(function(n){n.ALL="*",n.INSERT="INSERT",n.UPDATE="UPDATE",n.DELETE="DELETE"})(Ns||(Ns={}));var Us;(function(n){n.BROADCAST="broadcast",n.PRESENCE="presence",n.POSTGRES_CHANGES="postgres_changes",n.SYSTEM="system"})(Us||(Us={}));var qe;(function(n){n.SUBSCRIBED="SUBSCRIBED",n.TIMED_OUT="TIMED_OUT",n.CLOSED="CLOSED",n.CHANNEL_ERROR="CHANNEL_ERROR"})(qe||(qe={}));class Bn{constructor(e,t={config:{}},r){this.topic=e,this.params=t,this.socket=r,this.bindings={},this.state=pe.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new ir(this,Ce.join,this.params,this.timeout),this.rejoinTimer=new To(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=pe.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(s=>s.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=pe.closed,this.socket._remove(this)}),this._onError(s=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,s),this.state=pe.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=pe.errored,this.rejoinTimer.scheduleTimeout())}),this._on(Ce.reply,{},(s,i)=>{this._trigger(this._replyEventName(i),s)}),this.presence=new Ot(this),this.broadcastEndpointURL=ko(this.socket.endPoint)+"/api/broadcast",this.private=this.params.config.private||!1}subscribe(e,t=this.timeout){var r,s;if(this.socket.isConnected()||this.socket.connect(),this.state==pe.closed){const{config:{broadcast:i,presence:o,private:a}}=this.params;this._onError(h=>e?.(qe.CHANNEL_ERROR,h)),this._onClose(()=>e?.(qe.CLOSED));const c={},u={broadcast:i,presence:o,postgres_changes:(s=(r=this.bindings.postgres_changes)===null||r===void 0?void 0:r.map(h=>h.filter))!==null&&s!==void 0?s:[],private:a};this.socket.accessTokenValue&&(c.access_token=this.socket.accessTokenValue),this.updateJoinPayload(Object.assign({config:u},c)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:h})=>{var d;if(this.socket.setAuth(),h===void 0){e?.(qe.SUBSCRIBED);return}else{const f=this.bindings.postgres_changes,p=(d=f?.length)!==null&&d!==void 0?d:0,g=[];for(let m=0;m<p;m++){const v=f[m],{filter:{event:w,schema:E,table:_,filter:P}}=v,j=h&&h[m];if(j&&j.event===w&&j.schema===E&&j.table===_&&j.filter===P)g.push(Object.assign(Object.assign({},v),{id:j.id}));else{this.unsubscribe(),this.state=pe.errored,e?.(qe.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=g,e&&e(qe.SUBSCRIBED);return}}).receive("error",h=>{this.state=pe.errored,e?.(qe.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(h).join(", ")||"error")))}).receive("timeout",()=>{e?.(qe.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,r){return this._on(e,t,r)}async send(e,t={}){var r,s;if(!this._canPush()&&e.type==="broadcast"){const{event:i,payload:o}=e,c={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:o,private:this.private}]})};try{const u=await this._fetchWithTimeout(this.broadcastEndpointURL,c,(r=t.timeout)!==null&&r!==void 0?r:this.timeout);return await((s=u.body)===null||s===void 0?void 0:s.cancel()),u.ok?"ok":"error"}catch(u){return u.name==="AbortError"?"timed out":"error"}}else return new Promise(i=>{var o,a,c;const u=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((c=(a=(o=this.params)===null||o===void 0?void 0:o.config)===null||a===void 0?void 0:a.broadcast)===null||c===void 0)&&c.ack)&&i("ok"),u.receive("ok",()=>i("ok")),u.receive("error",()=>i("error")),u.receive("timeout",()=>i("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=pe.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(Ce.close,"leave",this._joinRef())};this.joinPush.destroy();let r=null;return new Promise(s=>{r=new ir(this,Ce.leave,{},e),r.receive("ok",()=>{t(),s("ok")}).receive("timeout",()=>{t(),s("timed out")}).receive("error",()=>{s("error")}),r.send(),this._canPush()||r.trigger("ok",{})}).finally(()=>{r?.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.rejoinTimer&&clearTimeout(this.rejoinTimer.timer),this.joinPush.destroy()}async _fetchWithTimeout(e,t,r){const s=new AbortController,i=setTimeout(()=>s.abort(),r),o=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:s.signal}));return clearTimeout(i),o}_push(e,t,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let s=new ir(this,e,t,r);return this._canPush()?s.send():(s.startTimeout(),this.pushBuffer.push(s)),s}_onMessage(e,t,r){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,r){var s,i;const o=e.toLocaleLowerCase(),{close:a,error:c,leave:u,join:h}=Ce;if(r&&[a,c,u,h].indexOf(o)>=0&&r!==this._joinRef())return;let f=this._onMessage(o,t,r);if(t&&!f)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(o)?(s=this.bindings.postgres_changes)===null||s===void 0||s.filter(p=>{var g,m,v;return((g=p.filter)===null||g===void 0?void 0:g.event)==="*"||((v=(m=p.filter)===null||m===void 0?void 0:m.event)===null||v===void 0?void 0:v.toLocaleLowerCase())===o}).map(p=>p.callback(f,r)):(i=this.bindings[o])===null||i===void 0||i.filter(p=>{var g,m,v,w,E,_;if(["broadcast","presence","postgres_changes"].includes(o))if("id"in p){const P=p.id,j=(g=p.filter)===null||g===void 0?void 0:g.event;return P&&((m=t.ids)===null||m===void 0?void 0:m.includes(P))&&(j==="*"||j?.toLocaleLowerCase()===((v=t.data)===null||v===void 0?void 0:v.type.toLocaleLowerCase()))}else{const P=(E=(w=p?.filter)===null||w===void 0?void 0:w.event)===null||E===void 0?void 0:E.toLocaleLowerCase();return P==="*"||P===((_=t?.event)===null||_===void 0?void 0:_.toLocaleLowerCase())}else return p.type.toLocaleLowerCase()===o}).map(p=>{if(typeof f=="object"&&"ids"in f){const g=f.data,{schema:m,table:v,commit_timestamp:w,type:E,errors:_}=g;f=Object.assign(Object.assign({},{schema:m,table:v,commit_timestamp:w,eventType:E,new:{},old:{},errors:_}),this._getPayloadRecords(g))}p.callback(f,r)})}_isClosed(){return this.state===pe.closed}_isJoined(){return this.state===pe.joined}_isJoining(){return this.state===pe.joining}_isLeaving(){return this.state===pe.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,r){const s=e.toLocaleLowerCase(),i={type:s,filter:t,callback:r};return this.bindings[s]?this.bindings[s].push(i):this.bindings[s]=[i],this}_off(e,t){const r=e.toLocaleLowerCase();return this.bindings[r]=this.bindings[r].filter(s=>{var i;return!(((i=s.type)===null||i===void 0?void 0:i.toLocaleLowerCase())===r&&Bn.isEqual(s.filter,t))}),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const r in e)if(e[r]!==t[r])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(Ce.close,{},e)}_onError(e){this._on(Ce.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=pe.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=Is(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=Is(e.columns,e.old_record)),t}}const Ds=()=>{},sl=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class il{constructor(e,t){var r;this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=Eo,this.heartbeatIntervalMs=25e3,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=Ds,this.ref=0,this.logger=Ds,this.conn=null,this.sendBuffer=[],this.serializer=new Qa,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._resolveFetch=i=>{let o;return i?o=i:typeof fetch>"u"?o=(...a)=>xt(async()=>{const{default:c}=await Promise.resolve().then(()=>yt);return{default:c}},void 0).then(({default:c})=>c(...a)):o=fetch,(...a)=>o(...a)},this.endPoint=`${e}/${Pn.websocket}`,this.httpEndpoint=ko(e),t?.transport?this.transport=t.transport:this.transport=null,t?.params&&(this.params=t.params),t?.timeout&&(this.timeout=t.timeout),t?.logger&&(this.logger=t.logger),(t?.logLevel||t?.log_level)&&(this.logLevel=t.logLevel||t.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),t?.heartbeatIntervalMs&&(this.heartbeatIntervalMs=t.heartbeatIntervalMs);const s=(r=t?.params)===null||r===void 0?void 0:r.apikey;if(s&&(this.accessTokenValue=s,this.apiKey=s),this.reconnectAfterMs=t?.reconnectAfterMs?t.reconnectAfterMs:i=>[1e3,2e3,5e3,1e4][i-1]||1e4,this.encode=t?.encode?t.encode:(i,o)=>o(JSON.stringify(i)),this.decode=t?.decode?t.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new To(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this._resolveFetch(t?.fetch),t?.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.worker=t?.worker||!1,this.workerUrl=t?.workerUrl}this.accessToken=t?.accessToken||null}connect(){if(!this.conn){if(this.transport||(this.transport=Ka),!this.transport)throw new Error("No transport provided");this.conn=new this.transport(this.endpointURL()),this.setupConnection()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:Ja}))}disconnect(e,t){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,t??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset(),this.channels.forEach(r=>r.teardown()))}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,t,r){this.logger(e,t,r)}connectionState(){switch(this.conn&&this.conn.readyState){case Rt.connecting:return Ze.Connecting;case Rt.open:return Ze.Open;case Rt.closing:return Ze.Closing;default:return Ze.Closed}}isConnected(){return this.connectionState()===Ze.Open}channel(e,t={config:{}}){const r=`realtime:${e}`,s=this.getChannels().find(i=>i.topic===r);if(s)return s;{const i=new Bn(`realtime:${e}`,t,this);return this.channels.push(i),i}}push(e){const{topic:t,event:r,payload:s,ref:i}=e,o=()=>{this.encode(e,a=>{var c;(c=this.conn)===null||c===void 0||c.send(a)})};this.log("push",`${t} ${r} (${i})`,s),this.isConnected()?o():this.sendBuffer.push(o)}async setAuth(e=null){let t=e||this.accessToken&&await this.accessToken()||this.accessTokenValue;this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach(r=>{const s={access_token:t,version:za};t&&r.updateJoinPayload(s),r.joinedOnce&&r._isJoined()&&r._push(Ce.access_token,{access_token:t})}))}async sendHeartbeat(){var e;if(!this.isConnected()){this.heartbeatCallback("disconnected");return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),this.heartbeatCallback("timeout"),(e=this.conn)===null||e===void 0||e.close(Ya,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.heartbeatCallback("sent"),await this.setAuth()}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(r=>r.topic===e&&(r._isJoined()||r._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_onConnMessage(e){this.decode(e.data,t=>{let{topic:r,event:s,payload:i,ref:o}=t;r==="phoenix"&&s==="phx_reply"&&this.heartbeatCallback(t.payload.status=="ok"?"ok":"error"),o&&o===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null),this.log("receive",`${i.status||""} ${r} ${s} ${o&&"("+o+")"||""}`,i),Array.from(this.channels).filter(a=>a._isMember(r)).forEach(a=>a._trigger(s,i,o)),this.stateChangeCallbacks.message.forEach(a=>a(t))})}_onConnOpen(){this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this.reconnectTimer.reset(),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this.stateChangeCallbacks.open.forEach(e=>e())}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this.workerRef.terminate()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(t=>t(e))}_onConnError(e){this.log("transport",`${e}`),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(t=>t(e))}_triggerChanError(){this.channels.forEach(e=>e._trigger(Ce.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const r=e.match(/\?/)?"&":"?",s=new URLSearchParams(t);return`${e}${r}${s}`}_workerObjectUrl(e){let t;if(e)t=e;else{const r=new Blob([sl],{type:"application/javascript"});t=URL.createObjectURL(r)}return t}}class Wn extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function de(n){return typeof n=="object"&&n!==null&&"__isStorageError"in n}class ol extends Wn{constructor(e,t){super(e),this.name="StorageApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class An extends Wn{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var al=function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(h){try{u(r.next(h))}catch(d){o(d)}}function c(h){try{u(r.throw(h))}catch(d){o(d)}}function u(h){h.done?i(h.value):s(h.value).then(a,c)}u((r=r.apply(n,e||[])).next())})};const Ao=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>xt(async()=>{const{default:r}=await Promise.resolve().then(()=>yt);return{default:r}},void 0).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)},ll=()=>al(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield xt(()=>Promise.resolve().then(()=>yt),void 0)).Response:Response}),$n=n=>{if(Array.isArray(n))return n.map(t=>$n(t));if(typeof n=="function"||n!==Object(n))return n;const e={};return Object.entries(n).forEach(([t,r])=>{const s=t.replace(/([-_][a-z])/gi,i=>i.toUpperCase().replace(/[-_]/g,""));e[s]=$n(r)}),e};var tt=function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(h){try{u(r.next(h))}catch(d){o(d)}}function c(h){try{u(r.throw(h))}catch(d){o(d)}}function u(h){h.done?i(h.value):s(h.value).then(a,c)}u((r=r.apply(n,e||[])).next())})};const or=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),cl=(n,e,t)=>tt(void 0,void 0,void 0,function*(){const r=yield ll();n instanceof r&&!t?.noResolveJson?n.json().then(s=>{e(new ol(or(s),n.status||500))}).catch(s=>{e(new An(or(s),s))}):e(new An(or(n),n))}),ul=(n,e,t,r)=>{const s={method:n,headers:e?.headers||{}};return n==="GET"?s:(s.headers=Object.assign({"Content-Type":"application/json"},e?.headers),r&&(s.body=JSON.stringify(r)),Object.assign(Object.assign({},s),t))};function Nt(n,e,t,r,s,i){return tt(this,void 0,void 0,function*(){return new Promise((o,a)=>{n(t,ul(e,r,s,i)).then(c=>{if(!c.ok)throw c;return r?.noResolveJson?c:c.json()}).then(c=>o(c)).catch(c=>cl(c,a,r))})})}function Vt(n,e,t,r){return tt(this,void 0,void 0,function*(){return Nt(n,"GET",e,t,r)})}function He(n,e,t,r,s){return tt(this,void 0,void 0,function*(){return Nt(n,"POST",e,r,s,t)})}function dl(n,e,t,r,s){return tt(this,void 0,void 0,function*(){return Nt(n,"PUT",e,r,s,t)})}function hl(n,e,t,r){return tt(this,void 0,void 0,function*(){return Nt(n,"HEAD",e,Object.assign(Object.assign({},t),{noResolveJson:!0}),r)})}function $o(n,e,t,r,s){return tt(this,void 0,void 0,function*(){return Nt(n,"DELETE",e,r,s,t)})}var _e=function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(h){try{u(r.next(h))}catch(d){o(d)}}function c(h){try{u(r.throw(h))}catch(d){o(d)}}function u(h){h.done?i(h.value):s(h.value).then(a,c)}u((r=r.apply(n,e||[])).next())})};const fl={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Ls={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class pl{constructor(e,t={},r,s){this.url=e,this.headers=t,this.bucketId=r,this.fetch=Ao(s)}uploadOrUpdate(e,t,r,s){return _e(this,void 0,void 0,function*(){try{let i;const o=Object.assign(Object.assign({},Ls),s);let a=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(o.upsert)});const c=o.metadata;typeof Blob<"u"&&r instanceof Blob?(i=new FormData,i.append("cacheControl",o.cacheControl),c&&i.append("metadata",this.encodeMetadata(c)),i.append("",r)):typeof FormData<"u"&&r instanceof FormData?(i=r,i.append("cacheControl",o.cacheControl),c&&i.append("metadata",this.encodeMetadata(c))):(i=r,a["cache-control"]=`max-age=${o.cacheControl}`,a["content-type"]=o.contentType,c&&(a["x-metadata"]=this.toBase64(this.encodeMetadata(c)))),s?.headers&&(a=Object.assign(Object.assign({},a),s.headers));const u=this._removeEmptyFolders(t),h=this._getFinalPath(u),d=yield this.fetch(`${this.url}/object/${h}`,Object.assign({method:e,body:i,headers:a},o?.duplex?{duplex:o.duplex}:{})),f=yield d.json();return d.ok?{data:{path:u,id:f.Id,fullPath:f.Key},error:null}:{data:null,error:f}}catch(i){if(de(i))return{data:null,error:i};throw i}})}upload(e,t,r){return _e(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,r)})}uploadToSignedUrl(e,t,r,s){return _e(this,void 0,void 0,function*(){const i=this._removeEmptyFolders(e),o=this._getFinalPath(i),a=new URL(this.url+`/object/upload/sign/${o}`);a.searchParams.set("token",t);try{let c;const u=Object.assign({upsert:Ls.upsert},s),h=Object.assign(Object.assign({},this.headers),{"x-upsert":String(u.upsert)});typeof Blob<"u"&&r instanceof Blob?(c=new FormData,c.append("cacheControl",u.cacheControl),c.append("",r)):typeof FormData<"u"&&r instanceof FormData?(c=r,c.append("cacheControl",u.cacheControl)):(c=r,h["cache-control"]=`max-age=${u.cacheControl}`,h["content-type"]=u.contentType);const d=yield this.fetch(a.toString(),{method:"PUT",body:c,headers:h}),f=yield d.json();return d.ok?{data:{path:i,fullPath:f.Key},error:null}:{data:null,error:f}}catch(c){if(de(c))return{data:null,error:c};throw c}})}createSignedUploadUrl(e,t){return _e(this,void 0,void 0,function*(){try{let r=this._getFinalPath(e);const s=Object.assign({},this.headers);t?.upsert&&(s["x-upsert"]="true");const i=yield He(this.fetch,`${this.url}/object/upload/sign/${r}`,{},{headers:s}),o=new URL(this.url+i.url),a=o.searchParams.get("token");if(!a)throw new Wn("No token returned by API");return{data:{signedUrl:o.toString(),path:e,token:a},error:null}}catch(r){if(de(r))return{data:null,error:r};throw r}})}update(e,t,r){return _e(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,r)})}move(e,t,r){return _e(this,void 0,void 0,function*(){try{return{data:yield He(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:r?.destinationBucket},{headers:this.headers}),error:null}}catch(s){if(de(s))return{data:null,error:s};throw s}})}copy(e,t,r){return _e(this,void 0,void 0,function*(){try{return{data:{path:(yield He(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:r?.destinationBucket},{headers:this.headers})).Key},error:null}}catch(s){if(de(s))return{data:null,error:s};throw s}})}createSignedUrl(e,t,r){return _e(this,void 0,void 0,function*(){try{let s=this._getFinalPath(e),i=yield He(this.fetch,`${this.url}/object/sign/${s}`,Object.assign({expiresIn:t},r?.transform?{transform:r.transform}:{}),{headers:this.headers});const o=r?.download?`&download=${r.download===!0?"":r.download}`:"";return i={signedUrl:encodeURI(`${this.url}${i.signedURL}${o}`)},{data:i,error:null}}catch(s){if(de(s))return{data:null,error:s};throw s}})}createSignedUrls(e,t,r){return _e(this,void 0,void 0,function*(){try{const s=yield He(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),i=r?.download?`&download=${r.download===!0?"":r.download}`:"";return{data:s.map(o=>Object.assign(Object.assign({},o),{signedUrl:o.signedURL?encodeURI(`${this.url}${o.signedURL}${i}`):null})),error:null}}catch(s){if(de(s))return{data:null,error:s};throw s}})}download(e,t){return _e(this,void 0,void 0,function*(){const s=typeof t?.transform<"u"?"render/image/authenticated":"object",i=this.transformOptsToQueryString(t?.transform||{}),o=i?`?${i}`:"";try{const a=this._getFinalPath(e);return{data:yield(yield Vt(this.fetch,`${this.url}/${s}/${a}${o}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(a){if(de(a))return{data:null,error:a};throw a}})}info(e){return _e(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const r=yield Vt(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:$n(r),error:null}}catch(r){if(de(r))return{data:null,error:r};throw r}})}exists(e){return _e(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield hl(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(r){if(de(r)&&r instanceof An){const s=r.originalError;if([400,404].includes(s?.status))return{data:!1,error:r}}throw r}})}getPublicUrl(e,t){const r=this._getFinalPath(e),s=[],i=t?.download?`download=${t.download===!0?"":t.download}`:"";i!==""&&s.push(i);const a=typeof t?.transform<"u"?"render/image":"object",c=this.transformOptsToQueryString(t?.transform||{});c!==""&&s.push(c);let u=s.join("&");return u!==""&&(u=`?${u}`),{data:{publicUrl:encodeURI(`${this.url}/${a}/public/${r}${u}`)}}}remove(e){return _e(this,void 0,void 0,function*(){try{return{data:yield $o(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(de(t))return{data:null,error:t};throw t}})}list(e,t,r){return _e(this,void 0,void 0,function*(){try{const s=Object.assign(Object.assign(Object.assign({},fl),t),{prefix:e||""});return{data:yield He(this.fetch,`${this.url}/object/list/${this.bucketId}`,s,{headers:this.headers},r),error:null}}catch(s){if(de(s))return{data:null,error:s};throw s}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const gl="2.7.1",vl={"X-Client-Info":`storage-js/${gl}`};var at=function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(h){try{u(r.next(h))}catch(d){o(d)}}function c(h){try{u(r.throw(h))}catch(d){o(d)}}function u(h){h.done?i(h.value):s(h.value).then(a,c)}u((r=r.apply(n,e||[])).next())})};class ml{constructor(e,t={},r){this.url=e,this.headers=Object.assign(Object.assign({},vl),t),this.fetch=Ao(r)}listBuckets(){return at(this,void 0,void 0,function*(){try{return{data:yield Vt(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(de(e))return{data:null,error:e};throw e}})}getBucket(e){return at(this,void 0,void 0,function*(){try{return{data:yield Vt(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(de(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return at(this,void 0,void 0,function*(){try{return{data:yield He(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(de(r))return{data:null,error:r};throw r}})}updateBucket(e,t){return at(this,void 0,void 0,function*(){try{return{data:yield dl(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(de(r))return{data:null,error:r};throw r}})}emptyBucket(e){return at(this,void 0,void 0,function*(){try{return{data:yield He(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(de(t))return{data:null,error:t};throw t}})}deleteBucket(e){return at(this,void 0,void 0,function*(){try{return{data:yield $o(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(de(t))return{data:null,error:t};throw t}})}}class yl extends ml{constructor(e,t={},r){super(e,t,r)}from(e){return new pl(this.url,this.headers,e,this.fetch)}}const _l="2.50.5";let At="";typeof Deno<"u"?At="deno":typeof document<"u"?At="web":typeof navigator<"u"&&navigator.product==="ReactNative"?At="react-native":At="node";const wl={"X-Client-Info":`supabase-js-${At}/${_l}`},bl={headers:wl},Sl={schema:"public"},El={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},Tl={};var Pl=function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(h){try{u(r.next(h))}catch(d){o(d)}}function c(h){try{u(r.throw(h))}catch(d){o(d)}}function u(h){h.done?i(h.value):s(h.value).then(a,c)}u((r=r.apply(n,e||[])).next())})};const kl=n=>{let e;return n?e=n:typeof fetch>"u"?e=mo:e=fetch,(...t)=>e(...t)},Al=()=>typeof Headers>"u"?yo:Headers,$l=(n,e,t)=>{const r=kl(t),s=Al();return(i,o)=>Pl(void 0,void 0,void 0,function*(){var a;const c=(a=yield e())!==null&&a!==void 0?a:n;let u=new s(o?.headers);return u.has("apikey")||u.set("apikey",n),u.has("Authorization")||u.set("Authorization",`Bearer ${c}`),r(i,Object.assign(Object.assign({},o),{headers:u}))})};var Rl=function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(h){try{u(r.next(h))}catch(d){o(d)}}function c(h){try{u(r.throw(h))}catch(d){o(d)}}function u(h){h.done?i(h.value):s(h.value).then(a,c)}u((r=r.apply(n,e||[])).next())})};function Ol(n){return n.endsWith("/")?n:n+"/"}function jl(n,e){var t,r;const{db:s,auth:i,realtime:o,global:a}=n,{db:c,auth:u,realtime:h,global:d}=e,f={db:Object.assign(Object.assign({},c),s),auth:Object.assign(Object.assign({},u),i),realtime:Object.assign(Object.assign({},h),o),global:Object.assign(Object.assign(Object.assign({},d),a),{headers:Object.assign(Object.assign({},(t=d?.headers)!==null&&t!==void 0?t:{}),(r=a?.headers)!==null&&r!==void 0?r:{})}),accessToken:()=>Rl(this,void 0,void 0,function*(){return""})};return n.accessToken?f.accessToken=n.accessToken:delete f.accessToken,f}const Ro="2.70.0",ht=30*1e3,Rn=3,ar=Rn*ht,Cl="http://localhost:9999",Il="supabase.auth.token",xl={"X-Client-Info":`gotrue-js/${Ro}`},On="X-Supabase-Api-Version",Oo={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},Nl=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,Ul=6e5;class Hn extends Error{constructor(e,t,r){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=r}}function G(n){return typeof n=="object"&&n!==null&&"__isAuthError"in n}class Dl extends Hn{constructor(e,t,r){super(e,t,r),this.name="AuthApiError",this.status=t,this.code=r}}function Ll(n){return G(n)&&n.name==="AuthApiError"}class jo extends Hn{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class Ke extends Hn{constructor(e,t,r,s){super(e,r,s),this.name=t,this.status=r}}class Be extends Ke{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function ql(n){return G(n)&&n.name==="AuthSessionMissingError"}class qt extends Ke{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Mt extends Ke{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class Ft extends Ke{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function Ml(n){return G(n)&&n.name==="AuthImplicitGrantRedirectError"}class qs extends Ke{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class jn extends Ke{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function lr(n){return G(n)&&n.name==="AuthRetryableFetchError"}class Ms extends Ke{constructor(e,t,r){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=r}}class jt extends Ke{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const zt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),Fs=` 	
\r=`.split(""),Fl=(()=>{const n=new Array(128);for(let e=0;e<n.length;e+=1)n[e]=-1;for(let e=0;e<Fs.length;e+=1)n[Fs[e].charCodeAt(0)]=-2;for(let e=0;e<zt.length;e+=1)n[zt[e].charCodeAt(0)]=e;return n})();function Bs(n,e,t){if(n!==null)for(e.queue=e.queue<<8|n,e.queuedBits+=8;e.queuedBits>=6;){const r=e.queue>>e.queuedBits-6&63;t(zt[r]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const r=e.queue>>e.queuedBits-6&63;t(zt[r]),e.queuedBits-=6}}function Co(n,e,t){const r=Fl[n];if(r>-1)for(e.queue=e.queue<<6|r,e.queuedBits+=6;e.queuedBits>=8;)t(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(r===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(n)}"`)}}function Ws(n){const e=[],t=o=>{e.push(String.fromCodePoint(o))},r={utf8seq:0,codepoint:0},s={queue:0,queuedBits:0},i=o=>{Hl(o,r,t)};for(let o=0;o<n.length;o+=1)Co(n.charCodeAt(o),s,i);return e.join("")}function Bl(n,e){if(n<=127){e(n);return}else if(n<=2047){e(192|n>>6),e(128|n&63);return}else if(n<=65535){e(224|n>>12),e(128|n>>6&63),e(128|n&63);return}else if(n<=1114111){e(240|n>>18),e(128|n>>12&63),e(128|n>>6&63),e(128|n&63);return}throw new Error(`Unrecognized Unicode codepoint: ${n.toString(16)}`)}function Wl(n,e){for(let t=0;t<n.length;t+=1){let r=n.charCodeAt(t);if(r>55295&&r<=56319){const s=(r-55296)*1024&65535;r=(n.charCodeAt(t+1)-56320&65535|s)+65536,t+=1}Bl(r,e)}}function Hl(n,e,t){if(e.utf8seq===0){if(n<=127){t(n);return}for(let r=1;r<6;r+=1)if((n>>7-r&1)===0){e.utf8seq=r;break}if(e.utf8seq===2)e.codepoint=n&31;else if(e.utf8seq===3)e.codepoint=n&15;else if(e.utf8seq===4)e.codepoint=n&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(n<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|n&63,e.utf8seq-=1,e.utf8seq===0&&t(e.codepoint)}}function Gl(n){const e=[],t={queue:0,queuedBits:0},r=s=>{e.push(s)};for(let s=0;s<n.length;s+=1)Co(n.charCodeAt(s),t,r);return new Uint8Array(e)}function Kl(n){const e=[];return Wl(n,t=>e.push(t)),new Uint8Array(e)}function Vl(n){const e=[],t={queue:0,queuedBits:0},r=s=>{e.push(s)};return n.forEach(s=>Bs(s,t,r)),Bs(null,t,r),e.join("")}function zl(n){return Math.round(Date.now()/1e3)+n}function Jl(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){const e=Math.random()*16|0;return(n=="x"?e:e&3|8).toString(16)})}const je=()=>typeof window<"u"&&typeof document<"u",Ye={tested:!1,writable:!1},Ct=()=>{if(!je())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(Ye.tested)return Ye.writable;const n=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(n,n),globalThis.localStorage.removeItem(n),Ye.tested=!0,Ye.writable=!0}catch{Ye.tested=!0,Ye.writable=!1}return Ye.writable};function Yl(n){const e={},t=new URL(n);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((s,i)=>{e[i]=s})}catch{}return t.searchParams.forEach((r,s)=>{e[s]=r}),e}const Io=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>xt(async()=>{const{default:r}=await Promise.resolve().then(()=>yt);return{default:r}},void 0).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)},Ql=n=>typeof n=="object"&&n!==null&&"status"in n&&"ok"in n&&"json"in n&&typeof n.json=="function",xo=async(n,e,t)=>{await n.setItem(e,JSON.stringify(t))},Bt=async(n,e)=>{const t=await n.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},Wt=async(n,e)=>{await n.removeItem(e)};class Yt{constructor(){this.promise=new Yt.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}Yt.promiseConstructor=Promise;function cr(n){const e=n.split(".");if(e.length!==3)throw new jt("Invalid JWT structure");for(let r=0;r<e.length;r++)if(!Nl.test(e[r]))throw new jt("JWT not in base64url format");return{header:JSON.parse(Ws(e[0])),payload:JSON.parse(Ws(e[1])),signature:Gl(e[2]),raw:{header:e[0],payload:e[1]}}}async function Xl(n){return await new Promise(e=>{setTimeout(()=>e(null),n)})}function Zl(n,e){return new Promise((r,s)=>{(async()=>{for(let i=0;i<1/0;i++)try{const o=await n(i);if(!e(i,null,o)){r(o);return}}catch(o){if(!e(i,o)){s(o);return}}})()})}function ec(n){return("0"+n.toString(16)).substr(-2)}function tc(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",r=t.length;let s="";for(let i=0;i<56;i++)s+=t.charAt(Math.floor(Math.random()*r));return s}return crypto.getRandomValues(e),Array.from(e,ec).join("")}async function rc(n){const t=new TextEncoder().encode(n),r=await crypto.subtle.digest("SHA-256",t),s=new Uint8Array(r);return Array.from(s).map(i=>String.fromCharCode(i)).join("")}async function nc(n){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),n;const t=await rc(n);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function lt(n,e,t=!1){const r=tc();let s=r;t&&(s+="/PASSWORD_RECOVERY"),await xo(n,`${e}-code-verifier`,s);const i=await nc(r);return[i,r===i?"plain":"s256"]}const sc=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function ic(n){const e=n.headers.get(On);if(!e||!e.match(sc))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function oc(n){if(!n)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(n<=e)throw new Error("JWT has expired")}function ac(n){switch(n){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const lc=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function ct(n){if(!lc.test(n))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}var cc=function(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(n);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(n,r[s])&&(t[r[s]]=n[r[s]]);return t};const Xe=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),uc=[502,503,504];async function Hs(n){var e;if(!Ql(n))throw new jn(Xe(n),0);if(uc.includes(n.status))throw new jn(Xe(n),n.status);let t;try{t=await n.json()}catch(i){throw new jo(Xe(i),i)}let r;const s=ic(n);if(s&&s.getTime()>=Oo["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?r=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(r=t.error_code),r){if(r==="weak_password")throw new Ms(Xe(t),n.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(r==="session_not_found")throw new Be}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((i,o)=>i&&typeof o=="string",!0))throw new Ms(Xe(t),n.status,t.weak_password.reasons);throw new Dl(Xe(t),n.status||500,r)}const dc=(n,e,t,r)=>{const s={method:n,headers:e?.headers||{}};return n==="GET"?s:(s.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e?.headers),s.body=JSON.stringify(r),Object.assign(Object.assign({},s),t))};async function z(n,e,t,r){var s;const i=Object.assign({},r?.headers);i[On]||(i[On]=Oo["2024-01-01"].name),r?.jwt&&(i.Authorization=`Bearer ${r.jwt}`);const o=(s=r?.query)!==null&&s!==void 0?s:{};r?.redirectTo&&(o.redirect_to=r.redirectTo);const a=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",c=await hc(n,e,t+a,{headers:i,noResolveJson:r?.noResolveJson},{},r?.body);return r?.xform?r?.xform(c):{data:Object.assign({},c),error:null}}async function hc(n,e,t,r,s,i){const o=dc(e,r,s,i);let a;try{a=await n(t,Object.assign({},o))}catch(c){throw console.error(c),new jn(Xe(c),0)}if(a.ok||await Hs(a),r?.noResolveJson)return a;try{return await a.json()}catch(c){await Hs(c)}}function Le(n){var e;let t=null;vc(n)&&(t=Object.assign({},n),n.expires_at||(t.expires_at=zl(n.expires_in)));const r=(e=n.user)!==null&&e!==void 0?e:n;return{data:{session:t,user:r},error:null}}function Gs(n){const e=Le(n);return!e.error&&n.weak_password&&typeof n.weak_password=="object"&&Array.isArray(n.weak_password.reasons)&&n.weak_password.reasons.length&&n.weak_password.message&&typeof n.weak_password.message=="string"&&n.weak_password.reasons.reduce((t,r)=>t&&typeof r=="string",!0)&&(e.data.weak_password=n.weak_password),e}function Ge(n){var e;return{data:{user:(e=n.user)!==null&&e!==void 0?e:n},error:null}}function fc(n){return{data:n,error:null}}function pc(n){const{action_link:e,email_otp:t,hashed_token:r,redirect_to:s,verification_type:i}=n,o=cc(n,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),a={action_link:e,email_otp:t,hashed_token:r,redirect_to:s,verification_type:i},c=Object.assign({},o);return{data:{properties:a,user:c},error:null}}function gc(n){return n}function vc(n){return n.access_token&&n.refresh_token&&n.expires_in}const ur=["global","local","others"];var mc=function(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(n);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(n,r[s])&&(t[r[s]]=n[r[s]]);return t};class yc{constructor({url:e="",headers:t={},fetch:r}){this.url=e,this.headers=t,this.fetch=Io(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t=ur[0]){if(ur.indexOf(t)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${ur.join(", ")}`);try{return await z(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(r){if(G(r))return{data:null,error:r};throw r}}async inviteUserByEmail(e,t={}){try{return await z(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:Ge})}catch(r){if(G(r))return{data:{user:null},error:r};throw r}}async generateLink(e){try{const{options:t}=e,r=mc(e,["options"]),s=Object.assign(Object.assign({},r),t);return"newEmail"in r&&(s.new_email=r?.newEmail,delete s.newEmail),await z(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:s,headers:this.headers,xform:pc,redirectTo:t?.redirectTo})}catch(t){if(G(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await z(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:Ge})}catch(t){if(G(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,r,s,i,o,a,c;try{const u={nextPage:null,lastPage:0,total:0},h=await z(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(t=e?.page)===null||t===void 0?void 0:t.toString())!==null&&r!==void 0?r:"",per_page:(i=(s=e?.perPage)===null||s===void 0?void 0:s.toString())!==null&&i!==void 0?i:""},xform:gc});if(h.error)throw h.error;const d=await h.json(),f=(o=h.headers.get("x-total-count"))!==null&&o!==void 0?o:0,p=(c=(a=h.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&c!==void 0?c:[];return p.length>0&&(p.forEach(g=>{const m=parseInt(g.split(";")[0].split("=")[1].substring(0,1)),v=JSON.parse(g.split(";")[1].split("=")[1]);u[`${v}Page`]=m}),u.total=parseInt(f)),{data:Object.assign(Object.assign({},d),u),error:null}}catch(u){if(G(u))return{data:{users:[]},error:u};throw u}}async getUserById(e){ct(e);try{return await z(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:Ge})}catch(t){if(G(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){ct(e);try{return await z(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:Ge})}catch(r){if(G(r))return{data:{user:null},error:r};throw r}}async deleteUser(e,t=!1){ct(e);try{return await z(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:Ge})}catch(r){if(G(r))return{data:{user:null},error:r};throw r}}async _listFactors(e){ct(e.userId);try{const{data:t,error:r}=await z(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:s=>({data:{factors:s},error:null})});return{data:t,error:r}}catch(t){if(G(t))return{data:null,error:t};throw t}}async _deleteFactor(e){ct(e.userId),ct(e.id);try{return{data:await z(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(G(t))return{data:null,error:t};throw t}}}const _c={getItem:n=>Ct()?globalThis.localStorage.getItem(n):null,setItem:(n,e)=>{Ct()&&globalThis.localStorage.setItem(n,e)},removeItem:n=>{Ct()&&globalThis.localStorage.removeItem(n)}};function Ks(n={}){return{getItem:e=>n[e]||null,setItem:(e,t)=>{n[e]=t},removeItem:e=>{delete n[e]}}}function wc(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const ut={debug:!!(globalThis&&Ct()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class No extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class bc extends No{}async function Sc(n,e,t){ut.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",n,e);const r=new globalThis.AbortController;return e>0&&setTimeout(()=>{r.abort(),ut.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",n)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(n,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},async s=>{if(s){ut.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",n,s.name);try{return await t()}finally{ut.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",n,s.name)}}else{if(e===0)throw ut.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",n),new bc(`Acquiring an exclusive Navigator LockManager lock "${n}" immediately failed`);if(ut.debug)try{const i=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(i,null,"  "))}catch(i){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",i)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}}))}wc();const Ec={url:Cl,storageKey:Il,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:xl,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function Vs(n,e,t){return await t()}class It{constructor(e){var t,r;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=It.nextInstanceID,It.nextInstanceID+=1,this.instanceID>0&&je()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const s=Object.assign(Object.assign({},Ec),e);if(this.logDebugMessages=!!s.debug,typeof s.debug=="function"&&(this.logger=s.debug),this.persistSession=s.persistSession,this.storageKey=s.storageKey,this.autoRefreshToken=s.autoRefreshToken,this.admin=new yc({url:s.url,headers:s.headers,fetch:s.fetch}),this.url=s.url,this.headers=s.headers,this.fetch=Io(s.fetch),this.lock=s.lock||Vs,this.detectSessionInUrl=s.detectSessionInUrl,this.flowType=s.flowType,this.hasCustomAuthorizationHeader=s.hasCustomAuthorizationHeader,s.lock?this.lock=s.lock:je()&&(!((t=globalThis?.navigator)===null||t===void 0)&&t.locks)?this.lock=Sc:this.lock=Vs,this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?s.storage?this.storage=s.storage:Ct()?this.storage=_c:(this.memoryStorage={},this.storage=Ks(this.memoryStorage)):(this.memoryStorage={},this.storage=Ks(this.memoryStorage)),je()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(i){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",i)}(r=this.broadcastChannel)===null||r===void 0||r.addEventListener("message",async i=>{this._debug("received broadcast notification from other tab or client",i),await this._notifyAllSubscribers(i.data.event,i.data.session,!1)})}this.initialize()}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${Ro}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{const t=Yl(window.location.href);let r="none";if(this._isImplicitGrantCallback(t)?r="implicit":await this._isPKCECallback(t)&&(r="pkce"),je()&&this.detectSessionInUrl&&r!=="none"){const{data:s,error:i}=await this._getSessionFromURL(t,r);if(i){if(this._debug("#_initialize()","error detecting session from URL",i),Ml(i)){const c=(e=i.details)===null||e===void 0?void 0:e.code;if(c==="identity_already_exists"||c==="identity_not_found"||c==="single_identity_not_deletable")return{error:i}}return await this._removeSession(),{error:i}}const{session:o,redirectType:a}=s;return this._debug("#_initialize()","detected session in URL",o,"redirect type",a),await this._saveSession(o),setTimeout(async()=>{a==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",o):await this._notifyAllSubscribers("SIGNED_IN",o)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return G(t)?{error:t}:{error:new jo("Unexpected error during initialization",t)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,r,s;try{const i=await z(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(r=(t=e?.options)===null||t===void 0?void 0:t.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:(s=e?.options)===null||s===void 0?void 0:s.captchaToken}},xform:Le}),{data:o,error:a}=i;if(a||!o)return{data:{user:null,session:null},error:a};const c=o.session,u=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:u,session:c},error:null}}catch(i){if(G(i))return{data:{user:null,session:null},error:i};throw i}}async signUp(e){var t,r,s;try{let i;if("email"in e){const{email:h,password:d,options:f}=e;let p=null,g=null;this.flowType==="pkce"&&([p,g]=await lt(this.storage,this.storageKey)),i=await z(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:f?.emailRedirectTo,body:{email:h,password:d,data:(t=f?.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:f?.captchaToken},code_challenge:p,code_challenge_method:g},xform:Le})}else if("phone"in e){const{phone:h,password:d,options:f}=e;i=await z(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:h,password:d,data:(r=f?.data)!==null&&r!==void 0?r:{},channel:(s=f?.channel)!==null&&s!==void 0?s:"sms",gotrue_meta_security:{captcha_token:f?.captchaToken}},xform:Le})}else throw new Mt("You must provide either an email or phone number and a password");const{data:o,error:a}=i;if(a||!o)return{data:{user:null,session:null},error:a};const c=o.session,u=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:u,session:c},error:null}}catch(i){if(G(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithPassword(e){try{let t;if("email"in e){const{email:i,password:o,options:a}=e;t=await z(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:i,password:o,gotrue_meta_security:{captcha_token:a?.captchaToken}},xform:Gs})}else if("phone"in e){const{phone:i,password:o,options:a}=e;t=await z(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:i,password:o,gotrue_meta_security:{captcha_token:a?.captchaToken}},xform:Gs})}else throw new Mt("You must provide either an email or phone number and a password");const{data:r,error:s}=t;return s?{data:{user:null,session:null},error:s}:!r||!r.session||!r.user?{data:{user:null,session:null},error:new qt}:(r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),{data:Object.assign({user:r.user,session:r.session},r.weak_password?{weakPassword:r.weak_password}:null),error:s})}catch(t){if(G(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,r,s,i;return await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(r=e.options)===null||r===void 0?void 0:r.scopes,queryParams:(s=e.options)===null||s===void 0?void 0:s.queryParams,skipBrowserRedirect:(i=e.options)===null||i===void 0?void 0:i.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:t}=e;if(t==="solana")return await this.signInWithSolana(e);throw new Error(`@supabase/auth-js: Unsupported chain "${t}"`)}async signInWithSolana(e){var t,r,s,i,o,a,c,u,h,d,f,p;let g,m;if("message"in e)g=e.message,m=e.signature;else{const{chain:v,wallet:w,statement:E,options:_}=e;let P;if(je())if(typeof w=="object")P=w;else{const U=window;if("solana"in U&&typeof U.solana=="object"&&("signIn"in U.solana&&typeof U.solana.signIn=="function"||"signMessage"in U.solana&&typeof U.solana.signMessage=="function"))P=U.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof w!="object"||!_?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");P=w}const j=new URL((t=_?.url)!==null&&t!==void 0?t:window.location.href);if("signIn"in P&&P.signIn){const U=await P.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},_?.signInWithSolana),{version:"1",domain:j.host,uri:j.href}),E?{statement:E}:null));let q;if(Array.isArray(U)&&U[0]&&typeof U[0]=="object")q=U[0];else if(U&&typeof U=="object"&&"signedMessage"in U&&"signature"in U)q=U;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in q&&"signature"in q&&(typeof q.signedMessage=="string"||q.signedMessage instanceof Uint8Array)&&q.signature instanceof Uint8Array)g=typeof q.signedMessage=="string"?q.signedMessage:new TextDecoder().decode(q.signedMessage),m=q.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in P)||typeof P.signMessage!="function"||!("publicKey"in P)||typeof P!="object"||!P.publicKey||!("toBase58"in P.publicKey)||typeof P.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");g=[`${j.host} wants you to sign in with your Solana account:`,P.publicKey.toBase58(),...E?["",E,""]:[""],"Version: 1",`URI: ${j.href}`,`Issued At: ${(s=(r=_?.signInWithSolana)===null||r===void 0?void 0:r.issuedAt)!==null&&s!==void 0?s:new Date().toISOString()}`,...!((i=_?.signInWithSolana)===null||i===void 0)&&i.notBefore?[`Not Before: ${_.signInWithSolana.notBefore}`]:[],...!((o=_?.signInWithSolana)===null||o===void 0)&&o.expirationTime?[`Expiration Time: ${_.signInWithSolana.expirationTime}`]:[],...!((a=_?.signInWithSolana)===null||a===void 0)&&a.chainId?[`Chain ID: ${_.signInWithSolana.chainId}`]:[],...!((c=_?.signInWithSolana)===null||c===void 0)&&c.nonce?[`Nonce: ${_.signInWithSolana.nonce}`]:[],...!((u=_?.signInWithSolana)===null||u===void 0)&&u.requestId?[`Request ID: ${_.signInWithSolana.requestId}`]:[],...!((d=(h=_?.signInWithSolana)===null||h===void 0?void 0:h.resources)===null||d===void 0)&&d.length?["Resources",..._.signInWithSolana.resources.map(q=>`- ${q}`)]:[]].join(`
`);const U=await P.signMessage(new TextEncoder().encode(g),"utf8");if(!U||!(U instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");m=U}}try{const{data:v,error:w}=await z(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:g,signature:Vl(m)},!((f=e.options)===null||f===void 0)&&f.captchaToken?{gotrue_meta_security:{captcha_token:(p=e.options)===null||p===void 0?void 0:p.captchaToken}}:null),xform:Le});if(w)throw w;return!v||!v.session||!v.user?{data:{user:null,session:null},error:new qt}:(v.session&&(await this._saveSession(v.session),await this._notifyAllSubscribers("SIGNED_IN",v.session)),{data:Object.assign({},v),error:w})}catch(v){if(G(v))return{data:{user:null,session:null},error:v};throw v}}async _exchangeCodeForSession(e){const t=await Bt(this.storage,`${this.storageKey}-code-verifier`),[r,s]=(t??"").split("/");try{const{data:i,error:o}=await z(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:r},xform:Le});if(await Wt(this.storage,`${this.storageKey}-code-verifier`),o)throw o;return!i||!i.session||!i.user?{data:{user:null,session:null,redirectType:null},error:new qt}:(i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",i.session)),{data:Object.assign(Object.assign({},i),{redirectType:s??null}),error:o})}catch(i){if(G(i))return{data:{user:null,session:null,redirectType:null},error:i};throw i}}async signInWithIdToken(e){try{const{options:t,provider:r,token:s,access_token:i,nonce:o}=e,a=await z(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:s,access_token:i,nonce:o,gotrue_meta_security:{captcha_token:t?.captchaToken}},xform:Le}),{data:c,error:u}=a;return u?{data:{user:null,session:null},error:u}:!c||!c.session||!c.user?{data:{user:null,session:null},error:new qt}:(c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",c.session)),{data:c,error:u})}catch(t){if(G(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,r,s,i,o;try{if("email"in e){const{email:a,options:c}=e;let u=null,h=null;this.flowType==="pkce"&&([u,h]=await lt(this.storage,this.storageKey));const{error:d}=await z(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:a,data:(t=c?.data)!==null&&t!==void 0?t:{},create_user:(r=c?.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:c?.captchaToken},code_challenge:u,code_challenge_method:h},redirectTo:c?.emailRedirectTo});return{data:{user:null,session:null},error:d}}if("phone"in e){const{phone:a,options:c}=e,{data:u,error:h}=await z(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:a,data:(s=c?.data)!==null&&s!==void 0?s:{},create_user:(i=c?.shouldCreateUser)!==null&&i!==void 0?i:!0,gotrue_meta_security:{captcha_token:c?.captchaToken},channel:(o=c?.channel)!==null&&o!==void 0?o:"sms"}});return{data:{user:null,session:null,messageId:u?.message_id},error:h}}throw new Mt("You must provide either an email or phone number.")}catch(a){if(G(a))return{data:{user:null,session:null},error:a};throw a}}async verifyOtp(e){var t,r;try{let s,i;"options"in e&&(s=(t=e.options)===null||t===void 0?void 0:t.redirectTo,i=(r=e.options)===null||r===void 0?void 0:r.captchaToken);const{data:o,error:a}=await z(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:i}}),redirectTo:s,xform:Le});if(a)throw a;if(!o)throw new Error("An error occurred on token verification.");const c=o.session,u=o.user;return c?.access_token&&(await this._saveSession(c),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",c)),{data:{user:u,session:c},error:null}}catch(s){if(G(s))return{data:{user:null,session:null},error:s};throw s}}async signInWithSSO(e){var t,r,s;try{let i=null,o=null;return this.flowType==="pkce"&&([i,o]=await lt(this.storage,this.storageKey)),await z(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(r=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&r!==void 0?r:void 0}),!((s=e?.options)===null||s===void 0)&&s.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:i,code_challenge_method:o}),headers:this.headers,xform:fc})}catch(i){if(G(i))return{data:null,error:i};throw i}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:r}=e;if(r)throw r;if(!t)throw new Be;const{error:s}=await z(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:s}})}catch(e){if(G(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:r,type:s,options:i}=e,{error:o}=await z(this.fetch,"POST",t,{headers:this.headers,body:{email:r,type:s,gotrue_meta_security:{captcha_token:i?.captchaToken}},redirectTo:i?.emailRedirectTo});return{data:{user:null,session:null},error:o}}else if("phone"in e){const{phone:r,type:s,options:i}=e,{data:o,error:a}=await z(this.fetch,"POST",t,{headers:this.headers,body:{phone:r,type:s,gotrue_meta_security:{captcha_token:i?.captchaToken}}});return{data:{user:null,session:null,messageId:o?.message_id},error:a}}throw new Mt("You must provide either an email or phone number and a type")}catch(t){if(G(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async t=>t))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const r=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),s=(async()=>(await r,await t()))();return this.pendingInLock.push((async()=>{try{await s}catch{}})()),s}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const r=t();for(this.pendingInLock.push((async()=>{try{await r}catch{}})()),await r;this.pendingInLock.length;){const s=[...this.pendingInLock];await Promise.all(s),this.pendingInLock.splice(0,s.length)}return await r}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await Bt(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const r=e.expires_at?e.expires_at*1e3-Date.now()<ar:!1;if(this._debug("#__loadSession()",`session has${r?"":" not"} expired`,"expires_at",e.expires_at),!r){if(this.storage.isServer){let o=this.suppressGetSessionWarning;e=new Proxy(e,{get:(c,u,h)=>(!o&&u==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),o=!0,this.suppressGetSessionWarning=!0),Reflect.get(c,u,h))})}return{data:{session:e},error:null}}const{session:s,error:i}=await this._callRefreshToken(e.refresh_token);return i?{data:{session:null},error:i}:{data:{session:s},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await z(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:Ge}):await this._useSession(async t=>{var r,s,i;const{data:o,error:a}=t;if(a)throw a;return!(!((r=o.session)===null||r===void 0)&&r.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Be}:await z(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(i=(s=o.session)===null||s===void 0?void 0:s.access_token)!==null&&i!==void 0?i:void 0,xform:Ge})})}catch(t){if(G(t))return ql(t)&&(await this._removeSession(),await Wt(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async r=>{const{data:s,error:i}=r;if(i)throw i;if(!s.session)throw new Be;const o=s.session;let a=null,c=null;this.flowType==="pkce"&&e.email!=null&&([a,c]=await lt(this.storage,this.storageKey));const{data:u,error:h}=await z(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t?.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:a,code_challenge_method:c}),jwt:o.access_token,xform:Ge});if(h)throw h;return o.user=u.user,await this._saveSession(o),await this._notifyAllSubscribers("USER_UPDATED",o),{data:{user:o.user},error:null}})}catch(r){if(G(r))return{data:{user:null},error:r};throw r}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new Be;const t=Date.now()/1e3;let r=t,s=!0,i=null;const{payload:o}=cr(e.access_token);if(o.exp&&(r=o.exp,s=r<=t),s){const{session:a,error:c}=await this._callRefreshToken(e.refresh_token);if(c)return{data:{user:null,session:null},error:c};if(!a)return{data:{user:null,session:null},error:null};i=a}else{const{data:a,error:c}=await this._getUser(e.access_token);if(c)throw c;i={access_token:e.access_token,refresh_token:e.refresh_token,user:a.user,token_type:"bearer",expires_in:r-t,expires_at:r},await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)}return{data:{user:i.user,session:i},error:null}}catch(t){if(G(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var r;if(!e){const{data:o,error:a}=t;if(a)throw a;e=(r=o.session)!==null&&r!==void 0?r:void 0}if(!e?.refresh_token)throw new Be;const{session:s,error:i}=await this._callRefreshToken(e.refresh_token);return i?{data:{user:null,session:null},error:i}:s?{data:{user:s.user,session:s},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if(G(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e,t){try{if(!je())throw new Ft("No browser detected.");if(e.error||e.error_description||e.error_code)throw new Ft(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if(this.flowType==="pkce")throw new qs("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new Ft("Not a valid implicit grant flow url.");break;default:}if(t==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new qs("No code detected.");const{data:E,error:_}=await this._exchangeCodeForSession(e.code);if(_)throw _;const P=new URL(window.location.href);return P.searchParams.delete("code"),window.history.replaceState(window.history.state,"",P.toString()),{data:{session:E.session,redirectType:null},error:null}}const{provider_token:r,provider_refresh_token:s,access_token:i,refresh_token:o,expires_in:a,expires_at:c,token_type:u}=e;if(!i||!a||!o||!u)throw new Ft("No session defined in URL");const h=Math.round(Date.now()/1e3),d=parseInt(a);let f=h+d;c&&(f=parseInt(c));const p=f-h;p*1e3<=ht&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${p}s, should have been closer to ${d}s`);const g=f-d;h-g>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",g,f,h):h-g<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",g,f,h);const{data:m,error:v}=await this._getUser(i);if(v)throw v;const w={provider_token:r,provider_refresh_token:s,access_token:i,expires_in:d,expires_at:f,refresh_token:o,token_type:u,user:m.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:w,redirectType:e.type},error:null}}catch(r){if(G(r))return{data:{session:null,redirectType:null},error:r};throw r}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await Bt(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var r;const{data:s,error:i}=t;if(i)return{error:i};const o=(r=s.session)===null||r===void 0?void 0:r.access_token;if(o){const{error:a}=await this.admin.signOut(o,e);if(a&&!(Ll(a)&&(a.status===404||a.status===401||a.status===403)))return{error:a}}return e!=="others"&&(await this._removeSession(),await Wt(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const t=Jl(),r={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,r),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:r}}}async _emitInitialSession(e){return await this._useSession(async t=>{var r,s;try{const{data:{session:i},error:o}=t;if(o)throw o;await((r=this.stateChangeEmitters.get(e))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",i)),this._debug("INITIAL_SESSION","callback id",e,"session",i)}catch(i){await((s=this.stateChangeEmitters.get(e))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",i),console.error(i)}})}async resetPasswordForEmail(e,t={}){let r=null,s=null;this.flowType==="pkce"&&([r,s]=await lt(this.storage,this.storageKey,!0));try{return await z(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:r,code_challenge_method:s,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(i){if(G(i))return{data:null,error:i};throw i}}async getUserIdentities(){var e;try{const{data:t,error:r}=await this.getUser();if(r)throw r;return{data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(t){if(G(t))return{data:null,error:t};throw t}}async linkIdentity(e){var t;try{const{data:r,error:s}=await this._useSession(async i=>{var o,a,c,u,h;const{data:d,error:f}=i;if(f)throw f;const p=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(o=e.options)===null||o===void 0?void 0:o.redirectTo,scopes:(a=e.options)===null||a===void 0?void 0:a.scopes,queryParams:(c=e.options)===null||c===void 0?void 0:c.queryParams,skipBrowserRedirect:!0});return await z(this.fetch,"GET",p,{headers:this.headers,jwt:(h=(u=d.session)===null||u===void 0?void 0:u.access_token)!==null&&h!==void 0?h:void 0})});if(s)throw s;return je()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(r?.url),{data:{provider:e.provider,url:r?.url},error:null}}catch(r){if(G(r))return{data:{provider:e.provider,url:null},error:r};throw r}}async unlinkIdentity(e){try{return await this._useSession(async t=>{var r,s;const{data:i,error:o}=t;if(o)throw o;return await z(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(s=(r=i.session)===null||r===void 0?void 0:r.access_token)!==null&&s!==void 0?s:void 0})})}catch(t){if(G(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const r=Date.now();return await Zl(async s=>(s>0&&await Xl(200*Math.pow(2,s-1)),this._debug(t,"refreshing attempt",s),await z(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:Le})),(s,i)=>{const o=200*Math.pow(2,s);return i&&lr(i)&&Date.now()+o-r<ht})}catch(r){if(this._debug(t,"error",r),G(r))return{data:{session:null,user:null},error:r};throw r}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const r=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",r),je()&&!t.skipBrowserRedirect&&window.location.assign(r),{data:{provider:e,url:r},error:null}}async _recoverAndRefresh(){var e;const t="#_recoverAndRefresh()";this._debug(t,"begin");try{const r=await Bt(this.storage,this.storageKey);if(this._debug(t,"session from storage",r),!this._isValidSession(r)){this._debug(t,"session is not valid"),r!==null&&await this._removeSession();return}const s=((e=r.expires_at)!==null&&e!==void 0?e:1/0)*1e3-Date.now()<ar;if(this._debug(t,`session has${s?"":" not"} expired with margin of ${ar}s`),s){if(this.autoRefreshToken&&r.refresh_token){const{error:i}=await this._callRefreshToken(r.refresh_token);i&&(console.error(i),lr(i)||(this._debug(t,"refresh failed with a non-retryable error, removing the session",i),await this._removeSession()))}}else await this._notifyAllSubscribers("SIGNED_IN",r)}catch(r){this._debug(t,"error",r),console.error(r);return}finally{this._debug(t,"end")}}async _callRefreshToken(e){var t,r;if(!e)throw new Be;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const s=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(s,"begin");try{this.refreshingDeferred=new Yt;const{data:i,error:o}=await this._refreshAccessToken(e);if(o)throw o;if(!i.session)throw new Be;await this._saveSession(i.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",i.session);const a={session:i.session,error:null};return this.refreshingDeferred.resolve(a),a}catch(i){if(this._debug(s,"error",i),G(i)){const o={session:null,error:i};return lr(i)||await this._removeSession(),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(o),o}throw(r=this.refreshingDeferred)===null||r===void 0||r.reject(i),i}finally{this.refreshingDeferred=null,this._debug(s,"end")}}async _notifyAllSubscribers(e,t,r=!0){const s=`#_notifyAllSubscribers(${e})`;this._debug(s,"begin",t,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:e,session:t});const i=[],o=Array.from(this.stateChangeEmitters.values()).map(async a=>{try{await a.callback(e,t)}catch(c){i.push(c)}});if(await Promise.all(o),i.length>0){for(let a=0;a<i.length;a+=1)console.error(i[a]);throw i[0]}}finally{this._debug(s,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await xo(this.storage,this.storageKey,e)}async _removeSession(){this._debug("#_removeSession()"),await Wt(this.storage,this.storageKey),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&je()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),ht);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:r}}=t;if(!r||!r.refresh_token||!r.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const s=Math.floor((r.expires_at*1e3-e)/ht);this._debug("#_autoRefreshTokenTick()",`access token expires in ${s} ticks, a tick lasts ${ht}ms, refresh threshold is ${Rn} ticks`),s<=Rn&&await this._callRefreshToken(r.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof No)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!je()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,r){const s=[`provider=${encodeURIComponent(t)}`];if(r?.redirectTo&&s.push(`redirect_to=${encodeURIComponent(r.redirectTo)}`),r?.scopes&&s.push(`scopes=${encodeURIComponent(r.scopes)}`),this.flowType==="pkce"){const[i,o]=await lt(this.storage,this.storageKey),a=new URLSearchParams({code_challenge:`${encodeURIComponent(i)}`,code_challenge_method:`${encodeURIComponent(o)}`});s.push(a.toString())}if(r?.queryParams){const i=new URLSearchParams(r.queryParams);s.push(i.toString())}return r?.skipBrowserRedirect&&s.push(`skip_http_redirect=${r.skipBrowserRedirect}`),`${e}?${s.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var r;const{data:s,error:i}=t;return i?{data:null,error:i}:await z(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(r=s?.session)===null||r===void 0?void 0:r.access_token})})}catch(t){if(G(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var r,s;const{data:i,error:o}=t;if(o)return{data:null,error:o};const a=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:{issuer:e.issuer}),{data:c,error:u}=await z(this.fetch,"POST",`${this.url}/factors`,{body:a,headers:this.headers,jwt:(r=i?.session)===null||r===void 0?void 0:r.access_token});return u?{data:null,error:u}:(e.factorType==="totp"&&(!((s=c?.totp)===null||s===void 0)&&s.qr_code)&&(c.totp.qr_code=`data:image/svg+xml;utf-8,${c.totp.qr_code}`),{data:c,error:null})})}catch(t){if(G(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r;const{data:s,error:i}=t;if(i)return{data:null,error:i};const{data:o,error:a}=await z(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(r=s?.session)===null||r===void 0?void 0:r.access_token});return a?{data:null,error:a}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+o.expires_in},o)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",o),{data:o,error:a})})}catch(t){if(G(t))return{data:null,error:t};throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r;const{data:s,error:i}=t;return i?{data:null,error:i}:await z(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:(r=s?.session)===null||r===void 0?void 0:r.access_token})})}catch(t){if(G(t))return{data:null,error:t};throw t}})}async _challengeAndVerify(e){const{data:t,error:r}=await this._challenge({factorId:e.factorId});return r?{data:null,error:r}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const r=e?.factors||[],s=r.filter(o=>o.factor_type==="totp"&&o.status==="verified"),i=r.filter(o=>o.factor_type==="phone"&&o.status==="verified");return{data:{all:r,totp:s,phone:i},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,r;const{data:{session:s},error:i}=e;if(i)return{data:null,error:i};if(!s)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:o}=cr(s.access_token);let a=null;o.aal&&(a=o.aal);let c=a;((r=(t=s.user.factors)===null||t===void 0?void 0:t.filter(d=>d.status==="verified"))!==null&&r!==void 0?r:[]).length>0&&(c="aal2");const h=o.amr||[];return{data:{currentLevel:a,nextLevel:c,currentAuthenticationMethods:h},error:null}}))}async fetchJwk(e,t={keys:[]}){let r=t.keys.find(o=>o.kid===e);if(r||(r=this.jwks.keys.find(o=>o.kid===e),r&&this.jwks_cached_at+Ul>Date.now()))return r;const{data:s,error:i}=await z(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(i)throw i;if(!s.keys||s.keys.length===0)throw new jt("JWKS is empty");if(this.jwks=s,this.jwks_cached_at=Date.now(),r=s.keys.find(o=>o.kid===e),!r)throw new jt("No matching signing key found in JWKS");return r}async getClaims(e,t={keys:[]}){try{let r=e;if(!r){const{data:p,error:g}=await this.getSession();if(g||!p.session)return{data:null,error:g};r=p.session.access_token}const{header:s,payload:i,signature:o,raw:{header:a,payload:c}}=cr(r);if(oc(i.exp),!s.kid||s.alg==="HS256"||!("crypto"in globalThis&&"subtle"in globalThis.crypto)){const{error:p}=await this.getUser(r);if(p)throw p;return{data:{claims:i,header:s,signature:o},error:null}}const u=ac(s.alg),h=await this.fetchJwk(s.kid,t),d=await crypto.subtle.importKey("jwk",h,u,!0,["verify"]);if(!await crypto.subtle.verify(u,d,o,Kl(`${a}.${c}`)))throw new jt("Invalid JWT signature");return{data:{claims:i,header:s,signature:o},error:null}}catch(r){if(G(r))return{data:null,error:r};throw r}}}It.nextInstanceID=0;const Tc=It;class Pc extends Tc{constructor(e){super(e)}}var kc=function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(h){try{u(r.next(h))}catch(d){o(d)}}function c(h){try{u(r.throw(h))}catch(d){o(d)}}function u(h){h.done?i(h.value):s(h.value).then(a,c)}u((r=r.apply(n,e||[])).next())})};class Ac{constructor(e,t,r){var s,i,o;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const a=Ol(e),c=new URL(a);this.realtimeUrl=new URL("realtime/v1",c),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",c),this.storageUrl=new URL("storage/v1",c),this.functionsUrl=new URL("functions/v1",c);const u=`sb-${c.hostname.split(".")[0]}-auth-token`,h={db:Sl,realtime:Tl,auth:Object.assign(Object.assign({},El),{storageKey:u}),global:bl},d=jl(r??{},h);this.storageKey=(s=d.auth.storageKey)!==null&&s!==void 0?s:"",this.headers=(i=d.global.headers)!==null&&i!==void 0?i:{},d.accessToken?(this.accessToken=d.accessToken,this.auth=new Proxy({},{get:(f,p)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(p)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((o=d.auth)!==null&&o!==void 0?o:{},this.headers,d.global.fetch),this.fetch=$l(t,this._getAccessToken.bind(this),d.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},d.realtime)),this.rest=new Ha(new URL("rest/v1",c).href,{headers:this.headers,schema:d.db.schema,fetch:this.fetch}),d.accessToken||this._listenForAuthEvents()}get functions(){return new Ca(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}get storage(){return new yl(this.storageUrl.href,this.headers,this.fetch)}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},r={}){return this.rest.rpc(e,t,r)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return kc(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:r}=yield this.auth.getSession();return(t=(e=r.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:null})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:s,storageKey:i,flowType:o,lock:a,debug:c},u,h){const d={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new Pc({url:this.authUrl.href,headers:Object.assign(Object.assign({},d),u),storageKey:i,autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:s,flowType:o,lock:a,debug:c,fetch:h,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(e){return new il(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,r)=>{this._handleTokenChanged(t,"CLIENT",r?.access_token)})}_handleTokenChanged(e,t,r){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==r?this.changedAccessToken=r:e==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const $c=(n,e,t)=>new Ac(n,e,t),Rc=void 0,Oc=void 0;console.log("🔍 Supabase Configuration Check:");console.log("URL:","MISSING");console.log("Anon Key:","MISSING");console.error("❌ Supabase URL or Anon Key is missing. Make sure to set VITE_SUPABASE_URL and VITE_SUPABASE_ANON_KEY in your .env file or Vercel environment variables."),console.error("Current env vars:",{VITE_SUPABASE_URL:!1,VITE_SUPABASE_ANON_KEY:!1});const V=$c(Rc,Oc,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!1,storageKey:"sb-auth-token",flowType:"pkce",debug:!1},db:{schema:"public"},global:{headers:{"Content-Type":"application/json","X-Client-Info":"supabase-js-web"},fetch:(n,e={})=>{const t=new AbortController,r=setTimeout(()=>t.abort(),15e3);return fetch(n,{...e,signal:t.signal}).finally(()=>{clearTimeout(r)}).catch(s=>{throw console.error("🚨 Supabase request failed:",{url:n,error:s.message,stack:s.stack}),s})}}}),Uo=async()=>{try{console.log("🔄 Testing Supabase connection...");const{data:n,error:e}=await V.from("watch_history").select("count").limit(1);if(e)return console.error("❌ Supabase connection test failed:",e),!1;const{data:t,error:r}=await V.auth.getSession();return r?(console.error("❌ Auth endpoint test failed:",r),!1):(console.log("✅ Supabase connection and auth endpoint tests successful"),!0)}catch(n){return console.error("❌ Supabase connection test error:",n),!1}},jc=n=>{console.error("🚨 Authentication error:",n);const e={"Invalid API key":"Check your VITE_SUPABASE_ANON_KEY environment variable","Invalid JWT":"Your session may have expired. Try logging in again.","User not found":"This email address is not registered.","Invalid login credentials":"Check your email and password.",NetworkError:"Check your internet connection and try again.","CORS error":"Contact support - there may be a configuration issue."},t=n.message||n.error_description||"Unknown error",r=Object.keys(e).find(s=>t.toLowerCase().includes(s.toLowerCase()));return r&&console.log("💡 Suggested fix:",e[r]),{message:t,suggestion:r?e[r]:"Please try again or contact support"}};typeof window<"u"&&(window.supabase=V,window.testSupabaseConnection=Uo,window.handleAuthError=jc);const Do=lo();function Cc({children:n}){const[e,t]=N(null),[r,s]=N(null),[i,o]=N(!0);ee(()=>{(async()=>{const{data:{session:h}}=await V.auth.getSession();t(h),s(h?.user??null),o(!1)})();const{data:u}=V.auth.onAuthStateChange((h,d)=>{t(d),s(d?.user??null)});return()=>{u.subscription.unsubscribe()}},[]);const a={session:e,user:r,signOut:()=>V.auth.signOut()};return l(Do.Provider,{value:a,children:!i&&n})}function Ve(){return co(Do)}let Ic=0,vt=null;const Fe={success:(n,e={})=>Ht(n,"success",e),error:(n,e={})=>Ht(n,"error",e),info:(n,e={})=>Ht(n,"info",e),warning:(n,e={})=>Ht(n,"warning",e)},Ht=(n,e="info",t={})=>{if(!vt)return;const r=Ic++,s=t.duration||(e==="error"?6e3:4e3),i={id:r,message:n,type:e,duration:s,timestamp:Date.now()};return vt(o=>[...o,i]),setTimeout(()=>{Cn(r)},s),r},Cn=n=>{vt&&vt(e=>e.filter(t=>t.id!==n))},xc=({position:n="top-center"})=>{const[e,t]=N([]);return ee(()=>(vt=t,()=>{vt=null}),[]),e.length===0?null:l("div",{class:`toast-container toast-container--${n}`,children:e.map(r=>l("div",{class:`toast toast--${r.type}`,onClick:()=>Cn(r.id),children:[l("div",{class:"toast__content",children:[r.type==="success"&&l("span",{class:"toast__icon",children:"✅"}),r.type==="error"&&l("span",{class:"toast__icon",children:"❌"}),r.type==="warning"&&l("span",{class:"toast__icon",children:"⚠️"}),r.type==="info"&&l("span",{class:"toast__icon",children:"ℹ️"}),l("span",{class:"toast__message",children:r.message})]}),l("button",{class:"toast__close",onClick:s=>{s.stopPropagation(),Cn(r.id)},children:"×"})]},r.id))})},be={DARK:"dark",LIGHT:"light"},Gn=()=>{const n=localStorage.getItem("theme");return n&&Object.values(be).includes(n)?n:window.matchMedia("(prefers-color-scheme: dark)").matches?be.DARK:be.LIGHT},In=n=>{Object.values(be).includes(n)||(console.warn(`Invalid theme: ${n}. Using default dark theme.`),n=be.DARK),n===be.LIGHT?document.documentElement.setAttribute("data-theme","light"):document.documentElement.removeAttribute("data-theme"),localStorage.setItem("theme",n),window.dispatchEvent(new CustomEvent("themeChanged",{detail:{theme:n}}))},Nc=()=>{const e=Gn()===be.LIGHT?be.DARK:be.LIGHT;return In(e),e},Uc=()=>{const n=Gn();In(n),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",e=>{localStorage.getItem("theme")||In(e.matches?be.DARK:be.LIGHT)})},zs=n=>{let e;const t=new Set,r=(u,h)=>{const d=typeof u=="function"?u(e):u;if(!Object.is(d,e)){const f=e;e=h??(typeof d!="object"||d===null)?d:Object.assign({},e,d),t.forEach(p=>p(e,f))}},s=()=>e,a={setState:r,getState:s,getInitialState:()=>c,subscribe:u=>(t.add(u),()=>t.delete(u))},c=e=n(r,s,a);return a},Dc=n=>n?zs(n):zs,Lc=n=>n;function qc(n,e=Lc){const t=ps.useSyncExternalStore(n.subscribe,()=>e(n.getState()),()=>e(n.getInitialState()));return ps.useDebugValue(t),t}const Js=n=>{const e=Dc(n),t=r=>qc(e,r);return Object.assign(t,e),t},Mc=n=>n?Js(n):Js;function Fc(n,e){let t;try{t=n()}catch{return}return{getItem:s=>{var i;const o=c=>c===null?null:JSON.parse(c,void 0),a=(i=t.getItem(s))!=null?i:null;return a instanceof Promise?a.then(o):o(a)},setItem:(s,i)=>t.setItem(s,JSON.stringify(i,void 0)),removeItem:s=>t.removeItem(s)}}const xn=n=>e=>{try{const t=n(e);return t instanceof Promise?t:{then(r){return xn(r)(t)},catch(r){return this}}}catch(t){return{then(r){return this},catch(r){return xn(r)(t)}}}},Bc=(n,e)=>(t,r,s)=>{let i={storage:Fc(()=>localStorage),partialize:m=>m,version:0,merge:(m,v)=>({...v,...m}),...e},o=!1;const a=new Set,c=new Set;let u=i.storage;if(!u)return n((...m)=>{console.warn(`[zustand persist middleware] Unable to update item '${i.name}', the given storage is currently unavailable.`),t(...m)},r,s);const h=()=>{const m=i.partialize({...r()});return u.setItem(i.name,{state:m,version:i.version})},d=s.setState;s.setState=(m,v)=>{d(m,v),h()};const f=n((...m)=>{t(...m),h()},r,s);s.getInitialState=()=>f;let p;const g=()=>{var m,v;if(!u)return;o=!1,a.forEach(E=>{var _;return E((_=r())!=null?_:f)});const w=((v=i.onRehydrateStorage)==null?void 0:v.call(i,(m=r())!=null?m:f))||void 0;return xn(u.getItem.bind(u))(i.name).then(E=>{if(E)if(typeof E.version=="number"&&E.version!==i.version){if(i.migrate){const _=i.migrate(E.state,E.version);return _ instanceof Promise?_.then(P=>[!0,P]):[!0,_]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,E.state];return[!1,void 0]}).then(E=>{var _;const[P,j]=E;if(p=i.merge(j,(_=r())!=null?_:f),t(p,!0),P)return h()}).then(()=>{w?.(p,void 0),p=r(),o=!0,c.forEach(E=>E(p))}).catch(E=>{w?.(void 0,E)})};return s.persist={setOptions:m=>{i={...i,...m},m.storage&&(u=m.storage)},clearStorage:()=>{u?.removeItem(i.name)},getOptions:()=>i,rehydrate:()=>g(),hasHydrated:()=>o,onHydrate:m=>(a.add(m),()=>{a.delete(m)}),onFinishHydration:m=>(c.add(m),()=>{c.delete(m)})},i.skipHydration||g(),p||f},Wc=Bc,Nn="https://image.tmdb.org/t/p/w500",Hc=()=>"/api",we=Hc();function Un(n){return n?`${we}/image-proxy?url=${encodeURIComponent(n)}`:""}console.log(`🚀 API Base URL: ${we}`);console.log("🌍 Environment: production");const Ue=async()=>{let e=0;for(;e<2;)try{const t=new Promise((o,a)=>setTimeout(()=>a(new Error("Auth timeout")),5e3)),r=V.auth.getSession(),{data:{session:s},error:i}=await Promise.race([r,t]);if(i){if(console.error("Error getting current session:",i),i.message&&i.message.includes("NetworkError")&&e<1){e++,console.log(`Retrying auth session (attempt ${e+1}/2)`),await new Promise(o=>setTimeout(o,500*e));continue}return null}return s?.user?.id||null}catch(t){if(console.error("Error in getCurrentUserId:",t),t.message&&(t.message.includes("NetworkError")||t.message.includes("timeout"))&&e<1){e++,console.log(`Retrying auth due to network error (attempt ${e+1}/2)`),await new Promise(r=>setTimeout(r,500*e));continue}return null}return console.error("Failed to get user session after all retry attempts"),null},Gc=async()=>{let e=0;for(;e<3;)try{const t=await Ue();if(!t)return console.log("No authenticated user, returning empty watch history"),[];const r=new Promise((a,c)=>setTimeout(()=>c(new Error("Request timeout")),1e4)),s=V.from("watch_history").select("*").eq("user_id",t).order("watched_at",{ascending:!1}),{data:i,error:o}=await Promise.race([s,r]);if(o){if(console.error("Error fetching watch history:",o),o.message&&o.message.includes("NetworkError")&&e<2){e++,console.log(`Retrying watch history fetch (attempt ${e+1}/3)`),await new Promise(a=>setTimeout(a,1e3*e));continue}return[]}return i||[]}catch(t){if(console.error("Error in getWatchHistory:",t),t.message&&(t.message.includes("NetworkError")||t.message.includes("timeout"))&&e<2){e++,console.log(`Retrying watch history fetch due to network error (attempt ${e+1}/3)`),await new Promise(r=>setTimeout(r,1e3*e));continue}return[]}return console.error("Failed to fetch watch history after all retry attempts"),[]},dr=async(n,e,t,r)=>{try{const s=await Ue();if(!s)return console.log("No authenticated user, returning null progress"),null;let i=V.from("watch_progress").select("progress_seconds, duration_seconds").eq("user_id",s).eq("media_id",n).eq("media_type",e);e!=="movie"&&(i=i.eq("season_number",t).eq("episode_number",r));const{data:o,error:a}=await i;return a?(console.error("Error fetching watch progress:",a),null):o&&o.length>0?o[0]:null}catch(s){return console.error("Error in getWatchProgressForMedia:",s),null}},Kc=async()=>{try{const n=await Ue();if(!n)return console.log("No authenticated user, returning empty continue watching list"),[];console.log("🔍 Fetching continue watching from watch_history...");const{data:e,error:t}=await V.from("watch_history").select("media_id, media_type, season_number, episode_number, watched_at").eq("user_id",n).order("watched_at",{ascending:!1});if(t)return console.error("Error fetching watch history for continue watching:",t),[];if(!e||e.length===0)return console.log("📭 No watch history found"),[];console.log(`📊 Found ${e.length} watch history entries`);const r=new Map;e.forEach(u=>{const h=u.media_id;r.has(h)||r.set(h,[]),r.get(h).push(u)});const s=[];for(const[u,h]of r){const f=h.sort((p,g)=>p.media_type==="movie"?new Date(g.watched_at)-new Date(p.watched_at):p.season_number!==g.season_number?(g.season_number||0)-(p.season_number||0):(g.episode_number||0)-(p.episode_number||0))[0];console.log(`📺 Most advanced for media ${u}: S${f.season_number}E${f.episode_number} (${f.media_type})`),s.push(f)}const o=(await Promise.all(s.map(async u=>{try{let h=V.from("watch_progress").select("progress_seconds, duration_seconds, updated_at").eq("user_id",n).eq("media_id",u.media_id).eq("media_type",u.media_type);u.media_type!=="movie"&&(h=h.eq("season_number",u.season_number).eq("episode_number",u.episode_number));const{data:d,error:f}=await h;if(f)return console.error(`Error fetching progress for ${u.media_id}:`,f),null;const p=d&&d.length>0?d[0]:null,g=p&&p.progress_seconds>30,m=new Date(u.watched_at)>new Date(Date.now()-7*24*60*60*1e3);if(g||m){if(p&&p.duration_seconds>0&&p.progress_seconds/p.duration_seconds>=.9){if(u.media_type!=="movie"){const w=await Lo(u.media_id,u.season_number,u.episode_number,u.media_type);if(w)return console.log(`✅ Episode completed, suggesting next: S${w.season}E${w.episode}`),{...u,season_number:w.season,episode_number:w.episode,progress_seconds:0,duration_seconds:null,updated_at:p.updated_at}}return null}return{...u,progress_seconds:p?.progress_seconds||0,duration_seconds:p?.duration_seconds||null,updated_at:p?.updated_at||u.watched_at}}return null}catch(h){return console.error(`Error processing continue watching entry for ${u.media_id}:`,h),null}}))).filter(Boolean).sort((u,h)=>new Date(h.updated_at)-new Date(u.updated_at));console.log(`📺 Found ${o.length} valid continue watching entries`);const c=(await Promise.all(o.map(async u=>{try{const h=await fetch(`${we}/tmdb/${u.media_type}/${u.media_id}`);return h.ok?{...await h.json(),type:u.media_type,progress_seconds:u.progress_seconds,duration_seconds:u.duration_seconds,season_number:u.season_number,episode_number:u.episode_number,updated_at:u.updated_at,media_id:u.media_id}:null}catch(h){return console.error("Error fetching TMDB details for continue watching item:",h),null}}))).filter(Boolean);return console.log(`🎬 Returning ${c.length} continue watching items`),c}catch(n){return console.error("Error in getContinueWatching:",n),[]}},Ys=async(n,e,t,r=!1)=>{const s=await Ue();if(!s)return console.error("❌ Cannot save watch progress: No authenticated user"),!1;if(!n||typeof e>"u"||e<0)return console.error("❌ Invalid progress data:",{item:n,progress:e,durationInSeconds:t}),!1;const i={p_media_id:n.id,p_media_type:n.type,p_season_number:n.season||null,p_episode_number:n.episode||null,p_progress_seconds:e>0?Math.ceil(e):0,p_duration_seconds:t?Math.round(t):null,p_force_history_entry:r};console.log("💾 Saving watch progress (v2) via RPC...",i);const{error:o}=await V.rpc("save_watch_progress",i);if(o)console.error(`❌ RPC (v2) failed. Error: ${o.message}. Details:`,o);else return console.log("✅ Watch progress saved successfully via RPC (v2). RPC Error object was:",o),!0;console.log("⚠️ RPC (v2) failed, trying legacy (v1) RPC...");const{p_force_history_entry:a,...c}=i,{error:u}=await V.rpc("save_watch_progress",c);if(u)console.error(`❌ RPC (v1) also failed. Error: ${u.message}. Details:`,u);else return console.log("✅ Watch progress saved successfully via RPC (v1)"),!0;console.log("⚠️ Both RPC methods failed, attempting direct DB write fallback...");try{if(await Vc(s,n,e,t,r))return console.log("✅ Watch progress saved successfully via direct DB fallback"),!0;console.error("❌ Direct DB write fallback reported failure.")}catch(h){console.error("❌ Direct DB write fallback threw an exception:",h)}return console.error("❌ All methods to save progress failed for media:",{item:n,progress:e,durationInSeconds:t}),!1},Vc=async(n,e,t,r,s)=>{try{console.log("🔄 Using direct database fallback for watch progress");const{error:i}=await V.from("watch_progress").upsert({user_id:n,media_id:e.id,media_type:e.type,season_number:e.season||null,episode_number:e.episode||null,progress_seconds:t>0?Math.ceil(t):0,duration_seconds:r?Math.round(r):null,updated_at:new Date().toISOString()},{onConflict:"user_id,media_id,media_type,season_number,episode_number"});if(i)return console.error("❌ Direct progress insert error:",i),!1;if(s||t>60){const{error:o}=await V.from("watch_history").upsert({user_id:n,media_id:e.id,media_type:e.type,season_number:e.season||null,episode_number:e.episode||null,watched_at:new Date().toISOString()},{onConflict:"user_id,media_id,media_type,season_number,episode_number"});o&&console.error("❌ Direct history insert error:",o)}return console.log("✅ Watch progress saved via direct database fallback"),!0}catch(i){return console.error("❌ Direct database fallback failed:",i),!1}},zc=async n=>{try{const e=await Ue();if(!e){console.log("Cannot add watch history entry: No authenticated user");return}if(!n)return;const{error:t}=await V.from("watch_history").upsert({user_id:e,media_id:n.id,media_type:n.type,season_number:n.season||null,episode_number:n.episode||null,watched_at:new Date().toISOString()},{onConflict:"user_id,media_id,media_type,season_number,episode_number"});t&&console.error("Error adding watch history entry:",t)}catch(e){console.error("Unexpected error adding watch history entry:",e)}},Jc=async n=>{try{if(!n)return;if(!await Ue()){console.log("Cannot delete watch item: No authenticated user");return}const{error:t}=await V.rpc("delete_watch_item",{p_media_id:n.media_id,p_media_type:n.media_type,p_season_number:n.season_number,p_episode_number:n.episode_number});t&&console.error("Error deleting watch item:",t)}catch(e){console.error("Error in deleteWatchItem:",e)}},Yc=async n=>{try{const e=await Ue();if(!e)return[];const{data:t,error:r}=await V.from("watch_progress").select("media_id, media_type, season_number, episode_number, progress_seconds, duration_seconds").eq("user_id",e).eq("media_id",n);return r?(console.error("Error fetching series history:",r),[]):t||[]}catch(e){return console.error("Error in getSeriesHistory:",e),[]}},Lo=async(n,e,t,r="tv")=>{try{const s=r==="anime"?"tv":r,i=await fetch(`${we}/tmdb/${s}/${n}`);if(!i.ok)return console.error(`Failed to fetch series details: ${i.status}`),null;const o=await i.json();if(!o.seasons||o.seasons.length===0)return console.error("No seasons found in series details"),null;const a=await fetch(`${we}/tmdb/${s}/${n}/season/${e}`);if(!a.ok)return console.error(`Failed to fetch season ${e} details: ${a.status}`),null;const c=await a.json();if(!c.episodes||c.episodes.length===0)return console.error(`No episodes found in season ${e}`),null;const u=c.episodes.length;if(console.log(`Current season ${e} has ${u} episodes, current episode: ${t}`),t<u)return console.log(`Next episode: S${e}E${t+1}`),{season:e,episode:t+1};const d=o.seasons.filter(f=>f.season_number>0).find(f=>f.season_number===e+1);return d&&d.episode_count>0?(console.log(`Next season found: S${d.season_number}E1`),{season:d.season_number,episode:1}):(console.log("No next episode available - series may be completed"),null)}catch(s){return console.error("Error getting next episode:",s),null}},Qc=async n=>{try{const e=await Ue();if(!e)return console.log("No authenticated user, returning null for last watched episode with progress"),null;console.log(`🔍 [CW] Looking for last watched episode for series ${n}`);const{data:t,error:r}=await V.from("watch_history").select("season_number, episode_number, watched_at, media_type").eq("user_id",e).eq("media_id",n).order("watched_at",{ascending:!1}).limit(1);if(r)return console.error("❌ [CW] Error fetching watch history:",r),null;if(!t||t.length===0)return console.log("📭 [CW] No episodes found in watch history for this series."),null;const s=t[0];console.log(`📺 [CW] Most recent interaction: S${s.season_number}E${s.episode_number} (at ${s.watched_at})`);const{data:i,error:o}=await V.from("watch_progress").select("progress_seconds, duration_seconds").eq("user_id",e).eq("media_id",n).eq("season_number",s.season_number).eq("episode_number",s.episode_number).limit(1);if(o)return console.error("❌ [CW] Error fetching progress data:",o),{season:s.season_number,episode:s.episode_number};const a=i&&i.length>0?i[0]:null;if(a&&a.duration_seconds>0){const c=a.progress_seconds/a.duration_seconds,u=a.duration_seconds-a.progress_seconds,f=c>=.9&&u<=60;if(console.log(`📊 [CW] Progress: ${(c*100).toFixed(1)}%, Time left: ${u}s - ${f?"COMPLETED":"INCOMPLETE"}`),f){console.log(`✅ [CW] Episode S${s.season_number}E${s.episode_number} is completed. Finding next...`);const p=await Lo(n,s.season_number,s.episode_number,s.media_type);return p?(console.log(`🎯 [CW] Next episode is S${p.season}E${p.episode}.`),p):(console.log('🏁 [CW] Series finished. No "continue watching" target.'),null)}else return console.log(`⏯️ [CW] Resuming incomplete episode S${s.season_number}E${s.episode_number}.`),{season:s.season_number,episode:s.episode_number}}else return console.log(`📝 [CW] No meaningful progress found. Suggesting last touched episode: S${s.season_number}E${s.episode_number}`),{season:s.season_number,episode:s.episode_number}}catch(e){return console.error("❌ [CW] Unexpected error in getLastWatchedEpisodeWithProgress:",e),null}},qo=async n=>{try{const e=await Ue();if(!e||!n||n.length===0)return{};const t={};return await Promise.all(n.map(async r=>{try{let s=V.from("watch_progress").select("progress_seconds, duration_seconds").eq("user_id",e).eq("media_id",r.media_id).eq("media_type",r.media_type);r.media_type==="tv"&&(r.season_number!=null&&(s=s.eq("season_number",r.season_number)),r.episode_number!=null&&(s=s.eq("episode_number",r.episode_number)));const{data:i,error:o}=await s;if(o)console.error(`Error fetching progress for ${r.media_type} ${r.media_id}:`,o);else if(i&&i.length>0){const a=i[0],c=`${r.media_id}-${r.media_type}-${r.season_number||0}-${r.episode_number||0}`;a.progress_seconds>=0&&a.duration_seconds>0&&(t[c]={progress_seconds:a.progress_seconds,duration_seconds:a.duration_seconds})}}catch(s){console.error(`Error fetching progress for item ${r.media_id}:`,s)}})),t}catch(e){return console.error("Error in getProgressForHistoryItems:",e),{}}},Xc=async()=>{let e=0;for(;e<3;)try{const t=await Ue();if(!t)return console.log("No authenticated user, returning empty watch history with progress"),[];console.log("🔄 Fetching combined watch history and progress data...");const[r,s]=await Promise.all([V.from("watch_history").select("*").eq("user_id",t).order("watched_at",{ascending:!1}),V.from("watch_progress").select("media_id, media_type, season_number, episode_number, progress_seconds, duration_seconds").eq("user_id",t)]);if(r.error)throw r.error;s.error&&console.warn("Error fetching progress data, continuing without progress:",s.error);const i=r.data||[],o=s.data||[],a={};o.forEach(u=>{const h=`${u.media_id}-${u.media_type}-${u.season_number||0}-${u.episode_number||0}`;a[h]=u});const c=i.map(u=>{const h=`${u.media_id}-${u.media_type}-${u.season_number||0}-${u.episode_number||0}`,d=a[h];return{...u,progress_seconds:d?.progress_seconds||null,duration_seconds:d?.duration_seconds||null}});return console.log("✅ Successfully fetched combined data:",{totalItems:c.length,itemsWithProgress:c.filter(u=>u.progress_seconds>0).length}),c}catch(t){if(console.error("Error in getWatchHistoryWithProgress:",t),t.message&&(t.message.includes("NetworkError")||t.message.includes("timeout"))&&e<2){e++,console.log(`Retrying combined fetch due to network error (attempt ${e+1}/3)`),await new Promise(r=>setTimeout(r,1e3*e));continue}try{console.log("📋 All retries failed, trying fallback approach...");const r=await Gc(),s=await qo(r);return r.map(i=>{const o=`${i.media_id}-${i.media_type}-${i.season_number||0}-${i.episode_number||0}`,a=s[o];return{...i,progress_seconds:a?.progress_seconds||null,duration_seconds:a?.duration_seconds||null}})}catch(r){return console.error("Fallback approach also failed:",r),[]}}return console.error("Failed to fetch combined watch history and progress after all retry attempts"),[]},Qe=async(n,e=3)=>{let t=[];for(let r=1;r<=e;r++)try{const s=await fetch(`${n}?page=${r}`);if(s.ok){const i=await s.json();t=[...t,...i.results||[]]}}catch(s){console.error(`Error fetching page ${r} from ${n}:`,s)}return t},Me=Mc(Wc((n,e)=>({trending:[],popularMovies:[],popularTv:[],topRatedMovies:[],topRatedTv:[],upcomingMovies:[],nowPlayingMovies:[],airingTodayTv:[],favorites:[],favoritesFetched:!1,favoritedMedia:new Set,currentMediaItem:null,continueWatching:[],continueWatchingFetched:!1,fetchContinueWatching:async()=>{const{data:{user:t}}=await V.auth.getUser();if(!t){n({continueWatching:[],continueWatchingFetched:!0});return}const r=await Kc();if(!r||r.length===0){n({continueWatching:[],continueWatchingFetched:!0});return}const s=r.reduce((i,o)=>(i.some(a=>a.media_id===o.media_id)||i.push(o),i),[]);n({continueWatching:s,continueWatchingFetched:!0})},removeContinueWatchingItem:t=>{n(r=>({continueWatching:r.continueWatching.filter(s=>s.media_id!==t)}))},setCurrentMediaItem:t=>n({currentMediaItem:t}),fetchTrending:async()=>{if(!(e().trending.length>0))try{const t=await fetch("/api/tmdb/trending/all/week");if(t.ok){const r=await t.json();n({trending:r.results||[]})}}catch(t){console.error("Error fetching trending:",t)}},fetchPopularMovies:async()=>{if(e().popularMovies.length>0)return;const t=await Qe("/api/tmdb/movie/popular");n({popularMovies:t})},fetchPopularTv:async()=>{if(e().popularTv.length>0)return;const t=await Qe("/api/tmdb/tv/popular");n({popularTv:t})},fetchTopRatedMovies:async()=>{if(e().topRatedMovies.length>0)return;const t=await Qe("/api/tmdb/movie/top_rated");n({topRatedMovies:t})},fetchTopRatedTv:async()=>{if(e().topRatedTv.length>0)return;const t=await Qe("/api/tmdb/tv/top_rated");n({topRatedTv:t})},fetchUpcomingMovies:async()=>{if(e().upcomingMovies.length>0)return;const t=await Qe("/api/tmdb/movie/upcoming");n({upcomingMovies:t})},fetchNowPlayingMovies:async()=>{if(e().nowPlayingMovies.length>0)return;const t=await Qe("/api/tmdb/movie/now_playing");n({nowPlayingMovies:t})},fetchAiringTodayTv:async()=>{if(e().airingTodayTv.length>0)return;const t=await Qe("/api/tmdb/tv/airing_today");n({airingTodayTv:t})},fetchFavorites:async()=>{const{data:{user:t}}=await V.auth.getUser();if(!t){n({favorites:[],favoritesFetched:!0});return}const{data:r,error:s}=await V.from("favorites").select("media_id, media_type, season_number, episode_number, episode_name").eq("user_id",t.id);if(s){console.error("Error fetching favorites:",s),n({favoritesFetched:!0});return}const i=new Set(r.map(a=>`${a.media_id}-${a.media_type}-${a.season_number||null}-${a.episode_number||null}`));n({favoritedMedia:i,favoritesFetched:!0});const o=await Promise.all(r.map(async a=>{try{const c=await fetch(`/api/tmdb/${a.media_type}/${a.media_id}`);if(c.ok){const u=await c.json();if(a.media_type==="tv"&&a.season_number&&a.episode_number){try{const h=await fetch(`/api/tmdb/tv/${a.media_id}/season/${a.season_number}/episode/${a.episode_number}`);if(h.ok){const d=await h.json();return{...u,type:a.media_type,season_number:a.season_number,episode_number:a.episode_number,episode_name:d.name||a.episode_name,still_path:d.still_path,vote_average:d.vote_average||u.vote_average,overview:d.overview||u.overview}}}catch(h){console.error("Error fetching episode details:",h)}return{...u,type:a.media_type,season_number:a.season_number,episode_number:a.episode_number,episode_name:a.episode_name}}return{...u,type:a.media_type}}return null}catch(c){return console.warn(`Could not fetch details for favorited item ${a.media_type}:${a.media_id}. It will not appear in the favorites list.`,c),null}}));n({favorites:o.filter(Boolean)})},addFavorite:async t=>{const{data:{user:r}}=await V.auth.getUser();if(!r)return;const{id:s,type:i,season_number:o,episode_number:a,name:c,title:u,poster_path:h,vote_average:d}=t,f=`${s}-${i}-${o||null}-${a||null}`;if(e().favoritedMedia.has(f)){console.warn("Attempted to add an already existing favorite. Aborting.",t);return}n(m=>({favorites:[t,...m.favorites],favoritedMedia:new Set(m.favoritedMedia).add(f)}));const p={user_id:r.id,media_id:s,media_type:i};i==="tv"&&o&&a&&(p.season_number=o,p.episode_number=a,p.episode_name=t.episode_name);const{error:g}=await V.from("favorites").insert(p,{onConflict:"user_id, media_id, media_type, season_number, episode_number"});g&&(console.error("Error adding favorite:",g),n(m=>{const v=new Set(m.favoritedMedia);return v.delete(f),{favoritedMedia:v,favorites:m.favorites.filter(w=>w.id!==s||w.season_number!==o||w.episode_number!==a)}}))},removeFavorite:async(t,r,s=null,i=null)=>{const{data:{user:o}}=await V.auth.getUser();if(!o)return;const a=`${t}-${r}-${s||null}-${i||null}`,c=e().favorites,u=e().favoritedMedia;n(f=>{const p=new Set(f.favoritedMedia);return p.delete(a),{favoritedMedia:p,favorites:f.favorites.filter(g=>!(g.id===t&&g.season_number===s&&g.episode_number===i))}});const h=V.from("favorites").delete().match({user_id:o.id,media_id:t});s!==null&&i!==null?h.match({season_number:s,episode_number:i}):h.is("season_number",null).is("episode_number",null);const{error:d}=await h;d&&(console.error("Error removing favorite:",d),n({favorites:c,favoritedMedia:u}))},isFavorited:(t,r,s=null,i=null)=>{const{favoritedMedia:o,favoritesFetched:a}=e();if(!a)return!1;const c=`${t}-${r}-${s||null}-${i||null}`;return o.has(c)}}),{name:"freestream-storage",storage:localStorage,partialize:n=>({favorites:n.favorites,favoritedMedia:n.favoritedMedia,trending:n.trending,popularMovies:n.popularMovies,popularTv:n.popularTv,topRatedMovies:n.topRatedMovies,topRatedTv:n.topRatedTv,upcomingMovies:n.upcomingMovies,nowPlayingMovies:n.nowPlayingMovies,airingTodayTv:n.airingTodayTv,continueWatching:n.continueWatching})})),Zc=()=>{const[n,e]=N(!0);return ee(()=>{const r=Gn();e(r===be.DARK);const s=i=>{e(i.detail.theme===be.DARK)};return window.addEventListener("themeChanged",s),()=>{window.removeEventListener("themeChanged",s)}},[]),l("button",{class:`theme-toggle ${n?"dark":"light"}`,onClick:()=>{const r=Nc();e(r===be.DARK)},"aria-label":`Switch to ${n?"light":"dark"} mode`,title:`Switch to ${n?"light":"dark"} mode`,children:l("div",{class:"toggle-track",children:l("div",{class:"toggle-thumb",children:l("div",{class:"icon",children:n?l("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:l("path",{d:"M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"})}):l("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[l("circle",{cx:"12",cy:"12",r:"5"}),l("line",{x1:"12",y1:"1",x2:"12",y2:"3"}),l("line",{x1:"12",y1:"21",x2:"12",y2:"23"}),l("line",{x1:"4.22",y1:"4.22",x2:"5.64",y2:"5.64"}),l("line",{x1:"18.36",y1:"18.36",x2:"19.78",y2:"19.78"}),l("line",{x1:"1",y1:"12",x2:"3",y2:"12"}),l("line",{x1:"21",y1:"12",x2:"23",y2:"12"}),l("line",{x1:"4.22",y1:"19.78",x2:"5.64",y2:"18.36"}),l("line",{x1:"18.36",y1:"5.64",x2:"19.78",y2:"4.22"})]})})})})})},eu=()=>{const[n,e]=N(""),[t,r]=N(!1),[s,i]=N(!1),{user:o,signOut:a}=Ve(),c=f=>{f.preventDefault(),n.trim()&&($e(`/search?q=${encodeURIComponent(n.trim())}`),e(""),i(!1))},u=async()=>{await a(),$e("/")},h=()=>{r(!t),i(!1)};return l("header",{children:l("div",{class:"container",children:[l("div",{class:"header-left",children:[l(Ne,{href:"/",class:"logo",children:"FreeStream"}),l("nav",{class:t?"active":"",children:l("ul",{onClick:()=>r(!1),children:[l("li",{children:l(Ne,{activeClassName:"active",href:"/movies",children:"Movies"})}),l("li",{children:l(Ne,{activeClassName:"active",href:"/tv",children:"TV"})}),o?l(ft,{children:[l("li",{children:l(Ne,{activeClassName:"active",href:"/favorites",children:"Favorites"})}),l("li",{children:l(Ne,{activeClassName:"active",href:"/history",children:"History"})})]}):l(ft,{children:[l("li",{children:l("a",{href:"/login",style:{color:"#999",fontSize:"0.9em"},children:"Favorites (Login Required)"})}),l("li",{children:l("a",{href:"/login",style:{color:"#999",fontSize:"0.9em"},children:"History (Login Required)"})})]})]})})]}),s&&l("div",{class:"mobile-search-overlay",children:l("form",{class:"mobile-search-form",onSubmit:c,children:[l("input",{type:"text",placeholder:"Search movies & TV shows...",value:n,onInput:f=>e(f.target.value),class:"mobile-search-input",autoFocus:!0}),l("button",{type:"submit",class:"mobile-search-submit",children:l("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2",children:[l("circle",{cx:"11",cy:"11",r:"8"}),l("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"})]})})]})}),l("div",{class:"header-right",children:[l("form",{class:"search-container desktop-only",onSubmit:c,children:l("input",{type:"text",placeholder:"Search...",value:n,onInput:f=>e(f.target.value),class:"glass-light"})}),l("button",{class:"search-toggle mobile-only",onClick:()=>{i(!s),r(!1)},"aria-label":"Toggle search",children:l("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2",children:[l("circle",{cx:"11",cy:"11",r:"8"}),l("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"})]})}),l(Zc,{}),l("div",{class:"auth-links",children:o?l(ft,{children:[l("span",{class:"user-email",children:o.email}),l("button",{onClick:u,class:"auth-button",children:"Logout"})]}):l(ft,{children:[l(Ne,{href:"/login",class:"auth-link",children:"Login"}),l(Ne,{href:"/signup",class:"auth-link",children:"Sign Up"})]})})]}),l("button",{class:"hamburger",onClick:h,"aria-label":"Toggle menu",children:[l("span",{class:"bar"}),l("span",{class:"bar"}),l("span",{class:"bar"})]})]})})};var tu=["className","activeClass","activeClassName","path"];function We(n){var e=n.className,t=n.activeClass,r=n.activeClassName,s=n.path,i=function(h,d){if(h==null)return{};var f,p,g={},m=Object.keys(h);for(p=0;p<m.length;p++)d.indexOf(f=m[p])>=0||(g[f]=h[f]);return g}(n,tu),o=wa()[0],a=s&&o.path&&Sn(o.path,s,{})||Sn(o.url,i.href,{}),c=i.class||e||"",u=a&&(t||r)||"";return i.class=c+(c&&u&&" ")+u,Dn(Ne,i)}const ru=()=>l("footer",{class:"app-footer",children:[l("div",{class:"footer-content",children:[l("div",{class:"footer-brand",children:[l(We,{href:"/",class:"logo",children:"FreeStream"}),l("p",{children:"Your gateway to unlimited entertainment. Built with passion."})]}),l("div",{class:"footer-links",children:[l("div",{class:"footer-section",children:[l("h4",{children:"Platform"}),l("ul",{children:[l("li",{children:l(We,{href:"/",children:"Home"})}),l("li",{children:l(We,{href:"/movies",children:"Movies"})}),l("li",{children:l(We,{href:"/tv",children:"TV Shows"})})]})]}),l("div",{class:"footer-section",children:[l("h4",{children:"Account"}),l("ul",{children:[l("li",{children:l(We,{href:"/login",children:"Login"})}),l("li",{children:l(We,{href:"/signup",children:"Sign Up"})}),l("li",{children:l(We,{href:"/favorites",children:"Favorites"})})]})]}),l("div",{class:"footer-section",children:[l("h4",{children:"Legal"}),l("ul",{children:[l("li",{children:l("a",{href:"#",children:"Terms of Service"})}),l("li",{children:l("a",{href:"#",children:"Privacy Policy"})})]})]})]})]}),l("div",{class:"footer-bottom",children:[l("p",{children:"© 2024 FreeStream. All Rights Reserved. Not a real streaming service."}),l("div",{class:"footer-socials",children:[l("a",{href:"#","aria-label":"Github",children:l("i",{class:"fab fa-github"})}),l("a",{href:"#","aria-label":"Twitter",children:l("i",{class:"fab fa-twitter"})})]})]})]}),mt=({item:n,type:e,progress:t,duration:r,showDeleteButton:s,onDelete:i})=>{const{id:o,title:a,name:c,poster_path:u,still_path:h,vote_average:d,episode_name:f,season_number:p,episode_number:g,first_air_date:m,release_date:v,number_of_seasons:w}=n,E=h||u,_=c||a,P=t&&r>0?t/r*100:0,j=v||m?new Date(v||m).getFullYear():null,{user:U}=Ve(),{addFavorite:q,removeFavorite:T,isFavorited:M,favoritesFetched:K}=Me();M(n.id,e,n.season_number,n.episode_number);const H=oe=>{oe.preventDefault(),oe.stopPropagation(),M(n.id,e,n.season_number,n.episode_number)?T(n.id,e,n.season_number,n.episode_number):q({...n,type:e})};let Z=`/watch/${e}/${n.id}`;e==="tv"&&n.season_number&&n.episode_number&&(Z+=`/season/${n.season_number}/episode/${n.episode_number}`);const te=e==="tv"&&p&&g?`S${p} E${g}${f?`: ${f}`:""}`:e==="tv"&&w?`${j||"Unknown"} • ${w} Season${w!==1?"s":""}`:e==="movie"&&j?j.toString():null;return l("div",{className:"movie-card-container",children:l(We,{href:Z,className:"movie-card",children:l("div",{className:"poster-wrapper",children:[l("img",{src:Un(E?`${Nn}${E}`:"https://via.placeholder.com/500x750/1a1a1a/ffffff?text=No+Image"),alt:_,loading:"lazy"}),l("div",{className:"scrim"}),P>.01&&l("div",{className:"progress-bar-container",children:l("div",{className:"progress-bar",style:{width:`${Math.min(P,100)}%`}})}),l("div",{className:"card-info",children:[l("div",{className:"title-row",children:[l("h3",{className:"card-title",children:_}),U&&l("button",{className:`favorite-btn ${M(n.id,e,n.season_number,n.episode_number)?"favorited":""}`,onClick:H,"aria-label":M(n.id,e,n.season_number,n.episode_number)?"Remove from favorites":"Add to favorites",disabled:!K,children:K?"♥︎":"..."})]}),te&&l("p",{className:"card-subtitle",children:te}),l("span",{className:"rating",children:["★ ",d?d.toFixed(1):"N/A"]})]}),s&&l("button",{className:"delete-btn",onClick:oe=>{oe.preventDefault(),oe.stopPropagation(),i&&i(n)},children:"×"})]})})})},nu=()=>l("div",{class:"features-showcase",children:[l("div",{class:"features-hero",children:l("div",{class:"features-hero-content",children:[l("h2",{class:"features-title",children:l("span",{class:"gradient-text",children:"Sign in for the full experience"})}),l("p",{class:"features-subtitle",children:"Get personalized recommendations, track your progress, and never lose your place"})]})}),l("div",{class:"features-grid",children:[{icon:"⏯️",title:"Continue Watching",description:"Pick up exactly where you left off across all your devices. Never lose your place again.",highlight:!0},{icon:"❤️",title:"Favorites Collection",description:"Save your favorite movies and TV shows in one place for quick access anytime.",highlight:!1},{icon:"📚",title:"Watch History",description:"Keep track of everything you've watched and easily find content you enjoyed.",highlight:!1},{icon:"🎯",title:"Personal Progress",description:"Sync your watch progress across devices and resume on any screen seamlessly.",highlight:!1},{icon:"🔍",title:"Smart Recommendations",description:"Get personalized suggestions based on your viewing history and preferences.",highlight:!1},{icon:"⚡",title:"Enhanced Experience",description:"Unlock the full potential of FreeStream with user-specific features and settings.",highlight:!1}].map((e,t)=>l("div",{class:`feature-card ${e.highlight?"featured":""}`,children:[l("div",{class:"feature-icon",children:e.icon}),l("h3",{class:"feature-title",children:e.title}),l("p",{class:"feature-description",children:e.description})]},t))}),l("div",{class:"features-footer",children:[l("div",{class:"features-stats",children:[l("div",{class:"stat",children:[l("span",{class:"stat-number",children:"10K+"}),l("span",{class:"stat-label",children:"Movies & Shows"})]}),l("div",{class:"stat",children:[l("span",{class:"stat-number",children:"4K"}),l("span",{class:"stat-label",children:"Ultra HD Quality"})]}),l("div",{class:"stat",children:[l("span",{class:"stat-number",children:"∞"}),l("span",{class:"stat-label",children:"Unlimited Access"})]})]}),l("p",{class:"features-note",children:[l(Ne,{href:"/login",class:"subtle-link",children:"Sign in"})," or ",l(Ne,{href:"/signup",class:"subtle-link",children:"create an account"})," to unlock these features"]})]})]}),Mo=({size:n="medium",text:e="Loading..."})=>{const t={small:"spinner-small",medium:"spinner-medium",large:"spinner-large"}[n];return l("div",{class:"loading-container",children:[l("div",{class:`loading-spinner ${t}`,children:[l("div",{class:"spinner-ring"}),l("div",{class:"spinner-ring"}),l("div",{class:"spinner-ring"}),l("div",{class:"spinner-ring"})]}),e&&l("p",{class:"loading-text",children:e})]})},su=()=>{const{user:n}=Ve();if(!n)return null;const e=()=>{const r=new Date().getHours();return r<12?"Good morning":r<17?"Good afternoon":"Good evening"},t=()=>n.user_metadata?.full_name?n.user_metadata.full_name.split(" ")[0]:n.email.split("@")[0];return l("div",{class:"welcome-message",children:[l("div",{class:"welcome-content",children:[l("h2",{class:"welcome-title",children:[e(),", ",l("span",{class:"user-name",children:t()}),"!"]}),l("p",{class:"welcome-subtitle",children:"What would you like to watch today?"})]}),l("div",{class:"welcome-stats",children:[l("div",{class:"stat-item",children:[l("span",{class:"stat-icon",children:"🎬"}),l("span",{class:"stat-text",children:"Unlimited Movies"})]}),l("div",{class:"stat-item",children:[l("span",{class:"stat-icon",children:"📺"}),l("span",{class:"stat-text",children:"TV Shows"})]}),l("div",{class:"stat-item",children:[l("span",{class:"stat-icon",children:"⚡"}),l("span",{class:"stat-text",children:"HD Streaming"})]})]})]})},hr=n=>{const{trending:e,popularMovies:t,popularTv:r,topRatedMovies:s,topRatedTv:i,upcomingMovies:o,nowPlayingMovies:a,airingTodayTv:c,fetchTrending:u,fetchPopularMovies:h,fetchPopularTv:d,fetchTopRatedMovies:f,fetchTopRatedTv:p,fetchUpcomingMovies:g,fetchNowPlayingMovies:m,fetchAiringTodayTv:v,continueWatching:w,continueWatchingFetched:E,fetchContinueWatching:_,fetchFavorites:P,favoritesFetched:j,isFavorited:U}=Me(),{user:q}=Ve(),[T,M]=N("all");ee(()=>{n.path==="/movies"?M("movie"):n.path==="/tv"?M("tv"):M("all")},[n.path]),ee(()=>{u(),h(),d(),f(),p(),g(),m(),v()},[u,h,d,f,p,g,m,v]),ee(()=>{q&&!E&&_()},[q,E,_]),ee(()=>{q&&!j&&P()},[q,j,P]);const K=(H,Z,le)=>!Z||Z.length===0?null:l("section",{class:"home-section",children:[l("h2",{children:H}),l("div",{class:"scrolling-row",children:Z.map(te=>l(mt,{item:te,type:le||te.media_type},`${H}-${te.id}`))})]});return l("div",{class:"container home-page",children:[l("h1",{class:"main-title",children:[T==="movie"&&"Movies",T==="tv"&&"TV Shows",T==="all"&&"Discover"]}),!q&&T==="all"&&l(ft,{children:[l("div",{class:"guest-info-banner",style:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"8px",padding:"16px",marginBottom:"24px",textAlign:"center"},children:[l("h3",{style:{margin:"0 0 8px 0",color:"var(--text-primary)"},children:"🎬 Start Streaming Instantly"}),l("p",{style:{margin:"0",color:"var(--text-secondary)"},children:["No account required! Click any movie or TV show to start watching immediately.",l("a",{href:"/login",style:{color:"var(--accent-color)",textDecoration:"none",marginLeft:"4px"},children:"Sign up"})," to save favorites, track progress, and continue watching across devices."]})]}),l(nu,{})]}),q&&T==="all"&&l(su,{}),E?w.length>0&&l("section",{class:"home-section",children:[l("h2",{children:"Continue Watching"}),l("div",{class:"scrolling-row scrolling-row--compact",children:w.map(H=>l(mt,{item:H,type:H.type,progress:H.progress_seconds,duration:H.duration_seconds},`continue-watching-${H.type}-${H.id}`))})]}):l(Mo,{text:"Loading your continue watching..."}),T==="all"&&K("Trending This Week",e,"movie"),T!=="tv"&&K("Popular Movies",t,"movie"),T!=="tv"&&K("Now Playing Movies",a,"movie"),T!=="movie"&&K("Popular TV Shows",r,"tv"),(T==="all"||T==="movie")&&K("Top Rated Movies",s,"movie"),(T==="all"||T==="movie")&&K("Upcoming Movies",o,"movie"),(T==="all"||T==="tv")&&K("Top Rated TV Shows",i,"tv"),(T==="all"||T==="tv")&&K("Airing Today",c,"tv")]})};var Gt={exports:{}};const Fo=vo(ua);var fr,Qs;function iu(){if(Qs)return fr;Qs=1;var n=Fo;function e(i,o){var a={};for(var c in i)o.indexOf(c)>=0||Object.prototype.hasOwnProperty.call(i,c)&&(a[c]=i[c]);return a}function t(i,o){if(!(i instanceof o))throw new TypeError("Cannot call a class as a function")}function r(i,o){if(!i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o&&(typeof o=="object"||typeof o=="function")?o:i}function s(i,o){if(typeof o!="function"&&o!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof o);i.prototype=Object.create(o&&o.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),o&&(Object.setPrototypeOf?Object.setPrototypeOf(i,o):i.__proto__=o)}return fr=function(o,a,c){if(typeof o!="function")throw new Error("Expected reducePropsToState to be a function.");if(typeof a!="function")throw new Error("Expected handleStateChangeOnClient to be a function.");if(typeof c<"u"&&typeof c!="function")throw new Error("Expected mapStateOnServer to either be undefined or a function.");function u(d){return d.displayName||d.name||"Component"}return function(f){if(typeof f!="function")throw new Error("Expected WrappedComponent to be a React component.");var p=[],g=void 0;function m(){g=o(p.map(function(w){return w.props})),v.canUseDOM?a(g):c&&(g=c(g))}var v=function(w){s(E,w);function E(){return t(this,E),r(this,w.apply(this,arguments))}return E.peek=function(){return g},E.rewind=function(){if(E.canUseDOM)throw new Error("You may only call rewind() on the server. Call peek() to read the current state.");var P=g;return g=void 0,p=[],P},E.prototype.shouldComponentUpdate=function(P){var j=P.children,U=e(P,["children"]);return j&&j.length&&(U.children=j),h(U,this.props)},E.prototype.componentWillMount=function(){p.push(this),m()},E.prototype.componentDidUpdate=function(){m()},E.prototype.componentWillUnmount=function(){var P=p.indexOf(this);p.splice(P,1),m()},E.prototype.render=function(){return(0,n.h)(f,this.props)},E}(n.Component);return v.displayName="SideEffect("+u(f)+")",v.canUseDOM=!!(typeof window<"u"&&window.document&&window.document.createElement),v};function h(d,f){for(var p in d)if(!(p in f))return!0;for(var g in f)if(d[g]!==f[g])return!0;return!1}},fr}var pr,Xs;function Bo(){if(Xs)return pr;Xs=1;var n=Object.prototype.toString;return pr=function(t){var r=n.call(t),s=r==="[object Arguments]";return s||(s=r!=="[object Array]"&&t!==null&&typeof t=="object"&&typeof t.length=="number"&&t.length>=0&&n.call(t.callee)==="[object Function]"),s},pr}var gr,Zs;function ou(){if(Zs)return gr;Zs=1;var n;if(!Object.keys){var e=Object.prototype.hasOwnProperty,t=Object.prototype.toString,r=Bo(),s=Object.prototype.propertyIsEnumerable,i=!s.call({toString:null},"toString"),o=s.call(function(){},"prototype"),a=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],c=function(f){var p=f.constructor;return p&&p.prototype===f},u={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},h=function(){if(typeof window>"u")return!1;for(var f in window)try{if(!u["$"+f]&&e.call(window,f)&&window[f]!==null&&typeof window[f]=="object")try{c(window[f])}catch{return!0}}catch{return!0}return!1}(),d=function(f){if(typeof window>"u"||!h)return c(f);try{return c(f)}catch{return!1}};n=function(p){var g=p!==null&&typeof p=="object",m=t.call(p)==="[object Function]",v=r(p),w=g&&t.call(p)==="[object String]",E=[];if(!g&&!m&&!v)throw new TypeError("Object.keys called on a non-object");var _=o&&m;if(w&&p.length>0&&!e.call(p,0))for(var P=0;P<p.length;++P)E.push(String(P));if(v&&p.length>0)for(var j=0;j<p.length;++j)E.push(String(j));else for(var U in p)!(_&&U==="prototype")&&e.call(p,U)&&E.push(String(U));if(i)for(var q=d(p),T=0;T<a.length;++T)!(q&&a[T]==="constructor")&&e.call(p,a[T])&&E.push(a[T]);return E}}return gr=n,gr}var vr,ei;function Wo(){if(ei)return vr;ei=1;var n=Array.prototype.slice,e=Bo(),t=Object.keys,r=t?function(o){return t(o)}:ou(),s=Object.keys;return r.shim=function(){if(Object.keys){var o=function(){var a=Object.keys(arguments);return a&&a.length===arguments.length}(1,2);o||(Object.keys=function(c){return e(c)?s(n.call(c)):s(c)})}else Object.keys=r;return Object.keys||r},vr=r,vr}var mr,ti;function Ho(){return ti||(ti=1,mr=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var e={},t=Symbol("test"),r=Object(t);if(typeof t=="string"||Object.prototype.toString.call(t)!=="[object Symbol]"||Object.prototype.toString.call(r)!=="[object Symbol]")return!1;var s=42;e[t]=s;for(var i in e)return!1;if(typeof Object.keys=="function"&&Object.keys(e).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(e).length!==0)return!1;var o=Object.getOwnPropertySymbols(e);if(o.length!==1||o[0]!==t||!Object.prototype.propertyIsEnumerable.call(e,t))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var a=Object.getOwnPropertyDescriptor(e,t);if(a.value!==s||a.enumerable!==!0)return!1}return!0}),mr}var yr,ri;function Kn(){if(ri)return yr;ri=1;var n=Ho();return yr=function(){return n()&&!!Symbol.toStringTag},yr}var _r,ni;function Go(){return ni||(ni=1,_r=Object),_r}var wr,si;function Ko(){return si||(si=1,wr=Error),wr}var br,ii;function au(){return ii||(ii=1,br=EvalError),br}var Sr,oi;function lu(){return oi||(oi=1,Sr=RangeError),Sr}var Er,ai;function cu(){return ai||(ai=1,Er=ReferenceError),Er}var Tr,li;function Vo(){return li||(li=1,Tr=SyntaxError),Tr}var Pr,ci;function _t(){return ci||(ci=1,Pr=TypeError),Pr}var kr,ui;function uu(){return ui||(ui=1,kr=URIError),kr}var Ar,di;function du(){return di||(di=1,Ar=Math.abs),Ar}var $r,hi;function hu(){return hi||(hi=1,$r=Math.floor),$r}var Rr,fi;function fu(){return fi||(fi=1,Rr=Math.max),Rr}var Or,pi;function pu(){return pi||(pi=1,Or=Math.min),Or}var jr,gi;function gu(){return gi||(gi=1,jr=Math.pow),jr}var Cr,vi;function vu(){return vi||(vi=1,Cr=Math.round),Cr}var Ir,mi;function mu(){return mi||(mi=1,Ir=Number.isNaN||function(e){return e!==e}),Ir}var xr,yi;function yu(){if(yi)return xr;yi=1;var n=mu();return xr=function(t){return n(t)||t===0?t:t<0?-1:1},xr}var Nr,_i;function _u(){return _i||(_i=1,Nr=Object.getOwnPropertyDescriptor),Nr}var Ur,wi;function wt(){if(wi)return Ur;wi=1;var n=_u();if(n)try{n([],"length")}catch{n=null}return Ur=n,Ur}var Dr,bi;function Qt(){if(bi)return Dr;bi=1;var n=Object.defineProperty||!1;if(n)try{n({},"a",{value:1})}catch{n=!1}return Dr=n,Dr}var Lr,Si;function wu(){if(Si)return Lr;Si=1;var n=typeof Symbol<"u"&&Symbol,e=Ho();return Lr=function(){return typeof n!="function"||typeof Symbol!="function"||typeof n("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:e()},Lr}var qr,Ei;function zo(){return Ei||(Ei=1,qr=typeof Reflect<"u"&&Reflect.getPrototypeOf||null),qr}var Mr,Ti;function Jo(){if(Ti)return Mr;Ti=1;var n=Go();return Mr=n.getPrototypeOf||null,Mr}var Fr,Pi;function bu(){if(Pi)return Fr;Pi=1;var n="Function.prototype.bind called on incompatible ",e=Object.prototype.toString,t=Math.max,r="[object Function]",s=function(c,u){for(var h=[],d=0;d<c.length;d+=1)h[d]=c[d];for(var f=0;f<u.length;f+=1)h[f+c.length]=u[f];return h},i=function(c,u){for(var h=[],d=u,f=0;d<c.length;d+=1,f+=1)h[f]=c[d];return h},o=function(a,c){for(var u="",h=0;h<a.length;h+=1)u+=a[h],h+1<a.length&&(u+=c);return u};return Fr=function(c){var u=this;if(typeof u!="function"||e.apply(u)!==r)throw new TypeError(n+u);for(var h=i(arguments,1),d,f=function(){if(this instanceof d){var w=u.apply(this,s(h,arguments));return Object(w)===w?w:this}return u.apply(c,s(h,arguments))},p=t(0,u.length-h.length),g=[],m=0;m<p;m++)g[m]="$"+m;if(d=Function("binder","return function ("+o(g,",")+"){ return binder.apply(this,arguments); }")(f),u.prototype){var v=function(){};v.prototype=u.prototype,d.prototype=new v,v.prototype=null}return d},Fr}var Br,ki;function Ut(){if(ki)return Br;ki=1;var n=bu();return Br=Function.prototype.bind||n,Br}var Wr,Ai;function Vn(){return Ai||(Ai=1,Wr=Function.prototype.call),Wr}var Hr,$i;function zn(){return $i||($i=1,Hr=Function.prototype.apply),Hr}var Gr,Ri;function Su(){return Ri||(Ri=1,Gr=typeof Reflect<"u"&&Reflect&&Reflect.apply),Gr}var Kr,Oi;function Yo(){if(Oi)return Kr;Oi=1;var n=Ut(),e=zn(),t=Vn(),r=Su();return Kr=r||n.call(t,e),Kr}var Vr,ji;function Jn(){if(ji)return Vr;ji=1;var n=Ut(),e=_t(),t=Vn(),r=Yo();return Vr=function(i){if(i.length<1||typeof i[0]!="function")throw new e("a function is required");return r(n,t,i)},Vr}var zr,Ci;function Eu(){if(Ci)return zr;Ci=1;var n=Jn(),e=wt(),t;try{t=[].__proto__===Array.prototype}catch(o){if(!o||typeof o!="object"||!("code"in o)||o.code!=="ERR_PROTO_ACCESS")throw o}var r=!!t&&e&&e(Object.prototype,"__proto__"),s=Object,i=s.getPrototypeOf;return zr=r&&typeof r.get=="function"?n([r.get]):typeof i=="function"?function(a){return i(a==null?a:s(a))}:!1,zr}var Jr,Ii;function Qo(){if(Ii)return Jr;Ii=1;var n=zo(),e=Jo(),t=Eu();return Jr=n?function(s){return n(s)}:e?function(s){if(!s||typeof s!="object"&&typeof s!="function")throw new TypeError("getProto: not an object");return e(s)}:t?function(s){return t(s)}:null,Jr}var Yr,xi;function Xo(){if(xi)return Yr;xi=1;var n=Function.prototype.call,e=Object.prototype.hasOwnProperty,t=Ut();return Yr=t.call(n,e),Yr}var Qr,Ni;function Zo(){if(Ni)return Qr;Ni=1;var n,e=Go(),t=Ko(),r=au(),s=lu(),i=cu(),o=Vo(),a=_t(),c=uu(),u=du(),h=hu(),d=fu(),f=pu(),p=gu(),g=vu(),m=yu(),v=Function,w=function(x){try{return v('"use strict"; return ('+x+").constructor;")()}catch{}},E=wt(),_=Qt(),P=function(){throw new a},j=E?function(){try{return arguments.callee,P}catch{try{return E(arguments,"callee").get}catch{return P}}}():P,U=wu()(),q=Qo(),T=Jo(),M=zo(),K=zn(),H=Vn(),Z={},le=typeof Uint8Array>"u"||!q?n:q(Uint8Array),te={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?n:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?n:ArrayBuffer,"%ArrayIteratorPrototype%":U&&q?q([][Symbol.iterator]()):n,"%AsyncFromSyncIteratorPrototype%":n,"%AsyncFunction%":Z,"%AsyncGenerator%":Z,"%AsyncGeneratorFunction%":Z,"%AsyncIteratorPrototype%":Z,"%Atomics%":typeof Atomics>"u"?n:Atomics,"%BigInt%":typeof BigInt>"u"?n:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?n:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?n:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?n:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":t,"%eval%":eval,"%EvalError%":r,"%Float16Array%":typeof Float16Array>"u"?n:Float16Array,"%Float32Array%":typeof Float32Array>"u"?n:Float32Array,"%Float64Array%":typeof Float64Array>"u"?n:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?n:FinalizationRegistry,"%Function%":v,"%GeneratorFunction%":Z,"%Int8Array%":typeof Int8Array>"u"?n:Int8Array,"%Int16Array%":typeof Int16Array>"u"?n:Int16Array,"%Int32Array%":typeof Int32Array>"u"?n:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":U&&q?q(q([][Symbol.iterator]())):n,"%JSON%":typeof JSON=="object"?JSON:n,"%Map%":typeof Map>"u"?n:Map,"%MapIteratorPrototype%":typeof Map>"u"||!U||!q?n:q(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":e,"%Object.getOwnPropertyDescriptor%":E,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?n:Promise,"%Proxy%":typeof Proxy>"u"?n:Proxy,"%RangeError%":s,"%ReferenceError%":i,"%Reflect%":typeof Reflect>"u"?n:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?n:Set,"%SetIteratorPrototype%":typeof Set>"u"||!U||!q?n:q(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?n:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":U&&q?q(""[Symbol.iterator]()):n,"%Symbol%":U?Symbol:n,"%SyntaxError%":o,"%ThrowTypeError%":j,"%TypedArray%":le,"%TypeError%":a,"%Uint8Array%":typeof Uint8Array>"u"?n:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?n:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?n:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?n:Uint32Array,"%URIError%":c,"%WeakMap%":typeof WeakMap>"u"?n:WeakMap,"%WeakRef%":typeof WeakRef>"u"?n:WeakRef,"%WeakSet%":typeof WeakSet>"u"?n:WeakSet,"%Function.prototype.call%":H,"%Function.prototype.apply%":K,"%Object.defineProperty%":_,"%Object.getPrototypeOf%":T,"%Math.abs%":u,"%Math.floor%":h,"%Math.max%":d,"%Math.min%":f,"%Math.pow%":p,"%Math.round%":g,"%Math.sign%":m,"%Reflect.getPrototypeOf%":M};if(q)try{null.error}catch(x){var oe=q(q(x));te["%Error.prototype%"]=oe}var Ie=function x(C){var D;if(C==="%AsyncFunction%")D=w("async function () {}");else if(C==="%GeneratorFunction%")D=w("function* () {}");else if(C==="%AsyncGeneratorFunction%")D=w("async function* () {}");else if(C==="%AsyncGenerator%"){var O=x("%AsyncGeneratorFunction%");O&&(D=O.prototype)}else if(C==="%AsyncIteratorPrototype%"){var W=x("%AsyncGenerator%");W&&q&&(D=q(W.prototype))}return te[C]=D,D},ve={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},Se=Ut(),xe=Xo(),bt=Se.call(H,Array.prototype.concat),De=Se.call(K,Array.prototype.splice),he=Se.call(H,String.prototype.replace),Re=Se.call(H,String.prototype.slice),L=Se.call(H,RegExp.prototype.exec),y=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,A=/\\(\\)?/g,S=function(C){var D=Re(C,0,1),O=Re(C,-1);if(D==="%"&&O!=="%")throw new o("invalid intrinsic syntax, expected closing `%`");if(O==="%"&&D!=="%")throw new o("invalid intrinsic syntax, expected opening `%`");var W=[];return he(C,y,function(J,fe,Y,ne){W[W.length]=Y?he(ne,A,"$1"):fe||J}),W},R=function(C,D){var O=C,W;if(xe(ve,O)&&(W=ve[O],O="%"+W[0]+"%"),xe(te,O)){var J=te[O];if(J===Z&&(J=Ie(O)),typeof J>"u"&&!D)throw new a("intrinsic "+C+" exists, but is not available. Please file an issue!");return{alias:W,name:O,value:J}}throw new o("intrinsic "+C+" does not exist!")};return Qr=function(C,D){if(typeof C!="string"||C.length===0)throw new a("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof D!="boolean")throw new a('"allowMissing" argument must be a boolean');if(L(/^%?[^%]*%?$/,C)===null)throw new o("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var O=S(C),W=O.length>0?O[0]:"",J=R("%"+W+"%",D),fe=J.name,Y=J.value,ne=!1,me=J.alias;me&&(W=me[0],De(O,bt([0,1],me)));for(var ge=1,ce=!0;ge<O.length;ge+=1){var F=O[ge],b=Re(F,0,1),Te=Re(F,-1);if((b==='"'||b==="'"||b==="`"||Te==='"'||Te==="'"||Te==="`")&&b!==Te)throw new o("property names with quotes must have matching quotes");if((F==="constructor"||!ce)&&(ne=!0),W+="."+F,fe="%"+W+"%",xe(te,fe))Y=te[fe];else if(Y!=null){if(!(F in Y)){if(!D)throw new a("base intrinsic for "+C+" exists, but the property is not available.");return}if(E&&ge+1>=O.length){var Pe=E(Y,F);ce=!!Pe,ce&&"get"in Pe&&!("originalValue"in Pe.get)?Y=Pe.get:Y=Y[F]}else ce=xe(Y,F),Y=Y[F];ce&&!ne&&(te[fe]=Y)}}return Y},Qr}var Xr,Ui;function Yn(){if(Ui)return Xr;Ui=1;var n=Zo(),e=Jn(),t=e([n("%String.prototype.indexOf%")]);return Xr=function(s,i){var o=n(s,!!i);return typeof o=="function"&&t(s,".prototype.")>-1?e([o]):o},Xr}var Zr,Di;function Tu(){if(Di)return Zr;Di=1;var n=Kn()(),e=Yn(),t=e("Object.prototype.toString"),r=function(a){return n&&a&&typeof a=="object"&&Symbol.toStringTag in a?!1:t(a)==="[object Arguments]"},s=function(a){return r(a)?!0:a!==null&&typeof a=="object"&&"length"in a&&typeof a.length=="number"&&a.length>=0&&t(a)!=="[object Array]"&&"callee"in a&&t(a.callee)==="[object Function]"},i=function(){return r(arguments)}();return r.isLegacyArguments=s,Zr=i?r:s,Zr}var en,Li;function Qn(){if(Li)return en;Li=1;var n=Qt(),e=Vo(),t=_t(),r=wt();return en=function(i,o,a){if(!i||typeof i!="object"&&typeof i!="function")throw new t("`obj` must be an object or a function`");if(typeof o!="string"&&typeof o!="symbol")throw new t("`property` must be a string or a symbol`");if(arguments.length>3&&typeof arguments[3]!="boolean"&&arguments[3]!==null)throw new t("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&typeof arguments[4]!="boolean"&&arguments[4]!==null)throw new t("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&typeof arguments[5]!="boolean"&&arguments[5]!==null)throw new t("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&typeof arguments[6]!="boolean")throw new t("`loose`, if provided, must be a boolean");var c=arguments.length>3?arguments[3]:null,u=arguments.length>4?arguments[4]:null,h=arguments.length>5?arguments[5]:null,d=arguments.length>6?arguments[6]:!1,f=!!r&&r(i,o);if(n)n(i,o,{configurable:h===null&&f?f.configurable:!h,enumerable:c===null&&f?f.enumerable:!c,value:a,writable:u===null&&f?f.writable:!u});else if(d||!c&&!u&&!h)i[o]=a;else throw new e("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.")},en}var tn,qi;function Xn(){if(qi)return tn;qi=1;var n=Qt(),e=function(){return!!n};return e.hasArrayLengthDefineBug=function(){if(!n)return null;try{return n([],"length",{value:1}).length!==1}catch{return!0}},tn=e,tn}var rn,Mi;function Dt(){if(Mi)return rn;Mi=1;var n=Wo(),e=typeof Symbol=="function"&&typeof Symbol("foo")=="symbol",t=Object.prototype.toString,r=Array.prototype.concat,s=Qn(),i=function(u){return typeof u=="function"&&t.call(u)==="[object Function]"},o=Xn()(),a=function(u,h,d,f){if(h in u){if(f===!0){if(u[h]===d)return}else if(!i(f)||!f())return}o?s(u,h,d,!0):s(u,h,d)},c=function(u,h){var d=arguments.length>2?arguments[2]:{},f=n(h);e&&(f=r.call(f,Object.getOwnPropertySymbols(h)));for(var p=0;p<f.length;p+=1)a(u,f[p],h[f[p]],d[f[p]])};return c.supportsDescriptors=!!o,rn=c,rn}var nn={exports:{}},sn,Fi;function Pu(){if(Fi)return sn;Fi=1;var n=Zo(),e=Qn(),t=Xn()(),r=wt(),s=_t(),i=n("%Math.floor%");return sn=function(a,c){if(typeof a!="function")throw new s("`fn` is not a function");if(typeof c!="number"||c<0||c>4294967295||i(c)!==c)throw new s("`length` must be a positive 32-bit integer");var u=arguments.length>2&&!!arguments[2],h=!0,d=!0;if("length"in a&&r){var f=r(a,"length");f&&!f.configurable&&(h=!1),f&&!f.writable&&(d=!1)}return(h||d||!u)&&(t?e(a,"length",c,!0,!0):e(a,"length",c)),a},sn}var on,Bi;function ku(){if(Bi)return on;Bi=1;var n=Ut(),e=zn(),t=Yo();return on=function(){return t(n,e,arguments)},on}var Wi;function ea(){return Wi||(Wi=1,function(n){var e=Pu(),t=Qt(),r=Jn(),s=ku();n.exports=function(o){var a=r(arguments),c=o.length-(arguments.length-1);return e(a,1+(c>0?c:0),!0)},t?t(n.exports,"apply",{value:s}):n.exports.apply=s}(nn)),nn.exports}var an,Hi;function ta(){if(Hi)return an;Hi=1;var n=function(e){return e!==e};return an=function(t,r){return t===0&&r===0?1/t===1/r:!!(t===r||n(t)&&n(r))},an}var ln,Gi;function ra(){if(Gi)return ln;Gi=1;var n=ta();return ln=function(){return typeof Object.is=="function"?Object.is:n},ln}var cn,Ki;function Au(){if(Ki)return cn;Ki=1;var n=ra(),e=Dt();return cn=function(){var r=n();return e(Object,{is:r},{is:function(){return Object.is!==r}}),r},cn}var un,Vi;function $u(){if(Vi)return un;Vi=1;var n=Dt(),e=ea(),t=ta(),r=ra(),s=Au(),i=e(r(),Object);return n(i,{getPolyfill:r,implementation:t,shim:s}),un=i,un}var dn,zi;function Ru(){if(zi)return dn;zi=1;var n=Yn(),e=Kn()(),t=Xo(),r=wt(),s;if(e){var i=n("RegExp.prototype.exec"),o={},a=function(){throw o},c={toString:a,valueOf:a};typeof Symbol.toPrimitive=="symbol"&&(c[Symbol.toPrimitive]=a),s=function(f){if(!f||typeof f!="object")return!1;var p=r(f,"lastIndex"),g=p&&t(p,"value");if(!g)return!1;try{i(f,c)}catch(m){return m===o}}}else{var u=n("Object.prototype.toString"),h="[object RegExp]";s=function(f){return!f||typeof f!="object"&&typeof f!="function"?!1:u(f)===h}}return dn=s,dn}var hn,Ji;function Ou(){if(Ji)return hn;Ji=1;var n=function(){return typeof(function(){}).name=="string"},e=Object.getOwnPropertyDescriptor;if(e)try{e([],"length")}catch{e=null}n.functionsHaveConfigurableNames=function(){if(!n()||!e)return!1;var s=e(function(){},"name");return!!s&&!!s.configurable};var t=Function.prototype.bind;return n.boundFunctionsHaveNames=function(){return n()&&typeof t=="function"&&(function(){}).bind().name!==""},hn=n,hn}var fn,Yi;function ju(){if(Yi)return fn;Yi=1;var n=Qn(),e=Xn()(),t=Ou().functionsHaveConfigurableNames(),r=_t();return fn=function(i,o){if(typeof i!="function")throw new r("`fn` is not a function");var a=arguments.length>2&&!!arguments[2];return(!a||t)&&(e?n(i,"name",o,!0,!0):n(i,"name",o)),i},fn}var pn,Qi;function na(){if(Qi)return pn;Qi=1;var n=ju(),e=_t(),t=Object;return pn=n(function(){if(this==null||this!==t(this))throw new e("RegExp.prototype.flags getter called on non-object");var s="";return this.hasIndices&&(s+="d"),this.global&&(s+="g"),this.ignoreCase&&(s+="i"),this.multiline&&(s+="m"),this.dotAll&&(s+="s"),this.unicode&&(s+="u"),this.unicodeSets&&(s+="v"),this.sticky&&(s+="y"),s},"get flags",!0),pn}var gn,Xi;function sa(){if(Xi)return gn;Xi=1;var n=na(),e=Dt().supportsDescriptors,t=Object.getOwnPropertyDescriptor;return gn=function(){if(e&&/a/mig.flags==="gim"){var s=t(RegExp.prototype,"flags");if(s&&typeof s.get=="function"&&"dotAll"in RegExp.prototype&&"hasIndices"in RegExp.prototype){var i="",o={};if(Object.defineProperty(o,"hasIndices",{get:function(){i+="d"}}),Object.defineProperty(o,"sticky",{get:function(){i+="y"}}),s.get.call(o),i==="dy")return s.get}}return n},gn}var vn,Zi;function Cu(){if(Zi)return vn;Zi=1;var n=Dt().supportsDescriptors,e=sa(),t=wt(),r=Object.defineProperty,s=Ko(),i=Qo(),o=/a/;return vn=function(){if(!n||!i)throw new s("RegExp.prototype.flags requires a true ES5 environment that supports property descriptors");var c=e(),u=i(o),h=t(u,"flags");return(!h||h.get!==c)&&r(u,"flags",{configurable:!0,enumerable:!1,get:c}),c},vn}var mn,eo;function Iu(){if(eo)return mn;eo=1;var n=Dt(),e=ea(),t=na(),r=sa(),s=Cu(),i=e(r());return n(i,{getPolyfill:r,implementation:t,shim:s}),mn=i,mn}var yn,to;function xu(){if(to)return yn;to=1;var n=Yn(),e=n("Date.prototype.getDay"),t=function(a){try{return e(a),!0}catch{return!1}},r=n("Object.prototype.toString"),s="[object Date]",i=Kn()();return yn=function(a){return typeof a!="object"||a===null?!1:i?t(a):r(a)===s},yn}var _n,ro;function Nu(){if(ro)return _n;ro=1;var n=Wo(),e=Tu(),t=$u(),r=Ru(),s=Iu(),i=xu(),o=Date.prototype.getTime;function a(d,f,p){var g=p||{};return(g.strict?t(d,f):d===f)?!0:!d||!f||typeof d!="object"&&typeof f!="object"?g.strict?t(d,f):d==f:h(d,f,g)}function c(d){return d==null}function u(d){return!(!d||typeof d!="object"||typeof d.length!="number"||typeof d.copy!="function"||typeof d.slice!="function"||d.length>0&&typeof d[0]!="number")}function h(d,f,p){var g,m;if(typeof d!=typeof f||c(d)||c(f)||d.prototype!==f.prototype||e(d)!==e(f))return!1;var v=r(d),w=r(f);if(v!==w)return!1;if(v||w)return d.source===f.source&&s(d)===s(f);if(i(d)&&i(f))return o.call(d)===o.call(f);var E=u(d),_=u(f);if(E!==_)return!1;if(E||_){if(d.length!==f.length)return!1;for(g=0;g<d.length;g++)if(d[g]!==f[g])return!1;return!0}if(typeof d!=typeof f)return!1;try{var P=n(d),j=n(f)}catch{return!1}if(P.length!==j.length)return!1;for(P.sort(),j.sort(),g=P.length-1;g>=0;g--)if(P[g]!=j[g])return!1;for(g=P.length-1;g>=0;g--)if(m=P[g],!a(d[m],f[m],p))return!1;return!0}return _n=a,_n}/*
object-assign
(c) Sindre Sorhus
@license MIT
*/var wn,no;function Uu(){if(no)return wn;no=1;var n=Object.getOwnPropertySymbols,e=Object.prototype.hasOwnProperty,t=Object.prototype.propertyIsEnumerable;function r(i){if(i==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(i)}function s(){try{if(!Object.assign)return!1;var i=new String("abc");if(i[5]="de",Object.getOwnPropertyNames(i)[0]==="5")return!1;for(var o={},a=0;a<10;a++)o["_"+String.fromCharCode(a)]=a;var c=Object.getOwnPropertyNames(o).map(function(h){return o[h]});if(c.join("")!=="0123456789")return!1;var u={};return"abcdefghijklmnopqrst".split("").forEach(function(h){u[h]=h}),Object.keys(Object.assign({},u)).join("")==="abcdefghijklmnopqrst"}catch{return!1}}return wn=s()?Object.assign:function(i,o){for(var a,c=r(i),u,h=1;h<arguments.length;h++){a=Object(arguments[h]);for(var d in a)e.call(a,d)&&(c[d]=a[d]);if(n){u=n(a);for(var f=0;f<u.length;f++)t.call(a,u[f])&&(c[u[f]]=a[u[f]])}}return c},wn}var dt={},so;function Du(){return so||(so=1,dt.__esModule=!0,dt.TAG_NAMES={HTML:"htmlAttributes",TITLE:"title",BASE:"base",META:"meta",LINK:"link",SCRIPT:"script",NOSCRIPT:"noscript",STYLE:"style"},dt.TAG_PROPERTIES={NAME:"name",CHARSET:"charset",HTTPEQUIV:"http-equiv",REL:"rel",HREF:"href",PROPERTY:"property",SRC:"src",INNER_HTML:"innerHTML",CSS_TEXT:"cssText",ITEM_PROP:"itemprop"},dt.PREACT_TAG_MAP={charset:"charSet","http-equiv":"httpEquiv",itemprop:"itemProp",class:"className"}),dt}var io;function Lu(){return io||(io=1,function(n,e){e.__esModule=!0;var t=function(){function L(y,A){for(var S=0;S<A.length;S++){var R=A[S];R.enumerable=R.enumerable||!1,R.configurable=!0,"value"in R&&(R.writable=!0),Object.defineProperty(y,R.key,R)}}return function(y,A,S){return A&&L(y.prototype,A),S&&L(y,S),y}}(),r=Object.assign||function(L){for(var y=1;y<arguments.length;y++){var A=arguments[y];for(var S in A)Object.prototype.hasOwnProperty.call(A,S)&&(L[S]=A[S])}return L},s=Fo,i=iu(),o=f(i),a=Nu(),c=f(a),u=Uu(),h=f(u),d=Du();function f(L){return L&&L.__esModule?L:{default:L}}function p(L,y){if(!(L instanceof y))throw new TypeError("Cannot call a class as a function")}function g(L,y){if(!L)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return y&&(typeof y=="object"||typeof y=="function")?y:L}function m(L,y){if(typeof y!="function"&&y!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof y);L.prototype=Object.create(y&&y.prototype,{constructor:{value:L,enumerable:!1,writable:!0,configurable:!0}}),y&&(Object.setPrototypeOf?Object.setPrototypeOf(L,y):L.__proto__=y)}function v(L,y,A){return y in L?Object.defineProperty(L,y,{value:A,enumerable:!0,configurable:!0,writable:!0}):L[y]=A,L}var w="data-preact-helmet",E=function(y){return String(y).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;")},_=function(y,A){for(var S=y.length-1;S>=0;S--){var R=y[S];if(R[A])return R[A]}return null},P=function(y){var A=_(y,"title"),S=_(y,"titleTemplate");if(S&&A)return S.replace(/%s/g,function(){return A});var R=_(y,"defaultTitle");return A||R||""},j=function(y){return _(y,"onChangeClientState")||function(){}},U=function(y,A){return A.filter(function(S){return typeof S[y]<"u"}).map(function(S){return S[y]}).reduce(function(S,R){return r({},S,R)},{})},q=function(y,A){return A.filter(function(S){return typeof S[d.TAG_NAMES.BASE]<"u"}).map(function(S){return S[d.TAG_NAMES.BASE]}).reverse().reduce(function(S,R){if(!S.length)for(var x=Object.keys(R),C=0;C<x.length;C++){var D=x[C],O=D.toLowerCase();if(y.indexOf(O)!==-1&&R[O])return S.concat(R)}return S},[])},T=function(y,A,S){var R={};return S.filter(function(x){return typeof x[y]<"u"}).map(function(x){return x[y]}).reverse().reduce(function(x,C){var D={};C.filter(function(Y){for(var ne=void 0,me=Object.keys(Y),ge=0;ge<me.length;ge++){var ce=me[ge],F=ce.toLowerCase();A.indexOf(F)!==-1&&!(ne===d.TAG_PROPERTIES.REL&&Y[ne].toLowerCase()==="canonical")&&!(F===d.TAG_PROPERTIES.REL&&Y[F].toLowerCase()==="stylesheet")&&(ne=F),A.indexOf(ce)!==-1&&(ce===d.TAG_PROPERTIES.INNER_HTML||ce===d.TAG_PROPERTIES.CSS_TEXT||ce===d.TAG_PROPERTIES.ITEM_PROP)&&(ne=ce)}if(!ne||!Y[ne])return!1;var b=Y[ne].toLowerCase();return R[ne]||(R[ne]={}),D[ne]||(D[ne]={}),R[ne][b]?!1:(D[ne][b]=!0,!0)}).reverse().forEach(function(Y){return x.push(Y)});for(var O=Object.keys(D),W=0;W<O.length;W++){var J=O[W],fe=(0,h.default)({},R[J],D[J]);R[J]=fe}return x},[]).reverse()},M=function(y,A){document.title=y||document.title,K(d.TAG_NAMES.TITLE,A)},K=function(y,A){for(var S=document.getElementsByTagName(y)[0],R=S.getAttribute(w),x=R?R.split(","):[],C=[].concat(x),D=Object.keys(A),O=0;O<D.length;O++){var W=D[O],J=A[W]||"";S.setAttribute(W,J),x.indexOf(W)===-1&&x.push(W);var fe=C.indexOf(W);fe!==-1&&C.splice(fe,1)}for(var Y=C.length-1;Y>=0;Y--)S.removeAttribute(C[Y]);x.length===C.length?S.removeAttribute(w):S.setAttribute(w,x.join(","))},H=function(y,A){var S=document.head||document.querySelector("head"),R=S.querySelectorAll(y+"["+w+"]"),x=Array.prototype.slice.call(R),C=[],D=void 0;return A&&A.length&&A.forEach(function(O){var W=document.createElement(y);for(var J in O)if(O.hasOwnProperty(J))if(J==="innerHTML")W.innerHTML=O.innerHTML;else if(J==="cssText")W.styleSheet?W.styleSheet.cssText=O.cssText:W.appendChild(document.createTextNode(O.cssText));else{var fe=typeof O[J]>"u"?"":O[J];W.setAttribute(J,fe)}W.setAttribute(w,"true"),x.some(function(Y,ne){return D=ne,W.isEqualNode(Y)})?x.splice(D,1):C.push(W)}),x.forEach(function(O){return O.parentNode.removeChild(O)}),C.forEach(function(O){return S.appendChild(O)}),{oldTags:x,newTags:C}},Z=function(y){return Object.keys(y).reduce(function(A,S){var R=typeof y[S]<"u"?S+'="'+y[S]+'"':""+S;return A?A+" "+R:R},"")},le=function(y,A,S){var R=Z(S);return R?"<"+y+" "+w+" "+R+">"+E(A)+"</"+y+">":"<"+y+" "+w+">"+E(A)+"</"+y+">"},te=function(y,A){return A.reduce(function(S,R){var x=Object.keys(R).filter(function(O){return!(O==="innerHTML"||O==="cssText")}).reduce(function(O,W){var J=typeof R[W]>"u"?W:W+'="'+E(R[W])+'"';return O?O+" "+J:J},""),C=R.innerHTML||R.cssText||"",D=[d.TAG_NAMES.NOSCRIPT,d.TAG_NAMES.SCRIPT,d.TAG_NAMES.STYLE].indexOf(y)===-1;return S+"<"+y+" "+w+" "+x+(D?">":">"+C+"</"+y+">")},"")},oe=function(y,A,S){var R=v({key:A},w,!0),x=Object.keys(S).reduce(function(C,D){return C[D]=S[D],C},R);return[(0,s.h)(d.TAG_NAMES.TITLE,x,A)]},Ie=function(y,A){return A.map(function(S,R){var x=v({key:R},w,!0);return Object.keys(S).forEach(function(C){var D=C;if(D==="innerHTML"||D==="cssText"){var O=S.innerHTML||S.cssText;x.dangerouslySetInnerHTML={__html:O}}else x[D]=S[C]}),(0,s.h)(y,x)})},ve=function(y,A){switch(y){case d.TAG_NAMES.TITLE:return{toComponent:function(){return oe(y,A.title,A.titleAttributes)},toString:function(){return le(y,A.title,A.titleAttributes)}};case d.TAG_NAMES.HTML:return{toComponent:function(){return A},toString:function(){return Z(A)}};default:return{toComponent:function(){return Ie(y,A)},toString:function(){return te(y,A)}}}},Se=function(y){var A=y.htmlAttributes,S=y.title,R=y.titleAttributes,x=y.baseTag,C=y.metaTags,D=y.linkTags,O=y.scriptTags,W=y.noscriptTags,J=y.styleTags;return{htmlAttributes:ve(d.TAG_NAMES.HTML,A),title:ve(d.TAG_NAMES.TITLE,{title:S,titleAttributes:R}),base:ve(d.TAG_NAMES.BASE,x),meta:ve(d.TAG_NAMES.META,C),link:ve(d.TAG_NAMES.LINK,D),script:ve(d.TAG_NAMES.SCRIPT,O),noscript:ve(d.TAG_NAMES.NOSCRIPT,W),style:ve(d.TAG_NAMES.STYLE,J)}},xe=function(y){var A,S;return S=A=function(R){m(x,R);function x(){return p(this,x),g(this,(x.__proto__||Object.getPrototypeOf(x)).apply(this,arguments))}return t(x,[{key:"shouldComponentUpdate",value:function(D){var O=r({},D);return(!O.children||!O.children.length)&&delete O.children,!(0,c.default)(this.props,O)}},{key:"render",value:function(){return(0,s.h)(y,this.props)}}],[{key:"canUseDOM",set:function(D){y.canUseDOM=D}}]),x}(s.Component),A.peek=y.peek,A.rewind=function(){var R=y.rewind();return R||(R=Se({htmlAttributes:{},title:"",titleAttributes:{},baseTag:[],metaTags:[],linkTags:[],scriptTags:[],noscriptTags:[],styleTags:[]})),R},S},bt=function(y){return{htmlAttributes:U(d.TAG_NAMES.HTML,y),title:P(y),titleAttributes:U("titleAttributes",y),baseTag:q([d.TAG_PROPERTIES.HREF],y),metaTags:T(d.TAG_NAMES.META,[d.TAG_PROPERTIES.NAME,d.TAG_PROPERTIES.CHARSET,d.TAG_PROPERTIES.HTTPEQUIV,d.TAG_PROPERTIES.PROPERTY,d.TAG_PROPERTIES.ITEM_PROP],y),linkTags:T(d.TAG_NAMES.LINK,[d.TAG_PROPERTIES.REL,d.TAG_PROPERTIES.HREF],y),scriptTags:T(d.TAG_NAMES.SCRIPT,[d.TAG_PROPERTIES.SRC,d.TAG_PROPERTIES.INNER_HTML],y),noscriptTags:T(d.TAG_NAMES.NOSCRIPT,[d.TAG_PROPERTIES.INNER_HTML],y),styleTags:T(d.TAG_NAMES.STYLE,[d.TAG_PROPERTIES.CSS_TEXT],y),onChangeClientState:j(y)}},De=function(y){var A=y.htmlAttributes,S=y.title,R=y.titleAttributes,x=y.baseTag,C=y.metaTags,D=y.linkTags,O=y.scriptTags,W=y.noscriptTags,J=y.styleTags,fe=y.onChangeClientState;K("html",A),M(S,R);var Y={baseTag:H(d.TAG_NAMES.BASE,x),metaTags:H(d.TAG_NAMES.META,C),linkTags:H(d.TAG_NAMES.LINK,D),scriptTags:H(d.TAG_NAMES.SCRIPT,O),noscriptTags:H(d.TAG_NAMES.NOSCRIPT,W),styleTags:H(d.TAG_NAMES.STYLE,J)},ne={},me={};Object.keys(Y).forEach(function(ge){var ce=Y[ge],F=ce.newTags,b=ce.oldTags;F.length&&(ne[ge]=F),b.length&&(me[ge]=Y[ge].oldTags)}),fe(y,ne,me)},he=function(){return null},Re=(0,o.default)(bt,De,Se)(he);e.default=xe(Re),n.exports=e.default}(Gt,Gt.exports)),Gt.exports}var qu=Lu();const Jt=go(qu),Mu=()=>{const{user:n}=Ve(),e=Me(s=>s.favorites),[t,r]=N({});return ee(()=>{document.title="My Favorites - FreeStream"},[]),ee(()=>{(async()=>{if(n&&e.length>0){const i=e.map(o=>({media_id:o.id,media_type:o.type,season_number:o.season_number||null,episode_number:o.episode_number||null}));try{const o=await qo(i);r(o)}catch(o){console.error("Error fetching progress data for favorites:",o),r({})}}else r({})})()},[n,e]),l("div",{class:"container",children:[l(Jt,{children:l("title",{children:"My Favorites - FreeStream"})}),l("h1",{children:"My Favorites"}),e.length>0?l("div",{class:"movie-grid",children:e.map(s=>{const i=`${s.id}-${s.type}-${s.season_number||0}-${s.episode_number||0}`,o=t[i];return l(mt,{item:s,type:s.type,progress:o?.progress_seconds,duration:o?.duration_seconds},`${s.type}-${s.id}-${s.season_number||0}-${s.episode_number||0}`)})}):l("p",{children:"You haven't added any favorites yet."})]})},oo=async(n,e=3,t=1e3)=>{for(let r=0;r<e;r++)try{const s=new Promise((a,c)=>{setTimeout(()=>c(new Error("Request timeout")),1e4)}),i=fetch(n,{headers:{Accept:"application/json","Content-Type":"application/json"}}),o=await Promise.race([i,s]);if(!o.ok)throw new Error(`HTTP ${o.status}: ${o.statusText}`);return o}catch(s){if(console.warn(`Fetch attempt ${r+1} failed for ${n}:`,s.message),r===e-1)throw s;await new Promise(i=>setTimeout(i,t*(r+1)))}},Fu=()=>{const{user:n}=Ve(),[e,t]=N([]),[r,s]=N(!0),[i,o]=N(null),{removeContinueWatchingItem:a,fetchContinueWatching:c}=Me(),u=da(async()=>{if(!n){s(!1);return}s(!0),o(null);try{if(!await Uo())throw new Error("Supabase connection test failed. Please check your internet connection and try again.");const p=await Xc();if(!p||p.length===0){t([]),s(!1);return}console.log("📚 Combined history data received:",{totalItems:p.length,itemsWithProgress:p.filter(v=>v.progress_seconds>0).length});const m=(await Promise.allSettled(p.map(async v=>{try{const E=await(await oo(`${we}/tmdb/${v.media_type}/${v.media_id}`)).json(),_={...E,id:E.id,watch_id:`${v.user_id}-${v.media_id}-${v.media_type}-${v.season_number||0}-${v.episode_number||0}`,type:v.media_type,media_type:v.media_type,media_id:v.media_id,season_number:v.season_number,episode_number:v.episode_number,watched_at:v.watched_at,progress_seconds:v.progress_seconds,duration_seconds:v.duration_seconds};if(v.media_type==="tv"&&v.season_number&&v.episode_number)try{const j=await(await oo(`${we}/tmdb/tv/${v.media_id}/season/${v.season_number}/episode/${v.episode_number}`)).json();return{..._,episode_name:j.name,still_path:j.still_path,episode_overview:j.overview}}catch(P){console.error("Error fetching episode details:",P)}return _}catch(w){return console.error(`Error fetching details for ${v.media_type} ${v.media_id}:`,w),{id:v.media_id,watch_id:`${v.user_id}-${v.media_id}-${v.media_type}-${v.season_number||0}-${v.episode_number||0}`,type:v.media_type,media_type:v.media_type,media_id:v.media_id,season_number:v.season_number,episode_number:v.episode_number,watched_at:v.watched_at,title:v.media_type==="tv"?"Unknown TV Show":"Unknown Movie",name:v.media_type==="tv"?"Unknown TV Show":void 0,poster_path:null,overview:"Details could not be loaded",_failed_to_load:!0,progress_seconds:v.progress_seconds,duration_seconds:v.duration_seconds}}}))).filter(v=>v.status==="fulfilled"&&v.value).map(v=>v.value);t(m)}catch(f){console.error("Error fetching watch history:",f),o("Failed to load watch history. Please try again."),t([])}finally{s(!1)}},[n]);ee(()=>{u()},[u]);const h=async f=>{t(e.filter(p=>p.watch_id!==f.watch_id)),a(f.media_id);try{await Jc(f),await c()}catch(p){console.error("Failed to delete item or refetch continue watching:",p)}},d=()=>{u()};return r?l("div",{class:"container",children:l("p",{children:"Loading watch history..."})}):i?l("div",{class:"container",children:[l(Jt,{children:l("title",{children:"Watch History - FreeStream"})}),l("h1",{children:"Watch History"}),l("div",{class:"error-message",children:[l("p",{children:i}),l("button",{onClick:d,class:"retry-button",children:"Retry"})]})]}):l("div",{class:"container",children:[l(Jt,{children:l("title",{children:"Watch History - FreeStream"})}),l("h1",{children:"Watch History"}),e.length>0?l("div",{class:"movie-grid",children:e.map(f=>l(mt,{item:f,type:f.type,progress:f.progress_seconds,duration:f.duration_seconds,showDeleteButton:!0,onDelete:h},f.watch_id))}):l("p",{children:"Your watch history is empty."})]})},ao=n=>{const[e,t]=N(null),[r,s]=N([]),[i,o]=N([]),[a,c]=N(""),[u,h]=N(!0),[d,f]=N(!1),[p,g]=N(null),[m,v]=N(null),[w,E]=N("videasy"),[_,P]=N(["videasy","vidsrc","embedsu"]),[j,U]=N(null),[q,T]=N(!1),[M,K]=N(!1),[H,Z]=N(null),[le,te]=N(!1),[oe,Ie]=N(!1),[ve,Se]=N([]),xe=ye(null),[bt,De]=N([]),[he,Re]=N(null),[L,y]=N(!1),[A,S]=N(0),[R,x]=N(1),C=6,D=ye(!1),O=ye(null),W=ye(!1),J=ye(!1),fe=ye(!1),Y=ye(null),ne=ye(!1),me=ye(new Set),ge=ye(0);ye(0);const ce=ye(null),{id:F,type:b,season:Te,episode:Pe}=n.matches,{user:ke}=Ve(),{addFavorite:Zn,removeFavorite:es,isFavorited:ts,setCurrentMediaItem:Xt,favoritesFetched:rs}=Me();ee(()=>{if(b==="tv"||b==="anime")if(Te&&Pe&&!isNaN(parseInt(Te))&&!isNaN(parseInt(Pe))){const B=parseInt(Te,10),$=parseInt(Pe,10);g(B),v($)}else g(1),v(1);else g(null),v(null)},[b,Te,Pe]);const ns=ha(()=>b!=="movie"||!he||!he.progress_seconds||he.progress_seconds<=0?0:he.duration_seconds>0?Math.min(100,he.progress_seconds/he.duration_seconds*100):he.progress_seconds>30?5:2,[b,he]),Zt=ke?.id,ss=ye(Zt);ye(0),ee(()=>{ss.current=Zt},[Zt]),ee(()=>()=>{me.current.forEach(k=>clearTimeout(k)),me.current.clear()},[p,m]),ee(()=>(e&&Xt({...e,type:b}),()=>{Xt(null)}),[e,b,Xt]),ee(()=>{if(!F||!b){$e("/");return}c(""),Ie(!1),Se([]),t(null),h(!0),De([]),W.current=!1,J.current=!1,fe.current=!1,Y.current=null,ne.current=!1,me.current.forEach(B=>clearTimeout(B)),me.current.clear(),ge.current=0,ce.current=null,(async()=>{h(!0);try{const B=new AbortController,$=setTimeout(()=>B.abort(),15e3),[Q,ae,X]=await Promise.all([fetch(`${we}/tmdb/${b}/${F}`,{signal:B.signal}).then(I=>{if(!I.ok)throw new Error(`HTTP ${I.status}: ${I.statusText}`);return I.json()}).catch(I=>{throw console.error("Error fetching media details:",I),I}),fetch(`${we}/tmdb/${b}/${F}/videos`,{signal:B.signal}).then(I=>{if(!I.ok)throw new Error(`HTTP ${I.status}: ${I.statusText}`);return I.json()}).catch(I=>(console.error("Error fetching videos:",I),{results:[]})),fetch(`${we}/tmdb/${b}/${F}/recommendations`,{signal:B.signal}).then(I=>{if(!I.ok)throw new Error(`HTTP ${I.status}: ${I.statusText}`);return I.json()}).catch(I=>(console.error("Error fetching recommendations:",I),{results:[]}))]);clearTimeout($),t(Q),s(ae.results||[]),o(X.results||[])}catch{t(null),s([]),o([])}finally{h(!1)}})()},[F,b,Te,Pe]),ee(()=>{(async()=>{if(!ke||!e||!F||!b){b==="movie"?Re(null):(b==="tv"||b==="anime")&&De([]);return}try{if((b==="tv"||b==="anime")&&e.seasons&&e.seasons.length>0&&!(Te&&Pe&&!isNaN(parseInt(Te))&&!isNaN(parseInt(Pe)))&&!J.current&&p!==null&&m!==null){console.log("🎬 Checking for continue watching episode...");const $=await Qc(F);$&&$.season&&$.episode?(console.log(`🔄 Continue watching: S${$.season}E${$.episode}`),setTimeout(()=>{g($.season),v($.episode);const Q=`/watch/${b}/${F}/season/${$.season}/episode/${$.episode}`;$e(Q,!0)},100)):console.log("📭 No continue watching data found, starting from beginning"),J.current=!0}if(b==="tv"||b==="anime"){const B=await Yc(F);De(B)}else if(b==="movie"){const B=await dr(F,b);console.log("Movie progress data loaded:",B),Re(B)}}catch(B){console.error("Error loading user-specific data:",B)}})()},[ke,e,F,b]),ee(()=>{p!==null&&x(1)},[p]),ee(()=>{(async()=>{if(!(b!=="tv"&&b!=="anime"||!F||!p||p===null)){T(!0);try{const B=new AbortController,$=setTimeout(()=>B.abort(),1e4),Q=await fetch(`${we}/tmdb/${b}/${F}/season/${p}`,{signal:B.signal});if(clearTimeout($),Q.ok){const ae=await Q.json();U(ae)}else U(null)}catch{U(null)}finally{T(!1)}}})()},[F,b,p]),ee(()=>{const k=`${p}-${m}`,B=O.current&&O.current!==k;if(O.current=k,D.current&&!B){D.current=!1;return}B&&(D.current=!1),(async()=>{if(!F||!b||(b==="tv"||b==="anime")&&(p===null||m===null))return;Z(null),te(!1);let Q=0;if(ss.current)try{const X=await dr(F,b,p,m);X&&X.progress_seconds>30?(Q=X.progress_seconds,S(X.progress_seconds)):S(0)}catch(X){console.error("Error fetching progress for stream URL:",X),S(0)}else S(0);let ae=`${we}/stream-url?type=${b}&id=${F}&source=${w}`;(b==="tv"||b==="anime")&&(ae+=`&season=${p}&episode=${m}`,b==="anime"&&(ae+=`&dub=${M}`)),w==="videasy"&&(Q>30&&(ae+=`&progress=${Math.floor(Q)}`),(b==="tv"||b==="anime")&&(ae+="&nextEpisode=true&episodeSelector=true&autoplayNextEpisode=true"));try{const X=new AbortController,I=setTimeout(()=>X.abort(),2e4),se=await fetch(ae,{signal:X.signal});clearTimeout(I);const ie=await se.json();if(!se.ok)throw new Error(ie.message||`HTTP ${se.status}`);let Ae=ie.url;if(!Ae)throw new Error("The streaming service did not provide a valid URL. This content might not be available.");ie.isDirectSource?(c(Ae),Se(ie.qualities||[]),Ie(!0)):(c(Ae),Ie(!1),Se([])),ie.currentSource&&ie.currentSource!==w&&(D.current=!0,E(ie.currentSource)),ie.availableSources&&P(ie.availableSources),Z(null)}catch(X){let I="Could not load the video stream.",se=!0;X.name==="AbortError"?I="Stream request timed out. Please try again.":X.message.includes("unavailable")?I="All streaming sources are currently unavailable. This is usually temporary.":X.message.includes("503")?I="Streaming service is temporarily down. Please try again in a few minutes.":X.message.includes("404")?I="This content is not available from the current source.":X.message.includes("NetworkError")||X.message.includes("fetch")?I="Network connection issue. Please check your internet and try again.":I="Unable to load video stream. This might be due to leaving and returning to the browser.",Z({message:I,canRetry:se}),c(""),Ie(!1)}})()},[F,b,p,m,w,M]),ee(()=>{if(ke&&e){const k=`${F}-${b}-${p}-${m}`,B=Date.now(),$=window.lastHistoryUpdate||{};(!$[k]||B-$[k]>5e3)&&(console.log("📝 Adding immediate watch history entry:",{mediaId:F,type:b,season:p,episode:m,title:e.title||e.name}),zc({...e,id:e.id,type:b,season:p,episode:m}).then(()=>{console.log("✅ Watch history entry added successfully")}).catch(Q=>{console.error("❌ Failed to add watch history entry:",Q)}),window.lastHistoryUpdate={...$,[k]:B})}},[ke,e,b,p,m,F]),ee(()=>{if(ke&&console.log("🔐 Progress tracking setup:",{hasUser:!0,userId:ke.id,hasMediaDetails:!!e}),!ke||!e){ke&&!e&&console.log("⚠️ Progress tracking disabled - media details not yet available");return}const k=async($,Q)=>{console.log(`📊 Progress update received via ${Q}:`,$);const ae=$.season||p,X=$.episode||m;if($&&$.progress>=0&&$.duration>0){const I=Date.now(),se=`${F}-${b}-${ae}-${X}`,ie=window.lastProgressSave||{};!ie[se]||I-ie[se]>5e3?(console.log(`🎬 Attempting to save progress for ${b} ${F}:`,{progress:$.progress,duration:$.duration,season:ae,episode:X}),await Ys({...e,id:e.id,type:b,season:ae,episode:X},$.progress,$.duration)?(console.log("✅ Progress saved successfully"),window.lastProgressSave={...ie,[se]:I},ae===p&&X===m&&(b==="movie"?Re({progress_seconds:$.progress,duration_seconds:$.duration}):(b==="tv"||b==="anime")&&De(ze=>{const Oe=[...ze],Je=Oe.findIndex(Et=>Et.season_number===ae&&Et.episode_number===X),St={media_id:parseInt(F,10),media_type:b,season_number:ae,episode_number:X,progress_seconds:$.progress,duration_seconds:$.duration};return Je>-1?Oe[Je]={...Oe[Je],...St}:Oe.push(St),Oe}))):console.error("❌ Failed to save progress")):console.log("⏭️ Progress save skipped (too recent):",{timeSinceLastSave:I-ie[se],threshold:5e3}),$.duration-$.progress}else console.log("⚠️ Progress update ignored (insufficient data):",{hasProgressData:!!$,progress:$?.progress,duration:$?.duration,meetsThreshold:$?.progress>=0&&$?.duration>0})};let B;if(oe){const $=xe.current;if(!$)return;const Q=async()=>{const X=await dr(F,b,p,m);X&&X.progress_seconds&&($.currentTime=X.progress_seconds)},ae=async()=>{if($.currentTime>0){const X=Date.now(),I=`${F}-${b}-${p}-${m}`,se=window.lastProgressSave||{};if(!se[I]||X-se[I]>5e3){const ie={progress:Math.round($.currentTime),duration:Math.round($.duration),percentage:$.duration>0?$.currentTime/$.duration*100:0};console.log("🎬 Direct video - saving progress:",ie),await Ys({...e,id:e.id,type:b,season:p,episode:m},ie.progress,ie.duration)?(console.log("✅ Direct video progress saved successfully"),window.lastProgressSave={...se,[I]:X},b==="movie"?Re({progress_seconds:ie.progress,duration_seconds:ie.duration}):(b==="tv"||b==="anime")&&De(ze=>{const Oe=[...ze],Je=Oe.findIndex(Et=>Et.season_number===p&&Et.episode_number===m),St={media_id:parseInt(F,10),media_type:b,season_number:p,episode_number:m,progress_seconds:ie.progress,duration_seconds:ie.duration};return Je>-1?Oe[Je]={...Oe[Je],...St}:Oe.push(St),Oe})):console.error("❌ Failed to save direct video progress")}}};return $.addEventListener("loadedmetadata",Q),$.addEventListener("timeupdate",ae),()=>{$.removeEventListener("loadedmetadata",Q),$.removeEventListener("timeupdate",ae)}}else{B=Q=>{const ae=["player.videasy.net","vidsrc.to","embed.su","vidsrc.xyz","vidsrc.in","vidsrc.pm"],X=new URL(Q.origin);if(ae.includes(X.hostname))try{const I=typeof Q.data=="string"?JSON.parse(Q.data):Q.data;if(I&&I.type==="PROGRESS_UPDATE"&&I.data){const se={progress:I.data.progress?.watched,duration:I.data.progress?.duration,season:I.data.season||p,episode:I.data.episode||m};k(se,"PROGRESS_UPDATE");return}if(I.type==="MEDIA_DATA"&&I.data){console.warn("Legacy 'MEDIA_DATA' format detected. Player should be updated.");let se=I.data;if(typeof se=="string")try{se=JSON.parse(se)}catch(ze){console.error("Error parsing double-encoded MEDIA_DATA string:",ze);return}const ie=`${b}-${F}`,Ae=se[ie];if(Ae&&Ae.progress){const ze={progress:Ae.progress.watched,duration:Ae.progress.duration,season:Ae.last_season_watched,episode:Ae.last_episode_watched};k(ze,"MEDIA_DATA")}return}if(I.type==="PLAYER_EVENT"&&I.data)if(I.data.event==="timeupdate"){const se={progress:I.data.time,duration:I.data.duration};se.progress&&se.duration&&k(se,"PLAYER_EVENT")}else I.data.event==="ended"&&(b==="tv"||b==="anime")?console.log('Player reported "ended" event - Videasy will handle next episode automatically.'):I.data.event==="player_ready"&&(console.log("Player is ready."),y(!0))}catch(I){console.error("Error processing message from player:",{origin:Q.origin,data:Q.data,error:I.message})}},window.addEventListener("message",B);const $=setTimeout(()=>{L||(console.log("Player ready timeout, starting fallback progress tracking."),ia())},5e3);return()=>{window.removeEventListener("message",B),clearTimeout($)}}},[ke,e,oe,xe,p,m,L]);const ia=()=>{const k=setInterval(()=>{document.hasFocus()&&console.log("Fallback: Checking for progress...")},15e3);return()=>clearInterval(k)};if(u)return l("div",{class:"loading-state",children:[l("div",{class:"loading-spinner"}),l("p",{children:"Loading media details..."})]});if(!e)return l("div",{class:"container",children:l("div",{class:"error-state",children:[l("h2",{children:"Unable to Load Media"}),l("p",{children:"We couldn't load the details for this content. This could be due to:"}),l("ul",{children:[l("li",{children:"Network connectivity issues"}),l("li",{children:"The content may no longer be available"}),l("li",{children:"Server maintenance"})]}),l("button",{onClick:()=>window.location.reload(),class:"btn btn-primary",style:{marginTop:"20px"},children:"Try Again"})]})});const{title:er,name:tr,overview:oa,vote_average:Ju,release_date:is,first_air_date:os,runtime:as,number_of_seasons:ls,genres:cs,poster_path:us}=e,rr=(b==="tv"||b==="anime")&&p&&m,nr=rr?ts(e.id,b,p,m):ts(e.id,b),ds=is||os?new Date(is||os).getFullYear():"",aa=()=>{if(!ke){window.confirm("You need to log in to save favorites. Would you like to go to the login page?")&&$e("/login");return}if(nr)rr?es(e.id,p,m):es(e.id);else if(rr){const k=j?.episodes?.find(B=>B.episode_number===m);Zn({...e,type:b,season_number:p,episode_number:m,episode_name:k?.name||`Episode ${m}`})}else Zn({...e,type:b})};return l("div",{children:[l(Jt,{children:l("title",{children:[er||tr," - FreeStream"]})}),l("div",{class:"player-container",children:[!a&&H&&l("div",{class:"stream-error-message",children:[l("p",{children:H.message}),H.canRetry&&l("div",{class:"error-actions",children:[l("button",{onClick:async()=>{te(!0),setTimeout(()=>{(async()=>{const B=`${we}/stream-url?type=${b}&id=${F}&source=${w}${b==="tv"||b==="anime"?`&season=${p}&episode=${m}`:""}${b==="anime"?`&dub=${M}`:""}`;try{const $=await fetch(B),Q=await $.json();if($.ok)c(Q.url),Ie(Q.isDirectSource),Se(Q.qualities||[]),Z(null);else throw new Error(Q.message)}catch($){console.error("Retry failed:",$),Z({message:"Retry failed. Please try selecting a different source.",canRetry:!0})}te(!1)})()},1e3)},disabled:le,class:"btn retry-btn",children:le?"Retrying...":"Retry"}),l("p",{children:"Or try selecting a different source from the list below."})]})]}),!a&&!H&&l("div",{class:"stream-loading",children:l("p",{children:"Loading video stream..."})}),oe?l("video",{ref:xe,src:a,controls:!0,autoPlay:!0,width:"100%"}):a&&l("iframe",{src:a,width:"100%",height:"100%",style:{position:"absolute",top:0,left:0,width:"100%",height:"100%"},frameBorder:"0",allowFullScreen:!0,allow:"autoplay; picture-in-picture",sandbox:"allow-forms allow-pointer-lock allow-same-origin allow-scripts allow-top-navigation",title:"Video Player",loading:"eager",referrerPolicy:"no-referrer-when-downgrade",importance:"high",onLoad:()=>{console.log("🎬 Player iframe loaded"),y(!0),w!=="videasy"&&A>30?setTimeout(()=>{const k=document.querySelector("iframe");if(k&&k.contentWindow)try{k.contentWindow.postMessage({type:"SEEK_TO",time:A},"*"),console.log(`📍 Sent seek command to restore progress: ${A}s`)}catch(B){console.log("Could not send seek command:",B)}},500):console.log(w==="videasy"?"📍 Videasy native resume - no seeking needed":"📍 No significant progress to resume, starting from beginning")}})]}),l("div",{class:"container",children:[l("div",{class:"media-details-layout",children:[l("div",{class:"poster",children:[l("img",{src:Un(us?`${Nn}${us}`:"https://via.placeholder.com/500x750.png?text=No+Image"),alt:er||tr}),ns>0&&l("div",{class:"movie-progress-container",children:[l("div",{class:"movie-progress-bar",children:l("div",{class:"movie-progress",style:{width:`${Math.max(2,ns)}%`}})}),l("div",{class:"movie-progress-text",children:he.duration_seconds>0?`${Math.floor(he.progress_seconds/60)}m / ${Math.floor(he.duration_seconds/60)}m watched`:`${Math.floor(he.progress_seconds/60)}m watched`})]})]}),l("div",{class:"details",children:[l("div",{class:"title-container",children:[l("h1",{children:er||tr}),l("button",{onClick:aa,class:`favorite-btn ${nr?"favorited":""}`,disabled:!rs,children:rs?nr?"♥ Favorited":"♡ Favorite":"..."}),!ke&&l("span",{class:"login-hint",children:l("small",{children:[l("a",{href:"/login",style:{color:"#007bff",textDecoration:"none"},children:"Log in"})," to save favorites, track progress & continue watching"]})})]}),l("div",{class:"meta",children:[l("span",{class:"rating",children:["★ ",e.vote_average?e.vote_average.toFixed(1):"N/A"]}),ds&&l("span",{children:ds}),as&&l("span",{children:[as," min"]}),ls&&l("span",{children:[ls," Seasons"]})]}),l("div",{class:"genres",children:cs&&cs.map(k=>l("span",{class:"genre-tag",children:k.name}))}),l("p",{class:"overview",children:oa}),ve.length>0&&l("div",{class:"quality-selector",children:[l("label",{children:"Quality:"}),ve.map(k=>l("button",{class:`quality-btn ${a===k.url?"active":""}`,onClick:()=>c(k.url),children:[k.quality,"p"]}))]})]})]}),b==="anime"&&l("div",{class:"select-container",children:[l("label",{for:"dub-select",children:"Audio:"}),l("select",{id:"dub-select",value:M,onChange:k=>K(k.target.value==="true"),children:[l("option",{value:"false",children:"Subbed"}),l("option",{value:"true",children:"Dubbed"})]})]}),l("div",{class:"selectors-container",children:[(b==="tv"||b==="anime")&&e&&e.seasons&&l("div",{class:"select-container",children:[l("label",{children:"Season:"}),l("div",{class:"selector-buttons",children:e.seasons.filter(k=>k.season_number>0).map(k=>l("button",{class:`selector-btn ${p===k.season_number?"active":""}`,onClick:()=>{console.log(`🎯 User manually selected season ${k.season_number}`),W.current=!0,ce.current=null;const B=`/watch/${b}/${F}/season/${k.season_number}/episode/1`;$e(B,!0)},children:k.name},k.id))})]}),_.length>1&&l("div",{class:"select-container",children:[l("label",{children:"Source:"}),l("div",{class:"selector-buttons",children:_.map(k=>l("button",{class:`selector-btn ${w===k?"active":""}`,onClick:()=>E(k),children:k},k))})]})]}),(b==="tv"||b==="anime")&&p!==null&&m!==null&&l("div",{class:"episodes-container",children:[l("h3",{children:"Episodes"}),q?l("div",{class:"loading-spinner"}):l(ft,{children:[l("div",{class:"episode-list",children:j?.episodes?.slice((R-1)*C,R*C)?.map(k=>{const B=bt.find(Q=>Q.season_number===p&&Q.episode_number===k.episode_number),$=B&&B.progress_seconds>0?B.duration_seconds&&B.duration_seconds>0?Math.min(100,B.progress_seconds/B.duration_seconds*100):B.progress_seconds>30?5:2:0;return l("div",{class:`episode-card ${k.episode_number===m?"active":""}`,onClick:()=>{console.log(`🎯 User manually selected episode ${k.episode_number}`),W.current=!0,ce.current=null;const Q=`/watch/${b}/${F}/season/${p}/episode/${k.episode_number}`;$e(Q,!0)},children:[l("div",{class:"episode-card-image",children:[l("img",{src:Un(k.still_path?`${Nn}${k.still_path}`:`https://via.placeholder.com/300x169.png?text=${encodeURIComponent(k.name)}`),alt:k.name}),l("div",{class:"episode-number-badge",children:k.episode_number}),$>0&&l("div",{class:"episode-progress-bar",children:l("div",{class:"episode-progress",style:{width:`${Math.max(2,$)}%`}})})]}),l("div",{class:"episode-card-content",children:[l("h4",{children:k.name}),l("p",{class:"episode-overview",children:k.overview})]})]},k.id)})}),j?.episodes&&j.episodes.length>C&&l("div",{class:"pagination-controls",children:[l("button",{class:"pagination-btn",onClick:()=>x(k=>Math.max(1,k-1)),disabled:R===1,children:"← Previous"}),l("div",{class:"pagination-info",children:[l("span",{class:"page-numbers",children:Array.from({length:Math.ceil(j.episodes.length/C)},(k,B)=>B+1).map(k=>l("button",{class:`page-number ${k===R?"active":""}`,onClick:()=>x(k),children:k},k))}),l("span",{class:"page-text",children:["Page ",R," of ",Math.ceil(j.episodes.length/C),"(",j.episodes.length," episodes)"]})]}),l("button",{class:"pagination-btn",onClick:()=>x(k=>Math.min(Math.ceil(j.episodes.length/C),k+1)),disabled:R===Math.ceil(j.episodes.length/C),children:"Next →"})]})]})]}),i.length>0&&l("div",{class:"recommendations",children:[l("h2",{children:"More Like This"}),l("div",{class:"movie-grid",children:i.map(k=>l(mt,{item:k,type:b,progress:null,duration:null},`${k.media_type||b}-${k.id}`))})]})]})]})},Bu=n=>{const[e,t]=N([]),[r,s]=N(!1),[i,o]=N("");ee(()=>{const u=new URLSearchParams(n.url?.split("?")[1]||"").get("q");o(u||""),u?a(u):t([])},[n.url]);const a=async c=>{s(!0);try{const h=await(await fetch(`${we}/tmdb/search/multi?query=${encodeURIComponent(c)}`)).json();if(h&&h.results){const d=h.results.filter(f=>(f.media_type==="movie"||f.media_type==="tv")&&f.poster_path);t(d)}}catch(u){console.error("Error performing search:",u),t([])}finally{s(!1)}};return l("div",{class:"container home-page",children:[l("div",{class:"search-header",children:[l("h1",{class:"main-title",children:"Search Results"}),l("div",{class:"search-query-display",children:[l("span",{class:"search-label",children:"Showing results for:"}),l("span",{class:"search-query",children:['"',i,'"']})]})]}),r?l(Mo,{text:"Searching for movies and TV shows..."}):e.length>0?l("section",{class:"home-section",children:[l("h2",{children:["Found ",e.length," result",e.length!==1?"s":""]}),l("div",{class:"movie-grid",children:e.map(c=>l(mt,{item:c,type:c.media_type,progress:null,duration:null},`${c.media_type}-${c.id}`))})]}):i?l("div",{class:"no-results",children:[l("div",{class:"no-results-icon",children:"🔍"}),l("h3",{children:"No results found"}),l("p",{children:[`We couldn't find anything for "`,i,'". Try searching with different keywords.']}),l("div",{class:"search-suggestions",children:[l("p",{children:"Try searching for:"}),l("ul",{children:[l("li",{children:"Movie or TV show titles"}),l("li",{children:"Actor or director names"}),l("li",{children:'Genre names (e.g., "action", "comedy")'}),l("li",{children:"Keywords from the plot"})]})]})]}):l("div",{class:"search-welcome",children:[l("div",{class:"search-welcome-icon",children:"🎬"}),l("h3",{children:"Start your search"}),l("p",{children:"Use the search bar above to find your favorite movies and TV shows."})]})]})};function bn(){const[n,e]=N(!1),[t,r]=N(""),[s,i]=N(""),[o,a]=N(!1),[c,u]=N({}),h=async p=>{try{const{error:g}=await V.auth.signInWithOAuth({provider:p});if(g)throw g}catch(g){Fe.error(g.error_description||g.message)}},d=()=>{const p={};return t?/\S+@\S+\.\S+/.test(t)||(p.email="Please enter a valid email"):p.email="Email is required",s?s.length<6&&(p.password="Password must be at least 6 characters"):p.password="Password is required",u(p),Object.keys(p).length===0},f=async p=>{if(p.preventDefault(),!!d())try{e(!0),u({});const{error:g}=await V.auth.signInWithPassword({email:t.trim(),password:s});if(g)throw g;Fe.success("Logged in successfully!"),$e("/",!0)}catch(g){console.error("Login error:",g),g.message.includes("Invalid login credentials")?u({general:"Invalid email or password"}):g.message.includes("Email not confirmed")?u({general:"Please check your email and confirm your account"}):u({general:g.error_description||g.message})}finally{e(!1)}};return l("div",{className:"auth-container",children:l("div",{className:"auth-form",children:[l("h1",{className:"header",children:"Login"}),l("p",{className:"description",children:"Sign in to your account."}),c.general&&l("div",{className:"error-message",children:c.general}),l("form",{onSubmit:f,noValidate:!0,children:[l("div",{className:"input-group",children:[l("label",{htmlFor:"email",children:"Email"}),l("input",{id:"email",className:`input-field ${c.email?"error":""}`,type:"email",placeholder:"Your email",value:t,onChange:p=>{r(p.target.value),c.email&&u({...c,email:null})},required:!0,"aria-describedby":c.email?"email-error":void 0,"aria-invalid":!!c.email}),c.email&&l("span",{id:"email-error",className:"field-error",role:"alert",children:c.email})]}),l("div",{className:"input-group",children:[l("label",{htmlFor:"password",children:"Password"}),l("div",{className:"password-input-container",children:[l("input",{id:"password",className:`input-field ${c.password?"error":""}`,type:o?"text":"password",placeholder:"Your password",value:s,onChange:p=>{i(p.target.value),c.password&&u({...c,password:null})},required:!0,"aria-describedby":c.password?"password-error":void 0,"aria-invalid":!!c.password}),l("button",{type:"button",className:"password-toggle",onClick:()=>a(!o),"aria-label":o?"Hide password":"Show password",children:o?"Hide":"Show"})]}),c.password&&l("span",{id:"password-error",className:"field-error",role:"alert",children:c.password})]}),l("div",{className:"auth-options",children:l("a",{href:"/forgot-password",className:"auth-link",children:"Forgot password?"})}),l("div",{children:l("button",{className:"button",disabled:n,children:n?l("span",{children:"Signing in..."}):l("span",{children:"Login"})})})]}),l("div",{className:"auth-divider",children:l("span",{children:"OR"})}),l("div",{className:"social-login-group",children:l("button",{type:"button",className:"social-button google",onClick:()=>h("google"),children:"Sign in with Google"})}),l("div",{className:"auth-links",children:l("p",{children:["Don't have an account?",l("a",{href:"/signup",className:"auth-link",children:" Sign up"})]})})]})})}function Wu(){const[n,e]=N(!1),[t,r]=N(""),[s,i]=N(""),o=async c=>{try{const{error:u}=await V.auth.signInWithOAuth({provider:c});if(u)throw u}catch(u){Fe.error(u.error_description||u.message)}};return l("div",{className:"auth-container",children:l("div",{className:"auth-form",children:[l("h1",{className:"header",children:"Create an account"}),l("p",{className:"description",children:"Sign up for a new account."}),l("form",{onSubmit:async c=>{c.preventDefault();try{e(!0);const{error:u}=await V.auth.signUp({email:t,password:s});if(u)throw u;Fe.success("Check your email for the confirmation link!")}catch(u){Fe.error(u.error_description||u.message)}finally{e(!1)}},children:[l("div",{className:"input-group",children:[l("label",{htmlFor:"email",children:"Email"}),l("input",{id:"email",className:"input-field",type:"email",placeholder:"Your email",value:t,onChange:c=>r(c.target.value)})]}),l("div",{className:"input-group",children:[l("label",{htmlFor:"password",children:"Password"}),l("input",{id:"password",className:"input-field",type:"password",placeholder:"Your password",value:s,onChange:c=>i(c.target.value)})]}),l("div",{children:l("button",{className:"button",disabled:n,children:n?l("span",{children:"Loading..."}):l("span",{children:"Sign Up"})})})]}),l("div",{className:"auth-divider",children:l("span",{children:"OR"})}),l("div",{className:"social-login-group",children:l("button",{type:"button",className:"social-button google",onClick:()=>o("google"),children:"Sign up with Google"})}),l("div",{className:"auth-links",children:l("p",{children:["Already have an account?",l("a",{href:"/login",className:"auth-link",children:" Log in"})]})})]})})}function Hu(){const[n,e]=N(!1),[t,r]=N("");return l("div",{className:"auth-container",children:l("div",{className:"auth-form",children:[l("h1",{className:"header",children:"Forgot Password"}),l("p",{className:"description",children:"Enter your email and we'll send you a link to reset your password."}),l("form",{onSubmit:async i=>{i.preventDefault();try{e(!0);const{error:o}=await V.auth.resetPasswordForEmail(t,{redirectTo:`${window.location.origin}/update-password`});if(o)throw o;Fe.success("Password reset link sent! Please check your email.")}catch(o){Fe.error(o.error_description||o.message)}finally{e(!1)}},children:[l("div",{className:"input-group",children:[l("label",{htmlFor:"email",children:"Email"}),l("input",{id:"email",className:"input-field",type:"email",placeholder:"Your email",value:t,onChange:i=>r(i.target.value),required:!0})]}),l("div",{children:l("button",{className:"button",disabled:n,children:n?l("span",{children:"Sending..."}):l("span",{children:"Send Reset Link"})})})]}),l("div",{className:"auth-links",children:l("a",{href:"/login",className:"auth-link",children:["Remembered your password? ",l("span",{children:"Log in"})]})})]})})}function Gu(){const[n,e]=N(!1),[t,r]=N(""),[s,i]=N(""),[o,a]=N(""),[c,u]=N(null);return ee(()=>{V.auth.getSession().then(({data:{session:f}})=>{f?u(f):(Fe.error("You must be logged in to update your password."),$e("/login",!0))});const{data:{subscription:d}}=V.auth.onAuthStateChange((f,p)=>{u(p)});return()=>d.unsubscribe()},[]),l("div",{className:"auth-container",children:l("div",{className:"auth-form",children:[l("h1",{className:"header",children:"Update Password"}),l("p",{className:"description",children:"Enter a new password for your account."}),o&&l("div",{className:"error-message",children:o}),l("form",{onSubmit:async d=>{if(d.preventDefault(),a(""),t!==s){a("Passwords do not match.");return}if(t.length<6){a("Password must be at least 6 characters long.");return}try{e(!0);const{error:f}=await V.auth.updateUser({password:t});if(f)throw f;Fe.success("Password updated successfully!"),$e("/",!0)}catch(f){a(f.error_description||f.message)}finally{e(!1)}},children:[l("div",{className:"input-group",children:[l("label",{htmlFor:"password",children:"New Password"}),l("input",{id:"password",className:"input-field",type:"password",placeholder:"Your new password",value:t,onChange:d=>r(d.target.value),required:!0})]}),l("div",{className:"input-group",children:[l("label",{htmlFor:"confirm-password",children:"Confirm New Password"}),l("input",{id:"confirm-password",className:"input-field",type:"password",placeholder:"Confirm your new password",value:s,onChange:d=>i(d.target.value),required:!0})]}),l("div",{children:l("button",{className:"button",disabled:n,children:n?l("span",{children:"Updating..."}):l("span",{children:"Update Password"})})})]})]})})}const Ku=()=>{const[n,e]=N(!1);return ee(()=>{const r=()=>{window.pageYOffset>300?e(!0):e(!1)};return window.addEventListener("scroll",r),()=>window.removeEventListener("scroll",r)},[]),l("button",{class:`scroll-to-top ${n?"visible":""}`,onClick:()=>{window.scrollTo({top:0,behavior:"smooth"})},"aria-label":"Scroll to top",children:l("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:l("path",{d:"M18 15l-6-6-6 6"})})})},Vu=()=>{const{user:n}=Ve(),e=Me(i=>i.fetchFavorites),t=Me(i=>i.favoritesFetched),r=Me(i=>i.fetchContinueWatching),s=Me(i=>i.continueWatchingFetched);return ee(()=>{n&&(t||e(),s||r())},[n,t,e,s,r]),l("div",{class:"app",children:[l(xc,{position:"top-center"}),l(eu,{}),l("main",{children:l(po,{history:Pa(),children:[l(hr,{path:"/"}),l(hr,{path:"/movies"}),l(hr,{path:"/tv"}),n?l(Mu,{path:"/favorites"}):l(bn,{path:"/favorites"}),n?l(Fu,{path:"/history"}):l(bn,{path:"/history"}),l(ao,{path:"/watch/:type/:id"}),l(ao,{path:"/watch/:type/:id/season/:season/episode/:episode"}),l(Bu,{path:"/search"}),l(bn,{path:"/login"}),l(Wu,{path:"/signup"}),l(Hu,{path:"/forgot-password"}),l(Gu,{path:"/update-password"})]})}),l(ru,{}),l(Ku,{})]})},zu=()=>(ee(()=>{Uc()},[]),l(Cc,{children:l(Vu,{})}));fa(l(zu,{}),document.getElementById("app"));
//# sourceMappingURL=index-CI1ssP7r.js.map
