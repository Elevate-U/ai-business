import{l as us,K as oo,H as ds,J as ua,_ as Dn,x as da,a as ao,d as N,y as ee,R as hs,A as ge,k as gt,p as ha,q as lo,T as fa,E as pa}from"./react-vendor-BYlzYzcd.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();var ga=0;function l(n,e,t,r,s,i){e||(e={});var o,a,c=e;if("ref"in c)for(a in c={},e)a=="ref"?o=e[a]:c[a]=e[a];var u={type:n,props:c,key:t,ref:o,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:--ga,__i:-1,__u:0,__source:s,__self:i};if(typeof n=="function"&&(o=n.defaultProps))for(a in o)c[a]===void 0&&(c[a]=o[a]);return us.vnode&&us.vnode(u),u}var va={};function $t(n,e){for(var t in e)n[t]=e[t];return n}function En(n,e,t){var r,s=/(?:\?([^#]*))?(#.*)?$/,i=n.match(s),o={};if(i&&i[1])for(var a=i[1].split("&"),c=0;c<a.length;c++){var u=a[c].split("=");o[decodeURIComponent(u[0])]=decodeURIComponent(u.slice(1).join("="))}n=Tn(n.replace(s,"")),e=Tn(e||"");for(var h=Math.max(n.length,e.length),d=0;d<h;d++)if(e[d]&&e[d].charAt(0)===":"){var f=e[d].replace(/(^:|[+*?]+$)/g,""),p=(e[d].match(/[+*?]+$/)||va)[0]||"",v=~p.indexOf("+"),m=~p.indexOf("*"),g=n[d]||"";if(!g&&!m&&(p.indexOf("?")<0||v)){r=!1;break}if(o[f]=decodeURIComponent(g),v||m){o[f]=n.slice(d).map(decodeURIComponent).join("/");break}}else if(e[d]!==n[d]){r=!1;break}return(t.default===!0||r!==!1)&&o}function ma(n,e){return n.rank<e.rank?1:n.rank>e.rank?-1:n.index-e.index}function ya(n,e){return n.index=e,n.rank=function(t){return t.props.default?0:Tn(t.props.path).map(_a).join("")}(n),n.props}function Tn(n){return n.replace(/(^\/+|\/+$)/g,"").split("/")}function _a(n){return n.charAt(0)==":"?1+"*+?".indexOf(n.charAt(n.length-1))||4:5}var wa={},rt=[],Ot=[],Pe=null,Mn={url:qn()},co=oo(Mn);function ba(){var n=ao(co);if(n===Mn){var e=N()[1];ee(function(){return Ot.push(e),function(){return Ot.splice(Ot.indexOf(e),1)}},[])}return[n,Ae]}function qn(){var n;return""+((n=Pe&&Pe.location?Pe.location:Pe&&Pe.getCurrentLocation?Pe.getCurrentLocation():typeof location<"u"?location:wa).pathname||"")+(n.search||"")}function Ae(n,e){return e===void 0&&(e=!1),typeof n!="string"&&n.url&&(e=n.replace,n=n.url),function(t){for(var r=rt.length;r--;)if(rt[r].canRoute(t))return!0;return!1}(n)&&function(t,r){r===void 0&&(r="push"),Pe&&Pe[r]?Pe[r](t):typeof history<"u"&&history[r+"State"]&&history[r+"State"](null,null,t)}(n,e?"replace":"push"),uo(n)}function uo(n){for(var e=!1,t=0;t<rt.length;t++)rt[t].routeTo(n)&&(e=!0);return e}function Sa(n){if(n&&n.getAttribute){var e=n.getAttribute("href"),t=n.getAttribute("target");if(e&&e.match(/^\//g)&&(!t||t.match(/^_?self$/i)))return Ae(e)}}function Ea(n){return n.stopImmediatePropagation&&n.stopImmediatePropagation(),n.stopPropagation&&n.stopPropagation(),n.preventDefault(),!1}function ho(n){if(!(n.ctrlKey||n.metaKey||n.altKey||n.shiftKey||n.button)){var e=n.target;do if(e.localName==="a"&&e.getAttribute("href")){if(e.hasAttribute("data-native")||e.hasAttribute("native"))return;if(Sa(e))return Ea(n)}while(e=e.parentNode)}}var fs=!1;function fo(n){n.history&&(Pe=n.history),this.state={url:n.url||qn()}}$t(fo.prototype=new da,{shouldComponentUpdate:function(n){return n.static!==!0||n.url!==this.props.url||n.onChange!==this.props.onChange},canRoute:function(n){var e=ds(this.props.children);return this.g(e,n)!==void 0},routeTo:function(n){this.setState({url:n});var e=this.canRoute(n);return this.p||this.forceUpdate(),e},componentWillMount:function(){this.p=!0},componentDidMount:function(){var n=this;fs||(fs=!0,Pe||addEventListener("popstate",function(){uo(qn())}),addEventListener("click",ho)),rt.push(this),Pe&&(this.u=Pe.listen(function(e){var t=e.location||e;n.routeTo(""+(t.pathname||"")+(t.search||""))})),this.p=!1},componentWillUnmount:function(){typeof this.u=="function"&&this.u(),rt.splice(rt.indexOf(this),1)},componentWillUpdate:function(){this.p=!0},componentDidUpdate:function(){this.p=!1},g:function(n,e){n=n.filter(ya).sort(ma);for(var t=0;t<n.length;t++){var r=n[t],s=En(e,r.props.path,r.props);if(s)return[r,s]}},render:function(n,e){var t,r,s=n.onChange,i=e.url,o=this.c,a=this.g(ds(n.children),i);if(a&&(r=ua(a[0],$t($t({url:i,matches:t=a[1]},t),{key:void 0,ref:void 0}))),i!==(o&&o.url)){$t(Mn,o=this.c={url:i,previous:o&&o.url,current:r,path:r?r.props.path:null,matches:t}),o.router=this,o.active=r?[r]:[];for(var c=Ot.length;c--;)Ot[c]({});typeof s=="function"&&s(o)}return Dn(co.Provider,{value:o},r)}});var Ne=function(n){return Dn("a",$t({onClick:ho},n))};function zt(){return zt=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},zt.apply(null,arguments)}var vt;(function(n){n.Pop="POP",n.Push="PUSH",n.Replace="REPLACE"})(vt||(vt={}));var ps=function(n){return n},gs="beforeunload",Ta="hashchange",Pa="popstate";function ka(n){n===void 0&&(n={});var e=n,t=e.window,r=t===void 0?document.defaultView:t,s=r.history;function i(){var T=ys(r.location.hash.substr(1)),B=T.pathname,G=B===void 0?"/":B,W=T.search,Z=W===void 0?"":W,ae=T.hash,se=ae===void 0?"":ae,ce=s.state||{};return[ce.idx,ps({pathname:G,search:Z,hash:se,state:ce.usr||null,key:ce.key||"default"})]}var o=null;function a(){if(o)p.call(o),o=null;else{var T=vt.Pop,B=i(),G=B[0],W=B[1];if(p.length){if(G!=null){var Z=h-G;Z&&(o={action:T,location:W,retry:function(){L(Z*-1)}},L(Z))}}else _(T)}}r.addEventListener(Pa,a),r.addEventListener(Ta,function(){var T=i(),B=T[1];ir(B)!==ir(d)&&a()});var c=vt.Pop,u=i(),h=u[0],d=u[1],f=ms(),p=ms();h==null&&(h=0,s.replaceState(zt({},s.state,{idx:h}),""));function v(){var T=document.querySelector("base"),B="";if(T&&T.getAttribute("href")){var G=r.location.href,W=G.indexOf("#");B=W===-1?G:G.slice(0,W)}return B}function m(T){return v()+"#"+(typeof T=="string"?T:ir(T))}function g(T,B){return B===void 0&&(B=null),ps(zt({pathname:d.pathname,hash:"",search:""},typeof T=="string"?ys(T):T,{state:B,key:Aa()}))}function w(T,B){return[{usr:T.state,key:T.key,idx:B},m(T)]}function b(T,B,G){return!p.length||(p.call({action:T,location:B,retry:G}),!1)}function _(T){c=T;var B=i();h=B[0],d=B[1],f.call({action:c,location:d})}function P(T,B){var G=vt.Push,W=g(T,B);function Z(){P(T,B)}if(b(G,W,Z)){var ae=w(W,h+1),se=ae[0],ce=ae[1];try{s.pushState(se,"",ce)}catch{r.location.assign(ce)}_(G)}}function C(T,B){var G=vt.Replace,W=g(T,B);function Z(){C(T,B)}if(b(G,W,Z)){var ae=w(W,h),se=ae[0],ce=ae[1];s.replaceState(se,"",ce),_(G)}}function L(T){s.go(T)}var q={get action(){return c},get location(){return d},createHref:m,push:P,replace:C,go:L,back:function(){L(-1)},forward:function(){L(1)},listen:function(B){return f.push(B)},block:function(B){var G=p.push(B);return p.length===1&&r.addEventListener(gs,vs),function(){G(),p.length||r.removeEventListener(gs,vs)}}};return q}function vs(n){n.preventDefault(),n.returnValue=""}function ms(){var n=[];return{get length(){return n.length},push:function(t){return n.push(t),function(){n=n.filter(function(r){return r!==t})}},call:function(t){n.forEach(function(r){return r&&r(t)})}}}function Aa(){return Math.random().toString(36).substr(2,8)}function ir(n){var e=n.pathname,t=e===void 0?"/":e,r=n.search,s=r===void 0?"":r,i=n.hash,o=i===void 0?"":i;return s&&s!=="?"&&(t+=s.charAt(0)==="?"?s:"?"+s),o&&o!=="#"&&(t+=o.charAt(0)==="#"?o:"#"+o),t}function ys(n){var e={};if(n){var t=n.indexOf("#");t>=0&&(e.hash=n.substr(t),n=n.substr(0,t));var r=n.indexOf("?");r>=0&&(e.search=n.substr(r),n=n.substr(0,r)),n&&(e.pathname=n)}return e}const $a="modulepreload",Ra=function(n){return"/"+n},_s={},Lt=function(e,t,r){let s=Promise.resolve();if(t&&t.length>0){let c=function(u){return Promise.all(u.map(h=>Promise.resolve(h).then(d=>({status:"fulfilled",value:d}),d=>({status:"rejected",reason:d}))))};document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),a=o?.nonce||o?.getAttribute("nonce");s=c(t.map(u=>{if(u=Ra(u),u in _s)return;_s[u]=!0;const h=u.endsWith(".css"),d=h?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${u}"]${d}`))return;const f=document.createElement("link");if(f.rel=h?"stylesheet":$a,h||(f.as="script"),f.crossOrigin="",f.href=u,a&&f.setAttribute("nonce",a),document.head.appendChild(f),h)return new Promise((p,v)=>{f.addEventListener("load",p),f.addEventListener("error",()=>v(new Error(`Unable to preload CSS for ${u}`)))})}))}function i(o){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=o,window.dispatchEvent(a),!a.defaultPrevented)throw o}return s.then(o=>{for(const a of o||[])a.status==="rejected"&&i(a.reason);return e().catch(i)})},Oa=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>Lt(async()=>{const{default:r}=await Promise.resolve().then(()=>wt);return{default:r}},void 0).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)};class Fn extends Error{constructor(e,t="FunctionsError",r){super(e),this.name=t,this.context=r}}class Ca extends Fn{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class ws extends Fn{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class bs extends Fn{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var Pn;(function(n){n.Any="any",n.ApNortheast1="ap-northeast-1",n.ApNortheast2="ap-northeast-2",n.ApSouth1="ap-south-1",n.ApSoutheast1="ap-southeast-1",n.ApSoutheast2="ap-southeast-2",n.CaCentral1="ca-central-1",n.EuCentral1="eu-central-1",n.EuWest1="eu-west-1",n.EuWest2="eu-west-2",n.EuWest3="eu-west-3",n.SaEast1="sa-east-1",n.UsEast1="us-east-1",n.UsWest1="us-west-1",n.UsWest2="us-west-2"})(Pn||(Pn={}));var ja=function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(h){try{u(r.next(h))}catch(d){o(d)}}function c(h){try{u(r.throw(h))}catch(d){o(d)}}function u(h){h.done?i(h.value):s(h.value).then(a,c)}u((r=r.apply(n,e||[])).next())})};class Ia{constructor(e,{headers:t={},customFetch:r,region:s=Pn.Any}={}){this.url=e,this.headers=t,this.region=s,this.fetch=Oa(r)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var r;return ja(this,void 0,void 0,function*(){try{const{headers:s,method:i,body:o}=t;let a={},{region:c}=t;c||(c=this.region);const u=new URL(`${this.url}/${e}`);c&&c!=="any"&&(a["x-region"]=c,u.searchParams.set("forceFunctionRegion",c));let h;o&&(s&&!Object.prototype.hasOwnProperty.call(s,"Content-Type")||!s)&&(typeof Blob<"u"&&o instanceof Blob||o instanceof ArrayBuffer?(a["Content-Type"]="application/octet-stream",h=o):typeof o=="string"?(a["Content-Type"]="text/plain",h=o):typeof FormData<"u"&&o instanceof FormData?h=o:(a["Content-Type"]="application/json",h=JSON.stringify(o)));const d=yield this.fetch(u.toString(),{method:i||"POST",headers:Object.assign(Object.assign(Object.assign({},a),this.headers),s),body:h}).catch(m=>{throw new Ca(m)}),f=d.headers.get("x-relay-error");if(f&&f==="true")throw new ws(d);if(!d.ok)throw new bs(d);let p=((r=d.headers.get("Content-Type"))!==null&&r!==void 0?r:"text/plain").split(";")[0].trim(),v;return p==="application/json"?v=yield d.json():p==="application/octet-stream"?v=yield d.blob():p==="text/event-stream"?v=d:p==="multipart/form-data"?v=yield d.formData():v=yield d.text(),{data:v,error:null,response:d}}catch(s){return{data:null,error:s,response:s instanceof bs||s instanceof ws?s.context:void 0}}})}}function po(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function go(n){if(Object.prototype.hasOwnProperty.call(n,"__esModule"))return n;var e=n.default;if(typeof e=="function"){var t=function r(){var s=!1;try{s=this instanceof r}catch{}return s?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(r){var s=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(t,r,s.get?s:{enumerable:!0,get:function(){return n[r]}})}),t}var he={},st={},it={},ot={},at={},lt={},xa=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},mt=xa();const Na=mt.fetch,vo=mt.fetch.bind(mt),mo=mt.Headers,La=mt.Request,Ua=mt.Response,wt=Object.freeze(Object.defineProperty({__proto__:null,Headers:mo,Request:La,Response:Ua,default:vo,fetch:Na},Symbol.toStringTag,{value:"Module"})),Da=go(wt);var qt={},Ss;function yo(){if(Ss)return qt;Ss=1,Object.defineProperty(qt,"__esModule",{value:!0});class n extends Error{constructor(t){super(t.message),this.name="PostgrestError",this.details=t.details,this.hint=t.hint,this.code=t.code}}return qt.default=n,qt}var Es;function _o(){if(Es)return lt;Es=1;var n=lt&&lt.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(lt,"__esModule",{value:!0});const e=n(Da),t=n(yo());class r{constructor(i){this.shouldThrowOnError=!1,this.method=i.method,this.url=i.url,this.headers=i.headers,this.schema=i.schema,this.body=i.body,this.shouldThrowOnError=i.shouldThrowOnError,this.signal=i.signal,this.isMaybeSingle=i.isMaybeSingle,i.fetch?this.fetch=i.fetch:typeof fetch>"u"?this.fetch=e.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(i,o){return this.headers=Object.assign({},this.headers),this.headers[i]=o,this}then(i,o){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");const a=this.fetch;let c=a(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async u=>{var h,d,f;let p=null,v=null,m=null,g=u.status,w=u.statusText;if(u.ok){if(this.method!=="HEAD"){const C=await u.text();C===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?v=C:v=JSON.parse(C))}const _=(h=this.headers.Prefer)===null||h===void 0?void 0:h.match(/count=(exact|planned|estimated)/),P=(d=u.headers.get("content-range"))===null||d===void 0?void 0:d.split("/");_&&P&&P.length>1&&(m=parseInt(P[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(v)&&(v.length>1?(p={code:"PGRST116",details:`Results contain ${v.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},v=null,m=null,g=406,w="Not Acceptable"):v.length===1?v=v[0]:v=null)}else{const _=await u.text();try{p=JSON.parse(_),Array.isArray(p)&&u.status===404&&(v=[],p=null,g=200,w="OK")}catch{u.status===404&&_===""?(g=204,w="No Content"):p={message:_}}if(p&&this.isMaybeSingle&&(!((f=p?.details)===null||f===void 0)&&f.includes("0 rows"))&&(p=null,g=200,w="OK"),p&&this.shouldThrowOnError)throw new t.default(p)}return{error:p,data:v,count:m,status:g,statusText:w}});return this.shouldThrowOnError||(c=c.catch(u=>{var h,d,f;return{error:{message:`${(h=u?.name)!==null&&h!==void 0?h:"FetchError"}: ${u?.message}`,details:`${(d=u?.stack)!==null&&d!==void 0?d:""}`,hint:"",code:`${(f=u?.code)!==null&&f!==void 0?f:""}`},data:null,count:null,status:0,statusText:""}})),c.then(i,o)}returns(){return this}overrideTypes(){return this}}return lt.default=r,lt}var Ts;function wo(){if(Ts)return at;Ts=1;var n=at&&at.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(at,"__esModule",{value:!0});const e=n(_o());class t extends e.default{select(s){let i=!1;const o=(s??"*").split("").map(a=>/\s/.test(a)&&!i?"":(a==='"'&&(i=!i),a)).join("");return this.url.searchParams.set("select",o),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(s,{ascending:i=!0,nullsFirst:o,foreignTable:a,referencedTable:c=a}={}){const u=c?`${c}.order`:"order",h=this.url.searchParams.get(u);return this.url.searchParams.set(u,`${h?`${h},`:""}${s}.${i?"asc":"desc"}${o===void 0?"":o?".nullsfirst":".nullslast"}`),this}limit(s,{foreignTable:i,referencedTable:o=i}={}){const a=typeof o>"u"?"limit":`${o}.limit`;return this.url.searchParams.set(a,`${s}`),this}range(s,i,{foreignTable:o,referencedTable:a=o}={}){const c=typeof a>"u"?"offset":`${a}.offset`,u=typeof a>"u"?"limit":`${a}.limit`;return this.url.searchParams.set(c,`${s}`),this.url.searchParams.set(u,`${i-s+1}`),this}abortSignal(s){return this.signal=s,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:s=!1,verbose:i=!1,settings:o=!1,buffers:a=!1,wal:c=!1,format:u="text"}={}){var h;const d=[s?"analyze":null,i?"verbose":null,o?"settings":null,a?"buffers":null,c?"wal":null].filter(Boolean).join("|"),f=(h=this.headers.Accept)!==null&&h!==void 0?h:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${u}; for="${f}"; options=${d};`,u==="json"?this:this}rollback(){var s;return((s=this.headers.Prefer)!==null&&s!==void 0?s:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}}return at.default=t,at}var Ps;function Bn(){if(Ps)return ot;Ps=1;var n=ot&&ot.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(ot,"__esModule",{value:!0});const e=n(wo());class t extends e.default{eq(s,i){return this.url.searchParams.append(s,`eq.${i}`),this}neq(s,i){return this.url.searchParams.append(s,`neq.${i}`),this}gt(s,i){return this.url.searchParams.append(s,`gt.${i}`),this}gte(s,i){return this.url.searchParams.append(s,`gte.${i}`),this}lt(s,i){return this.url.searchParams.append(s,`lt.${i}`),this}lte(s,i){return this.url.searchParams.append(s,`lte.${i}`),this}like(s,i){return this.url.searchParams.append(s,`like.${i}`),this}likeAllOf(s,i){return this.url.searchParams.append(s,`like(all).{${i.join(",")}}`),this}likeAnyOf(s,i){return this.url.searchParams.append(s,`like(any).{${i.join(",")}}`),this}ilike(s,i){return this.url.searchParams.append(s,`ilike.${i}`),this}ilikeAllOf(s,i){return this.url.searchParams.append(s,`ilike(all).{${i.join(",")}}`),this}ilikeAnyOf(s,i){return this.url.searchParams.append(s,`ilike(any).{${i.join(",")}}`),this}is(s,i){return this.url.searchParams.append(s,`is.${i}`),this}in(s,i){const o=Array.from(new Set(i)).map(a=>typeof a=="string"&&new RegExp("[,()]").test(a)?`"${a}"`:`${a}`).join(",");return this.url.searchParams.append(s,`in.(${o})`),this}contains(s,i){return typeof i=="string"?this.url.searchParams.append(s,`cs.${i}`):Array.isArray(i)?this.url.searchParams.append(s,`cs.{${i.join(",")}}`):this.url.searchParams.append(s,`cs.${JSON.stringify(i)}`),this}containedBy(s,i){return typeof i=="string"?this.url.searchParams.append(s,`cd.${i}`):Array.isArray(i)?this.url.searchParams.append(s,`cd.{${i.join(",")}}`):this.url.searchParams.append(s,`cd.${JSON.stringify(i)}`),this}rangeGt(s,i){return this.url.searchParams.append(s,`sr.${i}`),this}rangeGte(s,i){return this.url.searchParams.append(s,`nxl.${i}`),this}rangeLt(s,i){return this.url.searchParams.append(s,`sl.${i}`),this}rangeLte(s,i){return this.url.searchParams.append(s,`nxr.${i}`),this}rangeAdjacent(s,i){return this.url.searchParams.append(s,`adj.${i}`),this}overlaps(s,i){return typeof i=="string"?this.url.searchParams.append(s,`ov.${i}`):this.url.searchParams.append(s,`ov.{${i.join(",")}}`),this}textSearch(s,i,{config:o,type:a}={}){let c="";a==="plain"?c="pl":a==="phrase"?c="ph":a==="websearch"&&(c="w");const u=o===void 0?"":`(${o})`;return this.url.searchParams.append(s,`${c}fts${u}.${i}`),this}match(s){return Object.entries(s).forEach(([i,o])=>{this.url.searchParams.append(i,`eq.${o}`)}),this}not(s,i,o){return this.url.searchParams.append(s,`not.${i}.${o}`),this}or(s,{foreignTable:i,referencedTable:o=i}={}){const a=o?`${o}.or`:"or";return this.url.searchParams.append(a,`(${s})`),this}filter(s,i,o){return this.url.searchParams.append(s,`${i}.${o}`),this}}return ot.default=t,ot}var ks;function bo(){if(ks)return it;ks=1;var n=it&&it.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(it,"__esModule",{value:!0});const e=n(Bn());class t{constructor(s,{headers:i={},schema:o,fetch:a}){this.url=s,this.headers=i,this.schema=o,this.fetch=a}select(s,{head:i=!1,count:o}={}){const a=i?"HEAD":"GET";let c=!1;const u=(s??"*").split("").map(h=>/\s/.test(h)&&!c?"":(h==='"'&&(c=!c),h)).join("");return this.url.searchParams.set("select",u),o&&(this.headers.Prefer=`count=${o}`),new e.default({method:a,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(s,{count:i,defaultToNull:o=!0}={}){const a="POST",c=[];if(this.headers.Prefer&&c.push(this.headers.Prefer),i&&c.push(`count=${i}`),o||c.push("missing=default"),this.headers.Prefer=c.join(","),Array.isArray(s)){const u=s.reduce((h,d)=>h.concat(Object.keys(d)),[]);if(u.length>0){const h=[...new Set(u)].map(d=>`"${d}"`);this.url.searchParams.set("columns",h.join(","))}}return new e.default({method:a,url:this.url,headers:this.headers,schema:this.schema,body:s,fetch:this.fetch,allowEmpty:!1})}upsert(s,{onConflict:i,ignoreDuplicates:o=!1,count:a,defaultToNull:c=!0}={}){const u="POST",h=[`resolution=${o?"ignore":"merge"}-duplicates`];if(i!==void 0&&this.url.searchParams.set("on_conflict",i),this.headers.Prefer&&h.push(this.headers.Prefer),a&&h.push(`count=${a}`),c||h.push("missing=default"),this.headers.Prefer=h.join(","),Array.isArray(s)){const d=s.reduce((f,p)=>f.concat(Object.keys(p)),[]);if(d.length>0){const f=[...new Set(d)].map(p=>`"${p}"`);this.url.searchParams.set("columns",f.join(","))}}return new e.default({method:u,url:this.url,headers:this.headers,schema:this.schema,body:s,fetch:this.fetch,allowEmpty:!1})}update(s,{count:i}={}){const o="PATCH",a=[];return this.headers.Prefer&&a.push(this.headers.Prefer),i&&a.push(`count=${i}`),this.headers.Prefer=a.join(","),new e.default({method:o,url:this.url,headers:this.headers,schema:this.schema,body:s,fetch:this.fetch,allowEmpty:!1})}delete({count:s}={}){const i="DELETE",o=[];return s&&o.push(`count=${s}`),this.headers.Prefer&&o.unshift(this.headers.Prefer),this.headers.Prefer=o.join(","),new e.default({method:i,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}}return it.default=t,it}var kt={},At={},As;function Ma(){return As||(As=1,Object.defineProperty(At,"__esModule",{value:!0}),At.version=void 0,At.version="0.0.0-automated"),At}var $s;function qa(){if($s)return kt;$s=1,Object.defineProperty(kt,"__esModule",{value:!0}),kt.DEFAULT_HEADERS=void 0;const n=Ma();return kt.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${n.version}`},kt}var Rs;function Fa(){if(Rs)return st;Rs=1;var n=st&&st.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(st,"__esModule",{value:!0});const e=n(bo()),t=n(Bn()),r=qa();class s{constructor(o,{headers:a={},schema:c,fetch:u}={}){this.url=o,this.headers=Object.assign(Object.assign({},r.DEFAULT_HEADERS),a),this.schemaName=c,this.fetch=u}from(o){const a=new URL(`${this.url}/${o}`);return new e.default(a,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(o){return new s(this.url,{headers:this.headers,schema:o,fetch:this.fetch})}rpc(o,a={},{head:c=!1,get:u=!1,count:h}={}){let d;const f=new URL(`${this.url}/rpc/${o}`);let p;c||u?(d=c?"HEAD":"GET",Object.entries(a).filter(([m,g])=>g!==void 0).map(([m,g])=>[m,Array.isArray(g)?`{${g.join(",")}}`:`${g}`]).forEach(([m,g])=>{f.searchParams.append(m,g)})):(d="POST",p=a);const v=Object.assign({},this.headers);return h&&(v.Prefer=`count=${h}`),new t.default({method:d,url:f,headers:v,schema:this.schemaName,body:p,fetch:this.fetch,allowEmpty:!1})}}return st.default=s,st}var Os;function Ba(){if(Os)return he;Os=1;var n=he&&he.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(he,"__esModule",{value:!0}),he.PostgrestError=he.PostgrestBuilder=he.PostgrestTransformBuilder=he.PostgrestFilterBuilder=he.PostgrestQueryBuilder=he.PostgrestClient=void 0;const e=n(Fa());he.PostgrestClient=e.default;const t=n(bo());he.PostgrestQueryBuilder=t.default;const r=n(Bn());he.PostgrestFilterBuilder=r.default;const s=n(wo());he.PostgrestTransformBuilder=s.default;const i=n(_o());he.PostgrestBuilder=i.default;const o=n(yo());return he.PostgrestError=o.default,he.default={PostgrestClient:e.default,PostgrestQueryBuilder:t.default,PostgrestFilterBuilder:r.default,PostgrestTransformBuilder:s.default,PostgrestBuilder:i.default,PostgrestError:o.default},he}var Wa=Ba();const Ha=po(Wa),{PostgrestClient:Ga,PostgrestQueryBuilder:Xu,PostgrestFilterBuilder:Zu,PostgrestTransformBuilder:ed,PostgrestBuilder:td,PostgrestError:rd}=Ha;function Ka(){if(typeof WebSocket<"u")return WebSocket;if(typeof global.WebSocket<"u")return global.WebSocket;if(typeof window.WebSocket<"u")return window.WebSocket;if(typeof self.WebSocket<"u")return self.WebSocket;throw new Error("`WebSocket` is not supported in this environment")}const Va=Ka(),za="2.11.15",Ja=`realtime-js/${za}`,Ya="1.0.0",So=1e4,Qa=1e3;var Ct;(function(n){n[n.connecting=0]="connecting",n[n.open=1]="open",n[n.closing=2]="closing",n[n.closed=3]="closed"})(Ct||(Ct={}));var me;(function(n){n.closed="closed",n.errored="errored",n.joined="joined",n.joining="joining",n.leaving="leaving"})(me||(me={}));var Ie;(function(n){n.close="phx_close",n.error="phx_error",n.join="phx_join",n.reply="phx_reply",n.leave="phx_leave",n.access_token="access_token"})(Ie||(Ie={}));var kn;(function(n){n.websocket="websocket"})(kn||(kn={}));var tt;(function(n){n.Connecting="connecting",n.Open="open",n.Closing="closing",n.Closed="closed"})(tt||(tt={}));class Xa{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),r=new TextDecoder;return this._decodeBroadcast(e,t,r)}_decodeBroadcast(e,t,r){const s=t.getUint8(1),i=t.getUint8(2);let o=this.HEADER_LENGTH+2;const a=r.decode(e.slice(o,o+s));o=o+s;const c=r.decode(e.slice(o,o+i));o=o+i;const u=JSON.parse(r.decode(e.slice(o,e.byteLength)));return{ref:null,topic:a,event:c,payload:u}}}class Eo{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var re;(function(n){n.abstime="abstime",n.bool="bool",n.date="date",n.daterange="daterange",n.float4="float4",n.float8="float8",n.int2="int2",n.int4="int4",n.int4range="int4range",n.int8="int8",n.int8range="int8range",n.json="json",n.jsonb="jsonb",n.money="money",n.numeric="numeric",n.oid="oid",n.reltime="reltime",n.text="text",n.time="time",n.timestamp="timestamp",n.timestamptz="timestamptz",n.timetz="timetz",n.tsrange="tsrange",n.tstzrange="tstzrange"})(re||(re={}));const Cs=(n,e,t={})=>{var r;const s=(r=t.skipTypes)!==null&&r!==void 0?r:[];return Object.keys(e).reduce((i,o)=>(i[o]=Za(o,n,e,s),i),{})},Za=(n,e,t,r)=>{const s=e.find(a=>a.name===n),i=s?.type,o=t[n];return i&&!r.includes(i)?To(i,o):An(o)},To=(n,e)=>{if(n.charAt(0)==="_"){const t=n.slice(1,n.length);return nl(e,t)}switch(n){case re.bool:return el(e);case re.float4:case re.float8:case re.int2:case re.int4:case re.int8:case re.numeric:case re.oid:return tl(e);case re.json:case re.jsonb:return rl(e);case re.timestamp:return sl(e);case re.abstime:case re.date:case re.daterange:case re.int4range:case re.int8range:case re.money:case re.reltime:case re.text:case re.time:case re.timestamptz:case re.timetz:case re.tsrange:case re.tstzrange:return An(e);default:return An(e)}},An=n=>n,el=n=>{switch(n){case"t":return!0;case"f":return!1;default:return n}},tl=n=>{if(typeof n=="string"){const e=parseFloat(n);if(!Number.isNaN(e))return e}return n},rl=n=>{if(typeof n=="string")try{return JSON.parse(n)}catch(e){return console.log(`JSON parse error: ${e}`),n}return n},nl=(n,e)=>{if(typeof n!="string")return n;const t=n.length-1,r=n[t];if(n[0]==="{"&&r==="}"){let i;const o=n.slice(1,t);try{i=JSON.parse("["+o+"]")}catch{i=o?o.split(","):[]}return i.map(a=>To(e,a))}return n},sl=n=>typeof n=="string"?n.replace(" ","T"):n,Po=n=>{let e=n;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")};class or{constructor(e,t,r={},s=So){this.channel=e,this.event=t,this.payload=r,this.timeout=s,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var r;return this._hasReceived(e)&&t((r=this.receivedResp)===null||r===void 0?void 0:r.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(r=>r.status===e).forEach(r=>r.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var js;(function(n){n.SYNC="sync",n.JOIN="join",n.LEAVE="leave"})(js||(js={}));class jt{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=t?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},s=>{const{onJoin:i,onLeave:o,onSync:a}=this.caller;this.joinRef=this.channel._joinRef(),this.state=jt.syncState(this.state,s,i,o),this.pendingDiffs.forEach(c=>{this.state=jt.syncDiff(this.state,c,i,o)}),this.pendingDiffs=[],a()}),this.channel._on(r.diff,{},s=>{const{onJoin:i,onLeave:o,onSync:a}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(s):(this.state=jt.syncDiff(this.state,s,i,o),a())}),this.onJoin((s,i,o)=>{this.channel._trigger("presence",{event:"join",key:s,currentPresences:i,newPresences:o})}),this.onLeave((s,i,o)=>{this.channel._trigger("presence",{event:"leave",key:s,currentPresences:i,leftPresences:o})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,r,s){const i=this.cloneDeep(e),o=this.transformState(t),a={},c={};return this.map(i,(u,h)=>{o[u]||(c[u]=h)}),this.map(o,(u,h)=>{const d=i[u];if(d){const f=h.map(g=>g.presence_ref),p=d.map(g=>g.presence_ref),v=h.filter(g=>p.indexOf(g.presence_ref)<0),m=d.filter(g=>f.indexOf(g.presence_ref)<0);v.length>0&&(a[u]=v),m.length>0&&(c[u]=m)}else a[u]=h}),this.syncDiff(i,{joins:a,leaves:c},r,s)}static syncDiff(e,t,r,s){const{joins:i,leaves:o}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return r||(r=()=>{}),s||(s=()=>{}),this.map(i,(a,c)=>{var u;const h=(u=e[a])!==null&&u!==void 0?u:[];if(e[a]=this.cloneDeep(c),h.length>0){const d=e[a].map(p=>p.presence_ref),f=h.filter(p=>d.indexOf(p.presence_ref)<0);e[a].unshift(...f)}r(a,h,c)}),this.map(o,(a,c)=>{let u=e[a];if(!u)return;const h=c.map(d=>d.presence_ref);u=u.filter(d=>h.indexOf(d.presence_ref)<0),e[a]=u,s(a,u,c),u.length===0&&delete e[a]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(r=>t(r,e[r]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,r)=>{const s=e[r];return"metas"in s?t[r]=s.metas.map(i=>(i.presence_ref=i.phx_ref,delete i.phx_ref,delete i.phx_ref_prev,i)):t[r]=s,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var Is;(function(n){n.ALL="*",n.INSERT="INSERT",n.UPDATE="UPDATE",n.DELETE="DELETE"})(Is||(Is={}));var xs;(function(n){n.BROADCAST="broadcast",n.PRESENCE="presence",n.POSTGRES_CHANGES="postgres_changes",n.SYSTEM="system"})(xs||(xs={}));var Me;(function(n){n.SUBSCRIBED="SUBSCRIBED",n.TIMED_OUT="TIMED_OUT",n.CLOSED="CLOSED",n.CHANNEL_ERROR="CHANNEL_ERROR"})(Me||(Me={}));class Wn{constructor(e,t={config:{}},r){this.topic=e,this.params=t,this.socket=r,this.bindings={},this.state=me.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new or(this,Ie.join,this.params,this.timeout),this.rejoinTimer=new Eo(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=me.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(s=>s.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=me.closed,this.socket._remove(this)}),this._onError(s=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,s),this.state=me.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=me.errored,this.rejoinTimer.scheduleTimeout())}),this._on(Ie.reply,{},(s,i)=>{this._trigger(this._replyEventName(i),s)}),this.presence=new jt(this),this.broadcastEndpointURL=Po(this.socket.endPoint)+"/api/broadcast",this.private=this.params.config.private||!1}subscribe(e,t=this.timeout){var r,s;if(this.socket.isConnected()||this.socket.connect(),this.state==me.closed){const{config:{broadcast:i,presence:o,private:a}}=this.params;this._onError(h=>e?.(Me.CHANNEL_ERROR,h)),this._onClose(()=>e?.(Me.CLOSED));const c={},u={broadcast:i,presence:o,postgres_changes:(s=(r=this.bindings.postgres_changes)===null||r===void 0?void 0:r.map(h=>h.filter))!==null&&s!==void 0?s:[],private:a};this.socket.accessTokenValue&&(c.access_token=this.socket.accessTokenValue),this.updateJoinPayload(Object.assign({config:u},c)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:h})=>{var d;if(this.socket.setAuth(),h===void 0){e?.(Me.SUBSCRIBED);return}else{const f=this.bindings.postgres_changes,p=(d=f?.length)!==null&&d!==void 0?d:0,v=[];for(let m=0;m<p;m++){const g=f[m],{filter:{event:w,schema:b,table:_,filter:P}}=g,C=h&&h[m];if(C&&C.event===w&&C.schema===b&&C.table===_&&C.filter===P)v.push(Object.assign(Object.assign({},g),{id:C.id}));else{this.unsubscribe(),this.state=me.errored,e?.(Me.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=v,e&&e(Me.SUBSCRIBED);return}}).receive("error",h=>{this.state=me.errored,e?.(Me.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(h).join(", ")||"error")))}).receive("timeout",()=>{e?.(Me.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,r){return this._on(e,t,r)}async send(e,t={}){var r,s;if(!this._canPush()&&e.type==="broadcast"){const{event:i,payload:o}=e,c={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:o,private:this.private}]})};try{const u=await this._fetchWithTimeout(this.broadcastEndpointURL,c,(r=t.timeout)!==null&&r!==void 0?r:this.timeout);return await((s=u.body)===null||s===void 0?void 0:s.cancel()),u.ok?"ok":"error"}catch(u){return u.name==="AbortError"?"timed out":"error"}}else return new Promise(i=>{var o,a,c;const u=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((c=(a=(o=this.params)===null||o===void 0?void 0:o.config)===null||a===void 0?void 0:a.broadcast)===null||c===void 0)&&c.ack)&&i("ok"),u.receive("ok",()=>i("ok")),u.receive("error",()=>i("error")),u.receive("timeout",()=>i("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=me.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(Ie.close,"leave",this._joinRef())};this.joinPush.destroy();let r=null;return new Promise(s=>{r=new or(this,Ie.leave,{},e),r.receive("ok",()=>{t(),s("ok")}).receive("timeout",()=>{t(),s("timed out")}).receive("error",()=>{s("error")}),r.send(),this._canPush()||r.trigger("ok",{})}).finally(()=>{r?.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.rejoinTimer&&clearTimeout(this.rejoinTimer.timer),this.joinPush.destroy()}async _fetchWithTimeout(e,t,r){const s=new AbortController,i=setTimeout(()=>s.abort(),r),o=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:s.signal}));return clearTimeout(i),o}_push(e,t,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let s=new or(this,e,t,r);return this._canPush()?s.send():(s.startTimeout(),this.pushBuffer.push(s)),s}_onMessage(e,t,r){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,r){var s,i;const o=e.toLocaleLowerCase(),{close:a,error:c,leave:u,join:h}=Ie;if(r&&[a,c,u,h].indexOf(o)>=0&&r!==this._joinRef())return;let f=this._onMessage(o,t,r);if(t&&!f)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(o)?(s=this.bindings.postgres_changes)===null||s===void 0||s.filter(p=>{var v,m,g;return((v=p.filter)===null||v===void 0?void 0:v.event)==="*"||((g=(m=p.filter)===null||m===void 0?void 0:m.event)===null||g===void 0?void 0:g.toLocaleLowerCase())===o}).map(p=>p.callback(f,r)):(i=this.bindings[o])===null||i===void 0||i.filter(p=>{var v,m,g,w,b,_;if(["broadcast","presence","postgres_changes"].includes(o))if("id"in p){const P=p.id,C=(v=p.filter)===null||v===void 0?void 0:v.event;return P&&((m=t.ids)===null||m===void 0?void 0:m.includes(P))&&(C==="*"||C?.toLocaleLowerCase()===((g=t.data)===null||g===void 0?void 0:g.type.toLocaleLowerCase()))}else{const P=(b=(w=p?.filter)===null||w===void 0?void 0:w.event)===null||b===void 0?void 0:b.toLocaleLowerCase();return P==="*"||P===((_=t?.event)===null||_===void 0?void 0:_.toLocaleLowerCase())}else return p.type.toLocaleLowerCase()===o}).map(p=>{if(typeof f=="object"&&"ids"in f){const v=f.data,{schema:m,table:g,commit_timestamp:w,type:b,errors:_}=v;f=Object.assign(Object.assign({},{schema:m,table:g,commit_timestamp:w,eventType:b,new:{},old:{},errors:_}),this._getPayloadRecords(v))}p.callback(f,r)})}_isClosed(){return this.state===me.closed}_isJoined(){return this.state===me.joined}_isJoining(){return this.state===me.joining}_isLeaving(){return this.state===me.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,r){const s=e.toLocaleLowerCase(),i={type:s,filter:t,callback:r};return this.bindings[s]?this.bindings[s].push(i):this.bindings[s]=[i],this}_off(e,t){const r=e.toLocaleLowerCase();return this.bindings[r]=this.bindings[r].filter(s=>{var i;return!(((i=s.type)===null||i===void 0?void 0:i.toLocaleLowerCase())===r&&Wn.isEqual(s.filter,t))}),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const r in e)if(e[r]!==t[r])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(Ie.close,{},e)}_onError(e){this._on(Ie.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=me.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=Cs(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=Cs(e.columns,e.old_record)),t}}const Ns=()=>{},il=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class ol{constructor(e,t){var r;this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=So,this.heartbeatIntervalMs=25e3,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=Ns,this.ref=0,this.logger=Ns,this.conn=null,this.sendBuffer=[],this.serializer=new Xa,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._resolveFetch=i=>{let o;return i?o=i:typeof fetch>"u"?o=(...a)=>Lt(async()=>{const{default:c}=await Promise.resolve().then(()=>wt);return{default:c}},void 0).then(({default:c})=>c(...a)):o=fetch,(...a)=>o(...a)},this.endPoint=`${e}/${kn.websocket}`,this.httpEndpoint=Po(e),t?.transport?this.transport=t.transport:this.transport=null,t?.params&&(this.params=t.params),t?.timeout&&(this.timeout=t.timeout),t?.logger&&(this.logger=t.logger),(t?.logLevel||t?.log_level)&&(this.logLevel=t.logLevel||t.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),t?.heartbeatIntervalMs&&(this.heartbeatIntervalMs=t.heartbeatIntervalMs);const s=(r=t?.params)===null||r===void 0?void 0:r.apikey;if(s&&(this.accessTokenValue=s,this.apiKey=s),this.reconnectAfterMs=t?.reconnectAfterMs?t.reconnectAfterMs:i=>[1e3,2e3,5e3,1e4][i-1]||1e4,this.encode=t?.encode?t.encode:(i,o)=>o(JSON.stringify(i)),this.decode=t?.decode?t.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new Eo(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this._resolveFetch(t?.fetch),t?.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.worker=t?.worker||!1,this.workerUrl=t?.workerUrl}this.accessToken=t?.accessToken||null}connect(){if(!this.conn){if(this.transport||(this.transport=Va),!this.transport)throw new Error("No transport provided");this.conn=new this.transport(this.endpointURL()),this.setupConnection()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:Ya}))}disconnect(e,t){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,t??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset(),this.channels.forEach(r=>r.teardown()))}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,t,r){this.logger(e,t,r)}connectionState(){switch(this.conn&&this.conn.readyState){case Ct.connecting:return tt.Connecting;case Ct.open:return tt.Open;case Ct.closing:return tt.Closing;default:return tt.Closed}}isConnected(){return this.connectionState()===tt.Open}channel(e,t={config:{}}){const r=`realtime:${e}`,s=this.getChannels().find(i=>i.topic===r);if(s)return s;{const i=new Wn(`realtime:${e}`,t,this);return this.channels.push(i),i}}push(e){const{topic:t,event:r,payload:s,ref:i}=e,o=()=>{this.encode(e,a=>{var c;(c=this.conn)===null||c===void 0||c.send(a)})};this.log("push",`${t} ${r} (${i})`,s),this.isConnected()?o():this.sendBuffer.push(o)}async setAuth(e=null){let t=e||this.accessToken&&await this.accessToken()||this.accessTokenValue;this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach(r=>{const s={access_token:t,version:Ja};t&&r.updateJoinPayload(s),r.joinedOnce&&r._isJoined()&&r._push(Ie.access_token,{access_token:t})}))}async sendHeartbeat(){var e;if(!this.isConnected()){this.heartbeatCallback("disconnected");return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),this.heartbeatCallback("timeout"),(e=this.conn)===null||e===void 0||e.close(Qa,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.heartbeatCallback("sent"),await this.setAuth()}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(r=>r.topic===e&&(r._isJoined()||r._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_onConnMessage(e){this.decode(e.data,t=>{let{topic:r,event:s,payload:i,ref:o}=t;r==="phoenix"&&s==="phx_reply"&&this.heartbeatCallback(t.payload.status=="ok"?"ok":"error"),o&&o===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null),this.log("receive",`${i.status||""} ${r} ${s} ${o&&"("+o+")"||""}`,i),Array.from(this.channels).filter(a=>a._isMember(r)).forEach(a=>a._trigger(s,i,o)),this.stateChangeCallbacks.message.forEach(a=>a(t))})}_onConnOpen(){this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this.reconnectTimer.reset(),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this.stateChangeCallbacks.open.forEach(e=>e())}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this.workerRef.terminate()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(t=>t(e))}_onConnError(e){this.log("transport",`${e}`),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(t=>t(e))}_triggerChanError(){this.channels.forEach(e=>e._trigger(Ie.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const r=e.match(/\?/)?"&":"?",s=new URLSearchParams(t);return`${e}${r}${s}`}_workerObjectUrl(e){let t;if(e)t=e;else{const r=new Blob([il],{type:"application/javascript"});t=URL.createObjectURL(r)}return t}}class Hn extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function fe(n){return typeof n=="object"&&n!==null&&"__isStorageError"in n}class al extends Hn{constructor(e,t){super(e),this.name="StorageApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class $n extends Hn{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var ll=function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(h){try{u(r.next(h))}catch(d){o(d)}}function c(h){try{u(r.throw(h))}catch(d){o(d)}}function u(h){h.done?i(h.value):s(h.value).then(a,c)}u((r=r.apply(n,e||[])).next())})};const ko=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>Lt(async()=>{const{default:r}=await Promise.resolve().then(()=>wt);return{default:r}},void 0).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)},cl=()=>ll(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield Lt(()=>Promise.resolve().then(()=>wt),void 0)).Response:Response}),Rn=n=>{if(Array.isArray(n))return n.map(t=>Rn(t));if(typeof n=="function"||n!==Object(n))return n;const e={};return Object.entries(n).forEach(([t,r])=>{const s=t.replace(/([-_][a-z])/gi,i=>i.toUpperCase().replace(/[-_]/g,""));e[s]=Rn(r)}),e};var nt=function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(h){try{u(r.next(h))}catch(d){o(d)}}function c(h){try{u(r.throw(h))}catch(d){o(d)}}function u(h){h.done?i(h.value):s(h.value).then(a,c)}u((r=r.apply(n,e||[])).next())})};const ar=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),ul=(n,e,t)=>nt(void 0,void 0,void 0,function*(){const r=yield cl();n instanceof r&&!t?.noResolveJson?n.json().then(s=>{e(new al(ar(s),n.status||500))}).catch(s=>{e(new $n(ar(s),s))}):e(new $n(ar(n),n))}),dl=(n,e,t,r)=>{const s={method:n,headers:e?.headers||{}};return n==="GET"?s:(s.headers=Object.assign({"Content-Type":"application/json"},e?.headers),r&&(s.body=JSON.stringify(r)),Object.assign(Object.assign({},s),t))};function Ut(n,e,t,r,s,i){return nt(this,void 0,void 0,function*(){return new Promise((o,a)=>{n(t,dl(e,r,s,i)).then(c=>{if(!c.ok)throw c;return r?.noResolveJson?c:c.json()}).then(c=>o(c)).catch(c=>ul(c,a,r))})})}function Jt(n,e,t,r){return nt(this,void 0,void 0,function*(){return Ut(n,"GET",e,t,r)})}function He(n,e,t,r,s){return nt(this,void 0,void 0,function*(){return Ut(n,"POST",e,r,s,t)})}function hl(n,e,t,r,s){return nt(this,void 0,void 0,function*(){return Ut(n,"PUT",e,r,s,t)})}function fl(n,e,t,r){return nt(this,void 0,void 0,function*(){return Ut(n,"HEAD",e,Object.assign(Object.assign({},t),{noResolveJson:!0}),r)})}function Ao(n,e,t,r,s){return nt(this,void 0,void 0,function*(){return Ut(n,"DELETE",e,r,s,t)})}var we=function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(h){try{u(r.next(h))}catch(d){o(d)}}function c(h){try{u(r.throw(h))}catch(d){o(d)}}function u(h){h.done?i(h.value):s(h.value).then(a,c)}u((r=r.apply(n,e||[])).next())})};const pl={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Ls={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class gl{constructor(e,t={},r,s){this.url=e,this.headers=t,this.bucketId=r,this.fetch=ko(s)}uploadOrUpdate(e,t,r,s){return we(this,void 0,void 0,function*(){try{let i;const o=Object.assign(Object.assign({},Ls),s);let a=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(o.upsert)});const c=o.metadata;typeof Blob<"u"&&r instanceof Blob?(i=new FormData,i.append("cacheControl",o.cacheControl),c&&i.append("metadata",this.encodeMetadata(c)),i.append("",r)):typeof FormData<"u"&&r instanceof FormData?(i=r,i.append("cacheControl",o.cacheControl),c&&i.append("metadata",this.encodeMetadata(c))):(i=r,a["cache-control"]=`max-age=${o.cacheControl}`,a["content-type"]=o.contentType,c&&(a["x-metadata"]=this.toBase64(this.encodeMetadata(c)))),s?.headers&&(a=Object.assign(Object.assign({},a),s.headers));const u=this._removeEmptyFolders(t),h=this._getFinalPath(u),d=yield this.fetch(`${this.url}/object/${h}`,Object.assign({method:e,body:i,headers:a},o?.duplex?{duplex:o.duplex}:{})),f=yield d.json();return d.ok?{data:{path:u,id:f.Id,fullPath:f.Key},error:null}:{data:null,error:f}}catch(i){if(fe(i))return{data:null,error:i};throw i}})}upload(e,t,r){return we(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,r)})}uploadToSignedUrl(e,t,r,s){return we(this,void 0,void 0,function*(){const i=this._removeEmptyFolders(e),o=this._getFinalPath(i),a=new URL(this.url+`/object/upload/sign/${o}`);a.searchParams.set("token",t);try{let c;const u=Object.assign({upsert:Ls.upsert},s),h=Object.assign(Object.assign({},this.headers),{"x-upsert":String(u.upsert)});typeof Blob<"u"&&r instanceof Blob?(c=new FormData,c.append("cacheControl",u.cacheControl),c.append("",r)):typeof FormData<"u"&&r instanceof FormData?(c=r,c.append("cacheControl",u.cacheControl)):(c=r,h["cache-control"]=`max-age=${u.cacheControl}`,h["content-type"]=u.contentType);const d=yield this.fetch(a.toString(),{method:"PUT",body:c,headers:h}),f=yield d.json();return d.ok?{data:{path:i,fullPath:f.Key},error:null}:{data:null,error:f}}catch(c){if(fe(c))return{data:null,error:c};throw c}})}createSignedUploadUrl(e,t){return we(this,void 0,void 0,function*(){try{let r=this._getFinalPath(e);const s=Object.assign({},this.headers);t?.upsert&&(s["x-upsert"]="true");const i=yield He(this.fetch,`${this.url}/object/upload/sign/${r}`,{},{headers:s}),o=new URL(this.url+i.url),a=o.searchParams.get("token");if(!a)throw new Hn("No token returned by API");return{data:{signedUrl:o.toString(),path:e,token:a},error:null}}catch(r){if(fe(r))return{data:null,error:r};throw r}})}update(e,t,r){return we(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,r)})}move(e,t,r){return we(this,void 0,void 0,function*(){try{return{data:yield He(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:r?.destinationBucket},{headers:this.headers}),error:null}}catch(s){if(fe(s))return{data:null,error:s};throw s}})}copy(e,t,r){return we(this,void 0,void 0,function*(){try{return{data:{path:(yield He(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:r?.destinationBucket},{headers:this.headers})).Key},error:null}}catch(s){if(fe(s))return{data:null,error:s};throw s}})}createSignedUrl(e,t,r){return we(this,void 0,void 0,function*(){try{let s=this._getFinalPath(e),i=yield He(this.fetch,`${this.url}/object/sign/${s}`,Object.assign({expiresIn:t},r?.transform?{transform:r.transform}:{}),{headers:this.headers});const o=r?.download?`&download=${r.download===!0?"":r.download}`:"";return i={signedUrl:encodeURI(`${this.url}${i.signedURL}${o}`)},{data:i,error:null}}catch(s){if(fe(s))return{data:null,error:s};throw s}})}createSignedUrls(e,t,r){return we(this,void 0,void 0,function*(){try{const s=yield He(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),i=r?.download?`&download=${r.download===!0?"":r.download}`:"";return{data:s.map(o=>Object.assign(Object.assign({},o),{signedUrl:o.signedURL?encodeURI(`${this.url}${o.signedURL}${i}`):null})),error:null}}catch(s){if(fe(s))return{data:null,error:s};throw s}})}download(e,t){return we(this,void 0,void 0,function*(){const s=typeof t?.transform<"u"?"render/image/authenticated":"object",i=this.transformOptsToQueryString(t?.transform||{}),o=i?`?${i}`:"";try{const a=this._getFinalPath(e);return{data:yield(yield Jt(this.fetch,`${this.url}/${s}/${a}${o}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(a){if(fe(a))return{data:null,error:a};throw a}})}info(e){return we(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const r=yield Jt(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:Rn(r),error:null}}catch(r){if(fe(r))return{data:null,error:r};throw r}})}exists(e){return we(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield fl(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(r){if(fe(r)&&r instanceof $n){const s=r.originalError;if([400,404].includes(s?.status))return{data:!1,error:r}}throw r}})}getPublicUrl(e,t){const r=this._getFinalPath(e),s=[],i=t?.download?`download=${t.download===!0?"":t.download}`:"";i!==""&&s.push(i);const a=typeof t?.transform<"u"?"render/image":"object",c=this.transformOptsToQueryString(t?.transform||{});c!==""&&s.push(c);let u=s.join("&");return u!==""&&(u=`?${u}`),{data:{publicUrl:encodeURI(`${this.url}/${a}/public/${r}${u}`)}}}remove(e){return we(this,void 0,void 0,function*(){try{return{data:yield Ao(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(fe(t))return{data:null,error:t};throw t}})}list(e,t,r){return we(this,void 0,void 0,function*(){try{const s=Object.assign(Object.assign(Object.assign({},pl),t),{prefix:e||""});return{data:yield He(this.fetch,`${this.url}/object/list/${this.bucketId}`,s,{headers:this.headers},r),error:null}}catch(s){if(fe(s))return{data:null,error:s};throw s}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const vl="2.7.1",ml={"X-Client-Info":`storage-js/${vl}`};var ct=function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(h){try{u(r.next(h))}catch(d){o(d)}}function c(h){try{u(r.throw(h))}catch(d){o(d)}}function u(h){h.done?i(h.value):s(h.value).then(a,c)}u((r=r.apply(n,e||[])).next())})};class yl{constructor(e,t={},r){this.url=e,this.headers=Object.assign(Object.assign({},ml),t),this.fetch=ko(r)}listBuckets(){return ct(this,void 0,void 0,function*(){try{return{data:yield Jt(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(fe(e))return{data:null,error:e};throw e}})}getBucket(e){return ct(this,void 0,void 0,function*(){try{return{data:yield Jt(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(fe(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return ct(this,void 0,void 0,function*(){try{return{data:yield He(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(fe(r))return{data:null,error:r};throw r}})}updateBucket(e,t){return ct(this,void 0,void 0,function*(){try{return{data:yield hl(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(fe(r))return{data:null,error:r};throw r}})}emptyBucket(e){return ct(this,void 0,void 0,function*(){try{return{data:yield He(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(fe(t))return{data:null,error:t};throw t}})}deleteBucket(e){return ct(this,void 0,void 0,function*(){try{return{data:yield Ao(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(fe(t))return{data:null,error:t};throw t}})}}class _l extends yl{constructor(e,t={},r){super(e,t,r)}from(e){return new gl(this.url,this.headers,e,this.fetch)}}const wl="2.50.5";let Rt="";typeof Deno<"u"?Rt="deno":typeof document<"u"?Rt="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Rt="react-native":Rt="node";const bl={"X-Client-Info":`supabase-js-${Rt}/${wl}`},Sl={headers:bl},El={schema:"public"},Tl={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},Pl={};var kl=function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(h){try{u(r.next(h))}catch(d){o(d)}}function c(h){try{u(r.throw(h))}catch(d){o(d)}}function u(h){h.done?i(h.value):s(h.value).then(a,c)}u((r=r.apply(n,e||[])).next())})};const Al=n=>{let e;return n?e=n:typeof fetch>"u"?e=vo:e=fetch,(...t)=>e(...t)},$l=()=>typeof Headers>"u"?mo:Headers,Rl=(n,e,t)=>{const r=Al(t),s=$l();return(i,o)=>kl(void 0,void 0,void 0,function*(){var a;const c=(a=yield e())!==null&&a!==void 0?a:n;let u=new s(o?.headers);return u.has("apikey")||u.set("apikey",n),u.has("Authorization")||u.set("Authorization",`Bearer ${c}`),r(i,Object.assign(Object.assign({},o),{headers:u}))})};var Ol=function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(h){try{u(r.next(h))}catch(d){o(d)}}function c(h){try{u(r.throw(h))}catch(d){o(d)}}function u(h){h.done?i(h.value):s(h.value).then(a,c)}u((r=r.apply(n,e||[])).next())})};function Cl(n){return n.endsWith("/")?n:n+"/"}function jl(n,e){var t,r;const{db:s,auth:i,realtime:o,global:a}=n,{db:c,auth:u,realtime:h,global:d}=e,f={db:Object.assign(Object.assign({},c),s),auth:Object.assign(Object.assign({},u),i),realtime:Object.assign(Object.assign({},h),o),global:Object.assign(Object.assign(Object.assign({},d),a),{headers:Object.assign(Object.assign({},(t=d?.headers)!==null&&t!==void 0?t:{}),(r=a?.headers)!==null&&r!==void 0?r:{})}),accessToken:()=>Ol(this,void 0,void 0,function*(){return""})};return n.accessToken?f.accessToken=n.accessToken:delete f.accessToken,f}const $o="2.70.0",pt=30*1e3,On=3,lr=On*pt,Il="http://localhost:9999",xl="supabase.auth.token",Nl={"X-Client-Info":`gotrue-js/${$o}`},Cn="X-Supabase-Api-Version",Ro={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},Ll=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,Ul=6e5;class Gn extends Error{constructor(e,t,r){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=r}}function H(n){return typeof n=="object"&&n!==null&&"__isAuthError"in n}class Dl extends Gn{constructor(e,t,r){super(e,t,r),this.name="AuthApiError",this.status=t,this.code=r}}function Ml(n){return H(n)&&n.name==="AuthApiError"}class Oo extends Gn{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class Ke extends Gn{constructor(e,t,r,s){super(e,r,s),this.name=t,this.status=r}}class Be extends Ke{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function ql(n){return H(n)&&n.name==="AuthSessionMissingError"}class Ft extends Ke{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Bt extends Ke{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class Wt extends Ke{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function Fl(n){return H(n)&&n.name==="AuthImplicitGrantRedirectError"}class Us extends Ke{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class jn extends Ke{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function cr(n){return H(n)&&n.name==="AuthRetryableFetchError"}class Ds extends Ke{constructor(e,t,r){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=r}}class It extends Ke{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const Yt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),Ms=` 	
\r=`.split(""),Bl=(()=>{const n=new Array(128);for(let e=0;e<n.length;e+=1)n[e]=-1;for(let e=0;e<Ms.length;e+=1)n[Ms[e].charCodeAt(0)]=-2;for(let e=0;e<Yt.length;e+=1)n[Yt[e].charCodeAt(0)]=e;return n})();function qs(n,e,t){if(n!==null)for(e.queue=e.queue<<8|n,e.queuedBits+=8;e.queuedBits>=6;){const r=e.queue>>e.queuedBits-6&63;t(Yt[r]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const r=e.queue>>e.queuedBits-6&63;t(Yt[r]),e.queuedBits-=6}}function Co(n,e,t){const r=Bl[n];if(r>-1)for(e.queue=e.queue<<6|r,e.queuedBits+=6;e.queuedBits>=8;)t(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(r===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(n)}"`)}}function Fs(n){const e=[],t=o=>{e.push(String.fromCodePoint(o))},r={utf8seq:0,codepoint:0},s={queue:0,queuedBits:0},i=o=>{Gl(o,r,t)};for(let o=0;o<n.length;o+=1)Co(n.charCodeAt(o),s,i);return e.join("")}function Wl(n,e){if(n<=127){e(n);return}else if(n<=2047){e(192|n>>6),e(128|n&63);return}else if(n<=65535){e(224|n>>12),e(128|n>>6&63),e(128|n&63);return}else if(n<=1114111){e(240|n>>18),e(128|n>>12&63),e(128|n>>6&63),e(128|n&63);return}throw new Error(`Unrecognized Unicode codepoint: ${n.toString(16)}`)}function Hl(n,e){for(let t=0;t<n.length;t+=1){let r=n.charCodeAt(t);if(r>55295&&r<=56319){const s=(r-55296)*1024&65535;r=(n.charCodeAt(t+1)-56320&65535|s)+65536,t+=1}Wl(r,e)}}function Gl(n,e,t){if(e.utf8seq===0){if(n<=127){t(n);return}for(let r=1;r<6;r+=1)if((n>>7-r&1)===0){e.utf8seq=r;break}if(e.utf8seq===2)e.codepoint=n&31;else if(e.utf8seq===3)e.codepoint=n&15;else if(e.utf8seq===4)e.codepoint=n&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(n<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|n&63,e.utf8seq-=1,e.utf8seq===0&&t(e.codepoint)}}function Kl(n){const e=[],t={queue:0,queuedBits:0},r=s=>{e.push(s)};for(let s=0;s<n.length;s+=1)Co(n.charCodeAt(s),t,r);return new Uint8Array(e)}function Vl(n){const e=[];return Hl(n,t=>e.push(t)),new Uint8Array(e)}function zl(n){const e=[],t={queue:0,queuedBits:0},r=s=>{e.push(s)};return n.forEach(s=>qs(s,t,r)),qs(null,t,r),e.join("")}function Jl(n){return Math.round(Date.now()/1e3)+n}function Yl(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){const e=Math.random()*16|0;return(n=="x"?e:e&3|8).toString(16)})}const je=()=>typeof window<"u"&&typeof document<"u",Xe={tested:!1,writable:!1},xt=()=>{if(!je())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(Xe.tested)return Xe.writable;const n=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(n,n),globalThis.localStorage.removeItem(n),Xe.tested=!0,Xe.writable=!0}catch{Xe.tested=!0,Xe.writable=!1}return Xe.writable};function Ql(n){const e={},t=new URL(n);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((s,i)=>{e[i]=s})}catch{}return t.searchParams.forEach((r,s)=>{e[s]=r}),e}const jo=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>Lt(async()=>{const{default:r}=await Promise.resolve().then(()=>wt);return{default:r}},void 0).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)},Xl=n=>typeof n=="object"&&n!==null&&"status"in n&&"ok"in n&&"json"in n&&typeof n.json=="function",Io=async(n,e,t)=>{await n.setItem(e,JSON.stringify(t))},Ht=async(n,e)=>{const t=await n.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},Gt=async(n,e)=>{await n.removeItem(e)};class Xt{constructor(){this.promise=new Xt.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}Xt.promiseConstructor=Promise;function ur(n){const e=n.split(".");if(e.length!==3)throw new It("Invalid JWT structure");for(let r=0;r<e.length;r++)if(!Ll.test(e[r]))throw new It("JWT not in base64url format");return{header:JSON.parse(Fs(e[0])),payload:JSON.parse(Fs(e[1])),signature:Kl(e[2]),raw:{header:e[0],payload:e[1]}}}async function Zl(n){return await new Promise(e=>{setTimeout(()=>e(null),n)})}function ec(n,e){return new Promise((r,s)=>{(async()=>{for(let i=0;i<1/0;i++)try{const o=await n(i);if(!e(i,null,o)){r(o);return}}catch(o){if(!e(i,o)){s(o);return}}})()})}function tc(n){return("0"+n.toString(16)).substr(-2)}function rc(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",r=t.length;let s="";for(let i=0;i<56;i++)s+=t.charAt(Math.floor(Math.random()*r));return s}return crypto.getRandomValues(e),Array.from(e,tc).join("")}async function nc(n){const t=new TextEncoder().encode(n),r=await crypto.subtle.digest("SHA-256",t),s=new Uint8Array(r);return Array.from(s).map(i=>String.fromCharCode(i)).join("")}async function sc(n){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),n;const t=await nc(n);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function ut(n,e,t=!1){const r=rc();let s=r;t&&(s+="/PASSWORD_RECOVERY"),await Io(n,`${e}-code-verifier`,s);const i=await sc(r);return[i,r===i?"plain":"s256"]}const ic=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function oc(n){const e=n.headers.get(Cn);if(!e||!e.match(ic))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function ac(n){if(!n)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(n<=e)throw new Error("JWT has expired")}function lc(n){switch(n){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const cc=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function dt(n){if(!cc.test(n))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}var uc=function(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(n);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(n,r[s])&&(t[r[s]]=n[r[s]]);return t};const et=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),dc=[502,503,504];async function Bs(n){var e;if(!Xl(n))throw new jn(et(n),0);if(dc.includes(n.status))throw new jn(et(n),n.status);let t;try{t=await n.json()}catch(i){throw new Oo(et(i),i)}let r;const s=oc(n);if(s&&s.getTime()>=Ro["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?r=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(r=t.error_code),r){if(r==="weak_password")throw new Ds(et(t),n.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(r==="session_not_found")throw new Be}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((i,o)=>i&&typeof o=="string",!0))throw new Ds(et(t),n.status,t.weak_password.reasons);throw new Dl(et(t),n.status||500,r)}const hc=(n,e,t,r)=>{const s={method:n,headers:e?.headers||{}};return n==="GET"?s:(s.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e?.headers),s.body=JSON.stringify(r),Object.assign(Object.assign({},s),t))};async function V(n,e,t,r){var s;const i=Object.assign({},r?.headers);i[Cn]||(i[Cn]=Ro["2024-01-01"].name),r?.jwt&&(i.Authorization=`Bearer ${r.jwt}`);const o=(s=r?.query)!==null&&s!==void 0?s:{};r?.redirectTo&&(o.redirect_to=r.redirectTo);const a=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",c=await fc(n,e,t+a,{headers:i,noResolveJson:r?.noResolveJson},{},r?.body);return r?.xform?r?.xform(c):{data:Object.assign({},c),error:null}}async function fc(n,e,t,r,s,i){const o=hc(e,r,s,i);let a;try{a=await n(t,Object.assign({},o))}catch(c){throw console.error(c),new jn(et(c),0)}if(a.ok||await Bs(a),r?.noResolveJson)return a;try{return await a.json()}catch(c){await Bs(c)}}function De(n){var e;let t=null;mc(n)&&(t=Object.assign({},n),n.expires_at||(t.expires_at=Jl(n.expires_in)));const r=(e=n.user)!==null&&e!==void 0?e:n;return{data:{session:t,user:r},error:null}}function Ws(n){const e=De(n);return!e.error&&n.weak_password&&typeof n.weak_password=="object"&&Array.isArray(n.weak_password.reasons)&&n.weak_password.reasons.length&&n.weak_password.message&&typeof n.weak_password.message=="string"&&n.weak_password.reasons.reduce((t,r)=>t&&typeof r=="string",!0)&&(e.data.weak_password=n.weak_password),e}function Ge(n){var e;return{data:{user:(e=n.user)!==null&&e!==void 0?e:n},error:null}}function pc(n){return{data:n,error:null}}function gc(n){const{action_link:e,email_otp:t,hashed_token:r,redirect_to:s,verification_type:i}=n,o=uc(n,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),a={action_link:e,email_otp:t,hashed_token:r,redirect_to:s,verification_type:i},c=Object.assign({},o);return{data:{properties:a,user:c},error:null}}function vc(n){return n}function mc(n){return n.access_token&&n.refresh_token&&n.expires_in}const dr=["global","local","others"];var yc=function(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(n);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(n,r[s])&&(t[r[s]]=n[r[s]]);return t};class _c{constructor({url:e="",headers:t={},fetch:r}){this.url=e,this.headers=t,this.fetch=jo(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t=dr[0]){if(dr.indexOf(t)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${dr.join(", ")}`);try{return await V(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(r){if(H(r))return{data:null,error:r};throw r}}async inviteUserByEmail(e,t={}){try{return await V(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:Ge})}catch(r){if(H(r))return{data:{user:null},error:r};throw r}}async generateLink(e){try{const{options:t}=e,r=yc(e,["options"]),s=Object.assign(Object.assign({},r),t);return"newEmail"in r&&(s.new_email=r?.newEmail,delete s.newEmail),await V(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:s,headers:this.headers,xform:gc,redirectTo:t?.redirectTo})}catch(t){if(H(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await V(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:Ge})}catch(t){if(H(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,r,s,i,o,a,c;try{const u={nextPage:null,lastPage:0,total:0},h=await V(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(t=e?.page)===null||t===void 0?void 0:t.toString())!==null&&r!==void 0?r:"",per_page:(i=(s=e?.perPage)===null||s===void 0?void 0:s.toString())!==null&&i!==void 0?i:""},xform:vc});if(h.error)throw h.error;const d=await h.json(),f=(o=h.headers.get("x-total-count"))!==null&&o!==void 0?o:0,p=(c=(a=h.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&c!==void 0?c:[];return p.length>0&&(p.forEach(v=>{const m=parseInt(v.split(";")[0].split("=")[1].substring(0,1)),g=JSON.parse(v.split(";")[1].split("=")[1]);u[`${g}Page`]=m}),u.total=parseInt(f)),{data:Object.assign(Object.assign({},d),u),error:null}}catch(u){if(H(u))return{data:{users:[]},error:u};throw u}}async getUserById(e){dt(e);try{return await V(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:Ge})}catch(t){if(H(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){dt(e);try{return await V(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:Ge})}catch(r){if(H(r))return{data:{user:null},error:r};throw r}}async deleteUser(e,t=!1){dt(e);try{return await V(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:Ge})}catch(r){if(H(r))return{data:{user:null},error:r};throw r}}async _listFactors(e){dt(e.userId);try{const{data:t,error:r}=await V(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:s=>({data:{factors:s},error:null})});return{data:t,error:r}}catch(t){if(H(t))return{data:null,error:t};throw t}}async _deleteFactor(e){dt(e.userId),dt(e.id);try{return{data:await V(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(H(t))return{data:null,error:t};throw t}}}const wc={getItem:n=>xt()?globalThis.localStorage.getItem(n):null,setItem:(n,e)=>{xt()&&globalThis.localStorage.setItem(n,e)},removeItem:n=>{xt()&&globalThis.localStorage.removeItem(n)}};function Hs(n={}){return{getItem:e=>n[e]||null,setItem:(e,t)=>{n[e]=t},removeItem:e=>{delete n[e]}}}function bc(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const ht={debug:!!(globalThis&&xt()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class xo extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class Sc extends xo{}async function Ec(n,e,t){ht.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",n,e);const r=new globalThis.AbortController;return e>0&&setTimeout(()=>{r.abort(),ht.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",n)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(n,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},async s=>{if(s){ht.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",n,s.name);try{return await t()}finally{ht.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",n,s.name)}}else{if(e===0)throw ht.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",n),new Sc(`Acquiring an exclusive Navigator LockManager lock "${n}" immediately failed`);if(ht.debug)try{const i=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(i,null,"  "))}catch(i){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",i)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}}))}bc();const Tc={url:Il,storageKey:xl,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Nl,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function Gs(n,e,t){return await t()}class Nt{constructor(e){var t,r;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=Nt.nextInstanceID,Nt.nextInstanceID+=1,this.instanceID>0&&je()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const s=Object.assign(Object.assign({},Tc),e);if(this.logDebugMessages=!!s.debug,typeof s.debug=="function"&&(this.logger=s.debug),this.persistSession=s.persistSession,this.storageKey=s.storageKey,this.autoRefreshToken=s.autoRefreshToken,this.admin=new _c({url:s.url,headers:s.headers,fetch:s.fetch}),this.url=s.url,this.headers=s.headers,this.fetch=jo(s.fetch),this.lock=s.lock||Gs,this.detectSessionInUrl=s.detectSessionInUrl,this.flowType=s.flowType,this.hasCustomAuthorizationHeader=s.hasCustomAuthorizationHeader,s.lock?this.lock=s.lock:je()&&(!((t=globalThis?.navigator)===null||t===void 0)&&t.locks)?this.lock=Ec:this.lock=Gs,this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?s.storage?this.storage=s.storage:xt()?this.storage=wc:(this.memoryStorage={},this.storage=Hs(this.memoryStorage)):(this.memoryStorage={},this.storage=Hs(this.memoryStorage)),je()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(i){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",i)}(r=this.broadcastChannel)===null||r===void 0||r.addEventListener("message",async i=>{this._debug("received broadcast notification from other tab or client",i),await this._notifyAllSubscribers(i.data.event,i.data.session,!1)})}this.initialize()}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${$o}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{const t=Ql(window.location.href);let r="none";if(this._isImplicitGrantCallback(t)?r="implicit":await this._isPKCECallback(t)&&(r="pkce"),je()&&this.detectSessionInUrl&&r!=="none"){const{data:s,error:i}=await this._getSessionFromURL(t,r);if(i){if(this._debug("#_initialize()","error detecting session from URL",i),Fl(i)){const c=(e=i.details)===null||e===void 0?void 0:e.code;if(c==="identity_already_exists"||c==="identity_not_found"||c==="single_identity_not_deletable")return{error:i}}return await this._removeSession(),{error:i}}const{session:o,redirectType:a}=s;return this._debug("#_initialize()","detected session in URL",o,"redirect type",a),await this._saveSession(o),setTimeout(async()=>{a==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",o):await this._notifyAllSubscribers("SIGNED_IN",o)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return H(t)?{error:t}:{error:new Oo("Unexpected error during initialization",t)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,r,s;try{const i=await V(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(r=(t=e?.options)===null||t===void 0?void 0:t.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:(s=e?.options)===null||s===void 0?void 0:s.captchaToken}},xform:De}),{data:o,error:a}=i;if(a||!o)return{data:{user:null,session:null},error:a};const c=o.session,u=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:u,session:c},error:null}}catch(i){if(H(i))return{data:{user:null,session:null},error:i};throw i}}async signUp(e){var t,r,s;try{let i;if("email"in e){const{email:h,password:d,options:f}=e;let p=null,v=null;this.flowType==="pkce"&&([p,v]=await ut(this.storage,this.storageKey)),i=await V(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:f?.emailRedirectTo,body:{email:h,password:d,data:(t=f?.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:f?.captchaToken},code_challenge:p,code_challenge_method:v},xform:De})}else if("phone"in e){const{phone:h,password:d,options:f}=e;i=await V(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:h,password:d,data:(r=f?.data)!==null&&r!==void 0?r:{},channel:(s=f?.channel)!==null&&s!==void 0?s:"sms",gotrue_meta_security:{captcha_token:f?.captchaToken}},xform:De})}else throw new Bt("You must provide either an email or phone number and a password");const{data:o,error:a}=i;if(a||!o)return{data:{user:null,session:null},error:a};const c=o.session,u=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:u,session:c},error:null}}catch(i){if(H(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithPassword(e){try{let t;if("email"in e){const{email:i,password:o,options:a}=e;t=await V(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:i,password:o,gotrue_meta_security:{captcha_token:a?.captchaToken}},xform:Ws})}else if("phone"in e){const{phone:i,password:o,options:a}=e;t=await V(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:i,password:o,gotrue_meta_security:{captcha_token:a?.captchaToken}},xform:Ws})}else throw new Bt("You must provide either an email or phone number and a password");const{data:r,error:s}=t;return s?{data:{user:null,session:null},error:s}:!r||!r.session||!r.user?{data:{user:null,session:null},error:new Ft}:(r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),{data:Object.assign({user:r.user,session:r.session},r.weak_password?{weakPassword:r.weak_password}:null),error:s})}catch(t){if(H(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,r,s,i;return await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(r=e.options)===null||r===void 0?void 0:r.scopes,queryParams:(s=e.options)===null||s===void 0?void 0:s.queryParams,skipBrowserRedirect:(i=e.options)===null||i===void 0?void 0:i.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:t}=e;if(t==="solana")return await this.signInWithSolana(e);throw new Error(`@supabase/auth-js: Unsupported chain "${t}"`)}async signInWithSolana(e){var t,r,s,i,o,a,c,u,h,d,f,p;let v,m;if("message"in e)v=e.message,m=e.signature;else{const{chain:g,wallet:w,statement:b,options:_}=e;let P;if(je())if(typeof w=="object")P=w;else{const L=window;if("solana"in L&&typeof L.solana=="object"&&("signIn"in L.solana&&typeof L.solana.signIn=="function"||"signMessage"in L.solana&&typeof L.solana.signMessage=="function"))P=L.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof w!="object"||!_?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");P=w}const C=new URL((t=_?.url)!==null&&t!==void 0?t:window.location.href);if("signIn"in P&&P.signIn){const L=await P.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},_?.signInWithSolana),{version:"1",domain:C.host,uri:C.href}),b?{statement:b}:null));let q;if(Array.isArray(L)&&L[0]&&typeof L[0]=="object")q=L[0];else if(L&&typeof L=="object"&&"signedMessage"in L&&"signature"in L)q=L;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in q&&"signature"in q&&(typeof q.signedMessage=="string"||q.signedMessage instanceof Uint8Array)&&q.signature instanceof Uint8Array)v=typeof q.signedMessage=="string"?q.signedMessage:new TextDecoder().decode(q.signedMessage),m=q.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in P)||typeof P.signMessage!="function"||!("publicKey"in P)||typeof P!="object"||!P.publicKey||!("toBase58"in P.publicKey)||typeof P.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");v=[`${C.host} wants you to sign in with your Solana account:`,P.publicKey.toBase58(),...b?["",b,""]:[""],"Version: 1",`URI: ${C.href}`,`Issued At: ${(s=(r=_?.signInWithSolana)===null||r===void 0?void 0:r.issuedAt)!==null&&s!==void 0?s:new Date().toISOString()}`,...!((i=_?.signInWithSolana)===null||i===void 0)&&i.notBefore?[`Not Before: ${_.signInWithSolana.notBefore}`]:[],...!((o=_?.signInWithSolana)===null||o===void 0)&&o.expirationTime?[`Expiration Time: ${_.signInWithSolana.expirationTime}`]:[],...!((a=_?.signInWithSolana)===null||a===void 0)&&a.chainId?[`Chain ID: ${_.signInWithSolana.chainId}`]:[],...!((c=_?.signInWithSolana)===null||c===void 0)&&c.nonce?[`Nonce: ${_.signInWithSolana.nonce}`]:[],...!((u=_?.signInWithSolana)===null||u===void 0)&&u.requestId?[`Request ID: ${_.signInWithSolana.requestId}`]:[],...!((d=(h=_?.signInWithSolana)===null||h===void 0?void 0:h.resources)===null||d===void 0)&&d.length?["Resources",..._.signInWithSolana.resources.map(q=>`- ${q}`)]:[]].join(`
`);const L=await P.signMessage(new TextEncoder().encode(v),"utf8");if(!L||!(L instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");m=L}}try{const{data:g,error:w}=await V(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:v,signature:zl(m)},!((f=e.options)===null||f===void 0)&&f.captchaToken?{gotrue_meta_security:{captcha_token:(p=e.options)===null||p===void 0?void 0:p.captchaToken}}:null),xform:De});if(w)throw w;return!g||!g.session||!g.user?{data:{user:null,session:null},error:new Ft}:(g.session&&(await this._saveSession(g.session),await this._notifyAllSubscribers("SIGNED_IN",g.session)),{data:Object.assign({},g),error:w})}catch(g){if(H(g))return{data:{user:null,session:null},error:g};throw g}}async _exchangeCodeForSession(e){const t=await Ht(this.storage,`${this.storageKey}-code-verifier`),[r,s]=(t??"").split("/");try{const{data:i,error:o}=await V(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:r},xform:De});if(await Gt(this.storage,`${this.storageKey}-code-verifier`),o)throw o;return!i||!i.session||!i.user?{data:{user:null,session:null,redirectType:null},error:new Ft}:(i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",i.session)),{data:Object.assign(Object.assign({},i),{redirectType:s??null}),error:o})}catch(i){if(H(i))return{data:{user:null,session:null,redirectType:null},error:i};throw i}}async signInWithIdToken(e){try{const{options:t,provider:r,token:s,access_token:i,nonce:o}=e,a=await V(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:s,access_token:i,nonce:o,gotrue_meta_security:{captcha_token:t?.captchaToken}},xform:De}),{data:c,error:u}=a;return u?{data:{user:null,session:null},error:u}:!c||!c.session||!c.user?{data:{user:null,session:null},error:new Ft}:(c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",c.session)),{data:c,error:u})}catch(t){if(H(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,r,s,i,o;try{if("email"in e){const{email:a,options:c}=e;let u=null,h=null;this.flowType==="pkce"&&([u,h]=await ut(this.storage,this.storageKey));const{error:d}=await V(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:a,data:(t=c?.data)!==null&&t!==void 0?t:{},create_user:(r=c?.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:c?.captchaToken},code_challenge:u,code_challenge_method:h},redirectTo:c?.emailRedirectTo});return{data:{user:null,session:null},error:d}}if("phone"in e){const{phone:a,options:c}=e,{data:u,error:h}=await V(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:a,data:(s=c?.data)!==null&&s!==void 0?s:{},create_user:(i=c?.shouldCreateUser)!==null&&i!==void 0?i:!0,gotrue_meta_security:{captcha_token:c?.captchaToken},channel:(o=c?.channel)!==null&&o!==void 0?o:"sms"}});return{data:{user:null,session:null,messageId:u?.message_id},error:h}}throw new Bt("You must provide either an email or phone number.")}catch(a){if(H(a))return{data:{user:null,session:null},error:a};throw a}}async verifyOtp(e){var t,r;try{let s,i;"options"in e&&(s=(t=e.options)===null||t===void 0?void 0:t.redirectTo,i=(r=e.options)===null||r===void 0?void 0:r.captchaToken);const{data:o,error:a}=await V(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:i}}),redirectTo:s,xform:De});if(a)throw a;if(!o)throw new Error("An error occurred on token verification.");const c=o.session,u=o.user;return c?.access_token&&(await this._saveSession(c),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",c)),{data:{user:u,session:c},error:null}}catch(s){if(H(s))return{data:{user:null,session:null},error:s};throw s}}async signInWithSSO(e){var t,r,s;try{let i=null,o=null;return this.flowType==="pkce"&&([i,o]=await ut(this.storage,this.storageKey)),await V(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(r=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&r!==void 0?r:void 0}),!((s=e?.options)===null||s===void 0)&&s.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:i,code_challenge_method:o}),headers:this.headers,xform:pc})}catch(i){if(H(i))return{data:null,error:i};throw i}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:r}=e;if(r)throw r;if(!t)throw new Be;const{error:s}=await V(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:s}})}catch(e){if(H(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:r,type:s,options:i}=e,{error:o}=await V(this.fetch,"POST",t,{headers:this.headers,body:{email:r,type:s,gotrue_meta_security:{captcha_token:i?.captchaToken}},redirectTo:i?.emailRedirectTo});return{data:{user:null,session:null},error:o}}else if("phone"in e){const{phone:r,type:s,options:i}=e,{data:o,error:a}=await V(this.fetch,"POST",t,{headers:this.headers,body:{phone:r,type:s,gotrue_meta_security:{captcha_token:i?.captchaToken}}});return{data:{user:null,session:null,messageId:o?.message_id},error:a}}throw new Bt("You must provide either an email or phone number and a type")}catch(t){if(H(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async t=>t))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const r=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),s=(async()=>(await r,await t()))();return this.pendingInLock.push((async()=>{try{await s}catch{}})()),s}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const r=t();for(this.pendingInLock.push((async()=>{try{await r}catch{}})()),await r;this.pendingInLock.length;){const s=[...this.pendingInLock];await Promise.all(s),this.pendingInLock.splice(0,s.length)}return await r}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await Ht(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const r=e.expires_at?e.expires_at*1e3-Date.now()<lr:!1;if(this._debug("#__loadSession()",`session has${r?"":" not"} expired`,"expires_at",e.expires_at),!r){if(this.storage.isServer){let o=this.suppressGetSessionWarning;e=new Proxy(e,{get:(c,u,h)=>(!o&&u==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),o=!0,this.suppressGetSessionWarning=!0),Reflect.get(c,u,h))})}return{data:{session:e},error:null}}const{session:s,error:i}=await this._callRefreshToken(e.refresh_token);return i?{data:{session:null},error:i}:{data:{session:s},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await V(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:Ge}):await this._useSession(async t=>{var r,s,i;const{data:o,error:a}=t;if(a)throw a;return!(!((r=o.session)===null||r===void 0)&&r.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Be}:await V(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(i=(s=o.session)===null||s===void 0?void 0:s.access_token)!==null&&i!==void 0?i:void 0,xform:Ge})})}catch(t){if(H(t))return ql(t)&&(await this._removeSession(),await Gt(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async r=>{const{data:s,error:i}=r;if(i)throw i;if(!s.session)throw new Be;const o=s.session;let a=null,c=null;this.flowType==="pkce"&&e.email!=null&&([a,c]=await ut(this.storage,this.storageKey));const{data:u,error:h}=await V(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t?.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:a,code_challenge_method:c}),jwt:o.access_token,xform:Ge});if(h)throw h;return o.user=u.user,await this._saveSession(o),await this._notifyAllSubscribers("USER_UPDATED",o),{data:{user:o.user},error:null}})}catch(r){if(H(r))return{data:{user:null},error:r};throw r}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new Be;const t=Date.now()/1e3;let r=t,s=!0,i=null;const{payload:o}=ur(e.access_token);if(o.exp&&(r=o.exp,s=r<=t),s){const{session:a,error:c}=await this._callRefreshToken(e.refresh_token);if(c)return{data:{user:null,session:null},error:c};if(!a)return{data:{user:null,session:null},error:null};i=a}else{const{data:a,error:c}=await this._getUser(e.access_token);if(c)throw c;i={access_token:e.access_token,refresh_token:e.refresh_token,user:a.user,token_type:"bearer",expires_in:r-t,expires_at:r},await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)}return{data:{user:i.user,session:i},error:null}}catch(t){if(H(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var r;if(!e){const{data:o,error:a}=t;if(a)throw a;e=(r=o.session)!==null&&r!==void 0?r:void 0}if(!e?.refresh_token)throw new Be;const{session:s,error:i}=await this._callRefreshToken(e.refresh_token);return i?{data:{user:null,session:null},error:i}:s?{data:{user:s.user,session:s},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if(H(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e,t){try{if(!je())throw new Wt("No browser detected.");if(e.error||e.error_description||e.error_code)throw new Wt(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if(this.flowType==="pkce")throw new Us("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new Wt("Not a valid implicit grant flow url.");break;default:}if(t==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new Us("No code detected.");const{data:b,error:_}=await this._exchangeCodeForSession(e.code);if(_)throw _;const P=new URL(window.location.href);return P.searchParams.delete("code"),window.history.replaceState(window.history.state,"",P.toString()),{data:{session:b.session,redirectType:null},error:null}}const{provider_token:r,provider_refresh_token:s,access_token:i,refresh_token:o,expires_in:a,expires_at:c,token_type:u}=e;if(!i||!a||!o||!u)throw new Wt("No session defined in URL");const h=Math.round(Date.now()/1e3),d=parseInt(a);let f=h+d;c&&(f=parseInt(c));const p=f-h;p*1e3<=pt&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${p}s, should have been closer to ${d}s`);const v=f-d;h-v>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",v,f,h):h-v<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",v,f,h);const{data:m,error:g}=await this._getUser(i);if(g)throw g;const w={provider_token:r,provider_refresh_token:s,access_token:i,expires_in:d,expires_at:f,refresh_token:o,token_type:u,user:m.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:w,redirectType:e.type},error:null}}catch(r){if(H(r))return{data:{session:null,redirectType:null},error:r};throw r}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await Ht(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var r;const{data:s,error:i}=t;if(i)return{error:i};const o=(r=s.session)===null||r===void 0?void 0:r.access_token;if(o){const{error:a}=await this.admin.signOut(o,e);if(a&&!(Ml(a)&&(a.status===404||a.status===401||a.status===403)))return{error:a}}return e!=="others"&&(await this._removeSession(),await Gt(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const t=Yl(),r={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,r),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:r}}}async _emitInitialSession(e){return await this._useSession(async t=>{var r,s;try{const{data:{session:i},error:o}=t;if(o)throw o;await((r=this.stateChangeEmitters.get(e))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",i)),this._debug("INITIAL_SESSION","callback id",e,"session",i)}catch(i){await((s=this.stateChangeEmitters.get(e))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",i),console.error(i)}})}async resetPasswordForEmail(e,t={}){let r=null,s=null;this.flowType==="pkce"&&([r,s]=await ut(this.storage,this.storageKey,!0));try{return await V(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:r,code_challenge_method:s,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(i){if(H(i))return{data:null,error:i};throw i}}async getUserIdentities(){var e;try{const{data:t,error:r}=await this.getUser();if(r)throw r;return{data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(t){if(H(t))return{data:null,error:t};throw t}}async linkIdentity(e){var t;try{const{data:r,error:s}=await this._useSession(async i=>{var o,a,c,u,h;const{data:d,error:f}=i;if(f)throw f;const p=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(o=e.options)===null||o===void 0?void 0:o.redirectTo,scopes:(a=e.options)===null||a===void 0?void 0:a.scopes,queryParams:(c=e.options)===null||c===void 0?void 0:c.queryParams,skipBrowserRedirect:!0});return await V(this.fetch,"GET",p,{headers:this.headers,jwt:(h=(u=d.session)===null||u===void 0?void 0:u.access_token)!==null&&h!==void 0?h:void 0})});if(s)throw s;return je()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(r?.url),{data:{provider:e.provider,url:r?.url},error:null}}catch(r){if(H(r))return{data:{provider:e.provider,url:null},error:r};throw r}}async unlinkIdentity(e){try{return await this._useSession(async t=>{var r,s;const{data:i,error:o}=t;if(o)throw o;return await V(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(s=(r=i.session)===null||r===void 0?void 0:r.access_token)!==null&&s!==void 0?s:void 0})})}catch(t){if(H(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const r=Date.now();return await ec(async s=>(s>0&&await Zl(200*Math.pow(2,s-1)),this._debug(t,"refreshing attempt",s),await V(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:De})),(s,i)=>{const o=200*Math.pow(2,s);return i&&cr(i)&&Date.now()+o-r<pt})}catch(r){if(this._debug(t,"error",r),H(r))return{data:{session:null,user:null},error:r};throw r}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const r=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",r),je()&&!t.skipBrowserRedirect&&window.location.assign(r),{data:{provider:e,url:r},error:null}}async _recoverAndRefresh(){var e;const t="#_recoverAndRefresh()";this._debug(t,"begin");try{const r=await Ht(this.storage,this.storageKey);if(this._debug(t,"session from storage",r),!this._isValidSession(r)){this._debug(t,"session is not valid"),r!==null&&await this._removeSession();return}const s=((e=r.expires_at)!==null&&e!==void 0?e:1/0)*1e3-Date.now()<lr;if(this._debug(t,`session has${s?"":" not"} expired with margin of ${lr}s`),s){if(this.autoRefreshToken&&r.refresh_token){const{error:i}=await this._callRefreshToken(r.refresh_token);i&&(console.error(i),cr(i)||(this._debug(t,"refresh failed with a non-retryable error, removing the session",i),await this._removeSession()))}}else await this._notifyAllSubscribers("SIGNED_IN",r)}catch(r){this._debug(t,"error",r),console.error(r);return}finally{this._debug(t,"end")}}async _callRefreshToken(e){var t,r;if(!e)throw new Be;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const s=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(s,"begin");try{this.refreshingDeferred=new Xt;const{data:i,error:o}=await this._refreshAccessToken(e);if(o)throw o;if(!i.session)throw new Be;await this._saveSession(i.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",i.session);const a={session:i.session,error:null};return this.refreshingDeferred.resolve(a),a}catch(i){if(this._debug(s,"error",i),H(i)){const o={session:null,error:i};return cr(i)||await this._removeSession(),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(o),o}throw(r=this.refreshingDeferred)===null||r===void 0||r.reject(i),i}finally{this.refreshingDeferred=null,this._debug(s,"end")}}async _notifyAllSubscribers(e,t,r=!0){const s=`#_notifyAllSubscribers(${e})`;this._debug(s,"begin",t,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:e,session:t});const i=[],o=Array.from(this.stateChangeEmitters.values()).map(async a=>{try{await a.callback(e,t)}catch(c){i.push(c)}});if(await Promise.all(o),i.length>0){for(let a=0;a<i.length;a+=1)console.error(i[a]);throw i[0]}}finally{this._debug(s,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await Io(this.storage,this.storageKey,e)}async _removeSession(){this._debug("#_removeSession()"),await Gt(this.storage,this.storageKey),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&je()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),pt);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:r}}=t;if(!r||!r.refresh_token||!r.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const s=Math.floor((r.expires_at*1e3-e)/pt);this._debug("#_autoRefreshTokenTick()",`access token expires in ${s} ticks, a tick lasts ${pt}ms, refresh threshold is ${On} ticks`),s<=On&&await this._callRefreshToken(r.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof xo)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!je()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,r){const s=[`provider=${encodeURIComponent(t)}`];if(r?.redirectTo&&s.push(`redirect_to=${encodeURIComponent(r.redirectTo)}`),r?.scopes&&s.push(`scopes=${encodeURIComponent(r.scopes)}`),this.flowType==="pkce"){const[i,o]=await ut(this.storage,this.storageKey),a=new URLSearchParams({code_challenge:`${encodeURIComponent(i)}`,code_challenge_method:`${encodeURIComponent(o)}`});s.push(a.toString())}if(r?.queryParams){const i=new URLSearchParams(r.queryParams);s.push(i.toString())}return r?.skipBrowserRedirect&&s.push(`skip_http_redirect=${r.skipBrowserRedirect}`),`${e}?${s.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var r;const{data:s,error:i}=t;return i?{data:null,error:i}:await V(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(r=s?.session)===null||r===void 0?void 0:r.access_token})})}catch(t){if(H(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var r,s;const{data:i,error:o}=t;if(o)return{data:null,error:o};const a=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:{issuer:e.issuer}),{data:c,error:u}=await V(this.fetch,"POST",`${this.url}/factors`,{body:a,headers:this.headers,jwt:(r=i?.session)===null||r===void 0?void 0:r.access_token});return u?{data:null,error:u}:(e.factorType==="totp"&&(!((s=c?.totp)===null||s===void 0)&&s.qr_code)&&(c.totp.qr_code=`data:image/svg+xml;utf-8,${c.totp.qr_code}`),{data:c,error:null})})}catch(t){if(H(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r;const{data:s,error:i}=t;if(i)return{data:null,error:i};const{data:o,error:a}=await V(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(r=s?.session)===null||r===void 0?void 0:r.access_token});return a?{data:null,error:a}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+o.expires_in},o)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",o),{data:o,error:a})})}catch(t){if(H(t))return{data:null,error:t};throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r;const{data:s,error:i}=t;return i?{data:null,error:i}:await V(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:(r=s?.session)===null||r===void 0?void 0:r.access_token})})}catch(t){if(H(t))return{data:null,error:t};throw t}})}async _challengeAndVerify(e){const{data:t,error:r}=await this._challenge({factorId:e.factorId});return r?{data:null,error:r}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const r=e?.factors||[],s=r.filter(o=>o.factor_type==="totp"&&o.status==="verified"),i=r.filter(o=>o.factor_type==="phone"&&o.status==="verified");return{data:{all:r,totp:s,phone:i},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,r;const{data:{session:s},error:i}=e;if(i)return{data:null,error:i};if(!s)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:o}=ur(s.access_token);let a=null;o.aal&&(a=o.aal);let c=a;((r=(t=s.user.factors)===null||t===void 0?void 0:t.filter(d=>d.status==="verified"))!==null&&r!==void 0?r:[]).length>0&&(c="aal2");const h=o.amr||[];return{data:{currentLevel:a,nextLevel:c,currentAuthenticationMethods:h},error:null}}))}async fetchJwk(e,t={keys:[]}){let r=t.keys.find(o=>o.kid===e);if(r||(r=this.jwks.keys.find(o=>o.kid===e),r&&this.jwks_cached_at+Ul>Date.now()))return r;const{data:s,error:i}=await V(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(i)throw i;if(!s.keys||s.keys.length===0)throw new It("JWKS is empty");if(this.jwks=s,this.jwks_cached_at=Date.now(),r=s.keys.find(o=>o.kid===e),!r)throw new It("No matching signing key found in JWKS");return r}async getClaims(e,t={keys:[]}){try{let r=e;if(!r){const{data:p,error:v}=await this.getSession();if(v||!p.session)return{data:null,error:v};r=p.session.access_token}const{header:s,payload:i,signature:o,raw:{header:a,payload:c}}=ur(r);if(ac(i.exp),!s.kid||s.alg==="HS256"||!("crypto"in globalThis&&"subtle"in globalThis.crypto)){const{error:p}=await this.getUser(r);if(p)throw p;return{data:{claims:i,header:s,signature:o},error:null}}const u=lc(s.alg),h=await this.fetchJwk(s.kid,t),d=await crypto.subtle.importKey("jwk",h,u,!0,["verify"]);if(!await crypto.subtle.verify(u,d,o,Vl(`${a}.${c}`)))throw new It("Invalid JWT signature");return{data:{claims:i,header:s,signature:o},error:null}}catch(r){if(H(r))return{data:null,error:r};throw r}}}Nt.nextInstanceID=0;const Pc=Nt;class kc extends Pc{constructor(e){super(e)}}var Ac=function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(h){try{u(r.next(h))}catch(d){o(d)}}function c(h){try{u(r.throw(h))}catch(d){o(d)}}function u(h){h.done?i(h.value):s(h.value).then(a,c)}u((r=r.apply(n,e||[])).next())})};class $c{constructor(e,t,r){var s,i,o;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const a=Cl(e),c=new URL(a);this.realtimeUrl=new URL("realtime/v1",c),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",c),this.storageUrl=new URL("storage/v1",c),this.functionsUrl=new URL("functions/v1",c);const u=`sb-${c.hostname.split(".")[0]}-auth-token`,h={db:El,realtime:Pl,auth:Object.assign(Object.assign({},Tl),{storageKey:u}),global:Sl},d=jl(r??{},h);this.storageKey=(s=d.auth.storageKey)!==null&&s!==void 0?s:"",this.headers=(i=d.global.headers)!==null&&i!==void 0?i:{},d.accessToken?(this.accessToken=d.accessToken,this.auth=new Proxy({},{get:(f,p)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(p)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((o=d.auth)!==null&&o!==void 0?o:{},this.headers,d.global.fetch),this.fetch=Rl(t,this._getAccessToken.bind(this),d.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},d.realtime)),this.rest=new Ga(new URL("rest/v1",c).href,{headers:this.headers,schema:d.db.schema,fetch:this.fetch}),d.accessToken||this._listenForAuthEvents()}get functions(){return new Ia(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}get storage(){return new _l(this.storageUrl.href,this.headers,this.fetch)}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},r={}){return this.rest.rpc(e,t,r)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return Ac(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:r}=yield this.auth.getSession();return(t=(e=r.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:null})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:s,storageKey:i,flowType:o,lock:a,debug:c},u,h){const d={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new kc({url:this.authUrl.href,headers:Object.assign(Object.assign({},d),u),storageKey:i,autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:s,flowType:o,lock:a,debug:c,fetch:h,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(e){return new ol(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,r)=>{this._handleTokenChanged(t,"CLIENT",r?.access_token)})}_handleTokenChanged(e,t,r){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==r?this.changedAccessToken=r:e==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const Rc=(n,e,t)=>new $c(n,e,t),Oc=void 0,Cc=void 0;console.log("🔍 Supabase Configuration Check:");console.log("URL:","MISSING");console.log("Anon Key:","MISSING");console.error("❌ Supabase URL or Anon Key is missing. Make sure to set VITE_SUPABASE_URL and VITE_SUPABASE_ANON_KEY in your .env file or Vercel environment variables."),console.error("Current env vars:",{VITE_SUPABASE_URL:!1,VITE_SUPABASE_ANON_KEY:!1});const K=Rc(Oc,Cc,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!1,storageKey:"sb-auth-token",flowType:"pkce",debug:!1},db:{schema:"public"},global:{headers:{"Content-Type":"application/json","X-Client-Info":"supabase-js-web"},fetch:(n,e={})=>{const t=new AbortController,r=setTimeout(()=>t.abort(),15e3);return fetch(n,{...e,signal:t.signal}).finally(()=>{clearTimeout(r)}).catch(s=>{throw console.error("🚨 Supabase request failed:",{url:n,error:s.message,stack:s.stack}),s})}}}),No=async()=>{try{console.log("🔄 Testing Supabase connection...");const{data:n,error:e}=await K.from("watch_history").select("count").limit(1);if(e)return console.error("❌ Supabase connection test failed:",e),!1;const{data:t,error:r}=await K.auth.getSession();return r?(console.error("❌ Auth endpoint test failed:",r),!1):(console.log("✅ Supabase connection and auth endpoint tests successful"),!0)}catch(n){return console.error("❌ Supabase connection test error:",n),!1}},jc=n=>{console.error("🚨 Authentication error:",n);const e={"Invalid API key":"Check your VITE_SUPABASE_ANON_KEY environment variable","Invalid JWT":"Your session may have expired. Try logging in again.","User not found":"This email address is not registered.","Invalid login credentials":"Check your email and password.",NetworkError:"Check your internet connection and try again.","CORS error":"Contact support - there may be a configuration issue."},t=n.message||n.error_description||"Unknown error",r=Object.keys(e).find(s=>t.toLowerCase().includes(s.toLowerCase()));return r&&console.log("💡 Suggested fix:",e[r]),{message:t,suggestion:r?e[r]:"Please try again or contact support"}};typeof window<"u"&&(window.supabase=K,window.testSupabaseConnection=No,window.handleAuthError=jc);const Lo=oo();function Ic({children:n}){const[e,t]=N(null),[r,s]=N(null),[i,o]=N(!0);ee(()=>{(async()=>{const{data:{session:h}}=await K.auth.getSession();t(h),s(h?.user??null),o(!1)})();const{data:u}=K.auth.onAuthStateChange((h,d)=>{t(d),s(d?.user??null)});return()=>{u.subscription.unsubscribe()}},[]);const a={session:e,user:r,signOut:()=>K.auth.signOut()};return l(Lo.Provider,{value:a,children:!i&&n})}function Ve(){return ao(Lo)}let xc=0,yt=null;const Fe={success:(n,e={})=>Kt(n,"success",e),error:(n,e={})=>Kt(n,"error",e),info:(n,e={})=>Kt(n,"info",e),warning:(n,e={})=>Kt(n,"warning",e)},Kt=(n,e="info",t={})=>{if(!yt)return;const r=xc++,s=t.duration||(e==="error"?6e3:4e3),i={id:r,message:n,type:e,duration:s,timestamp:Date.now()};return yt(o=>[...o,i]),setTimeout(()=>{In(r)},s),r},In=n=>{yt&&yt(e=>e.filter(t=>t.id!==n))},Nc=({position:n="top-center"})=>{const[e,t]=N([]);return ee(()=>(yt=t,()=>{yt=null}),[]),e.length===0?null:l("div",{class:`toast-container toast-container--${n}`,children:e.map(r=>l("div",{class:`toast toast--${r.type}`,onClick:()=>In(r.id),children:[l("div",{class:"toast__content",children:[r.type==="success"&&l("span",{class:"toast__icon",children:"✅"}),r.type==="error"&&l("span",{class:"toast__icon",children:"❌"}),r.type==="warning"&&l("span",{class:"toast__icon",children:"⚠️"}),r.type==="info"&&l("span",{class:"toast__icon",children:"ℹ️"}),l("span",{class:"toast__message",children:r.message})]}),l("button",{class:"toast__close",onClick:s=>{s.stopPropagation(),In(r.id)},children:"×"})]},r.id))})},Se={DARK:"dark",LIGHT:"light"},Kn=()=>{const n=localStorage.getItem("theme");return n&&Object.values(Se).includes(n)?n:window.matchMedia("(prefers-color-scheme: dark)").matches?Se.DARK:Se.LIGHT},xn=n=>{Object.values(Se).includes(n)||(console.warn(`Invalid theme: ${n}. Using default dark theme.`),n=Se.DARK),n===Se.LIGHT?document.documentElement.setAttribute("data-theme","light"):document.documentElement.removeAttribute("data-theme"),localStorage.setItem("theme",n),window.dispatchEvent(new CustomEvent("themeChanged",{detail:{theme:n}}))},Lc=()=>{const e=Kn()===Se.LIGHT?Se.DARK:Se.LIGHT;return xn(e),e},Uc=()=>{const n=Kn();xn(n),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",e=>{localStorage.getItem("theme")||xn(e.matches?Se.DARK:Se.LIGHT)})},Ks=n=>{let e;const t=new Set,r=(u,h)=>{const d=typeof u=="function"?u(e):u;if(!Object.is(d,e)){const f=e;e=h??(typeof d!="object"||d===null)?d:Object.assign({},e,d),t.forEach(p=>p(e,f))}},s=()=>e,a={setState:r,getState:s,getInitialState:()=>c,subscribe:u=>(t.add(u),()=>t.delete(u))},c=e=n(r,s,a);return a},Dc=n=>n?Ks(n):Ks,Mc=n=>n;function qc(n,e=Mc){const t=hs.useSyncExternalStore(n.subscribe,()=>e(n.getState()),()=>e(n.getInitialState()));return hs.useDebugValue(t),t}const Vs=n=>{const e=Dc(n),t=r=>qc(e,r);return Object.assign(t,e),t},Fc=n=>n?Vs(n):Vs;function Bc(n,e){let t;try{t=n()}catch{return}return{getItem:s=>{var i;const o=c=>c===null?null:JSON.parse(c,void 0),a=(i=t.getItem(s))!=null?i:null;return a instanceof Promise?a.then(o):o(a)},setItem:(s,i)=>t.setItem(s,JSON.stringify(i,void 0)),removeItem:s=>t.removeItem(s)}}const Nn=n=>e=>{try{const t=n(e);return t instanceof Promise?t:{then(r){return Nn(r)(t)},catch(r){return this}}}catch(t){return{then(r){return this},catch(r){return Nn(r)(t)}}}},Wc=(n,e)=>(t,r,s)=>{let i={storage:Bc(()=>localStorage),partialize:m=>m,version:0,merge:(m,g)=>({...g,...m}),...e},o=!1;const a=new Set,c=new Set;let u=i.storage;if(!u)return n((...m)=>{console.warn(`[zustand persist middleware] Unable to update item '${i.name}', the given storage is currently unavailable.`),t(...m)},r,s);const h=()=>{const m=i.partialize({...r()});return u.setItem(i.name,{state:m,version:i.version})},d=s.setState;s.setState=(m,g)=>{d(m,g),h()};const f=n((...m)=>{t(...m),h()},r,s);s.getInitialState=()=>f;let p;const v=()=>{var m,g;if(!u)return;o=!1,a.forEach(b=>{var _;return b((_=r())!=null?_:f)});const w=((g=i.onRehydrateStorage)==null?void 0:g.call(i,(m=r())!=null?m:f))||void 0;return Nn(u.getItem.bind(u))(i.name).then(b=>{if(b)if(typeof b.version=="number"&&b.version!==i.version){if(i.migrate){const _=i.migrate(b.state,b.version);return _ instanceof Promise?_.then(P=>[!0,P]):[!0,_]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,b.state];return[!1,void 0]}).then(b=>{var _;const[P,C]=b;if(p=i.merge(C,(_=r())!=null?_:f),t(p,!0),P)return h()}).then(()=>{w?.(p,void 0),p=r(),o=!0,c.forEach(b=>b(p))}).catch(b=>{w?.(void 0,b)})};return s.persist={setOptions:m=>{i={...i,...m},m.storage&&(u=m.storage)},clearStorage:()=>{u?.removeItem(i.name)},getOptions:()=>i,rehydrate:()=>v(),hasHydrated:()=>o,onHydrate:m=>(a.add(m),()=>{a.delete(m)}),onFinishHydration:m=>(c.add(m),()=>{c.delete(m)})},i.skipHydration||v(),p||f},Hc=Wc,Ln="https://image.tmdb.org/t/p/w500",Gc=()=>"/api",be=Gc();function Un(n){return n?`${be}/image-proxy?url=${encodeURIComponent(n)}`:""}console.log(`🚀 API Base URL: ${be}`);console.log("🌍 Environment: production");const Le=async()=>{let e=0;for(;e<2;)try{const t=new Promise((o,a)=>setTimeout(()=>a(new Error("Auth timeout")),5e3)),r=K.auth.getSession(),{data:{session:s},error:i}=await Promise.race([r,t]);if(i){if(console.error("Error getting current session:",i),i.message&&i.message.includes("NetworkError")&&e<1){e++,console.log(`Retrying auth session (attempt ${e+1}/2)`),await new Promise(o=>setTimeout(o,500*e));continue}return null}return s?.user?.id||null}catch(t){if(console.error("Error in getCurrentUserId:",t),t.message&&(t.message.includes("NetworkError")||t.message.includes("timeout"))&&e<1){e++,console.log(`Retrying auth due to network error (attempt ${e+1}/2)`),await new Promise(r=>setTimeout(r,500*e));continue}return null}return console.error("Failed to get user session after all retry attempts"),null},Kc=async()=>{let e=0;for(;e<3;)try{const t=await Le();if(!t)return console.log("No authenticated user, returning empty watch history"),[];const r=new Promise((a,c)=>setTimeout(()=>c(new Error("Request timeout")),1e4)),s=K.from("watch_history").select("*").eq("user_id",t).order("watched_at",{ascending:!1}),{data:i,error:o}=await Promise.race([s,r]);if(o){if(console.error("Error fetching watch history:",o),o.message&&o.message.includes("NetworkError")&&e<2){e++,console.log(`Retrying watch history fetch (attempt ${e+1}/3)`),await new Promise(a=>setTimeout(a,1e3*e));continue}return[]}return i||[]}catch(t){if(console.error("Error in getWatchHistory:",t),t.message&&(t.message.includes("NetworkError")||t.message.includes("timeout"))&&e<2){e++,console.log(`Retrying watch history fetch due to network error (attempt ${e+1}/3)`),await new Promise(r=>setTimeout(r,1e3*e));continue}return[]}return console.error("Failed to fetch watch history after all retry attempts"),[]},hr=async(n,e,t,r)=>{try{const s=await Le();if(!s)return console.log("No authenticated user, returning null progress"),null;let i=K.from("watch_progress").select("progress_seconds, duration_seconds").eq("user_id",s).eq("media_id",n).eq("media_type",e);e!=="movie"&&(i=i.eq("season_number",t).eq("episode_number",r));const{data:o,error:a}=await i;return a?(console.error("Error fetching watch progress:",a),null):o&&o.length>0?o[0]:null}catch(s){return console.error("Error in getWatchProgressForMedia:",s),null}},Vc=async()=>{try{const n=await Le();if(!n)return console.log("No authenticated user, returning empty continue watching list"),[];console.log("🔍 Fetching continue watching from watch_history...");const{data:e,error:t}=await K.from("watch_history").select("media_id, media_type, season_number, episode_number, watched_at").eq("user_id",n).order("watched_at",{ascending:!1});if(t)return console.error("Error fetching watch history for continue watching:",t),[];if(!e||e.length===0)return console.log("📭 No watch history found"),[];console.log(`📊 Found ${e.length} watch history entries`);const r=new Map;e.forEach(u=>{const h=u.media_id;r.has(h)||r.set(h,[]),r.get(h).push(u)});const s=[];for(const[u,h]of r){const f=h.sort((p,v)=>p.media_type==="movie"?new Date(v.watched_at)-new Date(p.watched_at):p.season_number!==v.season_number?(v.season_number||0)-(p.season_number||0):(v.episode_number||0)-(p.episode_number||0))[0];console.log(`📺 Most advanced for media ${u}: S${f.season_number}E${f.episode_number} (${f.media_type})`),s.push(f)}const o=(await Promise.all(s.map(async u=>{try{let h=K.from("watch_progress").select("progress_seconds, duration_seconds, updated_at").eq("user_id",n).eq("media_id",u.media_id).eq("media_type",u.media_type);u.media_type!=="movie"&&(h=h.eq("season_number",u.season_number).eq("episode_number",u.episode_number));const{data:d,error:f}=await h;if(f)return console.error(`Error fetching progress for ${u.media_id}:`,f),null;const p=d&&d.length>0?d[0]:null,v=p&&p.progress_seconds>30,m=new Date(u.watched_at)>new Date(Date.now()-7*24*60*60*1e3);if(v||m){if(p&&p.duration_seconds>0&&p.progress_seconds/p.duration_seconds>=.9){if(u.media_type!=="movie"){const w=await Uo(u.media_id,u.season_number,u.episode_number,u.media_type);if(w)return console.log(`✅ Episode completed, suggesting next: S${w.season}E${w.episode}`),{...u,season_number:w.season,episode_number:w.episode,progress_seconds:0,duration_seconds:null,updated_at:p.updated_at}}return null}return{...u,progress_seconds:p?.progress_seconds||0,duration_seconds:p?.duration_seconds||null,updated_at:p?.updated_at||u.watched_at}}return null}catch(h){return console.error(`Error processing continue watching entry for ${u.media_id}:`,h),null}}))).filter(Boolean).sort((u,h)=>new Date(h.updated_at)-new Date(u.updated_at));console.log(`📺 Found ${o.length} valid continue watching entries`);const c=(await Promise.all(o.map(async u=>{try{const h=await fetch(`${be}/tmdb/${u.media_type}/${u.media_id}`);return h.ok?{...await h.json(),type:u.media_type,progress_seconds:u.progress_seconds,duration_seconds:u.duration_seconds,season_number:u.season_number,episode_number:u.episode_number,updated_at:u.updated_at,media_id:u.media_id}:null}catch(h){return console.error("Error fetching TMDB details for continue watching item:",h),null}}))).filter(Boolean);return console.log(`🎬 Returning ${c.length} continue watching items`),c}catch(n){return console.error("Error in getContinueWatching:",n),[]}},zs=async(n,e,t,r=!1)=>{const s=await Le();if(!s)return console.error("❌ Cannot save watch progress: No authenticated user"),!1;if(!n||typeof e>"u"||e<0)return console.error("❌ Invalid progress data:",{item:n,progress:e,durationInSeconds:t}),!1;const i={p_media_id:n.id,p_media_type:n.type,p_season_number:n.season||null,p_episode_number:n.episode||null,p_progress_seconds:e>0?Math.ceil(e):0,p_duration_seconds:t?Math.round(t):null,p_force_history_entry:r};console.log("💾 Saving watch progress (v2) via RPC...",i);const{error:o}=await K.rpc("save_watch_progress",i);if(o)console.error(`❌ RPC (v2) failed. Error: ${o.message}. Details:`,o);else return console.log("✅ Watch progress saved successfully via RPC (v2). RPC Error object was:",o),!0;console.log("⚠️ RPC (v2) failed, trying legacy (v1) RPC...");const{p_force_history_entry:a,...c}=i,{error:u}=await K.rpc("save_watch_progress",c);if(u)console.error(`❌ RPC (v1) also failed. Error: ${u.message}. Details:`,u);else return console.log("✅ Watch progress saved successfully via RPC (v1)"),!0;console.log("⚠️ Both RPC methods failed, attempting direct DB write fallback...");try{if(await zc(s,n,e,t,r))return console.log("✅ Watch progress saved successfully via direct DB fallback"),!0;console.error("❌ Direct DB write fallback reported failure.")}catch(h){console.error("❌ Direct DB write fallback threw an exception:",h)}return console.error("❌ All methods to save progress failed for media:",{item:n,progress:e,durationInSeconds:t}),!1},zc=async(n,e,t,r,s)=>{try{console.log("🔄 Using direct database fallback for watch progress");const{error:i}=await K.from("watch_progress").upsert({user_id:n,media_id:e.id,media_type:e.type,season_number:e.season||null,episode_number:e.episode||null,progress_seconds:t>0?Math.ceil(t):0,duration_seconds:r?Math.round(r):null,updated_at:new Date().toISOString()},{onConflict:"user_id,media_id,media_type,season_number,episode_number"});if(i)return console.error("❌ Direct progress insert error:",i),!1;if(s||t>60){const{error:o}=await K.from("watch_history").upsert({user_id:n,media_id:e.id,media_type:e.type,season_number:e.season||null,episode_number:e.episode||null,watched_at:new Date().toISOString()},{onConflict:"user_id,media_id,media_type,season_number,episode_number"});o&&console.error("❌ Direct history insert error:",o)}return console.log("✅ Watch progress saved via direct database fallback"),!0}catch(i){return console.error("❌ Direct database fallback failed:",i),!1}},Jc=async n=>{try{const e=await Le();if(!e){console.log("Cannot add watch history entry: No authenticated user");return}if(!n)return;const{error:t}=await K.from("watch_history").upsert({user_id:e,media_id:n.id,media_type:n.type,season_number:n.season||null,episode_number:n.episode||null,watched_at:new Date().toISOString()},{onConflict:"user_id,media_id,media_type,season_number,episode_number"});t&&console.error("Error adding watch history entry:",t)}catch(e){console.error("Unexpected error adding watch history entry:",e)}},Yc=async n=>{try{if(!n)return;if(!await Le()){console.log("Cannot delete watch item: No authenticated user");return}const{error:t}=await K.rpc("delete_watch_item",{p_media_id:n.media_id,p_media_type:n.media_type,p_season_number:n.season_number,p_episode_number:n.episode_number});t&&console.error("Error deleting watch item:",t)}catch(e){console.error("Error in deleteWatchItem:",e)}},Qc=async n=>{try{const e=await Le();if(!e)return[];const{data:t,error:r}=await K.from("watch_progress").select("media_id, media_type, season_number, episode_number, progress_seconds, duration_seconds").eq("user_id",e).eq("media_id",n);return r?(console.error("Error fetching series history:",r),[]):t||[]}catch(e){return console.error("Error in getSeriesHistory:",e),[]}},Uo=async(n,e,t,r="tv")=>{try{const s=r==="anime"?"tv":r,i=await fetch(`${be}/tmdb/${s}/${n}`);if(!i.ok)return console.error(`Failed to fetch series details: ${i.status}`),null;const o=await i.json();if(!o.seasons||o.seasons.length===0)return console.error("No seasons found in series details"),null;const a=await fetch(`${be}/tmdb/${s}/${n}/season/${e}`);if(!a.ok)return console.error(`Failed to fetch season ${e} details: ${a.status}`),null;const c=await a.json();if(!c.episodes||c.episodes.length===0)return console.error(`No episodes found in season ${e}`),null;const u=c.episodes.length;if(console.log(`Current season ${e} has ${u} episodes, current episode: ${t}`),t<u)return console.log(`Next episode: S${e}E${t+1}`),{season:e,episode:t+1};const d=o.seasons.filter(f=>f.season_number>0).find(f=>f.season_number===e+1);return d&&d.episode_count>0?(console.log(`Next season found: S${d.season_number}E1`),{season:d.season_number,episode:1}):(console.log("No next episode available - series may be completed"),null)}catch(s){return console.error("Error getting next episode:",s),null}},Xc=async n=>{try{const e=await Le();if(!e)return console.log("No authenticated user, returning null for last watched episode with progress"),null;console.log(`🔍 [CW] Looking for last watched episode for series ${n}`);const{data:t,error:r}=await K.from("watch_history").select("season_number, episode_number, watched_at, media_type").eq("user_id",e).eq("media_id",n).order("watched_at",{ascending:!1}).limit(1);if(r)return console.error("❌ [CW] Error fetching watch history:",r),null;if(!t||t.length===0)return console.log("📭 [CW] No episodes found in watch history for this series."),null;const s=t[0];console.log(`📺 [CW] Most recent interaction: S${s.season_number}E${s.episode_number} (at ${s.watched_at})`);const{data:i,error:o}=await K.from("watch_progress").select("progress_seconds, duration_seconds").eq("user_id",e).eq("media_id",n).eq("season_number",s.season_number).eq("episode_number",s.episode_number).limit(1);if(o)return console.error("❌ [CW] Error fetching progress data:",o),{season:s.season_number,episode:s.episode_number};const a=i&&i.length>0?i[0]:null;if(a&&a.duration_seconds>0){const c=a.progress_seconds/a.duration_seconds,u=a.duration_seconds-a.progress_seconds,f=c>=.9&&u<=60;if(console.log(`📊 [CW] Progress: ${(c*100).toFixed(1)}%, Time left: ${u}s - ${f?"COMPLETED":"INCOMPLETE"}`),f){console.log(`✅ [CW] Episode S${s.season_number}E${s.episode_number} is completed. Finding next...`);const p=await Uo(n,s.season_number,s.episode_number,s.media_type);return p?(console.log(`🎯 [CW] Next episode is S${p.season}E${p.episode}.`),p):(console.log('🏁 [CW] Series finished. No "continue watching" target.'),null)}else return console.log(`⏯️ [CW] Resuming incomplete episode S${s.season_number}E${s.episode_number}.`),{season:s.season_number,episode:s.episode_number}}else return console.log(`📝 [CW] No meaningful progress found. Suggesting last touched episode: S${s.season_number}E${s.episode_number}`),{season:s.season_number,episode:s.episode_number}}catch(e){return console.error("❌ [CW] Unexpected error in getLastWatchedEpisodeWithProgress:",e),null}},Do=async n=>{try{const e=await Le();if(!e||!n||n.length===0)return{};const t={};return await Promise.all(n.map(async r=>{try{let s=K.from("watch_progress").select("progress_seconds, duration_seconds").eq("user_id",e).eq("media_id",r.media_id).eq("media_type",r.media_type);r.media_type==="tv"&&(r.season_number!=null&&(s=s.eq("season_number",r.season_number)),r.episode_number!=null&&(s=s.eq("episode_number",r.episode_number)));const{data:i,error:o}=await s;if(o)console.error(`Error fetching progress for ${r.media_type} ${r.media_id}:`,o);else if(i&&i.length>0){const a=i[0],c=`${r.media_id}-${r.media_type}-${r.season_number||0}-${r.episode_number||0}`;a.progress_seconds>=0&&a.duration_seconds>0&&(t[c]={progress_seconds:a.progress_seconds,duration_seconds:a.duration_seconds})}}catch(s){console.error(`Error fetching progress for item ${r.media_id}:`,s)}})),t}catch(e){return console.error("Error in getProgressForHistoryItems:",e),{}}},Zc=async()=>{let e=0;for(;e<3;)try{const t=await Le();if(!t)return console.log("No authenticated user, returning empty watch history with progress"),[];console.log("🔄 Fetching combined watch history and progress data...");const[r,s]=await Promise.all([K.from("watch_history").select("*").eq("user_id",t).order("watched_at",{ascending:!1}),K.from("watch_progress").select("media_id, media_type, season_number, episode_number, progress_seconds, duration_seconds").eq("user_id",t)]);if(r.error)throw r.error;s.error&&console.warn("Error fetching progress data, continuing without progress:",s.error);const i=r.data||[],o=s.data||[],a={};o.forEach(u=>{const h=`${u.media_id}-${u.media_type}-${u.season_number||0}-${u.episode_number||0}`;a[h]=u});const c=i.map(u=>{const h=`${u.media_id}-${u.media_type}-${u.season_number||0}-${u.episode_number||0}`,d=a[h];return{...u,progress_seconds:d?.progress_seconds||null,duration_seconds:d?.duration_seconds||null}});return console.log("✅ Successfully fetched combined data:",{totalItems:c.length,itemsWithProgress:c.filter(u=>u.progress_seconds>0).length}),c}catch(t){if(console.error("Error in getWatchHistoryWithProgress:",t),t.message&&(t.message.includes("NetworkError")||t.message.includes("timeout"))&&e<2){e++,console.log(`Retrying combined fetch due to network error (attempt ${e+1}/3)`),await new Promise(r=>setTimeout(r,1e3*e));continue}try{console.log("📋 All retries failed, trying fallback approach...");const r=await Kc(),s=await Do(r);return r.map(i=>{const o=`${i.media_id}-${i.media_type}-${i.season_number||0}-${i.episode_number||0}`,a=s[o];return{...i,progress_seconds:a?.progress_seconds||null,duration_seconds:a?.duration_seconds||null}})}catch(r){return console.error("Fallback approach also failed:",r),[]}}return console.error("Failed to fetch combined watch history and progress after all retry attempts"),[]},Ze=async(n,e=3)=>{let t=[];for(let r=1;r<=e;r++)try{const s=await fetch(`${n}?page=${r}`);if(s.ok){const i=await s.json();t=[...t,...i.results||[]]}}catch(s){console.error(`Error fetching page ${r} from ${n}:`,s)}return t},qe=Fc(Hc((n,e)=>({trending:[],popularMovies:[],popularTv:[],topRatedMovies:[],topRatedTv:[],upcomingMovies:[],nowPlayingMovies:[],airingTodayTv:[],favorites:[],favoritesFetched:!1,favoritedMedia:new Set,currentMediaItem:null,continueWatching:[],continueWatchingFetched:!1,fetchContinueWatching:async()=>{const{data:{user:t}}=await K.auth.getUser();if(!t){n({continueWatching:[],continueWatchingFetched:!0});return}const r=await Vc();if(!r||r.length===0){n({continueWatching:[],continueWatchingFetched:!0});return}const s=r.reduce((i,o)=>(i.some(a=>a.media_id===o.media_id)||i.push(o),i),[]);n({continueWatching:s,continueWatchingFetched:!0})},removeContinueWatchingItem:t=>{n(r=>({continueWatching:r.continueWatching.filter(s=>s.media_id!==t)}))},setCurrentMediaItem:t=>n({currentMediaItem:t}),fetchTrending:async()=>{if(!(e().trending.length>0))try{const t=await fetch("/api/tmdb/trending/all/week");if(t.ok){const r=await t.json();n({trending:r.results||[]})}}catch(t){console.error("Error fetching trending:",t)}},fetchPopularMovies:async()=>{if(e().popularMovies.length>0)return;const t=await Ze("/api/tmdb/movie/popular");n({popularMovies:t})},fetchPopularTv:async()=>{if(e().popularTv.length>0)return;const t=await Ze("/api/tmdb/tv/popular");n({popularTv:t})},fetchTopRatedMovies:async()=>{if(e().topRatedMovies.length>0)return;const t=await Ze("/api/tmdb/movie/top_rated");n({topRatedMovies:t})},fetchTopRatedTv:async()=>{if(e().topRatedTv.length>0)return;const t=await Ze("/api/tmdb/tv/top_rated");n({topRatedTv:t})},fetchUpcomingMovies:async()=>{if(e().upcomingMovies.length>0)return;const t=await Ze("/api/tmdb/movie/upcoming");n({upcomingMovies:t})},fetchNowPlayingMovies:async()=>{if(e().nowPlayingMovies.length>0)return;const t=await Ze("/api/tmdb/movie/now_playing");n({nowPlayingMovies:t})},fetchAiringTodayTv:async()=>{if(e().airingTodayTv.length>0)return;const t=await Ze("/api/tmdb/tv/airing_today");n({airingTodayTv:t})},fetchFavorites:async()=>{const{data:{user:t}}=await K.auth.getUser();if(!t){n({favorites:[],favoritesFetched:!0});return}const{data:r,error:s}=await K.from("favorites").select("media_id, media_type").eq("user_id",t.id);if(s){console.error("Error fetching favorites:",s),n({favoritesFetched:!0});return}const i=new Set(r.map(a=>`${a.media_id}-${a.media_type}`));n({favoritedMedia:i,favoritesFetched:!0});const o=await Promise.all(r.map(async a=>{try{const c=await fetch(`/api/tmdb/${a.media_type}/${a.media_id}`);return c.ok?{...await c.json(),type:a.media_type}:null}catch(c){return console.warn(`Could not fetch details for favorited item ${a.media_type}:${a.media_id}. It will not appear in the favorites list.`,c),null}}));n({favorites:o.filter(Boolean)})},isFavorited:(t,r)=>r==="tv"||r==="anime"?e().favoritedMedia.has(`${t}-tv`):e().favoritedMedia.has(`${t}-${r}`),addFavorite:async t=>{const{data:{user:r}}=await K.auth.getUser();if(!r)return;const{id:s,type:i}=t,o=`${s}-${i}`;if(e().favoritedMedia.has(o))return;n(c=>({favorites:[t,...c.favorites],favoritedMedia:new Set(c.favoritedMedia).add(o)}));const{error:a}=await K.from("favorites").insert({user_id:r.id,media_id:s,media_type:i});a&&(console.error("Error adding favorite:",a),n(c=>{const u=new Set(c.favoritedMedia);return u.delete(o),{favoritedMedia:u,favorites:c.favorites.filter(h=>h.id!==s||h.type!==i)}}))},removeFavorite:async(t,r)=>{const{data:{user:s}}=await K.auth.getUser();if(!s)return;const i=`${t}-${r}`;n(a=>{const c=new Set(a.favoritedMedia);return c.delete(i),{favoritedMedia:c,favorites:a.favorites.filter(u=>!(u.id===t&&u.type===r))}});const{error:o}=await K.from("favorites").delete().match({user_id:s.id,media_id:t,media_type:r});o&&(console.error("Error removing favorite:",o),n(a=>({...a,favorites:e().favorites,favoritedMedia:e().favoritedMedia})))}}),{name:"freestream-storage",storage:localStorage,partialize:n=>({favorites:n.favorites,favoritedMedia:n.favoritedMedia,trending:n.trending,popularMovies:n.popularMovies,popularTv:n.popularTv,topRatedMovies:n.topRatedMovies,topRatedTv:n.topRatedTv,upcomingMovies:n.upcomingMovies,nowPlayingMovies:n.nowPlayingMovies,airingTodayTv:n.airingTodayTv,continueWatching:n.continueWatching})})),eu=()=>{const[n,e]=N(!0);return ee(()=>{const r=Kn();e(r===Se.DARK);const s=i=>{e(i.detail.theme===Se.DARK)};return window.addEventListener("themeChanged",s),()=>{window.removeEventListener("themeChanged",s)}},[]),l("button",{class:`theme-toggle ${n?"dark":"light"}`,onClick:()=>{const r=Lc();e(r===Se.DARK)},"aria-label":`Switch to ${n?"light":"dark"} mode`,title:`Switch to ${n?"light":"dark"} mode`,children:l("div",{class:"toggle-track",children:l("div",{class:"toggle-thumb",children:l("div",{class:"icon",children:n?l("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:l("path",{d:"M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"})}):l("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[l("circle",{cx:"12",cy:"12",r:"5"}),l("line",{x1:"12",y1:"1",x2:"12",y2:"3"}),l("line",{x1:"12",y1:"21",x2:"12",y2:"23"}),l("line",{x1:"4.22",y1:"4.22",x2:"5.64",y2:"5.64"}),l("line",{x1:"18.36",y1:"18.36",x2:"19.78",y2:"19.78"}),l("line",{x1:"1",y1:"12",x2:"3",y2:"12"}),l("line",{x1:"21",y1:"12",x2:"23",y2:"12"}),l("line",{x1:"4.22",y1:"19.78",x2:"5.64",y2:"18.36"}),l("line",{x1:"18.36",y1:"5.64",x2:"19.78",y2:"4.22"})]})})})})})},tu=()=>{const[n,e]=N(""),[t,r]=N(!1),[s,i]=N(!1),{user:o,signOut:a}=Ve(),c=ge(null),u=ge(null),h=ge(null),d=g=>{g.preventDefault(),n.trim()&&(Ae(`/search?q=${encodeURIComponent(n.trim())}`),e(""),i(!1),r(!1))},f=async()=>{await a(),Ae("/"),r(!1)},p=()=>{const g=!s;i(g),r(!1),g?document.body.classList.add("menu-open"):document.body.classList.remove("menu-open")},v=()=>{const g=!t;r(g),i(!1),g?document.body.classList.add("menu-open"):document.body.classList.remove("menu-open")},m=()=>{r(!1),i(!1),document.body.classList.remove("menu-open")};return ee(()=>{const g=Ae,w=(...b)=>(m(),g(...b));return Object.keys(g).forEach(b=>{w[b]=g[b]}),window.route=w,()=>{window.route=g}},[]),ee(()=>{const g=_=>{t&&c.current&&!c.current.contains(_.target)&&!u.current.contains(_.target)&&m(),s&&h.current&&!h.current.contains(_.target)&&(i(!1),document.body.classList.remove("menu-open"))},w=_=>{_.key==="Escape"&&(t?m():s&&(i(!1),document.body.classList.remove("menu-open")))},b=()=>{window.innerWidth>768&&m()};return(t||s)&&(document.addEventListener("mousedown",g),document.addEventListener("keydown",w),window.addEventListener("resize",b)),()=>{document.removeEventListener("mousedown",g),document.removeEventListener("keydown",w),window.removeEventListener("resize",b)}},[t,s]),ee(()=>{t&&c.current?.querySelector("a, button")?.focus()},[t]),ee(()=>(t||s?(document.body.style.overflow="hidden",document.body.style.position="fixed",document.body.style.width="100%",document.body.style.height="100%"):(document.body.style.overflow="",document.body.style.position="",document.body.style.width="",document.body.style.height=""),()=>{document.body.style.overflow="",document.body.style.position="",document.body.style.width="",document.body.style.height=""}),[t,s]),l("header",{class:t?"scrolled":"",children:l("div",{class:"container",children:[l("div",{class:"header-left",children:[l(Ne,{href:"/",class:"logo",onClick:m,children:"FreeStream"}),l("nav",{ref:c,class:t?"active":"","aria-hidden":!t,children:l("ul",{children:[l("li",{children:l(Ne,{activeClassName:"active",href:"/movies",onClick:m,children:"Movies"})}),l("li",{children:l(Ne,{activeClassName:"active",href:"/tv",onClick:m,children:"TV"})}),o?l(gt,{children:[l("li",{children:l(Ne,{activeClassName:"active",href:"/favorites",onClick:m,children:"Favorites"})}),l("li",{children:l(Ne,{activeClassName:"active",href:"/history",onClick:m,children:"History"})})]}):l(gt,{children:[l("li",{children:l("a",{href:"/login",style:{color:"#999",fontSize:"0.9em"},onClick:m,children:"Favorites (Login Required)"})}),l("li",{children:l("a",{href:"/login",style:{color:"#999",fontSize:"0.9em"},onClick:m,children:"History (Login Required)"})})]})]})})]}),s&&l("div",{ref:h,class:"mobile-search-overlay",children:l("form",{class:"mobile-search-form",onSubmit:d,children:[l("input",{type:"text",placeholder:"Search movies & TV shows...",value:n,onInput:g=>e(g.target.value),class:"mobile-search-input",autoFocus:!0}),l("button",{type:"submit",class:"mobile-search-submit",children:l("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2",children:[l("circle",{cx:"11",cy:"11",r:"8"}),l("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"})]})})]})}),t&&l("div",{class:"mobile-menu-backdrop",onClick:m}),l("div",{class:"header-right",children:[l("form",{class:"search-container desktop-only",onSubmit:d,children:l("input",{type:"text",placeholder:"Search...",value:n,onInput:g=>e(g.target.value),class:"glass-light"})}),l("button",{class:"search-toggle mobile-only",onClick:p,"aria-label":"Toggle search",children:l("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2",children:[l("circle",{cx:"11",cy:"11",r:"8"}),l("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"})]})}),l(eu,{}),l("div",{class:"auth-links",children:o?l(gt,{children:[l("span",{class:"user-email",children:o.email}),l("button",{onClick:f,class:"auth-button",children:"Logout"})]}):l(gt,{children:[l(Ne,{href:"/login",class:"auth-link",onClick:m,children:"Login"}),l(Ne,{href:"/signup",class:"auth-link",onClick:m,children:"Sign Up"})]})})]}),l("button",{ref:u,class:`hamburger ${t?"active":""}`,onClick:v,"aria-label":"Toggle menu","aria-expanded":t,"aria-controls":"mobile-menu",children:[l("span",{class:"bar"}),l("span",{class:"bar"}),l("span",{class:"bar"})]})]})})};var ru=["className","activeClass","activeClassName","path"];function We(n){var e=n.className,t=n.activeClass,r=n.activeClassName,s=n.path,i=function(h,d){if(h==null)return{};var f,p,v={},m=Object.keys(h);for(p=0;p<m.length;p++)d.indexOf(f=m[p])>=0||(v[f]=h[f]);return v}(n,ru),o=ba()[0],a=s&&o.path&&En(o.path,s,{})||En(o.url,i.href,{}),c=i.class||e||"",u=a&&(t||r)||"";return i.class=c+(c&&u&&" ")+u,Dn(Ne,i)}const nu=()=>l("footer",{class:"app-footer",children:[l("div",{class:"footer-content",children:[l("div",{class:"footer-brand",children:[l(We,{href:"/",class:"logo",children:"FreeStream"}),l("p",{children:"Your gateway to unlimited entertainment. Built with passion."})]}),l("div",{class:"footer-links",children:[l("div",{class:"footer-section",children:[l("h4",{children:"Platform"}),l("ul",{children:[l("li",{children:l(We,{href:"/",children:"Home"})}),l("li",{children:l(We,{href:"/movies",children:"Movies"})}),l("li",{children:l(We,{href:"/tv",children:"TV Shows"})})]})]}),l("div",{class:"footer-section",children:[l("h4",{children:"Account"}),l("ul",{children:[l("li",{children:l(We,{href:"/login",children:"Login"})}),l("li",{children:l(We,{href:"/signup",children:"Sign Up"})}),l("li",{children:l(We,{href:"/favorites",children:"Favorites"})})]})]}),l("div",{class:"footer-section",children:[l("h4",{children:"Legal"}),l("ul",{children:[l("li",{children:l("a",{href:"#",children:"Terms of Service"})}),l("li",{children:l("a",{href:"#",children:"Privacy Policy"})})]})]})]})]}),l("div",{class:"footer-bottom",children:[l("p",{children:"© 2024 FreeStream. All Rights Reserved. Not a real streaming service."}),l("div",{class:"footer-socials",children:[l("a",{href:"#","aria-label":"Github",children:l("i",{class:"fab fa-github"})}),l("a",{href:"#","aria-label":"Twitter",children:l("i",{class:"fab fa-twitter"})})]})]})]}),_t=({item:n,type:e,progress:t,duration:r,showDeleteButton:s,onDelete:i})=>{const{id:o,title:a,name:c,poster_path:u,still_path:h,vote_average:d,episode_name:f,season_number:p,episode_number:v,first_air_date:m,release_date:g,number_of_seasons:w}=n,b=h||u,_=c||a,P=t&&r>0?t/r*100:0,C=g||m?new Date(g||m).getFullYear():null,{user:L}=Ve(),{addFavorite:q,removeFavorite:T,isFavorited:B,favoritesFetched:G}=qe(),W=B(n.id,e,n.season_number,n.episode_number),Z=ve=>{ve.preventDefault(),ve.stopPropagation(),W?T(n.id,e,n.season_number,n.episode_number):q({...n,type:e})};let ae=`/watch/${e}/${n.id}`;e==="tv"&&n.season_number&&n.episode_number&&(ae+=`/season/${n.season_number}/episode/${n.episode_number}`);const ce=e==="tv"&&p&&v?`S${p} E${v}${f?`: ${f}`:""}`:e==="tv"&&w?`${C||"Unknown"} • ${w} Season${w!==1?"s":""}`:e==="movie"&&C?C.toString():null;return l("div",{className:"movie-card-container",children:l(We,{href:ae,className:"movie-card",children:l("div",{className:"poster-wrapper",children:[l("img",{src:Un(b?`${Ln}${b}`:"https://via.placeholder.com/500x750/1a1a1a/ffffff?text=No+Image"),alt:_,loading:"lazy"}),l("div",{className:"scrim"}),P>.01&&l("div",{className:"progress-bar-container",children:l("div",{className:"progress-bar",style:{width:`${Math.min(P,100)}%`}})}),l("div",{className:"card-info",children:[l("div",{className:"title-row",children:[l("h3",{className:"card-title",children:_}),L&&l("button",{className:`favorite-btn ${W?"favorited":""}`,onClick:Z,"aria-label":W?"Remove from favorites":"Add to favorites",disabled:!G,children:G?"♥︎":"..."})]}),ce&&l("p",{className:"card-subtitle",children:ce}),l("span",{className:"rating",children:["★ ",d?d.toFixed(1):"N/A"]})]}),s&&l("button",{className:"delete-btn",onClick:ve=>{ve.preventDefault(),ve.stopPropagation(),i&&i(n)},children:"×"})]})})})},su=()=>l("div",{class:"features-showcase",children:[l("div",{class:"features-hero",children:l("div",{class:"features-hero-content",children:[l("h2",{class:"features-title",children:l("span",{class:"gradient-text",children:"Sign in for the full experience"})}),l("p",{class:"features-subtitle",children:"Get personalized recommendations, track your progress, and never lose your place"})]})}),l("div",{class:"features-grid",children:[{icon:"⏯️",title:"Continue Watching",description:"Pick up exactly where you left off across all your devices. Never lose your place again.",highlight:!0},{icon:"❤️",title:"Favorites Collection",description:"Save your favorite movies and TV shows in one place for quick access anytime.",highlight:!1},{icon:"📚",title:"Watch History",description:"Keep track of everything you've watched and easily find content you enjoyed.",highlight:!1},{icon:"🎯",title:"Personal Progress",description:"Sync your watch progress across devices and resume on any screen seamlessly.",highlight:!1},{icon:"🔍",title:"Smart Recommendations",description:"Get personalized suggestions based on your viewing history and preferences.",highlight:!1},{icon:"⚡",title:"Enhanced Experience",description:"Unlock the full potential of FreeStream with user-specific features and settings.",highlight:!1}].map((e,t)=>l("div",{class:`feature-card ${e.highlight?"featured":""}`,children:[l("div",{class:"feature-icon",children:e.icon}),l("h3",{class:"feature-title",children:e.title}),l("p",{class:"feature-description",children:e.description})]},t))}),l("div",{class:"features-footer",children:[l("div",{class:"features-stats",children:[l("div",{class:"stat",children:[l("span",{class:"stat-number",children:"10K+"}),l("span",{class:"stat-label",children:"Movies & Shows"})]}),l("div",{class:"stat",children:[l("span",{class:"stat-number",children:"4K"}),l("span",{class:"stat-label",children:"Ultra HD Quality"})]}),l("div",{class:"stat",children:[l("span",{class:"stat-number",children:"∞"}),l("span",{class:"stat-label",children:"Unlimited Access"})]})]}),l("p",{class:"features-note",children:[l(Ne,{href:"/login",class:"subtle-link",children:"Sign in"})," or ",l(Ne,{href:"/signup",class:"subtle-link",children:"create an account"})," to unlock these features"]})]})]}),Mo=({size:n="medium",text:e="Loading..."})=>{const t={small:"spinner-small",medium:"spinner-medium",large:"spinner-large"}[n];return l("div",{class:"loading-container",children:[l("div",{class:`loading-spinner ${t}`,children:[l("div",{class:"spinner-ring"}),l("div",{class:"spinner-ring"}),l("div",{class:"spinner-ring"}),l("div",{class:"spinner-ring"})]}),e&&l("p",{class:"loading-text",children:e})]})},iu=()=>{const{user:n}=Ve();if(!n)return null;const e=()=>{const r=new Date().getHours();return r<12?"Good morning":r<17?"Good afternoon":"Good evening"},t=()=>n.user_metadata?.full_name?n.user_metadata.full_name.split(" ")[0]:n.email.split("@")[0];return l("div",{class:"welcome-message",children:[l("div",{class:"welcome-content",children:[l("h2",{class:"welcome-title",children:[e(),", ",l("span",{class:"user-name",children:t()}),"!"]}),l("p",{class:"welcome-subtitle",children:"What would you like to watch today?"})]}),l("div",{class:"welcome-stats",children:[l("div",{class:"stat-item",children:[l("span",{class:"stat-icon",children:"🎬"}),l("span",{class:"stat-text",children:"Unlimited Movies"})]}),l("div",{class:"stat-item",children:[l("span",{class:"stat-icon",children:"📺"}),l("span",{class:"stat-text",children:"TV Shows"})]}),l("div",{class:"stat-item",children:[l("span",{class:"stat-icon",children:"⚡"}),l("span",{class:"stat-text",children:"HD Streaming"})]})]})]})},fr=n=>{const{trending:e,popularMovies:t,popularTv:r,topRatedMovies:s,topRatedTv:i,upcomingMovies:o,nowPlayingMovies:a,airingTodayTv:c,fetchTrending:u,fetchPopularMovies:h,fetchPopularTv:d,fetchTopRatedMovies:f,fetchTopRatedTv:p,fetchUpcomingMovies:v,fetchNowPlayingMovies:m,fetchAiringTodayTv:g,continueWatching:w,continueWatchingFetched:b,fetchContinueWatching:_,fetchFavorites:P,favoritesFetched:C,isFavorited:L}=qe(),{user:q}=Ve(),[T,B]=N("all");ee(()=>{n.path==="/movies"?B("movie"):n.path==="/tv"?B("tv"):B("all")},[n.path]),ee(()=>{u(),h(),d(),f(),p(),v(),m(),g()},[u,h,d,f,p,v,m,g]),ee(()=>{q&&!b&&_()},[q,b,_]),ee(()=>{q&&!C&&P()},[q,C,P]);const G=(W,Z,ae)=>!Z||Z.length===0?null:l("section",{class:"home-section",children:[l("h2",{children:W}),l("div",{class:"scrolling-row",children:Z.map(se=>l(_t,{item:se,type:ae||se.media_type},`${W}-${se.id}`))})]});return l("div",{class:"container home-page",children:[l("h1",{class:"main-title",children:[T==="movie"&&"Movies",T==="tv"&&"TV Shows",T==="all"&&"Discover"]}),!q&&T==="all"&&l(gt,{children:[l("div",{class:"guest-info-banner",style:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"8px",padding:"16px",marginBottom:"24px",textAlign:"center"},children:[l("h3",{style:{margin:"0 0 8px 0",color:"var(--text-primary)"},children:"🎬 Start Streaming Instantly"}),l("p",{style:{margin:"0",color:"var(--text-secondary)"},children:["No account required! Click any movie or TV show to start watching immediately.",l("a",{href:"/login",style:{color:"var(--accent-color)",textDecoration:"none",marginLeft:"4px"},children:"Sign up"})," to save favorites, track progress, and continue watching across devices."]})]}),l(su,{})]}),q&&T==="all"&&l(iu,{}),b?w.length>0&&l("section",{class:"home-section",children:[l("h2",{children:"Continue Watching"}),l("div",{class:"scrolling-row scrolling-row--compact",children:w.map(W=>l(_t,{item:W,type:W.type,progress:W.progress_seconds,duration:W.duration_seconds},`continue-watching-${W.type}-${W.id}`))})]}):l(Mo,{text:"Loading your continue watching..."}),T==="all"&&G("Trending This Week",e,"movie"),T!=="tv"&&G("Popular Movies",t,"movie"),T!=="tv"&&G("Now Playing Movies",a,"movie"),T!=="movie"&&G("Popular TV Shows",r,"tv"),(T==="all"||T==="movie")&&G("Top Rated Movies",s,"movie"),(T==="all"||T==="movie")&&G("Upcoming Movies",o,"movie"),(T==="all"||T==="tv")&&G("Top Rated TV Shows",i,"tv"),(T==="all"||T==="tv")&&G("Airing Today",c,"tv")]})};var Vt={exports:{}};const qo=go(ha);var pr,Js;function ou(){if(Js)return pr;Js=1;var n=qo;function e(i,o){var a={};for(var c in i)o.indexOf(c)>=0||Object.prototype.hasOwnProperty.call(i,c)&&(a[c]=i[c]);return a}function t(i,o){if(!(i instanceof o))throw new TypeError("Cannot call a class as a function")}function r(i,o){if(!i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o&&(typeof o=="object"||typeof o=="function")?o:i}function s(i,o){if(typeof o!="function"&&o!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof o);i.prototype=Object.create(o&&o.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),o&&(Object.setPrototypeOf?Object.setPrototypeOf(i,o):i.__proto__=o)}return pr=function(o,a,c){if(typeof o!="function")throw new Error("Expected reducePropsToState to be a function.");if(typeof a!="function")throw new Error("Expected handleStateChangeOnClient to be a function.");if(typeof c<"u"&&typeof c!="function")throw new Error("Expected mapStateOnServer to either be undefined or a function.");function u(d){return d.displayName||d.name||"Component"}return function(f){if(typeof f!="function")throw new Error("Expected WrappedComponent to be a React component.");var p=[],v=void 0;function m(){v=o(p.map(function(w){return w.props})),g.canUseDOM?a(v):c&&(v=c(v))}var g=function(w){s(b,w);function b(){return t(this,b),r(this,w.apply(this,arguments))}return b.peek=function(){return v},b.rewind=function(){if(b.canUseDOM)throw new Error("You may only call rewind() on the server. Call peek() to read the current state.");var P=v;return v=void 0,p=[],P},b.prototype.shouldComponentUpdate=function(P){var C=P.children,L=e(P,["children"]);return C&&C.length&&(L.children=C),h(L,this.props)},b.prototype.componentWillMount=function(){p.push(this),m()},b.prototype.componentDidUpdate=function(){m()},b.prototype.componentWillUnmount=function(){var P=p.indexOf(this);p.splice(P,1),m()},b.prototype.render=function(){return(0,n.h)(f,this.props)},b}(n.Component);return g.displayName="SideEffect("+u(f)+")",g.canUseDOM=!!(typeof window<"u"&&window.document&&window.document.createElement),g};function h(d,f){for(var p in d)if(!(p in f))return!0;for(var v in f)if(d[v]!==f[v])return!0;return!1}},pr}var gr,Ys;function Fo(){if(Ys)return gr;Ys=1;var n=Object.prototype.toString;return gr=function(t){var r=n.call(t),s=r==="[object Arguments]";return s||(s=r!=="[object Array]"&&t!==null&&typeof t=="object"&&typeof t.length=="number"&&t.length>=0&&n.call(t.callee)==="[object Function]"),s},gr}var vr,Qs;function au(){if(Qs)return vr;Qs=1;var n;if(!Object.keys){var e=Object.prototype.hasOwnProperty,t=Object.prototype.toString,r=Fo(),s=Object.prototype.propertyIsEnumerable,i=!s.call({toString:null},"toString"),o=s.call(function(){},"prototype"),a=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],c=function(f){var p=f.constructor;return p&&p.prototype===f},u={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},h=function(){if(typeof window>"u")return!1;for(var f in window)try{if(!u["$"+f]&&e.call(window,f)&&window[f]!==null&&typeof window[f]=="object")try{c(window[f])}catch{return!0}}catch{return!0}return!1}(),d=function(f){if(typeof window>"u"||!h)return c(f);try{return c(f)}catch{return!1}};n=function(p){var v=p!==null&&typeof p=="object",m=t.call(p)==="[object Function]",g=r(p),w=v&&t.call(p)==="[object String]",b=[];if(!v&&!m&&!g)throw new TypeError("Object.keys called on a non-object");var _=o&&m;if(w&&p.length>0&&!e.call(p,0))for(var P=0;P<p.length;++P)b.push(String(P));if(g&&p.length>0)for(var C=0;C<p.length;++C)b.push(String(C));else for(var L in p)!(_&&L==="prototype")&&e.call(p,L)&&b.push(String(L));if(i)for(var q=d(p),T=0;T<a.length;++T)!(q&&a[T]==="constructor")&&e.call(p,a[T])&&b.push(a[T]);return b}}return vr=n,vr}var mr,Xs;function Bo(){if(Xs)return mr;Xs=1;var n=Array.prototype.slice,e=Fo(),t=Object.keys,r=t?function(o){return t(o)}:au(),s=Object.keys;return r.shim=function(){if(Object.keys){var o=function(){var a=Object.keys(arguments);return a&&a.length===arguments.length}(1,2);o||(Object.keys=function(c){return e(c)?s(n.call(c)):s(c)})}else Object.keys=r;return Object.keys||r},mr=r,mr}var yr,Zs;function Wo(){return Zs||(Zs=1,yr=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var e={},t=Symbol("test"),r=Object(t);if(typeof t=="string"||Object.prototype.toString.call(t)!=="[object Symbol]"||Object.prototype.toString.call(r)!=="[object Symbol]")return!1;var s=42;e[t]=s;for(var i in e)return!1;if(typeof Object.keys=="function"&&Object.keys(e).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(e).length!==0)return!1;var o=Object.getOwnPropertySymbols(e);if(o.length!==1||o[0]!==t||!Object.prototype.propertyIsEnumerable.call(e,t))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var a=Object.getOwnPropertyDescriptor(e,t);if(a.value!==s||a.enumerable!==!0)return!1}return!0}),yr}var _r,ei;function Vn(){if(ei)return _r;ei=1;var n=Wo();return _r=function(){return n()&&!!Symbol.toStringTag},_r}var wr,ti;function Ho(){return ti||(ti=1,wr=Object),wr}var br,ri;function Go(){return ri||(ri=1,br=Error),br}var Sr,ni;function lu(){return ni||(ni=1,Sr=EvalError),Sr}var Er,si;function cu(){return si||(si=1,Er=RangeError),Er}var Tr,ii;function uu(){return ii||(ii=1,Tr=ReferenceError),Tr}var Pr,oi;function Ko(){return oi||(oi=1,Pr=SyntaxError),Pr}var kr,ai;function bt(){return ai||(ai=1,kr=TypeError),kr}var Ar,li;function du(){return li||(li=1,Ar=URIError),Ar}var $r,ci;function hu(){return ci||(ci=1,$r=Math.abs),$r}var Rr,ui;function fu(){return ui||(ui=1,Rr=Math.floor),Rr}var Or,di;function pu(){return di||(di=1,Or=Math.max),Or}var Cr,hi;function gu(){return hi||(hi=1,Cr=Math.min),Cr}var jr,fi;function vu(){return fi||(fi=1,jr=Math.pow),jr}var Ir,pi;function mu(){return pi||(pi=1,Ir=Math.round),Ir}var xr,gi;function yu(){return gi||(gi=1,xr=Number.isNaN||function(e){return e!==e}),xr}var Nr,vi;function _u(){if(vi)return Nr;vi=1;var n=yu();return Nr=function(t){return n(t)||t===0?t:t<0?-1:1},Nr}var Lr,mi;function wu(){return mi||(mi=1,Lr=Object.getOwnPropertyDescriptor),Lr}var Ur,yi;function St(){if(yi)return Ur;yi=1;var n=wu();if(n)try{n([],"length")}catch{n=null}return Ur=n,Ur}var Dr,_i;function Zt(){if(_i)return Dr;_i=1;var n=Object.defineProperty||!1;if(n)try{n({},"a",{value:1})}catch{n=!1}return Dr=n,Dr}var Mr,wi;function bu(){if(wi)return Mr;wi=1;var n=typeof Symbol<"u"&&Symbol,e=Wo();return Mr=function(){return typeof n!="function"||typeof Symbol!="function"||typeof n("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:e()},Mr}var qr,bi;function Vo(){return bi||(bi=1,qr=typeof Reflect<"u"&&Reflect.getPrototypeOf||null),qr}var Fr,Si;function zo(){if(Si)return Fr;Si=1;var n=Ho();return Fr=n.getPrototypeOf||null,Fr}var Br,Ei;function Su(){if(Ei)return Br;Ei=1;var n="Function.prototype.bind called on incompatible ",e=Object.prototype.toString,t=Math.max,r="[object Function]",s=function(c,u){for(var h=[],d=0;d<c.length;d+=1)h[d]=c[d];for(var f=0;f<u.length;f+=1)h[f+c.length]=u[f];return h},i=function(c,u){for(var h=[],d=u,f=0;d<c.length;d+=1,f+=1)h[f]=c[d];return h},o=function(a,c){for(var u="",h=0;h<a.length;h+=1)u+=a[h],h+1<a.length&&(u+=c);return u};return Br=function(c){var u=this;if(typeof u!="function"||e.apply(u)!==r)throw new TypeError(n+u);for(var h=i(arguments,1),d,f=function(){if(this instanceof d){var w=u.apply(this,s(h,arguments));return Object(w)===w?w:this}return u.apply(c,s(h,arguments))},p=t(0,u.length-h.length),v=[],m=0;m<p;m++)v[m]="$"+m;if(d=Function("binder","return function ("+o(v,",")+"){ return binder.apply(this,arguments); }")(f),u.prototype){var g=function(){};g.prototype=u.prototype,d.prototype=new g,g.prototype=null}return d},Br}var Wr,Ti;function Dt(){if(Ti)return Wr;Ti=1;var n=Su();return Wr=Function.prototype.bind||n,Wr}var Hr,Pi;function zn(){return Pi||(Pi=1,Hr=Function.prototype.call),Hr}var Gr,ki;function Jn(){return ki||(ki=1,Gr=Function.prototype.apply),Gr}var Kr,Ai;function Eu(){return Ai||(Ai=1,Kr=typeof Reflect<"u"&&Reflect&&Reflect.apply),Kr}var Vr,$i;function Jo(){if($i)return Vr;$i=1;var n=Dt(),e=Jn(),t=zn(),r=Eu();return Vr=r||n.call(t,e),Vr}var zr,Ri;function Yn(){if(Ri)return zr;Ri=1;var n=Dt(),e=bt(),t=zn(),r=Jo();return zr=function(i){if(i.length<1||typeof i[0]!="function")throw new e("a function is required");return r(n,t,i)},zr}var Jr,Oi;function Tu(){if(Oi)return Jr;Oi=1;var n=Yn(),e=St(),t;try{t=[].__proto__===Array.prototype}catch(o){if(!o||typeof o!="object"||!("code"in o)||o.code!=="ERR_PROTO_ACCESS")throw o}var r=!!t&&e&&e(Object.prototype,"__proto__"),s=Object,i=s.getPrototypeOf;return Jr=r&&typeof r.get=="function"?n([r.get]):typeof i=="function"?function(a){return i(a==null?a:s(a))}:!1,Jr}var Yr,Ci;function Yo(){if(Ci)return Yr;Ci=1;var n=Vo(),e=zo(),t=Tu();return Yr=n?function(s){return n(s)}:e?function(s){if(!s||typeof s!="object"&&typeof s!="function")throw new TypeError("getProto: not an object");return e(s)}:t?function(s){return t(s)}:null,Yr}var Qr,ji;function Qo(){if(ji)return Qr;ji=1;var n=Function.prototype.call,e=Object.prototype.hasOwnProperty,t=Dt();return Qr=t.call(n,e),Qr}var Xr,Ii;function Xo(){if(Ii)return Xr;Ii=1;var n,e=Ho(),t=Go(),r=lu(),s=cu(),i=uu(),o=Ko(),a=bt(),c=du(),u=hu(),h=fu(),d=pu(),f=gu(),p=vu(),v=mu(),m=_u(),g=Function,w=function(I){try{return g('"use strict"; return ('+I+").constructor;")()}catch{}},b=St(),_=Zt(),P=function(){throw new a},C=b?function(){try{return arguments.callee,P}catch{try{return b(arguments,"callee").get}catch{return P}}}():P,L=bu()(),q=Yo(),T=zo(),B=Vo(),G=Jn(),W=zn(),Z={},ae=typeof Uint8Array>"u"||!q?n:q(Uint8Array),se={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?n:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?n:ArrayBuffer,"%ArrayIteratorPrototype%":L&&q?q([][Symbol.iterator]()):n,"%AsyncFromSyncIteratorPrototype%":n,"%AsyncFunction%":Z,"%AsyncGenerator%":Z,"%AsyncGeneratorFunction%":Z,"%AsyncIteratorPrototype%":Z,"%Atomics%":typeof Atomics>"u"?n:Atomics,"%BigInt%":typeof BigInt>"u"?n:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?n:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?n:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?n:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":t,"%eval%":eval,"%EvalError%":r,"%Float16Array%":typeof Float16Array>"u"?n:Float16Array,"%Float32Array%":typeof Float32Array>"u"?n:Float32Array,"%Float64Array%":typeof Float64Array>"u"?n:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?n:FinalizationRegistry,"%Function%":g,"%GeneratorFunction%":Z,"%Int8Array%":typeof Int8Array>"u"?n:Int8Array,"%Int16Array%":typeof Int16Array>"u"?n:Int16Array,"%Int32Array%":typeof Int32Array>"u"?n:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":L&&q?q(q([][Symbol.iterator]())):n,"%JSON%":typeof JSON=="object"?JSON:n,"%Map%":typeof Map>"u"?n:Map,"%MapIteratorPrototype%":typeof Map>"u"||!L||!q?n:q(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":e,"%Object.getOwnPropertyDescriptor%":b,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?n:Promise,"%Proxy%":typeof Proxy>"u"?n:Proxy,"%RangeError%":s,"%ReferenceError%":i,"%Reflect%":typeof Reflect>"u"?n:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?n:Set,"%SetIteratorPrototype%":typeof Set>"u"||!L||!q?n:q(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?n:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":L&&q?q(""[Symbol.iterator]()):n,"%Symbol%":L?Symbol:n,"%SyntaxError%":o,"%ThrowTypeError%":C,"%TypedArray%":ae,"%TypeError%":a,"%Uint8Array%":typeof Uint8Array>"u"?n:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?n:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?n:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?n:Uint32Array,"%URIError%":c,"%WeakMap%":typeof WeakMap>"u"?n:WeakMap,"%WeakRef%":typeof WeakRef>"u"?n:WeakRef,"%WeakSet%":typeof WeakSet>"u"?n:WeakSet,"%Function.prototype.call%":W,"%Function.prototype.apply%":G,"%Object.defineProperty%":_,"%Object.getPrototypeOf%":T,"%Math.abs%":u,"%Math.floor%":h,"%Math.max%":d,"%Math.min%":f,"%Math.pow%":p,"%Math.round%":v,"%Math.sign%":m,"%Reflect.getPrototypeOf%":B};if(q)try{null.error}catch(I){var ce=q(q(I));se["%Error.prototype%"]=ce}var ve=function I(x){var D;if(x==="%AsyncFunction%")D=w("async function () {}");else if(x==="%GeneratorFunction%")D=w("function* () {}");else if(x==="%AsyncGeneratorFunction%")D=w("async function* () {}");else if(x==="%AsyncGenerator%"){var A=I("%AsyncGeneratorFunction%");A&&(D=A.prototype)}else if(x==="%AsyncIteratorPrototype%"){var F=I("%AsyncGenerator%");F&&q&&(D=q(F.prototype))}return se[x]=D,D},_e={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},Ee=Dt(),xe=Qo(),Et=Ee.call(W,Array.prototype.concat),Ue=Ee.call(G,Array.prototype.splice),pe=Ee.call(W,String.prototype.replace),$e=Ee.call(W,String.prototype.slice),U=Ee.call(W,RegExp.prototype.exec),y=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,$=/\\(\\)?/g,S=function(x){var D=$e(x,0,1),A=$e(x,-1);if(D==="%"&&A!=="%")throw new o("invalid intrinsic syntax, expected closing `%`");if(A==="%"&&D!=="%")throw new o("invalid intrinsic syntax, expected opening `%`");var F=[];return pe(x,y,function(Q,ue,z,ne){F[F.length]=z?pe(ne,$,"$1"):ue||Q}),F},O=function(x,D){var A=x,F;if(xe(_e,A)&&(F=_e[A],A="%"+F[0]+"%"),xe(se,A)){var Q=se[A];if(Q===Z&&(Q=ve(A)),typeof Q>"u"&&!D)throw new a("intrinsic "+x+" exists, but is not available. Please file an issue!");return{alias:F,name:A,value:Q}}throw new o("intrinsic "+x+" does not exist!")};return Xr=function(x,D){if(typeof x!="string"||x.length===0)throw new a("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof D!="boolean")throw new a('"allowMissing" argument must be a boolean');if(U(/^%?[^%]*%?$/,x)===null)throw new o("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var A=S(x),F=A.length>0?A[0]:"",Q=O("%"+F+"%",D),ue=Q.name,z=Q.value,ne=!1,Re=Q.alias;Re&&(F=Re[0],Ue(A,Et([0,1],Re)));for(var ye=1,le=!0;ye<A.length;ye+=1){var de=A[ye],Te=$e(de,0,1),J=$e(de,-1);if((Te==='"'||Te==="'"||Te==="`"||J==='"'||J==="'"||J==="`")&&Te!==J)throw new o("property names with quotes must have matching quotes");if((de==="constructor"||!le)&&(ne=!0),F+="."+de,ue="%"+F+"%",xe(se,ue))z=se[ue];else if(z!=null){if(!(de in z)){if(!D)throw new a("base intrinsic for "+x+" exists, but the property is not available.");return}if(b&&ye+1>=A.length){var E=b(z,de);le=!!E,le&&"get"in E&&!("originalValue"in E.get)?z=E.get:z=z[de]}else le=xe(z,de),z=z[de];le&&!ne&&(se[ue]=z)}}return z},Xr}var Zr,xi;function Qn(){if(xi)return Zr;xi=1;var n=Xo(),e=Yn(),t=e([n("%String.prototype.indexOf%")]);return Zr=function(s,i){var o=n(s,!!i);return typeof o=="function"&&t(s,".prototype.")>-1?e([o]):o},Zr}var en,Ni;function Pu(){if(Ni)return en;Ni=1;var n=Vn()(),e=Qn(),t=e("Object.prototype.toString"),r=function(a){return n&&a&&typeof a=="object"&&Symbol.toStringTag in a?!1:t(a)==="[object Arguments]"},s=function(a){return r(a)?!0:a!==null&&typeof a=="object"&&"length"in a&&typeof a.length=="number"&&a.length>=0&&t(a)!=="[object Array]"&&"callee"in a&&t(a.callee)==="[object Function]"},i=function(){return r(arguments)}();return r.isLegacyArguments=s,en=i?r:s,en}var tn,Li;function Xn(){if(Li)return tn;Li=1;var n=Zt(),e=Ko(),t=bt(),r=St();return tn=function(i,o,a){if(!i||typeof i!="object"&&typeof i!="function")throw new t("`obj` must be an object or a function`");if(typeof o!="string"&&typeof o!="symbol")throw new t("`property` must be a string or a symbol`");if(arguments.length>3&&typeof arguments[3]!="boolean"&&arguments[3]!==null)throw new t("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&typeof arguments[4]!="boolean"&&arguments[4]!==null)throw new t("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&typeof arguments[5]!="boolean"&&arguments[5]!==null)throw new t("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&typeof arguments[6]!="boolean")throw new t("`loose`, if provided, must be a boolean");var c=arguments.length>3?arguments[3]:null,u=arguments.length>4?arguments[4]:null,h=arguments.length>5?arguments[5]:null,d=arguments.length>6?arguments[6]:!1,f=!!r&&r(i,o);if(n)n(i,o,{configurable:h===null&&f?f.configurable:!h,enumerable:c===null&&f?f.enumerable:!c,value:a,writable:u===null&&f?f.writable:!u});else if(d||!c&&!u&&!h)i[o]=a;else throw new e("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.")},tn}var rn,Ui;function Zn(){if(Ui)return rn;Ui=1;var n=Zt(),e=function(){return!!n};return e.hasArrayLengthDefineBug=function(){if(!n)return null;try{return n([],"length",{value:1}).length!==1}catch{return!0}},rn=e,rn}var nn,Di;function Mt(){if(Di)return nn;Di=1;var n=Bo(),e=typeof Symbol=="function"&&typeof Symbol("foo")=="symbol",t=Object.prototype.toString,r=Array.prototype.concat,s=Xn(),i=function(u){return typeof u=="function"&&t.call(u)==="[object Function]"},o=Zn()(),a=function(u,h,d,f){if(h in u){if(f===!0){if(u[h]===d)return}else if(!i(f)||!f())return}o?s(u,h,d,!0):s(u,h,d)},c=function(u,h){var d=arguments.length>2?arguments[2]:{},f=n(h);e&&(f=r.call(f,Object.getOwnPropertySymbols(h)));for(var p=0;p<f.length;p+=1)a(u,f[p],h[f[p]],d[f[p]])};return c.supportsDescriptors=!!o,nn=c,nn}var sn={exports:{}},on,Mi;function ku(){if(Mi)return on;Mi=1;var n=Xo(),e=Xn(),t=Zn()(),r=St(),s=bt(),i=n("%Math.floor%");return on=function(a,c){if(typeof a!="function")throw new s("`fn` is not a function");if(typeof c!="number"||c<0||c>4294967295||i(c)!==c)throw new s("`length` must be a positive 32-bit integer");var u=arguments.length>2&&!!arguments[2],h=!0,d=!0;if("length"in a&&r){var f=r(a,"length");f&&!f.configurable&&(h=!1),f&&!f.writable&&(d=!1)}return(h||d||!u)&&(t?e(a,"length",c,!0,!0):e(a,"length",c)),a},on}var an,qi;function Au(){if(qi)return an;qi=1;var n=Dt(),e=Jn(),t=Jo();return an=function(){return t(n,e,arguments)},an}var Fi;function Zo(){return Fi||(Fi=1,function(n){var e=ku(),t=Zt(),r=Yn(),s=Au();n.exports=function(o){var a=r(arguments),c=o.length-(arguments.length-1);return e(a,1+(c>0?c:0),!0)},t?t(n.exports,"apply",{value:s}):n.exports.apply=s}(sn)),sn.exports}var ln,Bi;function ea(){if(Bi)return ln;Bi=1;var n=function(e){return e!==e};return ln=function(t,r){return t===0&&r===0?1/t===1/r:!!(t===r||n(t)&&n(r))},ln}var cn,Wi;function ta(){if(Wi)return cn;Wi=1;var n=ea();return cn=function(){return typeof Object.is=="function"?Object.is:n},cn}var un,Hi;function $u(){if(Hi)return un;Hi=1;var n=ta(),e=Mt();return un=function(){var r=n();return e(Object,{is:r},{is:function(){return Object.is!==r}}),r},un}var dn,Gi;function Ru(){if(Gi)return dn;Gi=1;var n=Mt(),e=Zo(),t=ea(),r=ta(),s=$u(),i=e(r(),Object);return n(i,{getPolyfill:r,implementation:t,shim:s}),dn=i,dn}var hn,Ki;function Ou(){if(Ki)return hn;Ki=1;var n=Qn(),e=Vn()(),t=Qo(),r=St(),s;if(e){var i=n("RegExp.prototype.exec"),o={},a=function(){throw o},c={toString:a,valueOf:a};typeof Symbol.toPrimitive=="symbol"&&(c[Symbol.toPrimitive]=a),s=function(f){if(!f||typeof f!="object")return!1;var p=r(f,"lastIndex"),v=p&&t(p,"value");if(!v)return!1;try{i(f,c)}catch(m){return m===o}}}else{var u=n("Object.prototype.toString"),h="[object RegExp]";s=function(f){return!f||typeof f!="object"&&typeof f!="function"?!1:u(f)===h}}return hn=s,hn}var fn,Vi;function Cu(){if(Vi)return fn;Vi=1;var n=function(){return typeof(function(){}).name=="string"},e=Object.getOwnPropertyDescriptor;if(e)try{e([],"length")}catch{e=null}n.functionsHaveConfigurableNames=function(){if(!n()||!e)return!1;var s=e(function(){},"name");return!!s&&!!s.configurable};var t=Function.prototype.bind;return n.boundFunctionsHaveNames=function(){return n()&&typeof t=="function"&&(function(){}).bind().name!==""},fn=n,fn}var pn,zi;function ju(){if(zi)return pn;zi=1;var n=Xn(),e=Zn()(),t=Cu().functionsHaveConfigurableNames(),r=bt();return pn=function(i,o){if(typeof i!="function")throw new r("`fn` is not a function");var a=arguments.length>2&&!!arguments[2];return(!a||t)&&(e?n(i,"name",o,!0,!0):n(i,"name",o)),i},pn}var gn,Ji;function ra(){if(Ji)return gn;Ji=1;var n=ju(),e=bt(),t=Object;return gn=n(function(){if(this==null||this!==t(this))throw new e("RegExp.prototype.flags getter called on non-object");var s="";return this.hasIndices&&(s+="d"),this.global&&(s+="g"),this.ignoreCase&&(s+="i"),this.multiline&&(s+="m"),this.dotAll&&(s+="s"),this.unicode&&(s+="u"),this.unicodeSets&&(s+="v"),this.sticky&&(s+="y"),s},"get flags",!0),gn}var vn,Yi;function na(){if(Yi)return vn;Yi=1;var n=ra(),e=Mt().supportsDescriptors,t=Object.getOwnPropertyDescriptor;return vn=function(){if(e&&/a/mig.flags==="gim"){var s=t(RegExp.prototype,"flags");if(s&&typeof s.get=="function"&&"dotAll"in RegExp.prototype&&"hasIndices"in RegExp.prototype){var i="",o={};if(Object.defineProperty(o,"hasIndices",{get:function(){i+="d"}}),Object.defineProperty(o,"sticky",{get:function(){i+="y"}}),s.get.call(o),i==="dy")return s.get}}return n},vn}var mn,Qi;function Iu(){if(Qi)return mn;Qi=1;var n=Mt().supportsDescriptors,e=na(),t=St(),r=Object.defineProperty,s=Go(),i=Yo(),o=/a/;return mn=function(){if(!n||!i)throw new s("RegExp.prototype.flags requires a true ES5 environment that supports property descriptors");var c=e(),u=i(o),h=t(u,"flags");return(!h||h.get!==c)&&r(u,"flags",{configurable:!0,enumerable:!1,get:c}),c},mn}var yn,Xi;function xu(){if(Xi)return yn;Xi=1;var n=Mt(),e=Zo(),t=ra(),r=na(),s=Iu(),i=e(r());return n(i,{getPolyfill:r,implementation:t,shim:s}),yn=i,yn}var _n,Zi;function Nu(){if(Zi)return _n;Zi=1;var n=Qn(),e=n("Date.prototype.getDay"),t=function(a){try{return e(a),!0}catch{return!1}},r=n("Object.prototype.toString"),s="[object Date]",i=Vn()();return _n=function(a){return typeof a!="object"||a===null?!1:i?t(a):r(a)===s},_n}var wn,eo;function Lu(){if(eo)return wn;eo=1;var n=Bo(),e=Pu(),t=Ru(),r=Ou(),s=xu(),i=Nu(),o=Date.prototype.getTime;function a(d,f,p){var v=p||{};return(v.strict?t(d,f):d===f)?!0:!d||!f||typeof d!="object"&&typeof f!="object"?v.strict?t(d,f):d==f:h(d,f,v)}function c(d){return d==null}function u(d){return!(!d||typeof d!="object"||typeof d.length!="number"||typeof d.copy!="function"||typeof d.slice!="function"||d.length>0&&typeof d[0]!="number")}function h(d,f,p){var v,m;if(typeof d!=typeof f||c(d)||c(f)||d.prototype!==f.prototype||e(d)!==e(f))return!1;var g=r(d),w=r(f);if(g!==w)return!1;if(g||w)return d.source===f.source&&s(d)===s(f);if(i(d)&&i(f))return o.call(d)===o.call(f);var b=u(d),_=u(f);if(b!==_)return!1;if(b||_){if(d.length!==f.length)return!1;for(v=0;v<d.length;v++)if(d[v]!==f[v])return!1;return!0}if(typeof d!=typeof f)return!1;try{var P=n(d),C=n(f)}catch{return!1}if(P.length!==C.length)return!1;for(P.sort(),C.sort(),v=P.length-1;v>=0;v--)if(P[v]!=C[v])return!1;for(v=P.length-1;v>=0;v--)if(m=P[v],!a(d[m],f[m],p))return!1;return!0}return wn=a,wn}/*
object-assign
(c) Sindre Sorhus
@license MIT
*/var bn,to;function Uu(){if(to)return bn;to=1;var n=Object.getOwnPropertySymbols,e=Object.prototype.hasOwnProperty,t=Object.prototype.propertyIsEnumerable;function r(i){if(i==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(i)}function s(){try{if(!Object.assign)return!1;var i=new String("abc");if(i[5]="de",Object.getOwnPropertyNames(i)[0]==="5")return!1;for(var o={},a=0;a<10;a++)o["_"+String.fromCharCode(a)]=a;var c=Object.getOwnPropertyNames(o).map(function(h){return o[h]});if(c.join("")!=="0123456789")return!1;var u={};return"abcdefghijklmnopqrst".split("").forEach(function(h){u[h]=h}),Object.keys(Object.assign({},u)).join("")==="abcdefghijklmnopqrst"}catch{return!1}}return bn=s()?Object.assign:function(i,o){for(var a,c=r(i),u,h=1;h<arguments.length;h++){a=Object(arguments[h]);for(var d in a)e.call(a,d)&&(c[d]=a[d]);if(n){u=n(a);for(var f=0;f<u.length;f++)t.call(a,u[f])&&(c[u[f]]=a[u[f]])}}return c},bn}var ft={},ro;function Du(){return ro||(ro=1,ft.__esModule=!0,ft.TAG_NAMES={HTML:"htmlAttributes",TITLE:"title",BASE:"base",META:"meta",LINK:"link",SCRIPT:"script",NOSCRIPT:"noscript",STYLE:"style"},ft.TAG_PROPERTIES={NAME:"name",CHARSET:"charset",HTTPEQUIV:"http-equiv",REL:"rel",HREF:"href",PROPERTY:"property",SRC:"src",INNER_HTML:"innerHTML",CSS_TEXT:"cssText",ITEM_PROP:"itemprop"},ft.PREACT_TAG_MAP={charset:"charSet","http-equiv":"httpEquiv",itemprop:"itemProp",class:"className"}),ft}var no;function Mu(){return no||(no=1,function(n,e){e.__esModule=!0;var t=function(){function U(y,$){for(var S=0;S<$.length;S++){var O=$[S];O.enumerable=O.enumerable||!1,O.configurable=!0,"value"in O&&(O.writable=!0),Object.defineProperty(y,O.key,O)}}return function(y,$,S){return $&&U(y.prototype,$),S&&U(y,S),y}}(),r=Object.assign||function(U){for(var y=1;y<arguments.length;y++){var $=arguments[y];for(var S in $)Object.prototype.hasOwnProperty.call($,S)&&(U[S]=$[S])}return U},s=qo,i=ou(),o=f(i),a=Lu(),c=f(a),u=Uu(),h=f(u),d=Du();function f(U){return U&&U.__esModule?U:{default:U}}function p(U,y){if(!(U instanceof y))throw new TypeError("Cannot call a class as a function")}function v(U,y){if(!U)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return y&&(typeof y=="object"||typeof y=="function")?y:U}function m(U,y){if(typeof y!="function"&&y!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof y);U.prototype=Object.create(y&&y.prototype,{constructor:{value:U,enumerable:!1,writable:!0,configurable:!0}}),y&&(Object.setPrototypeOf?Object.setPrototypeOf(U,y):U.__proto__=y)}function g(U,y,$){return y in U?Object.defineProperty(U,y,{value:$,enumerable:!0,configurable:!0,writable:!0}):U[y]=$,U}var w="data-preact-helmet",b=function(y){return String(y).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;")},_=function(y,$){for(var S=y.length-1;S>=0;S--){var O=y[S];if(O[$])return O[$]}return null},P=function(y){var $=_(y,"title"),S=_(y,"titleTemplate");if(S&&$)return S.replace(/%s/g,function(){return $});var O=_(y,"defaultTitle");return $||O||""},C=function(y){return _(y,"onChangeClientState")||function(){}},L=function(y,$){return $.filter(function(S){return typeof S[y]<"u"}).map(function(S){return S[y]}).reduce(function(S,O){return r({},S,O)},{})},q=function(y,$){return $.filter(function(S){return typeof S[d.TAG_NAMES.BASE]<"u"}).map(function(S){return S[d.TAG_NAMES.BASE]}).reverse().reduce(function(S,O){if(!S.length)for(var I=Object.keys(O),x=0;x<I.length;x++){var D=I[x],A=D.toLowerCase();if(y.indexOf(A)!==-1&&O[A])return S.concat(O)}return S},[])},T=function(y,$,S){var O={};return S.filter(function(I){return typeof I[y]<"u"}).map(function(I){return I[y]}).reverse().reduce(function(I,x){var D={};x.filter(function(z){for(var ne=void 0,Re=Object.keys(z),ye=0;ye<Re.length;ye++){var le=Re[ye],de=le.toLowerCase();$.indexOf(de)!==-1&&!(ne===d.TAG_PROPERTIES.REL&&z[ne].toLowerCase()==="canonical")&&!(de===d.TAG_PROPERTIES.REL&&z[de].toLowerCase()==="stylesheet")&&(ne=de),$.indexOf(le)!==-1&&(le===d.TAG_PROPERTIES.INNER_HTML||le===d.TAG_PROPERTIES.CSS_TEXT||le===d.TAG_PROPERTIES.ITEM_PROP)&&(ne=le)}if(!ne||!z[ne])return!1;var Te=z[ne].toLowerCase();return O[ne]||(O[ne]={}),D[ne]||(D[ne]={}),O[ne][Te]?!1:(D[ne][Te]=!0,!0)}).reverse().forEach(function(z){return I.push(z)});for(var A=Object.keys(D),F=0;F<A.length;F++){var Q=A[F],ue=(0,h.default)({},O[Q],D[Q]);O[Q]=ue}return I},[]).reverse()},B=function(y,$){document.title=y||document.title,G(d.TAG_NAMES.TITLE,$)},G=function(y,$){for(var S=document.getElementsByTagName(y)[0],O=S.getAttribute(w),I=O?O.split(","):[],x=[].concat(I),D=Object.keys($),A=0;A<D.length;A++){var F=D[A],Q=$[F]||"";S.setAttribute(F,Q),I.indexOf(F)===-1&&I.push(F);var ue=x.indexOf(F);ue!==-1&&x.splice(ue,1)}for(var z=x.length-1;z>=0;z--)S.removeAttribute(x[z]);I.length===x.length?S.removeAttribute(w):S.setAttribute(w,I.join(","))},W=function(y,$){var S=document.head||document.querySelector("head"),O=S.querySelectorAll(y+"["+w+"]"),I=Array.prototype.slice.call(O),x=[],D=void 0;return $&&$.length&&$.forEach(function(A){var F=document.createElement(y);for(var Q in A)if(A.hasOwnProperty(Q))if(Q==="innerHTML")F.innerHTML=A.innerHTML;else if(Q==="cssText")F.styleSheet?F.styleSheet.cssText=A.cssText:F.appendChild(document.createTextNode(A.cssText));else{var ue=typeof A[Q]>"u"?"":A[Q];F.setAttribute(Q,ue)}F.setAttribute(w,"true"),I.some(function(z,ne){return D=ne,F.isEqualNode(z)})?I.splice(D,1):x.push(F)}),I.forEach(function(A){return A.parentNode.removeChild(A)}),x.forEach(function(A){return S.appendChild(A)}),{oldTags:I,newTags:x}},Z=function(y){return Object.keys(y).reduce(function($,S){var O=typeof y[S]<"u"?S+'="'+y[S]+'"':""+S;return $?$+" "+O:O},"")},ae=function(y,$,S){var O=Z(S);return O?"<"+y+" "+w+" "+O+">"+b($)+"</"+y+">":"<"+y+" "+w+">"+b($)+"</"+y+">"},se=function(y,$){return $.reduce(function(S,O){var I=Object.keys(O).filter(function(A){return!(A==="innerHTML"||A==="cssText")}).reduce(function(A,F){var Q=typeof O[F]>"u"?F:F+'="'+b(O[F])+'"';return A?A+" "+Q:Q},""),x=O.innerHTML||O.cssText||"",D=[d.TAG_NAMES.NOSCRIPT,d.TAG_NAMES.SCRIPT,d.TAG_NAMES.STYLE].indexOf(y)===-1;return S+"<"+y+" "+w+" "+I+(D?">":">"+x+"</"+y+">")},"")},ce=function(y,$,S){var O=g({key:$},w,!0),I=Object.keys(S).reduce(function(x,D){return x[D]=S[D],x},O);return[(0,s.h)(d.TAG_NAMES.TITLE,I,$)]},ve=function(y,$){return $.map(function(S,O){var I=g({key:O},w,!0);return Object.keys(S).forEach(function(x){var D=x;if(D==="innerHTML"||D==="cssText"){var A=S.innerHTML||S.cssText;I.dangerouslySetInnerHTML={__html:A}}else I[D]=S[x]}),(0,s.h)(y,I)})},_e=function(y,$){switch(y){case d.TAG_NAMES.TITLE:return{toComponent:function(){return ce(y,$.title,$.titleAttributes)},toString:function(){return ae(y,$.title,$.titleAttributes)}};case d.TAG_NAMES.HTML:return{toComponent:function(){return $},toString:function(){return Z($)}};default:return{toComponent:function(){return ve(y,$)},toString:function(){return se(y,$)}}}},Ee=function(y){var $=y.htmlAttributes,S=y.title,O=y.titleAttributes,I=y.baseTag,x=y.metaTags,D=y.linkTags,A=y.scriptTags,F=y.noscriptTags,Q=y.styleTags;return{htmlAttributes:_e(d.TAG_NAMES.HTML,$),title:_e(d.TAG_NAMES.TITLE,{title:S,titleAttributes:O}),base:_e(d.TAG_NAMES.BASE,I),meta:_e(d.TAG_NAMES.META,x),link:_e(d.TAG_NAMES.LINK,D),script:_e(d.TAG_NAMES.SCRIPT,A),noscript:_e(d.TAG_NAMES.NOSCRIPT,F),style:_e(d.TAG_NAMES.STYLE,Q)}},xe=function(y){var $,S;return S=$=function(O){m(I,O);function I(){return p(this,I),v(this,(I.__proto__||Object.getPrototypeOf(I)).apply(this,arguments))}return t(I,[{key:"shouldComponentUpdate",value:function(D){var A=r({},D);return(!A.children||!A.children.length)&&delete A.children,!(0,c.default)(this.props,A)}},{key:"render",value:function(){return(0,s.h)(y,this.props)}}],[{key:"canUseDOM",set:function(D){y.canUseDOM=D}}]),I}(s.Component),$.peek=y.peek,$.rewind=function(){var O=y.rewind();return O||(O=Ee({htmlAttributes:{},title:"",titleAttributes:{},baseTag:[],metaTags:[],linkTags:[],scriptTags:[],noscriptTags:[],styleTags:[]})),O},S},Et=function(y){return{htmlAttributes:L(d.TAG_NAMES.HTML,y),title:P(y),titleAttributes:L("titleAttributes",y),baseTag:q([d.TAG_PROPERTIES.HREF],y),metaTags:T(d.TAG_NAMES.META,[d.TAG_PROPERTIES.NAME,d.TAG_PROPERTIES.CHARSET,d.TAG_PROPERTIES.HTTPEQUIV,d.TAG_PROPERTIES.PROPERTY,d.TAG_PROPERTIES.ITEM_PROP],y),linkTags:T(d.TAG_NAMES.LINK,[d.TAG_PROPERTIES.REL,d.TAG_PROPERTIES.HREF],y),scriptTags:T(d.TAG_NAMES.SCRIPT,[d.TAG_PROPERTIES.SRC,d.TAG_PROPERTIES.INNER_HTML],y),noscriptTags:T(d.TAG_NAMES.NOSCRIPT,[d.TAG_PROPERTIES.INNER_HTML],y),styleTags:T(d.TAG_NAMES.STYLE,[d.TAG_PROPERTIES.CSS_TEXT],y),onChangeClientState:C(y)}},Ue=function(y){var $=y.htmlAttributes,S=y.title,O=y.titleAttributes,I=y.baseTag,x=y.metaTags,D=y.linkTags,A=y.scriptTags,F=y.noscriptTags,Q=y.styleTags,ue=y.onChangeClientState;G("html",$),B(S,O);var z={baseTag:W(d.TAG_NAMES.BASE,I),metaTags:W(d.TAG_NAMES.META,x),linkTags:W(d.TAG_NAMES.LINK,D),scriptTags:W(d.TAG_NAMES.SCRIPT,A),noscriptTags:W(d.TAG_NAMES.NOSCRIPT,F),styleTags:W(d.TAG_NAMES.STYLE,Q)},ne={},Re={};Object.keys(z).forEach(function(ye){var le=z[ye],de=le.newTags,Te=le.oldTags;de.length&&(ne[ye]=de),Te.length&&(Re[ye]=z[ye].oldTags)}),ue(y,ne,Re)},pe=function(){return null},$e=(0,o.default)(Et,Ue,Ee)(pe);e.default=xe($e),n.exports=e.default}(Vt,Vt.exports)),Vt.exports}var qu=Mu();const Qt=po(qu),Fu=()=>{const{user:n}=Ve(),e=qe(s=>s.favorites),[t,r]=N({});return ee(()=>{document.title="My Favorites - FreeStream"},[]),ee(()=>{(async()=>{if(n&&e.length>0){const i=e.map(o=>({media_id:o.id,media_type:o.type,season_number:o.season_number||null,episode_number:o.episode_number||null}));try{const o=await Do(i);r(o)}catch(o){console.error("Error fetching progress data for favorites:",o),r({})}}else r({})})()},[n,e]),l("div",{class:"container",children:[l(Qt,{children:l("title",{children:"My Favorites - FreeStream"})}),l("h1",{children:"My Favorites"}),e.length>0?l("div",{class:"movie-grid",children:e.map(s=>{const i=`${s.id}-${s.type}-${s.season_number||0}-${s.episode_number||0}`,o=t[i];return l(_t,{item:s,type:s.type,progress:o?.progress_seconds,duration:o?.duration_seconds},`${s.type}-${s.id}-${s.season_number||0}-${s.episode_number||0}`)})}):l("p",{children:"You haven't added any favorites yet."})]})},so=async(n,e=3,t=1e3)=>{for(let r=0;r<e;r++)try{const s=new Promise((a,c)=>{setTimeout(()=>c(new Error("Request timeout")),1e4)}),i=fetch(n,{headers:{Accept:"application/json","Content-Type":"application/json"}}),o=await Promise.race([i,s]);if(!o.ok)throw new Error(`HTTP ${o.status}: ${o.statusText}`);return o}catch(s){if(console.warn(`Fetch attempt ${r+1} failed for ${n}:`,s.message),r===e-1)throw s;await new Promise(i=>setTimeout(i,t*(r+1)))}},Bu=()=>{const{user:n}=Ve(),[e,t]=N([]),[r,s]=N(!0),[i,o]=N(null),{removeContinueWatchingItem:a,fetchContinueWatching:c}=qe(),u=lo(async()=>{if(!n){s(!1);return}s(!0),o(null);try{if(!await No())throw new Error("Supabase connection test failed. Please check your internet connection and try again.");const p=await Zc();if(!p||p.length===0){t([]),s(!1);return}console.log("📚 Combined history data received:",{totalItems:p.length,itemsWithProgress:p.filter(g=>g.progress_seconds>0).length});const m=(await Promise.allSettled(p.map(async g=>{try{const b=await(await so(`${be}/tmdb/${g.media_type}/${g.media_id}`)).json(),_={...b,id:b.id,watch_id:`${g.user_id}-${g.media_id}-${g.media_type}-${g.season_number||0}-${g.episode_number||0}`,type:g.media_type,media_type:g.media_type,media_id:g.media_id,season_number:g.season_number,episode_number:g.episode_number,watched_at:g.watched_at,progress_seconds:g.progress_seconds,duration_seconds:g.duration_seconds};if(g.media_type==="tv"&&g.season_number&&g.episode_number)try{const C=await(await so(`${be}/tmdb/tv/${g.media_id}/season/${g.season_number}/episode/${g.episode_number}`)).json();return{..._,episode_name:C.name,still_path:C.still_path,episode_overview:C.overview}}catch(P){console.error("Error fetching episode details:",P)}return _}catch(w){return console.error(`Error fetching details for ${g.media_type} ${g.media_id}:`,w),{id:g.media_id,watch_id:`${g.user_id}-${g.media_id}-${g.media_type}-${g.season_number||0}-${g.episode_number||0}`,type:g.media_type,media_type:g.media_type,media_id:g.media_id,season_number:g.season_number,episode_number:g.episode_number,watched_at:g.watched_at,title:g.media_type==="tv"?"Unknown TV Show":"Unknown Movie",name:g.media_type==="tv"?"Unknown TV Show":void 0,poster_path:null,overview:"Details could not be loaded",_failed_to_load:!0,progress_seconds:g.progress_seconds,duration_seconds:g.duration_seconds}}}))).filter(g=>g.status==="fulfilled"&&g.value).map(g=>g.value);t(m)}catch(f){console.error("Error fetching watch history:",f),o("Failed to load watch history. Please try again."),t([])}finally{s(!1)}},[n]);ee(()=>{u()},[u]);const h=async f=>{t(e.filter(p=>p.watch_id!==f.watch_id)),a(f.media_id);try{await Yc(f),await c()}catch(p){console.error("Failed to delete item or refetch continue watching:",p)}},d=()=>{u()};return r?l("div",{class:"container",children:l("p",{children:"Loading watch history..."})}):i?l("div",{class:"container",children:[l(Qt,{children:l("title",{children:"Watch History - FreeStream"})}),l("h1",{children:"Watch History"}),l("div",{class:"error-message",children:[l("p",{children:i}),l("button",{onClick:d,class:"retry-button",children:"Retry"})]})]}):l("div",{class:"container",children:[l(Qt,{children:l("title",{children:"Watch History - FreeStream"})}),l("h1",{children:"Watch History"}),e.length>0?l("div",{class:"movie-grid",children:e.map(f=>l(_t,{item:f,type:f.type,progress:f.progress_seconds,duration:f.duration_seconds,showDeleteButton:!0,onDelete:h},f.watch_id))}):l("p",{children:"Your watch history is empty."})]})},io=n=>{const[e,t]=N(null),[r,s]=N([]),[i,o]=N([]),[a,c]=N(""),[u,h]=N(!0),[d,f]=N(!1),[p,v]=N(null),[m,g]=N(null),[w,b]=N("videasy"),[_,P]=N(["videasy","vidsrc","embedsu"]),[C,L]=N(null),[q,T]=N(!1),[B,G]=N(!1),[W,Z]=N(null),[ae,se]=N(!1),[ce,ve]=N(!1),[_e,Ee]=N([]),xe=ge(null),[Et,Ue]=N([]),[pe,$e]=N(null),[U,y]=N(!1),[$,S]=N(0),[O,I]=N(1),[x,D]=N(!1),A=6,F=ge(!1),Q=ge(null),ue=ge(!1),z=ge(!1),ne=ge(!1),Re=ge(null),ye=ge(!1),le=ge(new Set),de=ge(0);ge(0);const Te=ge(null),{id:J,type:E,season:ze,episode:Je}=n.matches,{user:Oe}=Ve(),{setCurrentMediaItem:er,favoritesFetched:es}=qe(),{addFavoriteShow:sa,removeFavoriteShow:ia,isShowFavorited:oa}=require("../utils/favorites");ee(()=>{if(E==="tv"||E==="anime")if(ze&&Je&&!isNaN(parseInt(ze))&&!isNaN(parseInt(Je))){const M=parseInt(ze,10),R=parseInt(Je,10);v(M),g(R)}else v(1),g(1);else v(null),g(null)},[E,ze,Je]);const ts=fa(()=>E!=="movie"||!pe||!pe.progress_seconds||pe.progress_seconds<=0?0:pe.duration_seconds>0?Math.min(100,pe.progress_seconds/pe.duration_seconds*100):pe.progress_seconds>30?5:2,[E,pe]);lo((k,M)=>{if(!k||!M)return 1;const R=Math.ceil(k/A);return Math.max(1,Math.min(R,Math.ceil(M/A)))},[A]);const tr=Oe?.id,rs=ge(tr);ge(0),ee(()=>{rs.current=tr},[tr]),ee(()=>()=>{le.current.forEach(k=>clearTimeout(k)),le.current.clear()},[p,m]),ee(()=>(e&&er({...e,type:E}),()=>{er(null)}),[e,E,er]),ee(()=>{if(!J||!E){Ae("/");return}c(""),ve(!1),Ee([]),t(null),h(!0),Ue([]),ue.current=!1,z.current=!1,ne.current=!1,Re.current=null,ye.current=!1,I(1),D(!1),le.current.forEach(M=>clearTimeout(M)),le.current.clear(),de.current=0,Te.current=null,(async()=>{h(!0);try{const M=new AbortController,R=setTimeout(()=>M.abort(),15e3),[X,oe,Y]=await Promise.all([fetch(`${be}/tmdb/${E}/${J}`,{signal:M.signal}).then(j=>{if(!j.ok)throw new Error(`HTTP ${j.status}: ${j.statusText}`);return j.json()}).catch(j=>{throw console.error("Error fetching media details:",j),j}),fetch(`${be}/tmdb/${E}/${J}/videos`,{signal:M.signal}).then(j=>{if(!j.ok)throw new Error(`HTTP ${j.status}: ${j.statusText}`);return j.json()}).catch(j=>(console.error("Error fetching videos:",j),{results:[]})),fetch(`${be}/tmdb/${E}/${J}/recommendations`,{signal:M.signal}).then(j=>{if(!j.ok)throw new Error(`HTTP ${j.status}: ${j.statusText}`);return j.json()}).catch(j=>(console.error("Error fetching recommendations:",j),{results:[]}))]);clearTimeout(R),t(X),s(oe.results||[]),o(Y.results||[])}catch{t(null),s([]),o([])}finally{h(!1)}})()},[J,E,ze,Je]),ee(()=>{(async()=>{if(!Oe||!e||!J||!E){E==="movie"?$e(null):(E==="tv"||E==="anime")&&Ue([]);return}try{if((E==="tv"||E==="anime")&&e.seasons&&e.seasons.length>0&&!(ze&&Je&&!isNaN(parseInt(ze))&&!isNaN(parseInt(Je)))&&!z.current&&p!==null&&m!==null){console.log("🎬 Checking for continue watching episode...");const R=await Xc(J);R&&R.season&&R.episode?(console.log(`🔄 Continue watching: S${R.season}E${R.episode}`),setTimeout(()=>{v(R.season),g(R.episode);const X=`/watch/${E}/${J}/season/${R.season}/episode/${R.episode}`;Ae(X,!0)},100)):console.log("📭 No continue watching data found, starting from beginning"),z.current=!0}if(E==="tv"||E==="anime"){const M=await Qc(J);Ue(M)}else if(E==="movie"){const M=await hr(J,E);console.log("Movie progress data loaded:",M),$e(M)}}catch(M){console.error("Error loading user-specific data:",M)}})()},[Oe,e,J,E]),ee(()=>{p!==null&&!x&&I(1)},[p]),ee(()=>{(async()=>{if(!(E!=="tv"&&E!=="anime"||!J||!p||p===null)){T(!0);try{const M=new AbortController,R=setTimeout(()=>M.abort(),1e4),X=await fetch(`${be}/tmdb/${E}/${J}/season/${p}`,{signal:M.signal});if(clearTimeout(R),X.ok){const oe=await X.json();if(L(oe),m&&oe.episodes&&!x){const Y=Math.ceil(m/A),j=Math.ceil(oe.episodes.length/A),te=Math.max(1,Math.min(Y,j));I(te),D(!0)}}else L(null)}catch{L(null)}finally{T(!1)}}})()},[J,E,p,m,x]),ee(()=>{const k=`${p}-${m}`,M=Q.current&&Q.current!==k;if(Q.current=k,F.current&&!M){F.current=!1;return}M&&(F.current=!1),(async()=>{if(!J||!E||(E==="tv"||E==="anime")&&(p===null||m===null))return;Z(null),se(!1);let X=0;if(rs.current)try{const Y=await hr(J,E,p,m);Y&&Y.progress_seconds>30?(X=Y.progress_seconds,S(Y.progress_seconds)):S(0)}catch(Y){console.error("Error fetching progress for stream URL:",Y),S(0)}else S(0);let oe=`${be}/stream-url?type=${E}&id=${J}&source=${w}`;(E==="tv"||E==="anime")&&(oe+=`&season=${p}&episode=${m}`,E==="anime"&&(oe+=`&dub=${B}`)),w==="videasy"&&(X>30&&(oe+=`&progress=${Math.floor(X)}`),(E==="tv"||E==="anime")&&(oe+="&nextEpisode=true&episodeSelector=true&autoplayNextEpisode=true"));try{const Y=new AbortController,j=setTimeout(()=>Y.abort(),2e4),te=await fetch(oe,{signal:Y.signal});clearTimeout(j);const ie=await te.json();if(!te.ok)throw new Error(ie.message||`HTTP ${te.status}`);let ke=ie.url;if(!ke)throw new Error("The streaming service did not provide a valid URL. This content might not be available.");ie.isDirectSource?(c(ke),Ee(ie.qualities||[]),ve(!0)):(c(ke),ve(!1),Ee([])),ie.currentSource&&ie.currentSource!==w&&(F.current=!0,b(ie.currentSource)),ie.availableSources&&P(ie.availableSources),Z(null)}catch(Y){let j="Could not load the video stream.",te=!0;Y.name==="AbortError"?j="Stream request timed out. Please try again.":Y.message.includes("unavailable")?j="All streaming sources are currently unavailable. This is usually temporary.":Y.message.includes("503")?j="Streaming service is temporarily down. Please try again in a few minutes.":Y.message.includes("404")?j="This content is not available from the current source.":Y.message.includes("NetworkError")||Y.message.includes("fetch")?j="Network connection issue. Please check your internet and try again.":j="Unable to load video stream. This might be due to leaving and returning to the browser.",Z({message:j,canRetry:te}),c(""),ve(!1)}})()},[J,E,p,m,w,B]),ee(()=>{if(Oe&&e){const k=`${J}-${E}-${p}-${m}`,M=Date.now(),R=window.lastHistoryUpdate||{};(!R[k]||M-R[k]>5e3)&&(console.log("📝 Adding immediate watch history entry:",{mediaId:J,type:E,season:p,episode:m,title:e.title||e.name}),Jc({...e,id:e.id,type:E,season:p,episode:m}).then(()=>{console.log("✅ Watch history entry added successfully")}).catch(X=>{console.error("❌ Failed to add watch history entry:",X)}),window.lastHistoryUpdate={...R,[k]:M})}},[Oe,e,E,p,m,J]),ee(()=>{if(Oe&&console.log("🔐 Progress tracking setup:",{hasUser:!0,userId:Oe.id,hasMediaDetails:!!e}),!Oe||!e){Oe&&!e&&console.log("⚠️ Progress tracking disabled - media details not yet available");return}const k=async(R,X)=>{console.log(`📊 Progress update received via ${X}:`,R);const oe=R.season||p,Y=R.episode||m;if(R&&R.progress>=0&&R.duration>0){const j=Date.now(),te=`${J}-${E}-${oe}-${Y}`,ie=window.lastProgressSave||{};!ie[te]||j-ie[te]>5e3?(console.log(`🎬 Attempting to save progress for ${E} ${J}:`,{progress:R.progress,duration:R.duration,season:oe,episode:Y}),await zs({...e,id:e.id,type:E,season:oe,episode:Y},R.progress,R.duration)?(console.log("✅ Progress saved successfully"),window.lastProgressSave={...ie,[te]:j},oe===p&&Y===m&&(E==="movie"?$e({progress_seconds:R.progress,duration_seconds:R.duration}):(E==="tv"||E==="anime")&&Ue(Ye=>{const Ce=[...Ye],Qe=Ce.findIndex(Pt=>Pt.season_number===oe&&Pt.episode_number===Y),Tt={media_id:parseInt(J,10),media_type:E,season_number:oe,episode_number:Y,progress_seconds:R.progress,duration_seconds:R.duration};return Qe>-1?Ce[Qe]={...Ce[Qe],...Tt}:Ce.push(Tt),Ce}))):console.error("❌ Failed to save progress")):console.log("⏭️ Progress save skipped (too recent):",{timeSinceLastSave:j-ie[te],threshold:5e3}),R.duration-R.progress}else console.log("⚠️ Progress update ignored (insufficient data):",{hasProgressData:!!R,progress:R?.progress,duration:R?.duration,meetsThreshold:R?.progress>=0&&R?.duration>0})};let M;if(ce){const R=xe.current;if(!R)return;const X=async()=>{const Y=await hr(J,E,p,m);Y&&Y.progress_seconds&&(R.currentTime=Y.progress_seconds)},oe=async()=>{if(R.currentTime>0){const Y=Date.now(),j=`${J}-${E}-${p}-${m}`,te=window.lastProgressSave||{};if(!te[j]||Y-te[j]>5e3){const ie={progress:Math.round(R.currentTime),duration:Math.round(R.duration),percentage:R.duration>0?R.currentTime/R.duration*100:0};console.log("🎬 Direct video - saving progress:",ie),await zs({...e,id:e.id,type:E,season:p,episode:m},ie.progress,ie.duration)?(console.log("✅ Direct video progress saved successfully"),window.lastProgressSave={...te,[j]:Y},E==="movie"?$e({progress_seconds:ie.progress,duration_seconds:ie.duration}):(E==="tv"||E==="anime")&&Ue(Ye=>{const Ce=[...Ye],Qe=Ce.findIndex(Pt=>Pt.season_number===p&&Pt.episode_number===m),Tt={media_id:parseInt(J,10),media_type:E,season_number:p,episode_number:m,progress_seconds:ie.progress,duration_seconds:ie.duration};return Qe>-1?Ce[Qe]={...Ce[Qe],...Tt}:Ce.push(Tt),Ce})):console.error("❌ Failed to save direct video progress")}}};return R.addEventListener("loadedmetadata",X),R.addEventListener("timeupdate",oe),()=>{R.removeEventListener("loadedmetadata",X),R.removeEventListener("timeupdate",oe)}}else{M=X=>{const oe=["player.videasy.net","vidsrc.to","embed.su","vidsrc.xyz","vidsrc.in","vidsrc.pm"],Y=new URL(X.origin);if(oe.includes(Y.hostname))try{const j=typeof X.data=="string"?JSON.parse(X.data):X.data;if(j&&j.type==="PROGRESS_UPDATE"&&j.data){const te={progress:j.data.progress?.watched,duration:j.data.progress?.duration,season:j.data.season||p,episode:j.data.episode||m};k(te,"PROGRESS_UPDATE");return}if(j.type==="MEDIA_DATA"&&j.data){console.warn("Legacy 'MEDIA_DATA' format detected. Player should be updated.");let te=j.data;if(typeof te=="string")try{te=JSON.parse(te)}catch(Ye){console.error("Error parsing double-encoded MEDIA_DATA string:",Ye);return}const ie=`${E}-${J}`,ke=te[ie];if(ke&&ke.progress){const Ye={progress:ke.progress.watched,duration:ke.progress.duration,season:ke.last_season_watched,episode:ke.last_episode_watched};k(Ye,"MEDIA_DATA")}return}if(j.type==="PLAYER_EVENT"&&j.data)if(j.data.event==="timeupdate"){const te={progress:j.data.time,duration:j.data.duration};te.progress&&te.duration&&k(te,"PLAYER_EVENT")}else j.data.event==="ended"&&(E==="tv"||E==="anime")?console.log('Player reported "ended" event - Videasy will handle next episode automatically.'):j.data.event==="player_ready"&&(console.log("Player is ready."),y(!0))}catch(j){console.error("Error processing message from player:",{origin:X.origin,data:X.data,error:j.message})}},window.addEventListener("message",M);const R=setTimeout(()=>{U||(console.log("Player ready timeout, starting fallback progress tracking."),aa())},5e3);return()=>{window.removeEventListener("message",M),clearTimeout(R)}}},[Oe,e,ce,xe,p,m,U]);const aa=()=>{const k=setInterval(()=>{document.hasFocus()&&console.log("Fallback: Checking for progress...")},15e3);return()=>clearInterval(k)};if(u)return l("div",{class:"loading-state",children:[l("div",{class:"loading-spinner"}),l("p",{children:"Loading media details..."})]});if(!e)return l("div",{class:"container",children:l("div",{class:"error-state",children:[l("h2",{children:"Unable to Load Media"}),l("p",{children:"We couldn't load the details for this content. This could be due to:"}),l("ul",{children:[l("li",{children:"Network connectivity issues"}),l("li",{children:"The content may no longer be available"}),l("li",{children:"Server maintenance"})]}),l("button",{onClick:()=>window.location.reload(),class:"btn btn-primary",style:{marginTop:"20px"},children:"Try Again"})]})});const{title:rr,name:nr,overview:la,vote_average:Yu,release_date:ns,first_air_date:ss,runtime:is,number_of_seasons:os,genres:as,poster_path:ls}=e,sr=oa(e.id),cs=ns||ss?new Date(ns||ss).getFullYear():"",ca=()=>{sr?ia(e):sa({...e,type:E})};return l("div",{children:[l(Qt,{children:l("title",{children:[rr||nr," - FreeStream"]})}),l("div",{class:"player-container",children:[!a&&W&&l("div",{class:"stream-error-message",children:[l("p",{children:W.message}),W.canRetry&&l("div",{class:"error-actions",children:[l("button",{onClick:async()=>{se(!0),setTimeout(()=>{(async()=>{const M=`${be}/stream-url?type=${E}&id=${J}&source=${w}${E==="tv"||E==="anime"?`&season=${p}&episode=${m}`:""}${E==="anime"?`&dub=${B}`:""}`;try{const R=await fetch(M),X=await R.json();if(R.ok)c(X.url),ve(X.isDirectSource),Ee(X.qualities||[]),Z(null);else throw new Error(X.message)}catch(R){console.error("Retry failed:",R),Z({message:"Retry failed. Please try selecting a different source.",canRetry:!0})}se(!1)})()},1e3)},disabled:ae,class:"btn retry-btn",children:ae?"Retrying...":"Retry"}),l("p",{children:"Or try selecting a different source from the list below."})]})]}),!a&&!W&&l("div",{class:"stream-loading",children:l("p",{children:"Loading video stream..."})}),ce?l("video",{ref:xe,src:a,controls:!0,autoPlay:!0,width:"100%"}):a&&l("iframe",{src:a,width:"100%",height:"100%",style:{position:"absolute",top:0,left:0,width:"100%",height:"100%"},frameBorder:"0",allowFullScreen:!0,allow:"autoplay; picture-in-picture",sandbox:"allow-forms allow-pointer-lock allow-same-origin allow-scripts allow-top-navigation",title:"Video Player",loading:"eager",referrerPolicy:"no-referrer-when-downgrade",importance:"high",onLoad:()=>{console.log("🎬 Player iframe loaded"),y(!0),w!=="videasy"&&$>30?setTimeout(()=>{const k=document.querySelector("iframe");if(k&&k.contentWindow)try{k.contentWindow.postMessage({type:"SEEK_TO",time:$},"*"),console.log(`📍 Sent seek command to restore progress: ${$}s`)}catch(M){console.log("Could not send seek command:",M)}},500):console.log(w==="videasy"?"📍 Videasy native resume - no seeking needed":"📍 No significant progress to resume, starting from beginning")}})]}),l("div",{class:"container",children:[l("div",{class:"media-details-layout",children:[l("div",{class:"poster",children:[l("img",{src:Un(ls?`${Ln}${ls}`:"https://via.placeholder.com/500x750.png?text=No+Image"),alt:rr||nr}),ts>0&&l("div",{class:"movie-progress-container",children:[l("div",{class:"movie-progress-bar",children:l("div",{class:"movie-progress",style:{width:`${Math.max(2,ts)}%`}})}),l("div",{class:"movie-progress-text",children:pe.duration_seconds>0?`${Math.floor(pe.progress_seconds/60)}m / ${Math.floor(pe.duration_seconds/60)}m watched`:`${Math.floor(pe.progress_seconds/60)}m watched`})]})]}),l("div",{class:"details",children:[l("div",{class:"title-container",children:[l("h1",{children:rr||nr}),l("button",{onClick:ca,class:`favorite-btn ${sr?"favorited":""}`,disabled:!es,children:es?sr?"♥ Favorited":"♡ Favorite":"..."}),!Oe&&l("span",{class:"login-hint",children:l("small",{children:[l("a",{href:"/login",style:{color:"#007bff",textDecoration:"none"},children:"Log in"})," to save favorites, track progress & continue watching"]})})]}),l("div",{class:"meta",children:[l("span",{class:"rating",children:["★ ",e.vote_average?e.vote_average.toFixed(1):"N/A"]}),cs&&l("span",{children:cs}),is&&l("span",{children:[is," min"]}),os&&l("span",{children:[os," Seasons"]})]}),l("div",{class:"genres",children:as&&as.map(k=>l("span",{class:"genre-tag",children:k.name}))}),l("p",{class:"overview",children:la}),_e.length>0&&l("div",{class:"quality-selector",children:[l("label",{children:"Quality:"}),_e.map(k=>l("button",{class:`quality-btn ${a===k.url?"active":""}`,onClick:()=>c(k.url),children:[k.quality,"p"]}))]})]})]}),E==="anime"&&l("div",{class:"select-container",children:[l("label",{for:"dub-select",children:"Audio:"}),l("select",{id:"dub-select",value:B,onChange:k=>G(k.target.value==="true"),children:[l("option",{value:"false",children:"Subbed"}),l("option",{value:"true",children:"Dubbed"})]})]}),l("div",{class:"selectors-container",children:[(E==="tv"||E==="anime")&&e&&e.seasons&&l("div",{class:"select-container",children:[l("label",{children:"Season:"}),l("div",{class:"selector-buttons",children:e.seasons.filter(k=>k.season_number>0).map(k=>l("button",{class:`selector-btn ${p===k.season_number?"active":""}`,onClick:()=>{console.log(`🎯 User manually selected season ${k.season_number}`),ue.current=!0,Te.current=null;const M=`/watch/${E}/${J}/season/${k.season_number}/episode/1`;Ae(M,!0)},children:k.name},k.id))})]}),_.length>1&&l("div",{class:"select-container",children:[l("label",{children:"Source:"}),l("div",{class:"selector-buttons",children:_.map(k=>l("button",{class:`selector-btn ${w===k?"active":""}`,onClick:()=>b(k),children:k},k))})]})]}),(E==="tv"||E==="anime")&&p!==null&&m!==null&&l("div",{class:"episodes-container",children:[l("h3",{children:"Episodes"}),q?l("div",{class:"loading-spinner"}):l(gt,{children:[l("div",{class:"episode-list",children:C?.episodes?.slice((O-1)*A,O*A)?.map(k=>{const M=Et.find(X=>X.season_number===p&&X.episode_number===k.episode_number),R=M&&M.progress_seconds>0?M.duration_seconds&&M.duration_seconds>0?Math.min(100,M.progress_seconds/M.duration_seconds*100):M.progress_seconds>30?5:2:0;return l("div",{class:`episode-card ${k.episode_number===m?"active":""}`,onClick:()=>{console.log(`🎯 User manually selected episode ${k.episode_number}`),ue.current=!0,Te.current=null;const X=`/watch/${E}/${J}/season/${p}/episode/${k.episode_number}`;Ae(X,!0)},children:[l("div",{class:"episode-card-image",children:[l("img",{src:Un(k.still_path?`${Ln}${k.still_path}`:`https://via.placeholder.com/300x169.png?text=${encodeURIComponent(k.name)}`),alt:k.name}),l("div",{class:"episode-number-badge",children:k.episode_number}),R>0&&l("div",{class:"episode-progress-bar",children:l("div",{class:"episode-progress",style:{width:`${Math.max(2,R)}%`}})})]}),l("div",{class:"episode-card-content",children:[l("h4",{children:k.name}),l("p",{class:"episode-overview",children:k.overview})]})]},k.id)})}),C?.episodes&&C.episodes.length>A&&l("div",{class:"pagination-controls",children:[l("button",{class:"pagination-btn",onClick:()=>I(k=>Math.max(1,k-1)),disabled:O===1,children:"← Previous"}),l("div",{class:"pagination-info",children:[l("span",{class:"page-numbers",children:Array.from({length:Math.ceil(C.episodes.length/A)},(k,M)=>M+1).map(k=>l("button",{class:`page-number ${k===O?"active":""}`,onClick:()=>I(k),children:k},k))}),l("span",{class:"page-text",children:["Page ",O," of ",Math.ceil(C.episodes.length/A),"(",C.episodes.length," episodes)"]})]}),l("button",{class:"pagination-btn",onClick:()=>I(k=>Math.min(Math.ceil(C.episodes.length/A),k+1)),disabled:O===Math.ceil(C.episodes.length/A),children:"Next →"})]})]})]}),i.length>0&&l("div",{class:"recommendations",children:[l("h2",{children:"More Like This"}),l("div",{class:"movie-grid",children:i.map(k=>l(_t,{item:k,type:E,progress:null,duration:null},`${k.media_type||E}-${k.id}`))})]})]})]})},Wu=n=>{const[e,t]=N([]),[r,s]=N(!1),[i,o]=N("");ee(()=>{const u=new URLSearchParams(n.url?.split("?")[1]||"").get("q");o(u||""),u?a(u):t([])},[n.url]);const a=async c=>{s(!0);try{const h=await(await fetch(`${be}/tmdb/search/multi?query=${encodeURIComponent(c)}`)).json();if(h&&h.results){const d=h.results.filter(f=>(f.media_type==="movie"||f.media_type==="tv")&&f.poster_path);t(d)}}catch(u){console.error("Error performing search:",u),t([])}finally{s(!1)}};return l("div",{class:"container home-page",children:[l("div",{class:"search-header",children:[l("h1",{class:"main-title",children:"Search Results"}),l("div",{class:"search-query-display",children:[l("span",{class:"search-label",children:"Showing results for:"}),l("span",{class:"search-query",children:['"',i,'"']})]})]}),r?l(Mo,{text:"Searching for movies and TV shows..."}):e.length>0?l("section",{class:"home-section",children:[l("h2",{children:["Found ",e.length," result",e.length!==1?"s":""]}),l("div",{class:"movie-grid",children:e.map(c=>l(_t,{item:c,type:c.media_type,progress:null,duration:null},`${c.media_type}-${c.id}`))})]}):i?l("div",{class:"no-results",children:[l("div",{class:"no-results-icon",children:"🔍"}),l("h3",{children:"No results found"}),l("p",{children:[`We couldn't find anything for "`,i,'". Try searching with different keywords.']}),l("div",{class:"search-suggestions",children:[l("p",{children:"Try searching for:"}),l("ul",{children:[l("li",{children:"Movie or TV show titles"}),l("li",{children:"Actor or director names"}),l("li",{children:'Genre names (e.g., "action", "comedy")'}),l("li",{children:"Keywords from the plot"})]})]})]}):l("div",{class:"search-welcome",children:[l("div",{class:"search-welcome-icon",children:"🎬"}),l("h3",{children:"Start your search"}),l("p",{children:"Use the search bar above to find your favorite movies and TV shows."})]})]})};function Sn(){const[n,e]=N(!1),[t,r]=N(""),[s,i]=N(""),[o,a]=N(!1),[c,u]=N({}),h=async p=>{try{const{error:v}=await K.auth.signInWithOAuth({provider:p});if(v)throw v}catch(v){Fe.error(v.error_description||v.message)}},d=()=>{const p={};return t?/\S+@\S+\.\S+/.test(t)||(p.email="Please enter a valid email"):p.email="Email is required",s?s.length<6&&(p.password="Password must be at least 6 characters"):p.password="Password is required",u(p),Object.keys(p).length===0},f=async p=>{if(p.preventDefault(),!!d())try{e(!0),u({});const{error:v}=await K.auth.signInWithPassword({email:t.trim(),password:s});if(v)throw v;Fe.success("Logged in successfully!"),Ae("/",!0)}catch(v){console.error("Login error:",v),v.message.includes("Invalid login credentials")?u({general:"Invalid email or password"}):v.message.includes("Email not confirmed")?u({general:"Please check your email and confirm your account"}):u({general:v.error_description||v.message})}finally{e(!1)}};return l("div",{className:"auth-container",children:l("div",{className:"auth-form",children:[l("h1",{className:"header",children:"Login"}),l("p",{className:"description",children:"Sign in to your account."}),c.general&&l("div",{className:"error-message",children:c.general}),l("form",{onSubmit:f,noValidate:!0,children:[l("div",{className:"input-group",children:[l("label",{htmlFor:"email",children:"Email"}),l("input",{id:"email",className:`input-field ${c.email?"error":""}`,type:"email",placeholder:"Your email",value:t,onChange:p=>{r(p.target.value),c.email&&u({...c,email:null})},required:!0,"aria-describedby":c.email?"email-error":void 0,"aria-invalid":!!c.email}),c.email&&l("span",{id:"email-error",className:"field-error",role:"alert",children:c.email})]}),l("div",{className:"input-group",children:[l("label",{htmlFor:"password",children:"Password"}),l("div",{className:"password-input-container",children:[l("input",{id:"password",className:`input-field ${c.password?"error":""}`,type:o?"text":"password",placeholder:"Your password",value:s,onChange:p=>{i(p.target.value),c.password&&u({...c,password:null})},required:!0,"aria-describedby":c.password?"password-error":void 0,"aria-invalid":!!c.password}),l("button",{type:"button",className:"password-toggle",onClick:()=>a(!o),"aria-label":o?"Hide password":"Show password",children:o?"Hide":"Show"})]}),c.password&&l("span",{id:"password-error",className:"field-error",role:"alert",children:c.password})]}),l("div",{className:"auth-options",children:l("a",{href:"/forgot-password",className:"auth-link",children:"Forgot password?"})}),l("div",{children:l("button",{className:"button",disabled:n,children:n?l("span",{children:"Signing in..."}):l("span",{children:"Login"})})})]}),l("div",{className:"auth-divider",children:l("span",{children:"OR"})}),l("div",{className:"social-login-group",children:l("button",{type:"button",className:"social-button google",onClick:()=>h("google"),children:"Sign in with Google"})}),l("div",{className:"auth-links",children:l("p",{children:["Don't have an account?",l("a",{href:"/signup",className:"auth-link",children:" Sign up"})]})})]})})}function Hu(){const[n,e]=N(!1),[t,r]=N(""),[s,i]=N(""),o=async c=>{try{const{error:u}=await K.auth.signInWithOAuth({provider:c});if(u)throw u}catch(u){Fe.error(u.error_description||u.message)}};return l("div",{className:"auth-container",children:l("div",{className:"auth-form",children:[l("h1",{className:"header",children:"Create an account"}),l("p",{className:"description",children:"Sign up for a new account."}),l("form",{onSubmit:async c=>{c.preventDefault();try{e(!0);const{error:u}=await K.auth.signUp({email:t,password:s});if(u)throw u;Fe.success("Check your email for the confirmation link!")}catch(u){Fe.error(u.error_description||u.message)}finally{e(!1)}},children:[l("div",{className:"input-group",children:[l("label",{htmlFor:"email",children:"Email"}),l("input",{id:"email",className:"input-field",type:"email",placeholder:"Your email",value:t,onChange:c=>r(c.target.value)})]}),l("div",{className:"input-group",children:[l("label",{htmlFor:"password",children:"Password"}),l("input",{id:"password",className:"input-field",type:"password",placeholder:"Your password",value:s,onChange:c=>i(c.target.value)})]}),l("div",{children:l("button",{className:"button",disabled:n,children:n?l("span",{children:"Loading..."}):l("span",{children:"Sign Up"})})})]}),l("div",{className:"auth-divider",children:l("span",{children:"OR"})}),l("div",{className:"social-login-group",children:l("button",{type:"button",className:"social-button google",onClick:()=>o("google"),children:"Sign up with Google"})}),l("div",{className:"auth-links",children:l("p",{children:["Already have an account?",l("a",{href:"/login",className:"auth-link",children:" Log in"})]})})]})})}function Gu(){const[n,e]=N(!1),[t,r]=N("");return l("div",{className:"auth-container",children:l("div",{className:"auth-form",children:[l("h1",{className:"header",children:"Forgot Password"}),l("p",{className:"description",children:"Enter your email and we'll send you a link to reset your password."}),l("form",{onSubmit:async i=>{i.preventDefault();try{e(!0);const{error:o}=await K.auth.resetPasswordForEmail(t,{redirectTo:`${window.location.origin}/update-password`});if(o)throw o;Fe.success("Password reset link sent! Please check your email.")}catch(o){Fe.error(o.error_description||o.message)}finally{e(!1)}},children:[l("div",{className:"input-group",children:[l("label",{htmlFor:"email",children:"Email"}),l("input",{id:"email",className:"input-field",type:"email",placeholder:"Your email",value:t,onChange:i=>r(i.target.value),required:!0})]}),l("div",{children:l("button",{className:"button",disabled:n,children:n?l("span",{children:"Sending..."}):l("span",{children:"Send Reset Link"})})})]}),l("div",{className:"auth-links",children:l("a",{href:"/login",className:"auth-link",children:["Remembered your password? ",l("span",{children:"Log in"})]})})]})})}function Ku(){const[n,e]=N(!1),[t,r]=N(""),[s,i]=N(""),[o,a]=N(""),[c,u]=N(null);return ee(()=>{K.auth.getSession().then(({data:{session:f}})=>{f?u(f):(Fe.error("You must be logged in to update your password."),Ae("/login",!0))});const{data:{subscription:d}}=K.auth.onAuthStateChange((f,p)=>{u(p)});return()=>d.unsubscribe()},[]),l("div",{className:"auth-container",children:l("div",{className:"auth-form",children:[l("h1",{className:"header",children:"Update Password"}),l("p",{className:"description",children:"Enter a new password for your account."}),o&&l("div",{className:"error-message",children:o}),l("form",{onSubmit:async d=>{if(d.preventDefault(),a(""),t!==s){a("Passwords do not match.");return}if(t.length<6){a("Password must be at least 6 characters long.");return}try{e(!0);const{error:f}=await K.auth.updateUser({password:t});if(f)throw f;Fe.success("Password updated successfully!"),Ae("/",!0)}catch(f){a(f.error_description||f.message)}finally{e(!1)}},children:[l("div",{className:"input-group",children:[l("label",{htmlFor:"password",children:"New Password"}),l("input",{id:"password",className:"input-field",type:"password",placeholder:"Your new password",value:t,onChange:d=>r(d.target.value),required:!0})]}),l("div",{className:"input-group",children:[l("label",{htmlFor:"confirm-password",children:"Confirm New Password"}),l("input",{id:"confirm-password",className:"input-field",type:"password",placeholder:"Confirm your new password",value:s,onChange:d=>i(d.target.value),required:!0})]}),l("div",{children:l("button",{className:"button",disabled:n,children:n?l("span",{children:"Updating..."}):l("span",{children:"Update Password"})})})]})]})})}const Vu=()=>{const[n,e]=N(!1);return ee(()=>{const r=()=>{window.pageYOffset>300?e(!0):e(!1)};return window.addEventListener("scroll",r),()=>window.removeEventListener("scroll",r)},[]),l("button",{class:`scroll-to-top ${n?"visible":""}`,onClick:()=>{window.scrollTo({top:0,behavior:"smooth"})},"aria-label":"Scroll to top",children:l("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:l("path",{d:"M18 15l-6-6-6 6"})})})},zu=()=>{const{user:n}=Ve(),e=qe(i=>i.fetchFavorites),t=qe(i=>i.favoritesFetched),r=qe(i=>i.fetchContinueWatching),s=qe(i=>i.continueWatchingFetched);return ee(()=>{n&&(t||e(),s||r())},[n,t,e,s,r]),l("div",{class:"app",children:[l(Nc,{position:"top-center"}),l(tu,{}),l("main",{children:l(fo,{history:ka(),children:[l(fr,{path:"/"}),l(fr,{path:"/movies"}),l(fr,{path:"/tv"}),n?l(Fu,{path:"/favorites"}):l(Sn,{path:"/favorites"}),n?l(Bu,{path:"/history"}):l(Sn,{path:"/history"}),l(io,{path:"/watch/:type/:id"}),l(io,{path:"/watch/:type/:id/season/:season/episode/:episode"}),l(Wu,{path:"/search"}),l(Sn,{path:"/login"}),l(Hu,{path:"/signup"}),l(Gu,{path:"/forgot-password"}),l(Ku,{path:"/update-password"})]})}),l(nu,{}),l(Vu,{})]})},Ju=()=>(ee(()=>{Uc()},[]),l(Ic,{children:l(zu,{})}));pa(l(Ju,{}),document.getElementById("app"));
//# sourceMappingURL=index-Btp1h_Ne.js.map
