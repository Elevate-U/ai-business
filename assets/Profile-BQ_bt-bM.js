import{a as D,u as e,l as c,s as f,e as s}from"./index-Dg7sRPgL.js";import{d as i,A as S,y as I}from"./react-vendor-BYlzYzcd.js";const m=(a,t)=>a?.avatar_url?c(a.avatar_url):t?.user_metadata?.picture?c(t.user_metadata.picture):t?.user_metadata?.avatar_url?c(t.user_metadata.avatar_url):"/assets/default-avatar.png",$=()=>{const{user:a,profile:t,refreshProfile:A}=D(),[p,o]=i(t?.full_name||""),[U,u]=i(m(t,a)),[d,w]=i(null),[h,v]=i(!1),[x,g]=i(!0),C=S();return I(()=>{t?(o(t.full_name||""),u(m(t,a)),g(!1)):a&&(o(a.user_metadata?.full_name||""),u(m(null,a)),g(!1))},[t,a]),a?x?e("div",{className:"profile-container",children:e("div",{className:"profile-form",children:e("h2",{children:"Loading profile..."})})}):e("div",{className:"profile-container",children:e("div",{className:"profile-form",style:{maxWidth:420},children:e("form",{onSubmit:async l=>{l.preventDefault(),v(!0);try{let r=null;if(d){const P=d.name.split(".").pop(),N=`avatars/${a.id}/${Date.now()}.${P}`,{error:_}=await f.storage.from("avatars").upload(N,d,{upsert:!0,cacheControl:"3600"});if(_)throw _;const{data:F}=f.storage.from("avatars").getPublicUrl(N);r=F.publicUrl}const n={data:{full_name:p,...r&&{avatar_url:r}}},{data:{user:y},error:b}=await f.auth.updateUser(n);if(b)throw b;await A(),s.success("Profile updated successfully!")}catch(r){console.error("Profile update failed:",r),s.error(r.message||"An error occurred while updating your profile.")}finally{v(!1)}},children:[e("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",marginBottom:24},children:e("label",{htmlFor:"avatar-upload",style:{cursor:"pointer"},children:[e("img",{src:U,alt:"Profile avatar",style:{width:96,height:96,borderRadius:"50%",objectFit:"cover",marginBottom:8,border:"2px solid var(--brand-primary)"}}),e("input",{id:"avatar-upload",type:"file",accept:"image/*",style:{display:"none"},ref:C,onChange:l=>{const r=l.target.files[0];if(!r)return;if(!r.type.startsWith("image/")){s.error("Please select a valid image file.");return}if(r.size>50*1024*1024){s.error("Avatar must be less than 50MB.");return}w(r);const n=new FileReader;n.onload=y=>u(y.target.result),n.readAsDataURL(r)},"aria-label":"Change profile picture"}),e("div",{style:{color:"var(--brand-primary)",fontSize:14,textAlign:"center"},children:"Change Avatar"})]})}),e("div",{className:"input-group",children:[e("label",{htmlFor:"full-name",children:"Full Name"}),e("input",{id:"full-name",className:"input-field",type:"text",value:p,onInput:l=>o(l.target.value),placeholder:"Your name",maxLength:40,required:!0})]}),e("div",{className:"input-group",children:[e("label",{children:"Email"}),e("input",{className:"input-field",type:"email",value:a.email,disabled:!0,readOnly:!0})]}),e("button",{className:"button",type:"submit",disabled:h,style:{marginTop:16},children:h?"Saving...":"Save Changes"})]})})}):e("div",{className:"profile-container",children:e("div",{className:"profile-form",children:e("h2",{children:"Not logged in"})})})};export{$ as default};
//# sourceMappingURL=Profile-BQ_bt-bM.js.map
