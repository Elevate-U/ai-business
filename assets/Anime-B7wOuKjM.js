import{a as ee,b as ne,u as e,$ as se,k as F,A as Q,f as X,L as me}from"./index-BkQRV82z.js";import{d as v,A as pe,y as M,q as H}from"./react-vendor-BYlzYzcd.js";/* empty css                  *//* empty css             */const Z=({item:s,progress:w,duration:S,showDeleteButton:U,onDelete:I,onClick:T})=>{const[k,W]=v(!1),h=pe(null);M(()=>{const n=new IntersectionObserver(([a])=>{W(a.isIntersecting)},{rootMargin:"50px",threshold:.1});return h.current&&n.observe(h.current),()=>{h.current&&n.unobserve(h.current)}},[]);const{id:O,title:b,poster_path:N,overview:G,vote_average:C,first_air_date:c,status:A,episodes:E,format:y,nextAiringEpisode:_,studios:m,genres:p,season:R,seasonYear:$,source:L,meanScore:V,favourites:i,tags:t,trailer:r,isAdult:o,duration:l,season_number:P,episode_number:f,episode_name:g}=s,j=b?.english||b?.romaji||b||s.name||"Unknown Anime",z=w&&S>0?w/S*100:0,Y=c?new Date(c).getFullYear():$,{user:D}=ee(),{addFavorite:ie,removeFavorite:te,isShowFavorited:ae,favoritesFetched:re}=ne(),B=ae(s.id||s.anilist_id,"anime",s.season_number,s.episode_number),oe=n=>{n.preventDefault(),n.stopPropagation(),D&&(B?te(D.id,s.id||s.anilist_id,"anime",s.season_number,s.episode_number):ie(D.id,{...s,type:"anime"}))},q=n=>{if(n.preventDefault(),n.stopPropagation(),console.log("AnimeCard clicked:",s),T)T(s);else{let a;if(s.source==="tmdb"){const d=s.media_type||"tv",u=s.tmdb_id||s.id;a=`/watch/${d}/${u}`,d==="tv"&&(s.season_number&&s.episode_number?a+=`/season/${s.season_number}/episode/${s.episode_number}`:a+="/season/1/episode/1")}else a=`/watch/anime/${s.anilist_id||s.id}`,s.season_number&&s.episode_number?a+=`/season/${s.season_number}/episode/${s.episode_number}`:a+="/season/1/episode/1";if(s.source!=="tmdb"||s.media_type==="tv"){const d=localStorage.getItem("anime-audio-preference")||"subbed",u=new URLSearchParams;d==="dubbed"&&u.set("dub","true"),u.toString()&&(a+=`?${u.toString()}`)}console.log("Routing to:",a),se(a)}},K=(()=>{if(P&&f)return`S${P} E${f}${g?`: ${g}`:""}`;const n=[];return Y&&n.push(Y.toString()),E&&n.push(`${E} episodes`),y&&y!=="TV"&&n.push(y),A==="RELEASING"&&n.push("Airing"),n.length>0?n.join(" • "):"Anime"})(),ce=()=>{if(!A)return null;const a={RELEASING:{text:"Airing",class:"airing"},FINISHED:{text:"Completed",class:"completed"},NOT_YET_RELEASED:{text:"Upcoming",class:"upcoming"},CANCELLED:{text:"Cancelled",class:"cancelled"},HIATUS:{text:"Hiatus",class:"hiatus"}}[A];return a?e("div",{className:`anime-status-badge ${a.class}`,children:a.text}):null},le=()=>{if(!_||A!=="RELEASING")return null;const n=_.timeUntilAiring;if(n<=0)return null;const a=Math.floor(n/(24*60*60)),d=Math.floor(n%(24*60*60)/(60*60)),u=Math.floor(n%(60*60)/60);let x="";return a>0?x=`${a}d ${d}h`:d>0?x=`${d}h ${u}m`:u>0?x=`${u}m`:x="Soon",e("div",{className:"next-episode-info",children:[e("span",{className:"next-ep-label",children:["Ep ",_.episode]}),e("span",{className:"next-ep-time",children:["in ",x]})]})},J=()=>{if(!m||m.length===0)return null;const n=m.find(a=>a.isMain)||m[0];return n?.name||n},de=()=>!p||p.length===0?null:p.slice(0,2).map(n=>e("span",{className:"genre-tag",children:n},n)),ue=n=>n?n.includes("anilist.co")||n.includes("anili.st")||n.includes("anilistcdn")?F(n):n.startsWith("http")?F(n):n.startsWith("/")?F(`${`https://image.tmdb.org/t/p/${k?"w500":"w200"}`}${n}`):F(n):"https://via.placeholder.com/500x750/1a1a1a/ffffff?text=No+Image",he=()=>{const n=V||C;return n?(n>10?n/10:n).toFixed(1):"N/A"};return e("div",{className:"anime-card-container",ref:h,children:e("div",{className:"anime-card",onClick:q,style:{cursor:"pointer"},role:"button",tabIndex:0,onKeyDown:n=>{(n.key==="Enter"||n.key===" ")&&(n.preventDefault(),q(n))},children:e("div",{className:"anime-poster-wrapper",children:[e("img",{src:ue(N),alt:j,loading:"lazy",width:"500",height:"750"}),e("div",{className:"anime-scrim"}),ce(),z>.01&&e("div",{className:"anime-progress-container",children:e("div",{className:"anime-progress-bar",style:{width:`${Math.min(z,100)}%`}})}),e("div",{className:"streaming-indicator",children:e("span",{className:`source-badge ${(s.source||"tmdb")==="anilist"?"anilist":"tmdb"}`,children:(s.source||"tmdb")==="anilist"?"AniList":"TMDB"})}),e("div",{className:"anime-card-info",children:[e("div",{className:"anime-title-row",children:[e("h3",{className:"anime-card-title",children:j}),D&&e("button",{className:`anime-favorite-btn ${B?"favorited":""}`,onClick:oe,"aria-label":B?"Remove from favorites":"Add to favorites",disabled:!re,children:"♥︎"})]}),K&&e("p",{className:"anime-card-subtitle",children:K}),le(),J()&&e("p",{className:"anime-studio-info",children:J()}),p&&p.length>0&&e("div",{className:"anime-genre-tags",children:de()}),e("div",{className:"anime-rating-row",children:[e("span",{className:"anime-rating",children:["★ ",he()]}),i&&e("span",{className:"anime-favorites",children:["♥ ",i.toLocaleString()]})]})]}),U&&e("button",{className:"anime-delete-btn",onClick:n=>{n.preventDefault(),n.stopPropagation(),I&&I(s)},"aria-label":"Remove from continue watching",children:"×"})]})})})},ye=()=>{const[s,w]=v(!0),[S,U]=v([]),[I,T]=v([]),[k,W]=v([]),[h,O]=v([]),[b,N]=v(null),[G,C]=v(!0),{user:c}=ee(),{continueWatching:A,continueWatchingFetched:E,fetchContinueWatching:y}=ne();M(()=>{c&&!E&&y(c.id)},[c,E,y]);const _=A.filter(i=>i.type==="anime"),m=H(async(i=3)=>{try{const t=await fetch(`${Q}/trending/anime/combined`);if(!t.ok)throw new Error(`API error: ${t.status}`);return t.json()}catch(t){return console.error("Error fetching combined anime data:",t),i>0?(await new Promise(r=>setTimeout(r,1e3*(4-i))),m(i-1)):null}},[]),p=H(async i=>{let t,r,o;if(i.source==="tmdb"){if(t=i.media_type||"tv",r=i.tmdb_id||i.id,o=`/watch/${t}/${r}`,t==="tv")if(c){const l=await X(c.id,r);l?o+=`/season/${l.season}/episode/${l.episode}`:o+="/season/1/episode/1"}else o+="/season/1/episode/1"}else if(t="anime",r=i.anilist_id||i.id,o=`/watch/anime/${r}`,c){const l=await X(c.id,r);l?o+=`/season/${l.season}/episode/${l.episode}`:o+="/season/1/episode/1"}else o+="/season/1/episode/1";se(o)},[c]),R=H(async()=>{try{const i=await fetch(`${Q}/health/videasy`,{method:"GET",signal:AbortSignal.timeout(5e3)});C(i.ok)}catch(i){console.warn("Videasy availability check failed:",i),C(!1)}},[]);M(()=>{R()},[R]),M(()=>{(async()=>{w(!0),N(null);try{const t=await m();if(t){const r=f=>f.filter(g=>g.poster_path);U(r(t.combined||[]).slice(0,20)),T(r(t.seasonal||[]));const o=r(t.combined||[]),l=[...o].sort((f,g)=>(g.popularity||0)-(f.popularity||0));W(l.slice(0,20));const P=[...o].sort((f,g)=>(g.vote_average||0)-(f.vote_average||0));O(P.slice(0,20))}else throw new Error("Failed to fetch any anime data.")}catch(t){console.error("Error fetching anime data:",t),N("Failed to load anime data. Please refresh the page.")}finally{w(!1)}})()},[m]);const $=(i,t)=>!t||t.length===0?null:e("section",{class:"home-section",children:[e("h2",{children:i}),e("div",{class:"scrolling-row",children:t.map(r=>e(Z,{item:r,onClick:()=>p(r)},`${i}-${r.id}`))})]}),L=()=>e("div",{class:"service-status",children:e("div",{class:`status-indicator ${G?"online":"offline"}`,children:[e("span",{class:"status-dot"}),"Videasy: ",G?"Online":"Offline"]})}),V=({error:i,onRetry:t})=>e("div",{class:"error-container",children:[e("div",{class:"error-message",children:[e("h3",{children:"Something went wrong"}),e("p",{children:i}),e("button",{onClick:t,class:"retry-button",children:"Try Again"})]}),e(L,{})]});return s?e("div",{class:"container home-page anime-page",children:[e("h1",{class:"main-title",children:"Anime"}),e(L,{}),e(me,{text:"Loading anime..."})]}):b?e("div",{class:"container home-page anime-page",children:[e("h1",{class:"main-title",children:"Anime"}),e(V,{error:b,onRetry:()=>{N(null),R()}})]}):e("div",{class:"container home-page anime-page",children:[e("h1",{class:"main-title",children:"Anime"}),e("div",{class:"anime-controls",children:e(L,{})}),_.length>0&&e("section",{class:"home-section",children:[e("h2",{children:"Continue Watching"}),e("div",{class:"scrolling-row scrolling-row--compact",children:_.map(i=>e(Z,{item:i,progress:i.progress_seconds,duration:i.duration_seconds,onClick:()=>p(i)},`continue-watching-${i.id}`))})]}),$("Trending Now",S),$("This Season",I),$("Popular Anime",k),$("Top Rated Anime",h),!s&&S.length===0&&k.length===0&&h.length===0&&e("div",{class:"no-content",children:[e("h3",{children:"No anime content available"}),e("p",{children:"Please check your connection and try again."})]})]})};export{ye as default};
//# sourceMappingURL=Anime-B7wOuKjM.js.map
